{"version":3,"sources":["webpack:///@uirouter/core/transition/rejectFactory.ts","webpack:///@uirouter/core/common/glob.ts","webpack:///@uirouter/core/common/queue.ts","webpack:///@uirouter/core/common/strings.ts","webpack:///@uirouter/core/common/trace.ts","webpack:///@uirouter/core/params/paramType.ts","webpack:///@uirouter/core/params/param.ts","webpack:///@uirouter/core/params/paramTypes.ts","webpack:///@uirouter/core/params/stateParams.ts","webpack:///@uirouter/core/path/pathNode.ts","webpack:///@uirouter/core/state/targetState.ts","webpack:///@uirouter/core/path/pathUtils.ts","webpack:///@uirouter/core/resolve/interface.ts","webpack:///@uirouter/core/resolve/resolvable.ts","webpack:///@uirouter/core/resolve/resolveContext.ts","webpack:///@uirouter/core/state/stateBuilder.ts","webpack:///@uirouter/core/transition/interface.ts","webpack:///@uirouter/core/state/stateObject.ts","webpack:///@uirouter/core/state/stateMatcher.ts","webpack:///@uirouter/core/state/stateQueueManager.ts","webpack:///@uirouter/core/state/stateRegistry.ts","webpack:///@uirouter/core/transition/transitionHook.ts","webpack:///@uirouter/core/transition/hookRegistry.ts","webpack:///@uirouter/core/transition/hookBuilder.ts","webpack:///@uirouter/core/transition/transition.ts","webpack:///@uirouter/core/url/urlMatcher.ts","webpack:///@uirouter/core/url/urlMatcherFactory.ts","webpack:///@uirouter/core/url/urlRule.ts","webpack:///@uirouter/core/url/urlRouter.ts","webpack:///@uirouter/core/view/view.ts","webpack:///@uirouter/core/globals.ts","webpack:///@uirouter/core/url/urlService.ts","webpack:///@uirouter/core/router.ts","webpack:///@uirouter/core/hooks/coreResolvables.ts","webpack:///@uirouter/core/hooks/redirectTo.ts","webpack:///@uirouter/core/hooks/onEnterExitRetain.ts","webpack:///@uirouter/core/hooks/resolve.ts","webpack:///@uirouter/core/hooks/views.ts","webpack:///@uirouter/core/hooks/updateGlobals.ts","webpack:///@uirouter/core/hooks/url.ts","webpack:///@uirouter/core/hooks/lazyLoad.ts","webpack:///@uirouter/core/transition/transitionEventType.ts","webpack:///@uirouter/core/hooks/ignoredTransition.ts","webpack:///@uirouter/core/hooks/invalidTransition.ts","webpack:///@uirouter/core/transition/transitionService.ts","webpack:///@uirouter/core/state/stateService.ts","webpack:///@uirouter/core/vanilla/q.ts","webpack:///@uirouter/core/vanilla/injector.ts","webpack:///@uirouter/core/vanilla/utils.ts","webpack:///@uirouter/core/vanilla/baseLocationService.ts","webpack:///@uirouter/core/vanilla/hashLocationService.ts","webpack:///@uirouter/core/vanilla/memoryLocationService.ts","webpack:///@uirouter/core/vanilla/pushStateLocationService.ts","webpack:///@uirouter/core/vanilla/memoryLocationConfig.ts","webpack:///@uirouter/core/vanilla/browserLocationConfig.ts","webpack:///@uirouter/core/vanilla/plugins.ts","webpack:///@uirouter/core/interface.ts","webpack:///./node_modules/bike-app/router.js","webpack:///./node_modules/bike-app/bike-app.js","webpack:///./node_modules/bike-app/index.js","webpack:///@uirouter/core/common/common.ts","webpack:///@uirouter/core/common/predicates.ts","webpack:///@uirouter/core/common/hof.ts","webpack:///@uirouter/core/common/coreservices.ts","webpack:///webpack://@uirouter/visualizer/webpack/universalModuleDefinition","webpack:///webpack://@uirouter/visualizer/webpack/bootstrap","webpack:///webpack://@uirouter/visualizer/node_modules/preact/dist/preact.esm.js","webpack:///webpack://@uirouter/visualizer/src/util/easing.ts","webpack:///webpack://@uirouter/visualizer/src/statevis/renderers.tsx","webpack:///webpack://@uirouter/visualizer/src/util/strings.ts","webpack:///webpack://@uirouter/visualizer/src/selector/StateSelector.tsx","webpack:///webpack://@uirouter/visualizer/src/util/toggleClass.ts","webpack:///webpack://@uirouter/visualizer/src/statevis/tree/StateTree.tsx","webpack:///webpack://@uirouter/visualizer/src/util/animatepath.ts","webpack:///webpack://@uirouter/visualizer/node_modules/css-loader/lib/css-base.js","webpack:///webpack://@uirouter/visualizer/node_modules/style-loader/lib/addStyles.js","webpack:///webpack://@uirouter/visualizer/src/transition/KeysAndValues.tsx","webpack:///webpack://@uirouter/visualizer/src/util/modal.tsx","webpack:///webpack://@uirouter/visualizer/src/visualizer.ts","webpack:///webpack://@uirouter/visualizer/src/statevis/StateVisualizer.tsx","webpack:///webpack://@uirouter/visualizer/src/util/draggable.ts","webpack:///webpack://@uirouter/visualizer/src/statevis/tree/StateNode.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/tree/stateVisNode.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/Controls.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/LayoutPrefs.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/icons/ChevronDown.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/icons/Close.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/icons/Gear.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/icons/Help.tsx","webpack:///webpack://@uirouter/visualizer/images/16/chevron-down.png","webpack:///webpack://@uirouter/visualizer/src/statevis/StateVisWindow.tsx","webpack:///webpack://@uirouter/visualizer/src/statevis/statevis.css?dbbf","webpack:///webpack://@uirouter/visualizer/src/statevis/statevis.css","webpack:///webpack://@uirouter/visualizer/node_modules/style-loader/lib/urls.js","webpack:///webpack://@uirouter/visualizer/src/transition/TransitionVisualizer.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/TransitionView.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/TransitionPopover.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/PopoverHeading.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/TransSummary.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/ResolveData.tsx","webpack:///webpack://@uirouter/visualizer/src/util/pretty.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/NodePaths.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/NodeDetail.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/FlowArrow.tsx","webpack:///webpack://@uirouter/visualizer/src/transition/BreadcrumbArrow.tsx","webpack:///webpack://@uirouter/visualizer/src/util/cancelablePromise.ts","webpack:///webpack://@uirouter/visualizer/src/transition/transitionVisualizer.css?95a7","webpack:///webpack://@uirouter/visualizer/src/transition/transitionVisualizer.css","webpack:///webpack://@uirouter/visualizer/node_modules/css-loader/lib/url/escape.js","webpack:///webpack://@uirouter/visualizer/images/w/16/spinner.png","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/cluster.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/count.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/index.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/each.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/eachAfter.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/eachBefore.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/sum.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/sort.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/path.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/ancestors.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/descendants.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/leaves.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/hierarchy/links.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/array.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/pack/enclose.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/pack/siblings.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/accessors.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/constant.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/pack/index.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/round.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/dice.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/partition.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/stratify.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/tree.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/slice.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/squarify.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/index.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/binary.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/sliceDice.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-hierarchy/src/treemap/resquarify.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-color/src/define.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-color/src/color.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-color/src/math.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-color/src/lab.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-color/src/cubehelix.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/basis.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/basisClosed.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/constant.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/color.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/rgb.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/transform/parse.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/array.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/date.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/number.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/object.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/string.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/value.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/round.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/transform/decompose.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/transform/index.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/zoom.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/hsl.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/lab.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/hcl.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/cubehelix.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/piecewise.js","webpack:///webpack://@uirouter/visualizer/node_modules/d3-interpolate/src/quantize.js","webpack:///(webpack)/buildin/module.js"],"names":["RejectType","Glob","text","this","glob","split","regexpString","map","seg","join","regexp","RegExp","is","exec","fromString","prototype","matches","name","test","queue_Queue","Queue","_items","_limit","_evictListeners","onEvict","Object","common","enqueue","item","items","push","length","evict","shift","forEach","fn","dequeue","size","splice","clear","current","remove","idx","indexOf","peekTail","peekHead","rejectFactory_id","rejectFactory_Rejection","Rejection","type","message","detail","$id","isRejectionPromise","obj","then","hof","_transitionRejection","superseded","options","rejection","SUPERSEDED","redirected","invalid","INVALID","ignored","IGNORED","aborted","ABORTED","errored","ERROR","normalize","toString","d","stringify","toPromise","maxLength","max","str","substr","functionToString","fnStr","fnToString","namedFunctionMatch","match","toStr","fnName","_fn","predicates","slice","isRejection","stringifyPattern","x","constructor","o","seen","format","value","JSON","key","replace","beforeAfterSubstr","_char","stripLastPathElement","splitHash","splitQuery","splitEqual","joinNeighborsR","acc","concat","uiViewString","uiview","state","creationContext","id","$type","fqn","normalizedCat","input","Category","consoleLog","Function","bind","call","console","log","consoletable","table","_tid","_rid","transLbl","trans","trace","Trace","_enabled","approximateDigests","_set","enabled","categories","_this","keys","k","parseInt","filter","isNaN","category","enable","_i","arguments","disable","traceTransitionStart","TRANSITION","traceTransitionIgnored","traceHookInvocation","step","HOOK","event","context","registeredHook","callback","traceHookResult","hookResult","transitionOptions","traceResolvePath","path","when","RESOLVE","traceResolvableResolved","resolvable","data","traceError","reason","traceSuccess","finalState","traceUIViewEvent","viewData","extra","UIVIEW","padString","traceUIViewConfigUpdated","traceUIViewFill","html","traceViewSync","pairs","VIEWCONFIG","uivheader","mapping","_a","uiView","viewConfig","uiv","cfg","viewDecl","$context","$name","_b","sort","a","b","localeCompare","traceViewServiceEvent","view","$uiViewName","$uiViewContextAnchor","viewConfigString","traceViewServiceUIViewEvent","paramType_ParamType","ParamType","def","pattern","inherit","val","encode","decode","equals","$subPattern","sub","$normalize","$asArray","mode","isSearch","Error","ArrayType","arrayWrap","arrayHandler","allTruthyMode","arr","result","arrayUnwrap","arrayEqualsHandler","val1","val2","left","right","i","paramTypeFn","wrapperFn","dynamic","raw","$arrayMode","DefType","hasOwn","hasOwnProperty","isShorthand","getParamDeclaration","paramName","location","noReloadOnSearch","reloadOnSearch","SEARCH","undefined","find","defaultConfig","paramConfig","getStaticDefaultValue","$$fn","unwrapShorthand","params","makeDefaultType","param_Param","Param","urlMatcherFactory","config","urlType","paramTypes","CONFIG","PATH","getType","arrayDefaults","arrayParamNomenclature","arrayMode","array","isOptional","squash","defaultPolicy","getSquashPolicy","defaultSquashPolicy","from","to","configuredKeys","getReplace","values","paramValues","params_1","param","changed","values1","values2","validates","reduce","isDefaultValue","tuple","replaceSpecialValues","_defaultValueCache","defaultValue","coreservices","$injector","invoke","getDefaultValue","normalized","encoded","paramTypes_ParamTypes","ParamTypes","typeQueue","defaultTypes","types","definition","dispose","definitionFn","_flushTypeQueue","valToString","defaultTypeBase","String","string","query","hash","int","bool","Boolean","date","getFullYear","getMonth","getDate","capture","Date","valueOf","l","r","json","any","stateParams_StateParams","StateParams","$inherit","newParams","$current","$to","parentParams","parents","inherited","inheritList","j","pathNode_PathNode","PathNode","stateOrNode","node","paramSchema","resolvables","views","parameters","res","clone","applyRawParams","memo","pDef","paramDef","parameter","paramsFn","diff","targetState_TargetState","TargetState","_stateRegistry","_identifier","_params","_options","_definition","matcher","relative","identifier","$state","self","exists","valid","error","base","stateName","withState","withParams","withOptions","newOpts","isDef","pathUtils_PathUtils","PathUtils","makeTargetState","registry","buildPath","targetState","toParams","buildToPath","fromPath","toPath","inheritParams","applyViewConfigs","$view","states","viewDecls","subPath","n","viewConfigs","createViewConfig","toKeys","noInherit","toNode","toParamVals","incomingParamVals","fromParamVals","ownParamVals","treeChanges","reloadState","node1","node2","retained","exiting","entering","Math","min","keep","nonDynamicParams","retainedWithToParams","retainedNode","cloned","matching","pathA","pathB","done","nodeA","nodeB","predicate","elementIdx","resolvePolicies","LAZY","EAGER","defaultResolvePolicy","resolvable_Resolvable","Resolvable","arg1","resolveFn","deps","policy","resolved","promise","token","$q","literal","getPolicy","thisPolicy","statePolicy","resolvePolicy","async","resolve","resolveContext","findNode","maybeWaitForRx","observable$","cached","cache","take","all","getDependencies","get","resolvedDeps","apply","resolvedValue","fromData","whens","ALL_WHENS","EAGER_WHENS","NATIVE_INJECTOR_TOKEN","resolveContext_ResolveContext","ResolveContext","_path","getTokens","getResolvable","subContext","addResolvables","newResolvables","resolvePath","matchedWhens","matchesPolicy","acceptedVals","whenOrAsync","promises","nodeResolvables","nowait","wait","getResult","injector","_injector","resolveContext_UIInjectorImpl","availableResolvables","_node","fromInjector","getNative","UIInjectorImpl","getAsync","nameBuilder","selfBuilder","$$state","dataBuilder","parent","getUrlBuilder","$urlMatcherFactoryProvider","root","stateObject","url","parsed","charAt","substring","stateBuilder_parseUrl","compile","isMatcher","navigable","append","getNavigableBuilder","isRoot","stateBuilder_getParamsBuilder","paramFactory","urlParams","nonUrlParams","fromConfig","p","pathBuilder","includesBuilder","includes","resolvablesBuilder","resolveObj","getToken","provide","literal2Resolvable","useFactory","dependencies","useClass","useValue","useExisting","tuple2Resolvable","annotate","strictDi","item2Resolvable","decl","TransitionHookPhase","TransitionHookScope","stateBuilder_StateBuilder","StateBuilder","builders","parentName","builder","build","chain","parentFn","_state","segments","pop","stateObject_StateObject","StateObject","create","stateDecl","isStateClass","__stateObjectCache","nameGlob","ref","opts","matchingKeys","isState","stateMatcher_StateMatcher","StateMatcher","_states","isRelative","stateOrName","matchGlob","isStr","baseState","splitName","pathLength","relName","stateQueueManager_StateQueueManager","StateQueueManager","$registry","$urlRouter","listeners","queue","register","flush","registered","orphans","previousQueueLength","getState","notifyListeners","listener","s","name_1","orphanIdx","existingState","existingFutureState","deregister","attachRoute","prev","rule","urlRuleFactory","stateRegistry_StateRegistry","StateRegistry","_router","stateQueue","urlRouter","_registerRoot","_root","#","abstract","onStatesChanged","stateDefinition","_deregisterTree","children","getChildren","_children","deregistered","reverse","$ur","rules","removeRule","deregisteredStates","found","decorator","func","defaultOptions","transition","traceData","transitionHook_TransitionHook","TransitionHook","stateContext","isSuperseded","hookPhase","RUN","isActive","eventType","hooks","waitFor","nextHook","invokeHook","invokeHooks","doneCallback","remainingHooks","runAllHooks","hook","logError","err","router","stateService","defaultErrorHandler","_deregistered","notCurrent","getNotCurrentRejection","handleError","getErrorHandler","handleResult","getResultHandler","synchronous","invokeLimit","invokeCount","handleHookResult","isTargetState","_disposed","_aborted","HANDLE_RESULT","LOG_REJECTED_RESULT","LOG_ERROR","REJECT_ERROR","THROW_ERROR","matchState","criterion","toMatch","globStrings","hookRegistry_RegisteredHook","RegisteredHook","tranSvc","matchCriteria","removeHookFromRegistry","priority","_matchingNodes","nodes","_getDefaultMatchCriteria","_pluginapi","_getPathTypes","_getMatchingNodes","criteria","mn","pathtype","isStateHook","scope","STATE","every","makeEvent","transitionService","_registeredHooks","removeHookFn","hookRegistrationFn","matchObject","hookBuilder_HookBuilder","HookBuilder","buildHooksForPhase","phase","_getEvents","buildHooks","hookType","matchingHooks","getMatchingHooks","baseHookOptions","criteriaMatchPath","transitionHook","reverseDepthSort","factor","depthDelta","tupleSort","reverseSort","isCreate","CREATE","$transitions","reg","getHooks","stateSelf","transition_Transition","Transition","_deferred","defer","_hookBuilder","globals","_targetState","_transitionCount","_treeChanges","createTransitionHookRegFns","onCreateHooks","onBefore","onStart","onExit","onRetain","onEnter","onFinish","onSuccess","onError","hookName","enteringStates","$from","compare","pathname","freeze","paramsChanged","fromParams","allParamDescriptors","pathNode","changedValues","descriptor","pathName","getResolveTokens","addResolvable","topath","targetNode","redirectedFrom","originalTransition","rf","redirect","redirects","redirectOpts","source","newOptions","newTransition","originalEnteringNodes","redirectEnteringNodes","_changedParams","tc","reload","nodeSchemas","toValues","fromValues","schema","toVals","fromVals","changes","_ignoredReason","pending","same","newTC","pendTC","run","getHooksFor","allBeforeHooks","BEFORE","lastStartedTransitionId","transitionHistory","allRunHooks","success","SUCCESS","reject","_error","abort","paramDefs","invalidParams","invalidValues","fromStateOrName","toStateOrName","avoidEmptyHash","diToken","quoteRegExp","surroundPattern","re","splitOnSlash","urlMatcher_defaultConfig","strict","caseInsensitive","urlMatcher_UrlMatcher","UrlMatcher","_cache","_segments","_compiled","matchArray","details","segment","placeholder","searchPlaceholder","patterns","last","checkParamErrors","nameValidator","matchDetails","m","index","lastIndex","search","fromSearch","_pattern","encodeDashes","encodeURIComponent","c","charCodeAt","toUpperCase","pathSegmentsAndParams","staticSegments","pathParams","queryParams","weights","weightsA","weightsB","padVal","len","padArrays","cmp","_pairs","_prop","reverseString","allReversed","allParams","searchParams","nPathSegments","urlm","findParam","urlMatchers","getDetails","isValid","pathString","queryString","paramDetails","urlMatcherFactory_ParamFactory","ParamFactory","umf","urlMatcherFactory_UrlMatcherFactory","UrlMatcherFactory","_isCaseInsensitive","_isStrictMode","_defaultSquashPolicy","strictMode","__assign","globalConfig","object","$get","urlRule_UrlRuleFactory","UrlRuleFactory","what","handler","makeRule","_what","fromUrlMatcher","fromState","fromRegExp","urlRule_BaseUrlRule","urlMatcher","_handler","matchPriority","optional","href","transitionTo","global","sticky","Number","isUrlRule","defaultRuleSortFn","prioritySort","URLMATCHER","REGEXP","RAW","OTHER","typeSort","urlRouter_urlMatcherSort","useMatchPriority","idSort","urlRouter_UrlRouter","UrlRouter","_sortFn","_rules","interceptDeferred","_id","_sorted","listen","_otherwiseFn","compareFn","stableSort","ensureSorted","arrOfWrapper","elem","wrapperA","wrapperB","cmpDiff","wrapper","best","weight","sync","evt","defaultPrevented","$url","urlService","newurl","go","target","applyResult","_stopFn","onChange","update","read","locationService","absolute","isHtml5","html5Mode","hashPrefix","baseHref","appendBasePath","slash","cfgPort","port","protocol","host","otherwise","handlerFn","getHandlerFn","initial","urlParts","deferIntercept","view_ViewService","ViewService","_uiViews","_viewConfigs","_viewConfigFactories","_listeners","_rootViewContext","_viewConfigFactory","_registeredUIView","_registeredUIViews","_activeViewConfigs","_onSync","normalizeUIViewTarget","rawViewName","viewAtContext","uiViewName","uiViewContextAnchor","relativeViewNameSugar","anchorState","anchor","_rootContext","viewType","factory","cfgFactory","cfgs","deactivateViewConfig","activateViewConfig","uiViewsByFqn","viewConfigDepth","count","depthCompare","depthFn","posNeg","uiViewTuples","stateDepth","matchingConfigs","matchedViewConfigs","unmatchedConfigTuples","configUpdated","allTuples","cb","registerUIView","uiViews","available","active","vc","vcSegments","uivSegments","negOffset","fqnToFirstSegment","uiViewContext","globals_UIRouterGlobals","UIRouterGlobals","successfulTransitions","urlService_makeStub","locationServicesFns","locationConfigFns","umfFns","rulesFns","syncFns","urlService_UrlService","UrlService","lateBind","locationServices","locationConfig","parts","locationServiceStub","locationConfigStub","_routerInstance","router_UIRouter","UIRouter","_disposables","viewService","transitionService_TransitionService","stateRegistry","stateService_StateService","_plugins","disposable","plugin","pluginInstance","getPlugin","pluginName","addCoreResolvables","TRANSITION_TOKENS","isTransition","coreResolvables_treeChangesCleanup","replaceTransitionWithNull","redirectTo_redirectToHook","redirectTo","makeEnterExitRetainHook","hookFn","onExitHook","onRetainHook","onEnterHook","resolve_eagerResolvePath","resolve_lazyResolveState","resolve_resolveRemaining","views_loadEnteringViews","enteringViews","load","activateViews","exitingViews","updateGlobals_updateGlobalState","clearCurrentTransition","updateUrl","urlOptions","lazyLoad_lazyLoadHook","lazyLoad","lazyLoadState","orig","lazyLoadFn","Array","isArray","transitionEventType_TransitionEventType","hookOrder","ignoredHook","ignoredReason","invalidTransitionHook","defaultTransOpts","notify","custom","TransitionService","_eventTypes","_criteriaPaths","_deregisterHookFns","_defineCorePaths","_defineCoreEvents","_registerCoreTransitionHooks","onCreate","hooksArray","Phase","TH","paths","_defineEvent","_definePathType","cmpByPhase","hookScope","fns","addCoreResolves","registerIgnoredTransitionHook","registerInvalidTransitionHook","registerRedirectToHook","registerOnExitHook","registerOnRetainHook","registerOnEnterHook","eagerResolve","registerEagerResolvePath","lazyResolve","resolve_registerLazyResolveState","resolveAll","registerResolveRemaining","loadViews","registerLoadEnteringViews","registerActivateViews","updateGlobals","registerUpdateGlobalState","registerUpdateUrl","registerLazyLoadHook","StateService","invalidCallbacks","_defaultErrorHandler","$error$","stack","boundFns","defineProperty","_handleInvalidTargetState","toState","latestThing","latest","callbackQueue","checkForRedirect","invokeNextCallback","nextCallback","onInvalid","defautGoOpts","transOpts","getCurrentPath","latestSuccess","currentPath","transitionToPromise","rejectedTransitionHandler","isLatest","errorHandler","include","defaultHrefOpts","lossy","nav","q_$q","Promise","deferred","injector_globals","STRIP_COMMENTS","ARGUMENT_NAMES","injector_$injector","has","locals","ensureExist","args","$inject","utils_keyValsToObjectR","accum","utils_getParams","utils_parseUrl","orEmptyString","beforehash","locationPluginFactory","serviceClass","configurationClass","uiRouter","service","configuration","baseLocationService_BaseLocationServices","BaseLocationServices","fireAfterUpdate","_listener","_get","_location","_history","history","loc","searchObject","hashLocationService_HashLocationService","_super","HashLocationService","addEventListener","__extends","title","removeEventListener","MemoryLocationService","memoryLocationService_extends","_url","pushStateLocationService_PushStateLocationService","PushStateLocationService","_config","pushStateLocationService_extends","_getBasePrefix","basePrefix","exactBaseHrefMatch","startsWithBase","fullUrl","replaceState","pushState","memoryLocationConfig_MemoryLocationConfig","_baseHref","_port","_protocol","_host","_hashPrefix","newval","browserLocationConfig_BrowserLocationConfig","BrowserLocationConfig","_isHtml5","hostname","newprefix","getBaseHref","baseTag","document","getElementsByTagName","servicesPlugin","pushStateLocationPlugin","UIRouterPluginBase","createRouter","shadowRoot","Visualizer","stateDef","parentId","getElementById","innerHTML","naiveClearRenderedDom","naiveRenderIntoDom","BikeApp","_HTMLElement","_classCallCheck","_getPrototypeOf","_assertThisInitialized","shadow","attachShadow","div","createElement","appendChild","_inherits","_wrapNativeSuper","HTMLElement","_this2","window","dataset","navigate","dispatchEvent","CustomEvent","bootstrap","mount","customElements","define","unmount","__webpack_require__","__webpack_exports__","_typeof","angular","fromJson","parse","toJson","_predicates__WEBPACK_IMPORTED_MODULE_0__","extend","assign","toObj","_equals","identity","noop","createProxyFunctions","fnNames","latebind","bindFunction","inArray","_hof__WEBPACK_IMPORTED_MODULE_1__","removeFrom","pushTo","deregAll","functions","defaults","defaultsList","defaultVals","pick","mergeR","ancestors","first","second","propNames","objCopy","omit","collection","accept","mapObj","allTrueR","anyTrueR","unnestR","flattenR","pushR","uniqR","unnest","assertPredicate","assertFn","predicateOrMap","errMsg","arrayTuples","maxArrayLen","applyPairs","keyValTuple","tail","copy","src","dest","o1","o2","t1","a1","a2","tup","t","getTime","silenceUncaughtInPromise","e","silentRejection","_coreservices__WEBPACK_IMPORTED_MODULE_2__","tis","isUndefined","isDefined","_hof__WEBPACK_IMPORTED_MODULE_0__","isNull","isNullOrUndefined","isFunction","isNumber","isString","isObject","isDate","isRegExp","isInjectable","head","isPromise","curry","initial_args","func_args_length","curried","pipe","funcs","start","prop","propEq","not","and","or","_val","fn1","fn2","ctor","v","struct","notImplemented","services","fnname","exports","modules","module","enumerable","Symbol","toStringTag","__esModule","z","R","EMPTY_CHILDREN","lastSimple","child","simple","u","attributes","setTimeout","nodeName","vnode","h","component","list","f","normalizedNodeName","toLowerCase","props","defaultProps","y","parentNode","old","setProperty","removeAttribute","ns","g","diffLevel","isSvgMode","hydrating","A","T","V","prevSvgMode","dom","out","recollectNodeTree","_component","originalComponent","oldDom","isDirectOwner","isOwner","_parentComponent","setComponentProps","unmountComponent","vnodeName","firstChild","vchildren","fc","vchild","childNodes","keyed","keyedLen","childrenLen","vlen","_","w","S","removeNode","innerDiffNode","attrs","setAccessor","diffAttributes","componentRoot","__preactattr_","removeChildren","previousSibling","E","C","inst","Ctor","Component","N","O","syncComponentUpdates","enqueueRender","renderComponent","M","_disable","rendered","cbase","previousProps","previousState","previousContext","isUpdate","nextBase","initialBase","initialChildComponent","skip","shouldComponentUpdate","toUnmount","baseParent","componentRef","mounts","_renderCallbacks","P","inner","components","collectComponent","setState","forceUpdate","render","cloneElement","rerender","easeInOutQuad","easeInOutCubic","easeInOutQuart","easeInOutQuint","easeInOutSine","cos","PI","easeInOutExpo","pow","easeInOutCirc","sqrt","easeInElastic","abs","asin","sin","easeOutElastic","easeInOutElastic","easeInOutBack","d3_hierarchy_1","Tree","layoutFn","TREE_LAYOUT","sortNodesFn","TOP_TO_BOTTOM_SORT","labelRenderFn","SLANTED_TEXT","edgeRenderFn","TREE_EDGE","Cluster","CLUSTER_LAYOUT","Radial","RADIAL_LAYOUT","BOTTOM_TO_TOP_SORT","RADIAL_TEXT","RADIAL_EDGE","tree","b2t","layoutY","layoutX","t2b","rootNode","updateNodes","separation","depth","each","angle","radius","projected","visNode","renderer","baseFontSize","zoom","fontSize","textAnchor","transform","preact_1","className","text-anchor","font-size","strokeWidth","baseStrokeWidth","animX","animY","_parent","stroke-width","yAvg","baseRadius","baseNodeStrokeWidth","setPrototypeOf","__proto__","StateSelector","deregisterFn","updateStates","deregisterStateListenerFn","selectState","style","maxWidth","classname","el","StateNode_1","animatepath_1","easing_1","renderers_1","stateVisNode_1","resetMetadata","label","highlight","future","entered","exited","inactive","StateTree","layout","cancelCurrentAnimation","getNodes","visible","visibleAncestor","dimensions","currentCoords","width","height","targetCoords","xval","scaleX","offsetX","yval","scaleY","offsetY","tupleCount","xyValArray","known","getPrototypeOf","toAdd","toDel","createStateVisNode","isPrototypeOf","nodeForState","unmounted","doLayoutAnimation","$transition$","getNode","element","initialProps","_render","body","readyState","deregisterHookFn","lastSuccessful","newProps","renderNodes","doLayout","d3_interpolate_1","newValue","oldValue","duration","updateFrame","finishFn","easeFn","interpolate","requestAnimationFrame","now","progress","percent","sourceMap","cssMapping","btoa","sourceURLs","sourceRoot","content","alreadyImportedModules","mediaQuery","isOldIE","atob","getElement","querySelector","HTMLIFrameElement","styleTarget","singleton","singletonCounter","stylesInsertedAtTop","fixUrls","domStyle","stylesInDom","newStyles","part","css","insertInto","insertAt","lastStyleElementInsertedAtTop","before","addAttrs","insertStyleElement","URL","createObjectURL","revokeObjectURL","Blob","autoFixUrls","oldSrc","link","removeStyleElement","media","styleSheet","newObj","DEBUG","addStylesToDom","refs","mayRemove","newList","listToStyles","textStore","createTextNode","modal_1","ResolveData_1","strings_1","KeyValueRow","classes","modalTitle","showModal","Modal","show","onClick","collapseFalsy","KeysAndValues","definitions","buckets","bucket","groupedValues","falsyGroupDefinitions","enableGroupToggle","isCollapsed","makeBuckets","defaultBucket","groupedBuckets","groupedCount","total","tuples","groupedTuples","showGroupToggle","_ref","fades","getElementsByClassName","zIndex","tabIndex","display","modal","Nothing","close","StateSelector_1","StateVisualizer_1","StateTree_1","TransitionVisualizer_1","DEFAULTS","stateVisualizerEl","transitionVisualizerEl","draggable_1","Controls_1","StateVisWindow_1","minimized","StateVisualizer","minimizeAfter","ev","minimizeTimeout","clearTimeout","deregisterFns","enaabled","controlsEl","windowEl","visEl","move","draggable","onMouseDown","cancelAutoMinimize","onMouseEnter","windowRef","onResize","onRendererChange","handleRendererChange","onMinimize","onClose","svgWidth","svgHeight","elementToMove","elementBeingDragged","lastClientX","lastClientY","newClientX","newClientY","bounds","getBoundingClientRect","top","dx","dy","bottom","isDragging","initialClientX","initialClientY","mouseDownListener","clientX","clientY","dragListener","preventDefault","doneDragging","toggleClass_1","StateNode","goTimeout","_collapsed","nodeStrokeWidth","circleClasses","clazz","descendents","collapsed","totalDescendents","handleGoClicked","onDblClick","handleCollapseClicked","LayoutPrefs_1","ChevronDown_1","Close_1","Gear_1","Help_1","Controls","showRendererPrefs","marginLeft","cursor","float","LayoutPrefs","presetName","parseFloat","settings","flexFlow","stopPropagation","flex","alignItems","handleLayout","preset","onInput","handleZoom","viewBox","xmlns","StateVisWindow","innerWidth","innerHeight","unminimize","animationEndListener","nextProps","unminimize_1","minimize","MutationObserver","monitorResizeEvents","_width","_height","observer","mutations","mutation","attributeName","newwidth","newheight","observe","childList","characterData","subtree","attributeFilter","disconnect","hmr","nonce","currentDir","newUrl","trim","fullMatch","baseUrl","TransitionView_1","transitions","pointerEvents","documentElement","clientHeight","TransitionVisualizer","dereg","_div","targetScrollX","scrollWidth","clientWidth","cancelPreviousAnim","newVal","oldVal","scrollLeft","maximumTransitions","vals","onMouseMove","minWidth","border","TransitionPopover_1","BreadcrumbArrow_1","cancelablePromise_1","TransitionView","status","pinned","expanded","open","deregisterFunctions","setMessage","transitionPromise","isCanceled","statename","cancel","onMouseLeave","togglePinned","togglePin","toggleExpand","PopoverHeading_1","TransSummary_1","NodePaths_1","TransitionPopover","PopoverHeading","KeysAndValues_1","TransSummary","pretty_1","ResolveData","Pretty","padding","margin","preStyle","NodeDetail_1","FlowArrow_1","NodePaths","enterExit","tcPaths","partialKey","pathname1","pathname2","toType","fromType","maxPathLength","lastEnterIdx","colSpan","NodeDetail","ignoredTokens","resolves","FlowArrow","stroke","fill","renderCurve","points","renderSvg","_t","renderVerticalLine","renderCurveRU","renderCurveRD","renderArrowU","renderArrowD","overflow","position","BreadcrumbArrow","running","handleClick","iconClass","hasCanceled_","cancelablePromise","escape","nodeSize","previousNode","x0","x1","eachAfter","cluster","childs","valued","eachBefore","Node","next","sum","ancestor","bNodes","end","descendants","leaves","links","enclosesWeakAll","enclosesNot","x2","x21","x3","a3","b2","b3","c2","c3","d1","d2","d3","ab","xa","xb","ya","yb","B","place","pack","sj","sk","aa","ca","packEnclose","dice","src_partition","round","y0","y1","partition","keyPrefix","preroot","ambiguous","q","I","Q","nodeId","nodeKey","nodeByKey","U","stratify","Y","X","H","W","wp","wm","K","J","TreeNode","G","tx","kx","ky","siblings","change","executeShifts","vop","vim","vom","sip","sop","sim","som","moveSubtree","vip","treemap_slice","phi","nn","row","nodeValue","sumValue","minValue","maxValue","newRatio","minRatio","alpha","beta","i0","i1","rows","tn","squarifyRatio","squarify","src_treemap","paddingStack","paddingInner","paddingTop","paddingRight","paddingBottom","paddingLeft","tile","treemap","paddingOuter","binary","sums","valueTarget","hi","valueRight","sliceDice","$","D","an","_squarify","ratio","resquarify","reI","reN","reP","reHex3","reHex6","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","NaN","opacity","displayable","rgb","brighter","darker","m2","m1","hsl2rgb","rad2deg","Xn","Yn","Zn","t0","t2","t3","L","xyz2lab","F","atan2","xyz2rgb","ED","EB","BC_DA","bl","en","cosh","sinh","rn","floor","v1","v2","v0","v3","basisClosed","constant","sn","un","cn","pn","ln","hn","color","cssNode","cssRoot","cssView","svgNode","dn","rgbBasisClosed","na","setTime","number","gn","reA","reB","Vn","am","bm","bs","bn","_n","bi","one","zero","src_value","vn","degrees","translateX","translateY","rotate","skewX","decompose","On","translate","scale","Mn","Cn","interpolateTransformSvg","rho","Rn","exp","jn","ux1","ux0","uy0","w0","b0","b1","r0","r1","coshr0","Dn","Bn","hslLong","Fn","Un","qn","hclLong","Qn","cubehelix","cubehelixLong","Hn","Wn","kn","on","yn","Sn","Pn","Ln","In","webpackPolyfill","deprecate"],"mappings":"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AAG,EAAAx9B,GAAAq9B,EAAAr9B,GACA,OAAAw9B,ECNA,SAAAjsC,KAEA,IAGA04D,wBACAC,kDACAC,mDACAC,qBACAC,qBACAC,uCACAC,uCACAC,0CACAC,0CACAC,uCACAC,0CAEAC,GACAC,mBACAC,sBACAC,WACAC,mBACAC,eACAC,eACAC,gBACAC,QACAC,wBACAC,SACAC,mBACAC,eACAC,mBACAC,kBACAC,mBACAC,mBACAC,eACAC,uBACAC,kBACAC,iBACAC,WACAC,aACAC,eACAC,uBACAC,kBACAC,gBACAC,kBACAC,mBACAC,oBACAC,uBACAC,oBACAC,oBACAC,gBACAC,oBACAC,qBACAC,sBACAC,sBACAC,sBACAC,oBACAC,mBACAC,kBACAC,kBACAC,gBACAC,gBACAC,mBACAC,mBACAC,qBACAC,oBACAC,iBACAC,mBACAC,oBACAC,cACAC,mBACAC,aACAC,YACAC,qBACAC,aACAC,kBACAC,iBACAC,mBACAC,eACAC,eACAC,eACAC,kBACAC,uBACAC,kBACAC,sBACAC,mBACAC,oBACAC,mBACAC,8BACAC,mBACAC,mBACAC,mBACAC,mBACAC,qBACAC,sBACAC,qBACAC,uBACAC,uBACAC,wBACAC,qBACAC,WACAC,kBACAC,eACAC,iBACAC,eACAC,yBACAC,eACAC,sBACAC,qBACAC,uBACAC,wBACAC,wBACAC,wBACAC,yBACAC,qBACAC,mBACAC,mBACAC,kBACAC,qBACAC,SACAC,iBACAC,cACAC,kBACAC,gBACAC,mBACAC,gBACAC,uBACAC,mBACAC,uBACAC,uBACAC,oBACAC,mBACAC,cACAC,cACAC,cACAC,oBACAC,eACAC,sBACAC,aACAC,mBACAC,kBACAC,oBACAC,gBACAC,oBACAC,iBACAC,kBACAC,gBACAC,gBACAC,gBACAC,kBACAC,kBACAC,kBACAC,cACAC,kBACAC,kBACAC,aACAC,WACAC,iBACAC,gBACAC,kBACAC,gBACAC,eACAC,eACAC,oBACAC,gBACAC,sBAYA,SAAAjyB,EAAA19B,GACA,IAAAg5B,EAEA,OADA5rC,+BACA4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","file":"1.js","sourcesContent":["/**\n * @coreapi\n * @module transition\n */ /** for typedoc */\n'use strict';\nimport { extend, silentRejection } from '../common/common';\nimport { stringify } from '../common/strings';\nimport { is } from '../common/hof';\n\nenum RejectType {\n  /**\n   * A new transition superseded this one.\n   *\n   * While this transition was running, a new transition started.\n   * This transition is cancelled because it was superseded by new transition.\n   */\n  SUPERSEDED = 2,\n\n  /**\n   * The transition was aborted\n   *\n   * The transition was aborted by a hook which returned `false`\n   */\n  ABORTED = 3,\n\n  /**\n   * The transition was invalid\n   *\n   * The transition was never started because it was invalid\n   */\n  INVALID = 4,\n\n  /**\n   * The transition was ignored\n   *\n   * The transition was ignored because it would have no effect.\n   *\n   * Either:\n   *\n   * - The transition is targeting the current state and parameter values\n   * - The transition is targeting the same state and parameter values as the currently running transition.\n   */\n  IGNORED = 5,\n\n  /**\n   * The transition errored.\n   *\n   * This generally means a hook threw an error or returned a rejected promise\n   */\n  ERROR = 6,\n}\n\nexport { RejectType };\n\n/** @hidden */\nlet id = 0;\n\nexport class Rejection {\n  /** @hidden */\n  $id = id++;\n  /**\n   * The type of the rejection.\n   *\n   * This value is an number representing the type of transition rejection.\n   * If using Typescript, this is a Typescript enum.\n   *\n   * - [[RejectType.SUPERSEDED]] (`2`)\n   * - [[RejectType.ABORTED]] (`3`)\n   * - [[RejectType.INVALID]] (`4`)\n   * - [[RejectType.IGNORED]] (`5`)\n   * - [[RejectType.ERROR]] (`6`)\n   *\n   */\n  type: RejectType;\n\n  /**\n   * A message describing the rejection\n   */\n  message: string;\n\n  /**\n   * A detail object\n   *\n   * This value varies based on the mechanism for rejecting the transition.\n   * For example, if an error was thrown from a hook, the `detail` will be the `Error` object.\n   * If a hook returned a rejected promise, the `detail` will be the rejected value.\n   */\n  detail: any;\n\n  /**\n   * Indicates if the transition was redirected.\n   *\n   * When a transition is redirected, the rejection [[type]] will be [[RejectType.SUPERSEDED]] and this flag will be true.\n   */\n  redirected: boolean;\n\n  /** Returns true if the obj is a rejected promise created from the `asPromise` factory */\n  static isRejectionPromise(obj: any): boolean {\n    return obj && typeof obj.then === 'function' && is(Rejection)(obj._transitionRejection);\n  }\n\n  /** Returns a Rejection due to transition superseded */\n  static superseded(detail?: any, options?: any): Rejection {\n    const message = 'The transition has been superseded by a different transition';\n    const rejection = new Rejection(RejectType.SUPERSEDED, message, detail);\n    if (options && options.redirected) {\n      rejection.redirected = true;\n    }\n    return rejection;\n  }\n\n  /** Returns a Rejection due to redirected transition */\n  static redirected(detail?: any): Rejection {\n    return Rejection.superseded(detail, { redirected: true });\n  }\n\n  /** Returns a Rejection due to invalid transition */\n  static invalid(detail?: any): Rejection {\n    const message = 'This transition is invalid';\n    return new Rejection(RejectType.INVALID, message, detail);\n  }\n\n  /** Returns a Rejection due to ignored transition */\n  static ignored(detail?: any): Rejection {\n    const message = 'The transition was ignored';\n    return new Rejection(RejectType.IGNORED, message, detail);\n  }\n\n  /** Returns a Rejection due to aborted transition */\n  static aborted(detail?: any): Rejection {\n    const message = 'The transition has been aborted';\n    return new Rejection(RejectType.ABORTED, message, detail);\n  }\n\n  /** Returns a Rejection due to aborted transition */\n  static errored(detail?: any): Rejection {\n    const message = 'The transition errored';\n    return new Rejection(RejectType.ERROR, message, detail);\n  }\n\n  /**\n   * Returns a Rejection\n   *\n   * Normalizes a value as a Rejection.\n   * If the value is already a Rejection, returns it.\n   * Otherwise, wraps and returns the value as a Rejection (Rejection type: ERROR).\n   *\n   * @returns `detail` if it is already a `Rejection`, else returns an ERROR Rejection.\n   */\n  static normalize(detail?: Rejection | Error | any): Rejection {\n    return is(Rejection)(detail) ? detail : Rejection.errored(detail);\n  }\n\n  constructor(type: number, message?: string, detail?: any) {\n    this.type = type;\n    this.message = message;\n    this.detail = detail;\n  }\n\n  toString() {\n    const detailString = (d: any) => (d && d.toString !== Object.prototype.toString ? d.toString() : stringify(d));\n    const detail = detailString(this.detail);\n    const { $id, type, message } = this;\n    return `Transition Rejection($id: ${$id} type: ${type}, message: ${message}, detail: ${detail})`;\n  }\n\n  toPromise(): Promise<any> {\n    return extend(silentRejection(this), { _transitionRejection: this });\n  }\n}\n","/**\n * @coreapi\n * @module core\n */\n/**\n * Matches state names using glob-like pattern strings.\n *\n * Globs can be used in specific APIs including:\n *\n * - [[StateService.is]]\n * - [[StateService.includes]]\n * - The first argument to Hook Registration functions like [[TransitionService.onStart]]\n *    - [[HookMatchCriteria]] and [[HookMatchCriterion]]\n *\n * A `Glob` string is a pattern which matches state names.\n * Nested state names are split into segments (separated by a dot) when processing.\n * The state named `foo.bar.baz` is split into three segments ['foo', 'bar', 'baz']\n *\n * Globs work according to the following rules:\n *\n * ### Exact match:\n *\n * The glob `'A.B'` matches the state named exactly `'A.B'`.\n *\n * | Glob        |Matches states named|Does not match state named|\n * |:------------|:--------------------|:---------------------|\n * | `'A'`       | `'A'`               | `'B'` , `'A.C'`      |\n * | `'A.B'`     | `'A.B'`             | `'A'` , `'A.B.C'`    |\n * | `'foo'`     | `'foo'`             | `'FOO'` , `'foo.bar'`|\n *\n * ### Single star (`*`)\n *\n * A single star (`*`) is a wildcard that matches exactly one segment.\n *\n * | Glob        |Matches states named  |Does not match state named |\n * |:------------|:---------------------|:--------------------------|\n * | `'*'`       | `'A'` , `'Z'`        | `'A.B'` , `'Z.Y.X'`       |\n * | `'A.*'`     | `'A.B'` , `'A.C'`    | `'A'` , `'A.B.C'`         |\n * | `'A.*.*'`   | `'A.B.C'` , `'A.X.Y'`| `'A'`, `'A.B'` , `'Z.Y.X'`|\n *\n * ### Double star (`**`)\n *\n * A double star (`'**'`) is a wildcard that matches *zero or more segments*\n *\n * | Glob        |Matches states named                           |Does not match state named         |\n * |:------------|:----------------------------------------------|:----------------------------------|\n * | `'**'`      | `'A'` , `'A.B'`, `'Z.Y.X'`                    | (matches all states)              |\n * | `'A.**'`    | `'A'` , `'A.B'` , `'A.C.X'`                   | `'Z.Y.X'`                         |\n * | `'**.X'`    | `'X'` , `'A.X'` , `'Z.Y.X'`                   | `'A'` , `'A.login.Z'`             |\n * | `'A.**.X'`  | `'A.X'` , `'A.B.X'` , `'A.B.C.X'`             | `'A'` , `'A.B.C'`                 |\n *\n */\nexport class Glob {\n  text: string;\n  glob: Array<string>;\n  regexp: RegExp;\n\n  /** Returns true if the string has glob-like characters in it */\n  static is(text: string) {\n    return !!/[!,*]+/.exec(text);\n  }\n\n  /** Returns a glob from the string, or null if the string isn't Glob-like */\n  static fromString(text: string) {\n    return Glob.is(text) ? new Glob(text) : null;\n  }\n\n  constructor(text: string) {\n    this.text = text;\n    this.glob = text.split('.');\n\n    const regexpString = this.text\n      .split('.')\n      .map(seg => {\n        if (seg === '**') return '(?:|(?:\\\\.[^.]*)*)';\n        if (seg === '*') return '\\\\.[^.]*';\n        return '\\\\.' + seg;\n      })\n      .join('');\n\n    this.regexp = new RegExp('^' + regexpString + '$');\n  }\n\n  matches(name: string) {\n    return this.regexp.test('.' + name);\n  }\n}\n","/** @module common */\nimport { pushTo } from './common';\n\nexport class Queue<T> {\n  private _evictListeners: ((item: T) => void)[] = [];\n  public onEvict = pushTo(this._evictListeners);\n\n  constructor(private _items: T[] = [], private _limit: number = null) {}\n\n  enqueue(item: T) {\n    const items = this._items;\n    items.push(item);\n    if (this._limit && items.length > this._limit) this.evict();\n    return item;\n  }\n\n  evict(): T {\n    const item: T = this._items.shift();\n    this._evictListeners.forEach(fn => fn(item));\n    return item;\n  }\n\n  dequeue(): T {\n    if (this.size()) return this._items.splice(0, 1)[0];\n  }\n\n  clear(): Array<T> {\n    const current = this._items;\n    this._items = [];\n    return current;\n  }\n\n  size(): number {\n    return this._items.length;\n  }\n\n  remove(item: T) {\n    const idx = this._items.indexOf(item);\n    return idx > -1 && this._items.splice(idx, 1)[0];\n  }\n\n  peekTail(): T {\n    return this._items[this._items.length - 1];\n  }\n\n  peekHead(): T {\n    if (this.size()) return this._items[0];\n  }\n}\n","/**\n * Functions that manipulate strings\n *\n * Although these functions are exported, they are subject to change without notice.\n *\n * @module common_strings\n */ /** */\n\nimport { isArray, isFunction, isInjectable, isNull, isObject, isPromise, isString, isUndefined } from './predicates';\nimport { Rejection } from '../transition/rejectFactory';\nimport { identity, IInjectable, pushR, tail } from './common';\nimport { pattern, val } from './hof';\n\n/**\n * Returns a string shortened to a maximum length\n *\n * If the string is already less than the `max` length, return the string.\n * Else return the string, shortened to `max - 3` and append three dots (\"...\").\n *\n * @param max the maximum length of the string to return\n * @param str the input string\n */\nexport function maxLength(max: number, str: string) {\n  if (str.length <= max) return str;\n  return str.substr(0, max - 3) + '...';\n}\n\n/**\n * Returns a string, with spaces added to the end, up to a desired str length\n *\n * If the string is already longer than the desired length, return the string.\n * Else returns the string, with extra spaces on the end, such that it reaches `length` characters.\n *\n * @param length the desired length of the string to return\n * @param str the input string\n */\nexport function padString(length: number, str: string) {\n  while (str.length < length) str += ' ';\n  return str;\n}\n\nexport function kebobString(camelCase: string) {\n  return camelCase\n    .replace(/^([A-Z])/, $1 => $1.toLowerCase()) // replace first char\n    .replace(/([A-Z])/g, $1 => '-' + $1.toLowerCase()); // replace rest\n}\n\nexport function functionToString(fn: Function) {\n  const fnStr = fnToString(fn);\n  const namedFunctionMatch = fnStr.match(/^(function [^ ]+\\([^)]*\\))/);\n  const toStr = namedFunctionMatch ? namedFunctionMatch[1] : fnStr;\n\n  const fnName = fn['name'] || '';\n  if (fnName && toStr.match(/function \\(/)) {\n    return 'function ' + fnName + toStr.substr(9);\n  }\n  return toStr;\n}\n\nexport function fnToString(fn: IInjectable) {\n  const _fn = isArray(fn) ? fn.slice(-1)[0] : fn;\n  return (_fn && _fn.toString()) || 'undefined';\n}\n\nconst isRejection = Rejection.isRejectionPromise;\nconst hasToString = (obj: any) =>\n  isObject(obj) && !isArray(obj) && obj.constructor !== Object && isFunction(obj.toString);\n\nconst stringifyPattern = pattern([\n  [isUndefined, val('undefined')],\n  [isNull, val('null')],\n  [isPromise, val('[Promise]')],\n  [isRejection, (x: any) => x._transitionRejection.toString()],\n  [hasToString, (x: object) => x.toString()],\n  [isInjectable, functionToString],\n  [val(true), identity],\n]) as (val: any) => string;\n\nexport function stringify(o: any) {\n  const seen: any[] = [];\n\n  function format(value: any) {\n    if (isObject(value)) {\n      if (seen.indexOf(value) !== -1) return '[circular ref]';\n      seen.push(value);\n    }\n    return stringifyPattern(value);\n  }\n\n  if (isUndefined(o)) {\n    // Workaround for IE & Edge Spec incompatibility where replacer function would not be called when JSON.stringify\n    // is given `undefined` as value. To work around that, we simply detect `undefined` and bail out early by\n    // manually stringifying it.\n    return format(o);\n  }\n\n  return JSON.stringify(o, (key, value) => format(value)).replace(/\\\\\"/g, '\"');\n}\n\n/** Returns a function that splits a string on a character or substring */\nexport const beforeAfterSubstr = (char: string) => (str: string): string[] => {\n  if (!str) return ['', ''];\n  const idx = str.indexOf(char);\n  if (idx === -1) return [str, ''];\n  return [str.substr(0, idx), str.substr(idx + 1)];\n};\n\nexport const hostRegex = new RegExp('^(?:[a-z]+:)?//[^/]+/');\nexport const stripLastPathElement = (str: string) => str.replace(/\\/[^/]*$/, '');\nexport const splitHash = beforeAfterSubstr('#');\nexport const splitQuery = beforeAfterSubstr('?');\nexport const splitEqual = beforeAfterSubstr('=');\nexport const trimHashVal = (str: string) => (str ? str.replace(/^#/, '') : '');\n\n/**\n * Splits on a delimiter, but returns the delimiters in the array\n *\n * #### Example:\n * ```js\n * var splitOnSlashes = splitOnDelim('/');\n * splitOnSlashes(\"/foo\"); // [\"/\", \"foo\"]\n * splitOnSlashes(\"/foo/\"); // [\"/\", \"foo\", \"/\"]\n * ```\n */\nexport function splitOnDelim(delim: string) {\n  const re = new RegExp('(' + delim + ')', 'g');\n  return (str: string) => str.split(re).filter(identity);\n}\n\n/**\n * Reduce fn that joins neighboring strings\n *\n * Given an array of strings, returns a new array\n * where all neighboring strings have been joined.\n *\n * #### Example:\n * ```js\n * let arr = [\"foo\", \"bar\", 1, \"baz\", \"\", \"qux\" ];\n * arr.reduce(joinNeighborsR, []) // [\"foobar\", 1, \"bazqux\" ]\n * ```\n */\nexport function joinNeighborsR(acc: any[], x: any) {\n  if (isString(tail(acc)) && isString(x)) return acc.slice(0, -1).concat(tail(acc) + x);\n  return pushR(acc, x);\n}\n","/**\n * # Transition tracing (debug)\n *\n * Enable transition tracing to print transition information to the console,\n * in order to help debug your application.\n * Tracing logs detailed information about each Transition to your console.\n *\n * To enable tracing, import the [[Trace]] singleton and enable one or more categories.\n *\n * ### ES6\n * ```js\n * import {trace} from \"@uirouter/core\";\n * trace.enable(1, 5); // TRANSITION and VIEWCONFIG\n * ```\n *\n * ### CJS\n * ```js\n * let trace = require(\"@uirouter/core\").trace;\n * trace.enable(\"TRANSITION\", \"VIEWCONFIG\");\n * ```\n *\n * ### Globals\n * ```js\n * let trace = window[\"@uirouter/core\"].trace;\n * trace.enable(); // Trace everything (very verbose)\n * ```\n *\n * ### Angular 1:\n * ```js\n * app.run($trace => $trace.enable());\n * ```\n *\n * @coreapi\n * @module trace\n */\n/* tslint:disable:no-console */\nimport { parse } from '../common/hof';\nimport { isFunction, isNumber } from '../common/predicates';\nimport { Transition } from '../transition/transition';\nimport { ViewTuple } from '../view';\nimport { ActiveUIView, ViewConfig, ViewContext } from '../view/interface';\nimport { stringify, functionToString, maxLength, padString } from './strings';\nimport { Resolvable } from '../resolve/resolvable';\nimport { PathNode } from '../path/pathNode';\nimport { PolicyWhen } from '../resolve/interface';\nimport { TransitionHook } from '../transition/transitionHook';\nimport { HookResult } from '../transition/interface';\nimport { StateObject } from '../state/stateObject';\n\n/** @hidden */\nfunction uiViewString(uiview: ActiveUIView) {\n  if (!uiview) return 'ui-view (defunct)';\n  const state = uiview.creationContext ? uiview.creationContext.name || '(root)' : '(none)';\n  return `[ui-view#${uiview.id} ${uiview.$type}:${uiview.fqn} (${uiview.name}@${state})]`;\n}\n\n/** @hidden */\nconst viewConfigString = (viewConfig: ViewConfig) => {\n  const view = viewConfig.viewDecl;\n  const state = view.$context.name || '(root)';\n  return `[View#${viewConfig.$id} from '${state}' state]: target ui-view: '${view.$uiViewName}@${\n    view.$uiViewContextAnchor\n  }'`;\n};\n\n/** @hidden */\nfunction normalizedCat(input: Category | string): string {\n  return isNumber(input) ? Category[input] : Category[Category[input]];\n}\n\n/** @hidden */\nconst consoleLog = Function.prototype.bind.call(console.log, console);\n\n/** @hidden */\nconst consoletable = isFunction(console.table) ? console.table.bind(console) : consoleLog.bind(console);\n\n/**\n * Trace categories Enum\n *\n * Enable or disable a category using [[Trace.enable]] or [[Trace.disable]]\n *\n * `trace.enable(Category.TRANSITION)`\n *\n * These can also be provided using a matching string, or position ordinal\n *\n * `trace.enable(\"TRANSITION\")`\n *\n * `trace.enable(1)`\n */\nenum Category {\n  RESOLVE,\n  TRANSITION,\n  HOOK,\n  UIVIEW,\n  VIEWCONFIG,\n}\n\nexport { Category };\n\n/** @hidden */\nconst _tid = parse('$id');\n\n/** @hidden */\nconst _rid = parse('router.$id');\n\n/** @hidden */\nconst transLbl = trans => `Transition #${_tid(trans)}-${_rid(trans)}`;\n\n/**\n * Prints UI-Router Transition trace information to the console.\n */\nexport class Trace {\n  /** @hidden */\n  approximateDigests: number;\n\n  /** @hidden */\n  private _enabled: { [key: string]: boolean } = {};\n\n  /** @hidden */\n  constructor() {\n    this.approximateDigests = 0;\n  }\n\n  /** @hidden */\n  private _set(enabled: boolean, categories: Category[]) {\n    if (!categories.length) {\n      categories = <any>Object.keys(Category)\n        .map(k => parseInt(k, 10))\n        .filter(k => !isNaN(k))\n        .map(key => Category[key]);\n    }\n    categories.map(normalizedCat).forEach(category => (this._enabled[category] = enabled));\n  }\n\n  /**\n   * Enables a trace [[Category]]\n   *\n   * ```js\n   * trace.enable(\"TRANSITION\");\n   * ```\n   *\n   * @param categories categories to enable. If `categories` is omitted, all categories are enabled.\n   *        Also takes strings (category name) or ordinal (category position)\n   */\n  enable(...categories: (Category | string | number)[]);\n  enable(...categories: any[]) {\n    this._set(true, categories);\n  }\n  /**\n   * Disables a trace [[Category]]\n   *\n   * ```js\n   * trace.disable(\"VIEWCONFIG\");\n   * ```\n   *\n   * @param categories categories to disable. If `categories` is omitted, all categories are disabled.\n   *        Also takes strings (category name) or ordinal (category position)\n   */\n  disable(...categories: (Category | string | number)[]);\n  disable(...categories: any[]) {\n    this._set(false, categories);\n  }\n\n  /**\n   * Retrieves the enabled stateus of a [[Category]]\n   *\n   * ```js\n   * trace.enabled(\"VIEWCONFIG\"); // true or false\n   * ```\n   *\n   * @returns boolean true if the category is enabled\n   */\n  enabled(category: Category | string | number): boolean {\n    return !!this._enabled[normalizedCat(category)];\n  }\n\n  /** @internalapi called by ui-router code */\n  traceTransitionStart(trans: Transition) {\n    if (!this.enabled(Category.TRANSITION)) return;\n    console.log(`${transLbl(trans)}: Started  -> ${stringify(trans)}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceTransitionIgnored(trans: Transition) {\n    if (!this.enabled(Category.TRANSITION)) return;\n    console.log(`${transLbl(trans)}: Ignored  <> ${stringify(trans)}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceHookInvocation(step: TransitionHook, trans: Transition, options: any) {\n    if (!this.enabled(Category.HOOK)) return;\n    const event = parse('traceData.hookType')(options) || 'internal',\n      context = parse('traceData.context.state.name')(options) || parse('traceData.context')(options) || 'unknown',\n      name = functionToString((step as any).registeredHook.callback);\n    console.log(`${transLbl(trans)}:   Hook -> ${event} context: ${context}, ${maxLength(200, name)}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceHookResult(hookResult: HookResult, trans: Transition, transitionOptions: any) {\n    if (!this.enabled(Category.HOOK)) return;\n    console.log(`${transLbl(trans)}:   <- Hook returned: ${maxLength(200, stringify(hookResult))}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceResolvePath(path: PathNode[], when: PolicyWhen, trans?: Transition) {\n    if (!this.enabled(Category.RESOLVE)) return;\n    console.log(`${transLbl(trans)}:         Resolving ${path} (${when})`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceResolvableResolved(resolvable: Resolvable, trans?: Transition) {\n    if (!this.enabled(Category.RESOLVE)) return;\n    console.log(\n      `${transLbl(trans)}:               <- Resolved  ${resolvable} to: ${maxLength(200, stringify(resolvable.data))}`\n    );\n  }\n\n  /** @internalapi called by ui-router code */\n  traceError(reason: any, trans: Transition) {\n    if (!this.enabled(Category.TRANSITION)) return;\n    console.log(`${transLbl(trans)}: <- Rejected ${stringify(trans)}, reason: ${reason}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceSuccess(finalState: StateObject, trans: Transition) {\n    if (!this.enabled(Category.TRANSITION)) return;\n    console.log(`${transLbl(trans)}: <- Success  ${stringify(trans)}, final state: ${finalState.name}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceUIViewEvent(event: string, viewData: ActiveUIView, extra = '') {\n    if (!this.enabled(Category.UIVIEW)) return;\n    console.log(`ui-view: ${padString(30, event)} ${uiViewString(viewData)}${extra}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceUIViewConfigUpdated(viewData: ActiveUIView, context: ViewContext) {\n    if (!this.enabled(Category.UIVIEW)) return;\n    this.traceUIViewEvent('Updating', viewData, ` with ViewConfig from context='${context}'`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceUIViewFill(viewData: ActiveUIView, html: string) {\n    if (!this.enabled(Category.UIVIEW)) return;\n    this.traceUIViewEvent('Fill', viewData, ` with: ${maxLength(200, html)}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceViewSync(pairs: ViewTuple[]) {\n    if (!this.enabled(Category.VIEWCONFIG)) return;\n    const uivheader = 'uiview component fqn';\n    const cfgheader = 'view config state (view name)';\n    const mapping = pairs\n      .map(({ uiView, viewConfig }) => {\n        const uiv = uiView && uiView.fqn;\n        const cfg = viewConfig && `${viewConfig.viewDecl.$context.name}: (${viewConfig.viewDecl.$name})`;\n        return { [uivheader]: uiv, [cfgheader]: cfg };\n      })\n      .sort((a, b) => (a[uivheader] || '').localeCompare(b[uivheader] || ''));\n\n    consoletable(mapping);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceViewServiceEvent(event: string, viewConfig: ViewConfig) {\n    if (!this.enabled(Category.VIEWCONFIG)) return;\n    console.log(`VIEWCONFIG: ${event} ${viewConfigString(viewConfig)}`);\n  }\n\n  /** @internalapi called by ui-router code */\n  traceViewServiceUIViewEvent(event: string, viewData: ActiveUIView) {\n    if (!this.enabled(Category.VIEWCONFIG)) return;\n    console.log(`VIEWCONFIG: ${event} ${uiViewString(viewData)}`);\n  }\n}\n\n/**\n * The [[Trace]] singleton\n *\n * #### Example:\n * ```js\n * import {trace} from \"@uirouter/core\";\n * trace.enable(1, 5);\n * ```\n */\nconst trace = new Trace();\nexport { trace };\n","/**\n * @coreapi\n * @module params\n */\n/** */\nimport { extend, filter, map } from '../common/common';\nimport { isArray, isDefined } from '../common/predicates';\nimport { ParamTypeDefinition } from './interface';\n\n/**\n * An internal class which implements [[ParamTypeDefinition]].\n *\n * A [[ParamTypeDefinition]] is a plain javascript object used to register custom parameter types.\n * When a param type definition is registered, an instance of this class is created internally.\n *\n * This class has naive implementations for all the [[ParamTypeDefinition]] methods.\n *\n * Used by [[UrlMatcher]] when matching or formatting URLs, or comparing and validating parameter values.\n *\n * #### Example:\n * ```js\n * var paramTypeDef = {\n *   decode: function(val) { return parseInt(val, 10); },\n *   encode: function(val) { return val && val.toString(); },\n *   equals: function(a, b) { return this.is(a) && a === b; },\n *   is: function(val) { return angular.isNumber(val) && isFinite(val) && val % 1 === 0; },\n *   pattern: /\\d+/\n * }\n *\n * var paramType = new ParamType(paramTypeDef);\n * ```\n * @internalapi\n */\nexport class ParamType implements ParamTypeDefinition {\n  /** @inheritdoc */\n  pattern: RegExp = /.*/;\n  /** The name/id of the parameter type */\n  name: string;\n  /** @inheritdoc */\n  raw: boolean;\n  /** @inheritdoc */\n  dynamic: boolean;\n  /** @inheritdoc */\n  inherit = true;\n\n  /**\n   * @param def  A configuration object which contains the custom type definition.  The object's\n   *        properties will override the default methods and/or pattern in `ParamType`'s public interface.\n   * @returns a new ParamType object\n   */\n  constructor(def: ParamTypeDefinition) {\n    extend(this, def);\n  }\n\n  // consider these four methods to be \"abstract methods\" that should be overridden\n  /** @inheritdoc */\n  is(val: any, key?: string): boolean {\n    return true;\n  }\n  /** @inheritdoc */\n  encode(val: any, key?: string): string | string[] {\n    return val;\n  }\n  /** @inheritdoc */\n  decode(val: string, key?: string): any {\n    return val;\n  }\n  /** @inheritdoc */\n  equals(a: any, b: any): boolean {\n    // tslint:disable-next-line:triple-equals\n    return a == b;\n  }\n\n  $subPattern() {\n    const sub = this.pattern.toString();\n    return sub.substr(1, sub.length - 2);\n  }\n\n  toString() {\n    return `{ParamType:${this.name}}`;\n  }\n\n  /** Given an encoded string, or a decoded object, returns a decoded object */\n  $normalize(val: any) {\n    return this.is(val) ? val : this.decode(val);\n  }\n\n  /**\n   * Wraps an existing custom ParamType as an array of ParamType, depending on 'mode'.\n   * e.g.:\n   * - urlmatcher pattern \"/path?{queryParam[]:int}\"\n   * - url: \"/path?queryParam=1&queryParam=2\n   * - $stateParams.queryParam will be [1, 2]\n   * if `mode` is \"auto\", then\n   * - url: \"/path?queryParam=1 will create $stateParams.queryParam: 1\n   * - url: \"/path?queryParam=1&queryParam=2 will create $stateParams.queryParam: [1, 2]\n   */\n  $asArray(mode: boolean | 'auto', isSearch: boolean) {\n    if (!mode) return this;\n    if (mode === 'auto' && !isSearch) throw new Error(\"'auto' array mode is for query parameters only\");\n    return new (<any>ArrayType)(this, mode);\n  }\n}\n\n/**\n * Wraps up a `ParamType` object to handle array values.\n * @internalapi\n */\nfunction ArrayType(type: ParamType, mode: boolean | 'auto') {\n  // Wrap non-array value as array\n  function arrayWrap(val: any): any[] {\n    return isArray(val) ? val : isDefined(val) ? [val] : [];\n  }\n\n  // Unwrap array value for \"auto\" mode. Return undefined for empty array.\n  function arrayUnwrap(val: any) {\n    switch (val.length) {\n      case 0:\n        return undefined;\n      case 1:\n        return mode === 'auto' ? val[0] : val;\n      default:\n        return val;\n    }\n  }\n\n  // Wraps type (.is/.encode/.decode) functions to operate on each value of an array\n  function arrayHandler(callback: (x: any) => any, allTruthyMode?: boolean) {\n    return function handleArray(val: any) {\n      if (isArray(val) && val.length === 0) return val;\n      const arr = arrayWrap(val);\n      const result = map(arr, callback);\n      return allTruthyMode === true ? filter(result, x => !x).length === 0 : arrayUnwrap(result);\n    };\n  }\n\n  // Wraps type (.equals) functions to operate on each value of an array\n  function arrayEqualsHandler(callback: (l: any, r: any) => boolean) {\n    return function handleArray(val1: any, val2: any) {\n      const left = arrayWrap(val1),\n        right = arrayWrap(val2);\n      if (left.length !== right.length) return false;\n      for (let i = 0; i < left.length; i++) {\n        if (!callback(left[i], right[i])) return false;\n      }\n      return true;\n    };\n  }\n\n  ['encode', 'decode', 'equals', '$normalize'].forEach(name => {\n    const paramTypeFn = type[name].bind(type);\n    const wrapperFn: Function = name === 'equals' ? arrayEqualsHandler : arrayHandler;\n    this[name] = wrapperFn(paramTypeFn);\n  });\n\n  extend(this, {\n    dynamic: type.dynamic,\n    name: type.name,\n    pattern: type.pattern,\n    inherit: type.inherit,\n    raw: type.raw,\n    is: arrayHandler(type.is.bind(type), true),\n    $arrayMode: mode,\n  });\n}\n","/**\n * @coreapi\n * @module params\n */ /** for typedoc */\nimport { extend, filter, map, allTrueR } from '../common/common';\nimport { prop } from '../common/hof';\nimport { isInjectable, isDefined, isString, isArray, isUndefined } from '../common/predicates';\nimport { RawParams, ParamDeclaration } from '../params/interface';\nimport { services } from '../common/coreservices';\nimport { ParamType } from './paramType';\nimport { ParamTypes } from './paramTypes';\nimport { UrlMatcherFactory } from '../url/urlMatcherFactory';\nimport { StateDeclaration } from '../state';\n\n/** @hidden */\nconst hasOwn = Object.prototype.hasOwnProperty;\n\n/** @hidden */\nconst isShorthand = (cfg: ParamDeclaration) =>\n  ['value', 'type', 'squash', 'array', 'dynamic'].filter(hasOwn.bind(cfg || {})).length === 0;\n\n/** @internalapi */\nenum DefType {\n  PATH,\n  SEARCH,\n  CONFIG,\n}\nexport { DefType };\n\nfunction getParamDeclaration(paramName: string, location: DefType, state: StateDeclaration): ParamDeclaration {\n  const noReloadOnSearch = (state.reloadOnSearch === false && location === DefType.SEARCH) || undefined;\n  const dynamic = [state.dynamic, noReloadOnSearch].find(isDefined);\n  const defaultConfig = isDefined(dynamic) ? { dynamic } : {};\n  const paramConfig = unwrapShorthand(state && state.params && state.params[paramName]);\n  return extend(defaultConfig, paramConfig);\n}\n\n/** @hidden */\nfunction unwrapShorthand(cfg: ParamDeclaration): ParamDeclaration {\n  cfg = isShorthand(cfg) ? ({ value: cfg } as ParamDeclaration) : cfg;\n\n  getStaticDefaultValue['__cacheable'] = true;\n  function getStaticDefaultValue() {\n    return cfg.value;\n  }\n\n  const $$fn = isInjectable(cfg.value) ? cfg.value : getStaticDefaultValue;\n  return extend(cfg, { $$fn });\n}\n\n/** @hidden */\nfunction getType(cfg: ParamDeclaration, urlType: ParamType, location: DefType, id: string, paramTypes: ParamTypes) {\n  if (cfg.type && urlType && urlType.name !== 'string') throw new Error(`Param '${id}' has two type configurations.`);\n  if (cfg.type && urlType && urlType.name === 'string' && paramTypes.type(cfg.type as string))\n    return paramTypes.type(cfg.type as string);\n  if (urlType) return urlType;\n  if (!cfg.type) {\n    const type =\n      location === DefType.CONFIG\n        ? 'any'\n        : location === DefType.PATH\n          ? 'path'\n          : location === DefType.SEARCH\n            ? 'query'\n            : 'string';\n    return paramTypes.type(type);\n  }\n  return cfg.type instanceof ParamType ? cfg.type : paramTypes.type(cfg.type as string);\n}\n\n/**\n * @internalapi\n * returns false, true, or the squash value to indicate the \"default parameter url squash policy\".\n */\nfunction getSquashPolicy(config: ParamDeclaration, isOptional: boolean, defaultPolicy: boolean | string) {\n  const squash = config.squash;\n  if (!isOptional || squash === false) return false;\n  if (!isDefined(squash) || squash == null) return defaultPolicy;\n  if (squash === true || isString(squash)) return squash;\n  throw new Error(`Invalid squash policy: '${squash}'. Valid policies: false, true, or arbitrary string`);\n}\n\n/** @internalapi */\nfunction getReplace(config: ParamDeclaration, arrayMode: boolean, isOptional: boolean, squash: string | boolean) {\n  const defaultPolicy = [\n    { from: '', to: isOptional || arrayMode ? undefined : '' },\n    { from: null, to: isOptional || arrayMode ? undefined : '' },\n  ];\n\n  const replace = isArray(config.replace) ? config.replace : [];\n  if (isString(squash)) replace.push({ from: squash, to: undefined });\n\n  const configuredKeys = map(replace, prop('from'));\n  return filter(defaultPolicy, item => configuredKeys.indexOf(item.from) === -1).concat(replace);\n}\n\n/** @internalapi */\nexport class Param {\n  id: string;\n  type: ParamType;\n  location: DefType;\n  isOptional: boolean;\n  dynamic: boolean;\n  raw: boolean;\n  squash: boolean | string;\n  replace: [{ to: any; from: any }];\n  inherit: boolean;\n  array: boolean;\n  config: any;\n  /** Cache the default value if it is a static value */\n  _defaultValueCache: {\n    defaultValue: any;\n  };\n\n  static values(params: Param[], values: RawParams = {}): RawParams {\n    const paramValues = {} as RawParams;\n    for (const param of params) {\n      paramValues[param.id] = param.value(values[param.id]);\n    }\n    return paramValues;\n  }\n\n  /**\n   * Finds [[Param]] objects which have different param values\n   *\n   * Filters a list of [[Param]] objects to only those whose parameter values differ in two param value objects\n   *\n   * @param params: The list of Param objects to filter\n   * @param values1: The first set of parameter values\n   * @param values2: the second set of parameter values\n   *\n   * @returns any Param objects whose values were different between values1 and values2\n   */\n  static changed(params: Param[], values1: RawParams = {}, values2: RawParams = {}): Param[] {\n    return params.filter(param => !param.type.equals(values1[param.id], values2[param.id]));\n  }\n\n  /**\n   * Checks if two param value objects are equal (for a set of [[Param]] objects)\n   *\n   * @param params The list of [[Param]] objects to check\n   * @param values1 The first set of param values\n   * @param values2 The second set of param values\n   *\n   * @returns true if the param values in values1 and values2 are equal\n   */\n  static equals(params: Param[], values1 = {}, values2 = {}): boolean {\n    return Param.changed(params, values1, values2).length === 0;\n  }\n\n  /** Returns true if a the parameter values are valid, according to the Param definitions */\n  static validates(params: Param[], values: RawParams = {}): boolean {\n    return params.map(param => param.validates(values[param.id])).reduce(allTrueR, true);\n  }\n\n  constructor(\n    id: string,\n    type: ParamType,\n    location: DefType,\n    urlMatcherFactory: UrlMatcherFactory,\n    state: StateDeclaration\n  ) {\n    const config: ParamDeclaration = getParamDeclaration(id, location, state);\n    type = getType(config, type, location, id, urlMatcherFactory.paramTypes);\n    const arrayMode = getArrayMode();\n    type = arrayMode ? type.$asArray(arrayMode, location === DefType.SEARCH) : type;\n    const isOptional = config.value !== undefined || location === DefType.SEARCH;\n    const dynamic = isDefined(config.dynamic) ? !!config.dynamic : !!type.dynamic;\n    const raw = isDefined(config.raw) ? !!config.raw : !!type.raw;\n    const squash = getSquashPolicy(config, isOptional, urlMatcherFactory.defaultSquashPolicy());\n    const replace = getReplace(config, arrayMode, isOptional, squash);\n    const inherit = isDefined(config.inherit) ? !!config.inherit : !!type.inherit;\n\n    // array config: param name (param[]) overrides default settings.  explicit config overrides param name.\n    function getArrayMode() {\n      const arrayDefaults = { array: location === DefType.SEARCH ? 'auto' : false };\n      const arrayParamNomenclature = id.match(/\\[\\]$/) ? { array: true } : {};\n      return extend(arrayDefaults, arrayParamNomenclature, config).array;\n    }\n\n    extend(this, { id, type, location, isOptional, dynamic, raw, squash, replace, inherit, array: arrayMode, config });\n  }\n\n  isDefaultValue(value: any): boolean {\n    return this.isOptional && this.type.equals(this.value(), value);\n  }\n\n  /**\n   * [Internal] Gets the decoded representation of a value if the value is defined, otherwise, returns the\n   * default value, which may be the result of an injectable function.\n   */\n  value(value?: any): any {\n    /**\n     * [Internal] Get the default value of a parameter, which may be an injectable function.\n     */\n    const getDefaultValue = () => {\n      if (this._defaultValueCache) return this._defaultValueCache.defaultValue;\n\n      if (!services.$injector) throw new Error('Injectable functions cannot be called at configuration time');\n\n      const defaultValue = services.$injector.invoke(this.config.$$fn);\n\n      if (defaultValue !== null && defaultValue !== undefined && !this.type.is(defaultValue))\n        throw new Error(\n          `Default value (${defaultValue}) for parameter '${this.id}' is not an instance of ParamType (${\n            this.type.name\n          })`\n        );\n\n      if (this.config.$$fn['__cacheable']) {\n        this._defaultValueCache = { defaultValue };\n      }\n\n      return defaultValue;\n    };\n\n    const replaceSpecialValues = (val: any) => {\n      for (const tuple of this.replace) {\n        if (tuple.from === val) return tuple.to;\n      }\n      return val;\n    };\n\n    value = replaceSpecialValues(value);\n\n    return isUndefined(value) ? getDefaultValue() : this.type.$normalize(value);\n  }\n\n  isSearch(): boolean {\n    return this.location === DefType.SEARCH;\n  }\n\n  validates(value: any): boolean {\n    // There was no parameter value, but the param is optional\n    if ((isUndefined(value) || value === null) && this.isOptional) return true;\n\n    // The value was not of the correct ParamType, and could not be decoded to the correct ParamType\n    const normalized = this.type.$normalize(value);\n    if (!this.type.is(normalized)) return false;\n\n    // The value was of the correct type, but when encoded, did not match the ParamType's regexp\n    const encoded = this.type.encode(normalized);\n    return !(isString(encoded) && !this.type.pattern.exec(<string>encoded));\n  }\n\n  toString() {\n    return `{Param:${this.id} ${this.type} squash: '${this.squash}' optional: ${this.isOptional}}`;\n  }\n}\n","/**\n * @coreapi\n * @module params\n */\n/** */\nimport { fromJson, toJson, identity, equals, inherit, map, extend, pick } from '../common/common';\nimport { isDefined, isNullOrUndefined } from '../common/predicates';\nimport { is } from '../common/hof';\nimport { services } from '../common/coreservices';\nimport { ParamType } from './paramType';\nimport { ParamTypeDefinition } from './interface';\n\n/**\n * A registry for parameter types.\n *\n * This registry manages the built-in (and custom) parameter types.\n *\n * The built-in parameter types are:\n *\n * - [[string]]\n * - [[path]]\n * - [[query]]\n * - [[hash]]\n * - [[int]]\n * - [[bool]]\n * - [[date]]\n * - [[json]]\n * - [[any]]\n */\nexport class ParamTypes {\n  /**\n   * Built-in parameter type: `string`\n   *\n   * This parameter type coerces values to strings.\n   * It matches anything (`new RegExp(\".*\")`) in the URL\n   */\n  static string: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `path`\n   *\n   * This parameter type is the default type for path parameters.\n   * A path parameter is any parameter declared in the path portion of a url\n   *\n   * - `/foo/:param1/:param2`: two path parameters\n   *\n   * This parameter type behaves exactly like the [[string]] type with one exception.\n   * When matching parameter values in the URL, the `path` type does not match forward slashes `/`.\n   *\n   * #### Angular 1 note:\n   * In ng1, this type is overridden with one that pre-encodes slashes as `~2F` instead of `%2F`.\n   * For more details about this angular 1 behavior, see: https://github.com/angular-ui/ui-router/issues/2598\n   */\n  static path: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `query`\n   *\n   * This parameter type is the default type for query/search parameters.\n   * It behaves the same as the [[string]] parameter type.\n   *\n   * A query parameter is any parameter declared in the query/search portion of a url\n   *\n   * - `/bar?param2`: a query parameter\n   */\n  static query: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `hash`\n   *\n   * This parameter type is used for the `#` parameter (the hash)\n   * It behaves the same as the [[string]] parameter type.\n   * @coreapi\n   */\n  static hash: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `int`\n   *\n   * This parameter type serializes javascript integers (`number`s which represent an integer) to the URL.\n   *\n   * #### Example:\n   * ```js\n   * .state({\n   *   name: 'user',\n   *   url: '/user/{id:int}'\n   * });\n   * ```\n   * ```js\n   * $state.go('user', { id: 1298547 });\n   * ```\n   *\n   * The URL will serialize to: `/user/1298547`.\n   *\n   * When the parameter value is read, it will be the `number` `1298547`, not the string `\"1298547\"`.\n   */\n  static int: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `bool`\n   *\n   * This parameter type serializes `true`/`false` as `1`/`0`\n   *\n   * #### Example:\n   * ```js\n   * .state({\n   *   name: 'inbox',\n   *   url: '/inbox?{unread:bool}'\n   * });\n   * ```\n   * ```js\n   * $state.go('inbox', { unread: true });\n   * ```\n   *\n   * The URL will serialize to: `/inbox?unread=1`.\n   *\n   * Conversely, if the url is `/inbox?unread=0`, the value of the `unread` parameter will be a `false`.\n   */\n  static bool: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `date`\n   *\n   * This parameter type can be used to serialize Javascript dates as parameter values.\n   *\n   * #### Example:\n   * ```js\n   * .state({\n   *   name: 'search',\n   *   url: '/search?{start:date}'\n   * });\n   * ```\n   * ```js\n   * $state.go('search', { start: new Date(2000, 0, 1) });\n   * ```\n   *\n   * The URL will serialize to: `/search?start=2000-01-01`.\n   *\n   * Conversely, if the url is `/search?start=2016-12-25`, the value of the `start` parameter will be a `Date` object where:\n   *\n   * - `date.getFullYear() === 2016`\n   * - `date.getMonth() === 11` (month is 0-based)\n   * - `date.getDate() === 25`\n   */\n  static date: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `json`\n   *\n   * This parameter type can be used to serialize javascript objects into the URL using JSON serialization.\n   *\n   * #### Example:\n   * This example serializes an plain javascript object to the URL\n   * ```js\n   * .state({\n   *   name: 'map',\n   *   url: '/map/{coords:json}'\n   * });\n   * ```\n   * ```js\n   * $state.go('map', { coords: { x: 10399.2, y: 49071 });\n   * ```\n   *\n   * The URL will serialize to: `/map/%7B%22x%22%3A10399.2%2C%22y%22%3A49071%7D`\n   */\n  static json: ParamTypeDefinition;\n\n  /**\n   * Built-in parameter type: `any`\n   *\n   * This parameter type is used by default for url-less parameters (parameters that do not appear in the URL).\n   * This type does not encode or decode.\n   * It is compared using a deep `equals` comparison.\n   *\n   * #### Example:\n   * This example defines a non-url parameter on a [[StateDeclaration]].\n   * ```js\n   * .state({\n   *   name: 'new',\n   *   url: '/new',\n   *   params: {\n   *     inrepyto: null\n   *   }\n   * });\n   * ```\n   * ```js\n   * $state.go('new', { inreplyto: currentMessage });\n   * ```\n   */\n  static any: ParamTypeDefinition;\n\n  /** @hidden */\n  types: any;\n  /** @hidden */\n  enqueue = true;\n  /** @hidden */\n  typeQueue: any[] = [];\n\n  /** @internalapi */\n  private defaultTypes: any = pick(ParamTypes.prototype, [\n    'hash',\n    'string',\n    'query',\n    'path',\n    'int',\n    'bool',\n    'date',\n    'json',\n    'any',\n  ]);\n\n  /** @internalapi */\n  constructor() {\n    // Register default types. Store them in the prototype of this.types.\n    const makeType = (definition: ParamTypeDefinition, name: string) => new ParamType(extend({ name }, definition));\n    this.types = inherit(map(this.defaultTypes, makeType), {});\n  }\n\n  /** @internalapi */\n  dispose() {\n    this.types = {};\n  }\n\n  /**\n   * Registers a parameter type\n   *\n   * End users should call [[UrlMatcherFactory.type]], which delegates to this method.\n   */\n  type(name: string, definition?: ParamTypeDefinition, definitionFn?: () => ParamTypeDefinition) {\n    if (!isDefined(definition)) return this.types[name];\n    if (this.types.hasOwnProperty(name)) throw new Error(`A type named '${name}' has already been defined.`);\n\n    this.types[name] = new ParamType(extend({ name }, definition));\n\n    if (definitionFn) {\n      this.typeQueue.push({ name, def: definitionFn });\n      if (!this.enqueue) this._flushTypeQueue();\n    }\n\n    return this;\n  }\n\n  /** @internalapi */\n  _flushTypeQueue() {\n    while (this.typeQueue.length) {\n      const type = this.typeQueue.shift();\n      if (type.pattern) throw new Error(\"You cannot override a type's .pattern at runtime.\");\n      extend(this.types[type.name], services.$injector.invoke(type.def));\n    }\n  }\n}\n\n/** @hidden */\nfunction initDefaultTypes() {\n  const makeDefaultType = def => {\n    const valToString = (val: any) => (val != null ? val.toString() : val);\n\n    const defaultTypeBase = {\n      encode: valToString,\n      decode: valToString,\n      is: is(String),\n      pattern: /.*/,\n      // tslint:disable-next-line:triple-equals\n      equals: (a: any, b: any) => a == b, // allow coersion for null/undefined/\"\"\n    };\n\n    return extend({}, defaultTypeBase, def) as ParamTypeDefinition;\n  };\n\n  // Default Parameter Type Definitions\n  extend(ParamTypes.prototype, {\n    string: makeDefaultType({}),\n\n    path: makeDefaultType({\n      pattern: /[^/]*/,\n    }),\n\n    query: makeDefaultType({}),\n\n    hash: makeDefaultType({\n      inherit: false,\n    }),\n\n    int: makeDefaultType({\n      decode: (val: string) => parseInt(val, 10),\n      is: function(val: any) {\n        return !isNullOrUndefined(val) && this.decode(val.toString()) === val;\n      },\n      pattern: /-?\\d+/,\n    }),\n\n    bool: makeDefaultType({\n      encode: (val: any) => (val && 1) || 0,\n      decode: (val: string) => parseInt(val, 10) !== 0,\n      is: is(Boolean),\n      pattern: /0|1/,\n    }),\n\n    date: makeDefaultType({\n      encode: function(val: any) {\n        return !this.is(val)\n          ? undefined\n          : [val.getFullYear(), ('0' + (val.getMonth() + 1)).slice(-2), ('0' + val.getDate()).slice(-2)].join('-');\n      },\n      decode: function(val: string) {\n        if (this.is(val)) return (<any>val) as Date;\n        const match = this.capture.exec(val);\n        return match ? new Date(match[1], match[2] - 1, match[3]) : undefined;\n      },\n      is: (val: any) => val instanceof Date && !isNaN(val.valueOf()),\n      equals(l: any, r: any) {\n        return ['getFullYear', 'getMonth', 'getDate'].reduce((acc, fn) => acc && l[fn]() === r[fn](), true);\n      },\n      pattern: /[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/,\n      capture: /([0-9]{4})-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])/,\n    }),\n\n    json: makeDefaultType({\n      encode: toJson,\n      decode: fromJson,\n      is: is(Object),\n      equals: equals,\n      pattern: /[^/]*/,\n    }),\n\n    // does not encode/decode\n    any: makeDefaultType({\n      encode: identity,\n      decode: identity,\n      is: () => true,\n      equals: equals,\n    }),\n  });\n}\n\ninitDefaultTypes();\n","/**\n * @coreapi\n * @module params\n */\n/** */\nimport { extend, ancestors, Obj } from '../common/common';\nimport { StateObject } from '../state/stateObject';\n\n/** @internalapi */\nexport class StateParams {\n  [key: string]: any;\n\n  constructor(params: Obj = {}) {\n    extend(this, params);\n  }\n\n  /**\n   * Merges a set of parameters with all parameters inherited between the common parents of the\n   * current state and a given destination state.\n   *\n   * @param {Object} newParams The set of parameters which will be composited with inherited params.\n   * @param {Object} $current Internal definition of object representing the current state.\n   * @param {Object} $to Internal definition of object representing state to transition to.\n   */\n  $inherit(newParams: Obj, $current: StateObject, $to: StateObject) {\n    let parentParams: string[];\n    const parents = ancestors($current, $to),\n      inherited: Obj = {},\n      inheritList: string[] = [];\n\n    for (const i in parents) {\n      if (!parents[i] || !parents[i].params) continue;\n      parentParams = Object.keys(parents[i].params);\n      if (!parentParams.length) continue;\n\n      for (const j in parentParams) {\n        if (inheritList.indexOf(parentParams[j]) >= 0) continue;\n        inheritList.push(parentParams[j]);\n        inherited[parentParams[j]] = this[parentParams[j]];\n      }\n    }\n    return extend({}, inherited, newParams);\n  }\n}\n","/** @module path */ /** for typedoc */\nimport { extend, applyPairs, find, allTrueR, pairs, arrayTuples } from '../common/common';\nimport { propEq } from '../common/hof';\nimport { StateObject } from '../state/stateObject';\nimport { RawParams } from '../params/interface';\nimport { Param } from '../params/param';\nimport { Resolvable } from '../resolve/resolvable';\nimport { ViewConfig } from '../view/interface';\n\n/**\n * @internalapi\n *\n * A node in a [[TreeChanges]] path\n *\n * For a [[TreeChanges]] path, this class holds the stateful information for a single node in the path.\n * Each PathNode corresponds to a state being entered, exited, or retained.\n * The stateful information includes parameter values and resolve data.\n */\nexport class PathNode {\n  /** The state being entered, exited, or retained */\n  public state: StateObject;\n  /** The parameters declared on the state */\n  public paramSchema: Param[];\n  /** The parameter values that belong to the state */\n  public paramValues: { [key: string]: any };\n  /** The individual (stateful) resolvable objects that belong to the state */\n  public resolvables: Resolvable[];\n  /** The state's declared view configuration objects */\n  public views: ViewConfig[];\n\n  /**\n   * Returns a clone of the PathNode\n   * @deprecated use instance method `node.clone()`\n   */\n  static clone = (node: PathNode) => node.clone();\n\n  /** Creates a copy of a PathNode */\n  constructor(node: PathNode);\n  /** Creates a new (empty) PathNode for a State */\n  constructor(state: StateObject);\n  constructor(stateOrNode: any) {\n    if (stateOrNode instanceof PathNode) {\n      const node: PathNode = stateOrNode;\n      this.state = node.state;\n      this.paramSchema = node.paramSchema.slice();\n      this.paramValues = extend({}, node.paramValues);\n      this.resolvables = node.resolvables.slice();\n      this.views = node.views && node.views.slice();\n    } else {\n      const state: StateObject = stateOrNode;\n      this.state = state;\n      this.paramSchema = state.parameters({ inherit: false });\n      this.paramValues = {};\n      this.resolvables = state.resolvables.map(res => res.clone());\n    }\n  }\n\n  clone() {\n    return new PathNode(this);\n  }\n\n  /** Sets [[paramValues]] for the node, from the values of an object hash */\n  applyRawParams(params: RawParams): PathNode {\n    const getParamVal = (paramDef: Param) => [paramDef.id, paramDef.value(params[paramDef.id])];\n    this.paramValues = this.paramSchema.reduce((memo, pDef) => applyPairs(memo, getParamVal(pDef)), {});\n    return this;\n  }\n\n  /** Gets a specific [[Param]] metadata that belongs to the node */\n  parameter(name: string): Param {\n    return find(this.paramSchema, propEq('id', name));\n  }\n\n  /**\n   * @returns true if the state and parameter values for another PathNode are\n   * equal to the state and param values for this PathNode\n   */\n  equals(node: PathNode, paramsFn?: GetParamsFn): boolean {\n    const diff = this.diff(node, paramsFn);\n    return diff && diff.length === 0;\n  }\n\n  /**\n   * Finds Params with different parameter values on another PathNode.\n   *\n   * Given another node (of the same state), finds the parameter values which differ.\n   * Returns the [[Param]] (schema objects) whose parameter values differ.\n   *\n   * Given another node for a different state, returns `false`\n   *\n   * @param node The node to compare to\n   * @param paramsFn A function that returns which parameters should be compared.\n   * @returns The [[Param]]s which differ, or null if the two nodes are for different states\n   */\n  diff(node: PathNode, paramsFn?: GetParamsFn): Param[] | false {\n    if (this.state !== node.state) return false;\n\n    const params: Param[] = paramsFn ? paramsFn(this) : this.paramSchema;\n    return Param.changed(params, this.paramValues, node.paramValues);\n  }\n}\n\n/** @hidden */\nexport type GetParamsFn = (pathNode: PathNode) => Param[];\n","/**\n * @coreapi\n * @module state\n */ /** for typedoc */\n\nimport { StateDeclaration, StateOrName, TargetStateDef } from './interface';\nimport { TransitionOptions } from '../transition/interface';\nimport { StateObject } from './stateObject';\nimport { isString } from '../common/predicates';\nimport { stringify } from '../common/strings';\nimport { extend } from '../common';\nimport { StateRegistry } from './stateRegistry';\nimport { RawParams } from '../params';\n\n/**\n * Encapsulate the target (destination) state/params/options of a [[Transition]].\n *\n * This class is frequently used to redirect a transition to a new destination.\n *\n * See:\n *\n * - [[HookResult]]\n * - [[TransitionHookFn]]\n * - [[TransitionService.onStart]]\n *\n * To create a `TargetState`, use [[StateService.target]].\n *\n * ---\n *\n * This class wraps:\n *\n * 1) an identifier for a state\n * 2) a set of parameters\n * 3) and transition options\n * 4) the registered state object (the [[StateDeclaration]])\n *\n * Many UI-Router APIs such as [[StateService.go]] take a [[StateOrName]] argument which can\n * either be a *state object* (a [[StateDeclaration]] or [[StateObject]]) or a *state name* (a string).\n * The `TargetState` class normalizes those options.\n *\n * A `TargetState` may be valid (the state being targeted exists in the registry)\n * or invalid (the state being targeted is not registered).\n */\nexport class TargetState {\n  private _definition: StateObject;\n  private _params: RawParams;\n  private _options: TransitionOptions;\n\n  /** Returns true if the object has a state property that might be a state or state name */\n  static isDef = (obj): obj is TargetStateDef => obj && obj.state && (isString(obj.state) || isString(obj.state.name));\n\n  /**\n   * The TargetState constructor\n   *\n   * Note: Do not construct a `TargetState` manually.\n   * To create a `TargetState`, use the [[StateService.target]] factory method.\n   *\n   * @param _stateRegistry The StateRegistry to use to look up the _definition\n   * @param _identifier An identifier for a state.\n   *    Either a fully-qualified state name, or the object used to define the state.\n   * @param _params Parameters for the target state\n   * @param _options Transition options.\n   *\n   * @internalapi\n   */\n  constructor(\n    private _stateRegistry: StateRegistry,\n    private _identifier: StateOrName,\n    _params?: RawParams,\n    _options?: TransitionOptions\n  ) {\n    this._identifier = _identifier;\n    this._params = extend({}, _params || {});\n    this._options = extend({}, _options || {});\n    this._definition = _stateRegistry.matcher.find(_identifier, this._options.relative);\n  }\n\n  /** The name of the state this object targets */\n  name(): string {\n    return (this._definition && this._definition.name) || <string>this._identifier;\n  }\n\n  /** The identifier used when creating this TargetState */\n  identifier(): StateOrName {\n    return this._identifier;\n  }\n\n  /** The target parameter values */\n  params(): RawParams {\n    return this._params;\n  }\n\n  /** The internal state object (if it was found) */\n  $state(): StateObject {\n    return this._definition;\n  }\n\n  /** The internal state declaration (if it was found) */\n  state(): StateDeclaration {\n    return this._definition && this._definition.self;\n  }\n\n  /** The target options */\n  options() {\n    return this._options;\n  }\n\n  /** True if the target state was found */\n  exists(): boolean {\n    return !!(this._definition && this._definition.self);\n  }\n\n  /** True if the object is valid */\n  valid(): boolean {\n    return !this.error();\n  }\n\n  /** If the object is invalid, returns the reason why */\n  error(): string {\n    const base = <any>this.options().relative;\n    if (!this._definition && !!base) {\n      const stateName = base.name ? base.name : base;\n      return `Could not resolve '${this.name()}' from state '${stateName}'`;\n    }\n    if (!this._definition) return `No such state '${this.name()}'`;\n    if (!this._definition.self) return `State '${this.name()}' has an invalid definition`;\n  }\n\n  toString() {\n    return `'${this.name()}'${stringify(this.params())}`;\n  }\n\n  /**\n   * Returns a copy of this TargetState which targets a different state.\n   * The new TargetState has the same parameter values and transition options.\n   *\n   * @param state The new state that should be targeted\n   */\n  withState(state: StateOrName): TargetState {\n    return new TargetState(this._stateRegistry, state, this._params, this._options);\n  }\n\n  /**\n   * Returns a copy of this TargetState, using the specified parameter values.\n   *\n   * @param params the new parameter values to use\n   * @param replace When false (default) the new parameter values will be merged with the current values.\n   *                When true the parameter values will be used instead of the current values.\n   */\n  withParams(params: RawParams, replace = false): TargetState {\n    const newParams: RawParams = replace ? params : extend({}, this._params, params);\n    return new TargetState(this._stateRegistry, this._identifier, newParams, this._options);\n  }\n\n  /**\n   * Returns a copy of this TargetState, using the specified Transition Options.\n   *\n   * @param options the new options to use\n   * @param replace When false (default) the new options will be merged with the current options.\n   *                When true the options will be used instead of the current options.\n   */\n  withOptions(options: TransitionOptions, replace = false): TargetState {\n    const newOpts = replace ? options : extend({}, this._options, options);\n    return new TargetState(this._stateRegistry, this._identifier, this._params, newOpts);\n  }\n}\n","/** @module path */ /** for typedoc */\n\nimport {\n  extend,\n  find,\n  pick,\n  omit,\n  tail,\n  mergeR,\n  values,\n  unnestR,\n  Predicate,\n  inArray,\n  arrayTuples,\n} from '../common/common';\nimport { prop, propEq, not } from '../common/hof';\n\nimport { RawParams } from '../params/interface';\nimport { TreeChanges } from '../transition/interface';\nimport { ViewConfig } from '../view/interface';\nimport { _ViewDeclaration } from '../state/interface';\n\nimport { StateObject } from '../state/stateObject';\nimport { TargetState } from '../state/targetState';\nimport { GetParamsFn, PathNode } from './pathNode';\nimport { ViewService } from '../view/view';\nimport { Param } from '../params/param';\nimport { StateRegistry } from '../state';\n\n/**\n * This class contains functions which convert TargetStates, Nodes and paths from one type to another.\n */\nexport class PathUtils {\n  /** Given a PathNode[], create an TargetState */\n  static makeTargetState(registry: StateRegistry, path: PathNode[]): TargetState {\n    const state = tail(path).state;\n    return new TargetState(registry, state, path.map(prop('paramValues')).reduce(mergeR, {}), {});\n  }\n\n  static buildPath(targetState: TargetState) {\n    const toParams = targetState.params();\n    return targetState.$state().path.map(state => new PathNode(state).applyRawParams(toParams));\n  }\n\n  /** Given a fromPath: PathNode[] and a TargetState, builds a toPath: PathNode[] */\n  static buildToPath(fromPath: PathNode[], targetState: TargetState): PathNode[] {\n    const toPath: PathNode[] = PathUtils.buildPath(targetState);\n    if (targetState.options().inherit) {\n      return PathUtils.inheritParams(fromPath, toPath, Object.keys(targetState.params()));\n    }\n    return toPath;\n  }\n\n  /**\n   * Creates ViewConfig objects and adds to nodes.\n   *\n   * On each [[PathNode]], creates ViewConfig objects from the views: property of the node's state\n   */\n  static applyViewConfigs($view: ViewService, path: PathNode[], states: StateObject[]) {\n    // Only apply the viewConfigs to the nodes for the given states\n    path.filter(node => inArray(states, node.state)).forEach(node => {\n      const viewDecls: _ViewDeclaration[] = values(node.state.views || {});\n      const subPath = PathUtils.subPath(path, n => n === node);\n      const viewConfigs: ViewConfig[][] = viewDecls.map(view => $view.createViewConfig(subPath, view));\n      node.views = viewConfigs.reduce(unnestR, []);\n    });\n  }\n\n  /**\n   * Given a fromPath and a toPath, returns a new to path which inherits parameters from the fromPath\n   *\n   * For a parameter in a node to be inherited from the from path:\n   * - The toPath's node must have a matching node in the fromPath (by state).\n   * - The parameter name must not be found in the toKeys parameter array.\n   *\n   * Note: the keys provided in toKeys are intended to be those param keys explicitly specified by some\n   * caller, for instance, $state.transitionTo(..., toParams).  If a key was found in toParams,\n   * it is not inherited from the fromPath.\n   */\n  static inheritParams(fromPath: PathNode[], toPath: PathNode[], toKeys: string[] = []): PathNode[] {\n    function nodeParamVals(path: PathNode[], state: StateObject): RawParams {\n      const node: PathNode = find(path, propEq('state', state));\n      return extend({}, node && node.paramValues);\n    }\n\n    const noInherit = fromPath\n      .map(node => node.paramSchema)\n      .reduce(unnestR, [])\n      .filter(param => !param.inherit)\n      .map(prop('id'));\n\n    /**\n     * Given an [[PathNode]] \"toNode\", return a new [[PathNode]] with param values inherited from the\n     * matching node in fromPath.  Only inherit keys that aren't found in \"toKeys\" from the node in \"fromPath\"\"\n     */\n    function makeInheritedParamsNode(toNode: PathNode): PathNode {\n      // All param values for the node (may include default key/vals, when key was not found in toParams)\n      let toParamVals = extend({}, toNode && toNode.paramValues);\n      // limited to only those keys found in toParams\n      const incomingParamVals = pick(toParamVals, toKeys);\n      toParamVals = omit(toParamVals, toKeys);\n      const fromParamVals = omit(nodeParamVals(fromPath, toNode.state) || {}, noInherit);\n      // extend toParamVals with any fromParamVals, then override any of those those with incomingParamVals\n      const ownParamVals: RawParams = extend(toParamVals, fromParamVals, incomingParamVals);\n      return new PathNode(toNode.state).applyRawParams(ownParamVals);\n    }\n\n    // The param keys specified by the incoming toParams\n    return <PathNode[]>toPath.map(makeInheritedParamsNode);\n  }\n\n  static nonDynamicParams = (node: PathNode): Param[] =>\n    node.state.parameters({ inherit: false }).filter(param => !param.dynamic);\n\n  /**\n   * Computes the tree changes (entering, exiting) between a fromPath and toPath.\n   */\n  static treeChanges(fromPath: PathNode[], toPath: PathNode[], reloadState: StateObject): TreeChanges {\n    const max = Math.min(fromPath.length, toPath.length);\n    let keep = 0;\n\n    const nodesMatch = (node1: PathNode, node2: PathNode) => node1.equals(node2, PathUtils.nonDynamicParams);\n\n    while (keep < max && fromPath[keep].state !== reloadState && nodesMatch(fromPath[keep], toPath[keep])) {\n      keep++;\n    }\n\n    /** Given a retained node, return a new node which uses the to node's param values */\n    function applyToParams(retainedNode: PathNode, idx: number): PathNode {\n      const cloned = retainedNode.clone();\n      cloned.paramValues = toPath[idx].paramValues;\n      return cloned;\n    }\n\n    let from: PathNode[], retained: PathNode[], exiting: PathNode[], entering: PathNode[], to: PathNode[];\n\n    from = fromPath;\n    retained = from.slice(0, keep);\n    exiting = from.slice(keep);\n\n    // Create a new retained path (with shallow copies of nodes) which have the params of the toPath mapped\n    const retainedWithToParams = retained.map(applyToParams);\n    entering = toPath.slice(keep);\n    to = retainedWithToParams.concat(entering);\n\n    return { from, to, retained, retainedWithToParams, exiting, entering };\n  }\n\n  /**\n   * Returns a new path which is: the subpath of the first path which matches the second path.\n   *\n   * The new path starts from root and contains any nodes that match the nodes in the second path.\n   * It stops before the first non-matching node.\n   *\n   * Nodes are compared using their state property and their parameter values.\n   * If a `paramsFn` is provided, only the [[Param]] returned by the function will be considered when comparing nodes.\n   *\n   * @param pathA the first path\n   * @param pathB the second path\n   * @param paramsFn a function which returns the parameters to consider when comparing\n   *\n   * @returns an array of PathNodes from the first path which match the nodes in the second path\n   */\n  static matching(pathA: PathNode[], pathB: PathNode[], paramsFn?: GetParamsFn): PathNode[] {\n    let done = false;\n    const tuples: PathNode[][] = arrayTuples(pathA, pathB);\n    return tuples.reduce((matching, [nodeA, nodeB]) => {\n      done = done || !nodeA.equals(nodeB, paramsFn);\n      return done ? matching : matching.concat(nodeA);\n    }, []);\n  }\n\n  /**\n   * Returns true if two paths are identical.\n   *\n   * @param pathA\n   * @param pathB\n   * @param paramsFn a function which returns the parameters to consider when comparing\n   * @returns true if the the states and parameter values for both paths are identical\n   */\n  static equals(pathA: PathNode[], pathB: PathNode[], paramsFn?: GetParamsFn): boolean {\n    return pathA.length === pathB.length && PathUtils.matching(pathA, pathB, paramsFn).length === pathA.length;\n  }\n\n  /**\n   * Return a subpath of a path, which stops at the first matching node\n   *\n   * Given an array of nodes, returns a subset of the array starting from the first node,\n   * stopping when the first node matches the predicate.\n   *\n   * @param path a path of [[PathNode]]s\n   * @param predicate a [[Predicate]] fn that matches [[PathNode]]s\n   * @returns a subpath up to the matching node, or undefined if no match is found\n   */\n  static subPath(path: PathNode[], predicate: Predicate<PathNode>): PathNode[] {\n    const node = find(path, predicate);\n    const elementIdx = path.indexOf(node);\n    return elementIdx === -1 ? undefined : path.slice(0, elementIdx + 1);\n  }\n\n  /** Gets the raw parameter values from a path */\n  static paramValues = (path: PathNode[]) => path.reduce((acc, node) => extend(acc, node.paramValues), {});\n}\n","/**\n * # The Resolve subsystem\n *\n * This subsystem is an asynchronous, hierarchical Dependency Injection system.\n *\n * Typically, resolve is configured on a state using a [[StateDeclaration.resolve]] declaration.\n *\n * @coreapi\n * @module resolve\n */ /** for typedoc */\nimport { Resolvable } from './resolvable';\n\n/**\n * An interface which is similar to an Angular 2 `Provider`\n */\nexport interface ProviderLike {\n  provide: any;\n  useClass?: any;\n  useFactory?: Function;\n  useValue?: any;\n  useExisting?: any;\n  deps?: any[];\n}\n\n/**\n * A plain object used to describe a [[Resolvable]]\n *\n * These objects may be used in the [[StateDeclaration.resolve]] array to declare\n * async data that the state or substates require.\n *\n * #### Example:\n * ```js\n *\n * var state = {\n *   name: 'main',\n *   resolve: [\n *     { token: 'myData', deps: [MyDataApi], resolveFn: (myDataApi) => myDataApi.getData() },\n *   ],\n * }\n * ```\n */\nexport interface ResolvableLiteral {\n  /**\n   * A Dependency Injection token\n   *\n   * This Resolvable's DI token.\n   * The Resolvable will be injectable elsewhere using the token.\n   */\n  token: any;\n\n  /**\n   * A function which fetches the Resolvable's data\n   *\n   * A function which returns one of:\n   *\n   * - The resolved value (synchronously)\n   * - A promise for the resolved value\n   * - An Observable of the resolved value(s)\n   *\n   * This function will be provided the dependencies listed in [[deps]] as its arguments.\n   * The resolve system will asynchronously fetch the dependencies before invoking this function.\n   */\n  resolveFn: Function;\n\n  /**\n   * Defines the Resolve Policy\n   *\n   * A policy that defines when to invoke the resolve,\n   * and whether to wait for async and unwrap the data\n   */\n  policy?: ResolvePolicy;\n\n  /**\n   * The Dependency Injection tokens\n   *\n   * This is an array of Dependency Injection tokens for the dependencies of the [[resolveFn]].\n   *\n   * The DI tokens are references to other `Resolvables`, or to other\n   * services from the native DI system.\n   */\n  deps?: any[];\n\n  /** Pre-resolved data. */\n  data?: any;\n}\n\n/**\n * Defines how a resolve is processed during a transition\n *\n * This object is the [[StateDeclaration.resolvePolicy]] property.\n *\n * #### Example:\n * ```js\n * // Fetched when the resolve's state is being entered.\n * // Wait for the promise to resolve.\n * var policy1 = { when: \"LAZY\", async: \"WAIT\" }\n *\n * // Fetched when the Transition is starting.\n * // Do not wait for the returned promise to resolve.\n * // Inject the raw promise/value\n * var policy2 = { when: \"EAGER\", async: \"NOWAIT\" }\n * ```\n *\n * The policy for a given Resolvable is merged from three sources (highest priority first):\n *\n * - 1) Individual resolve definition\n * - 2) State definition\n * - 3) Global default\n *\n * #### Example:\n * ```js\n * // Wait for an Observable to emit one item.\n * // Since `wait` is not specified, it uses the `wait`\n * // policy defined on the state, or the global default\n * // if no `wait` policy is defined on the state\n * var myResolvablePolicy = { async: \"RXWAIT\" }\n * ```\n */\nexport interface ResolvePolicy {\n  /**\n   * Defines when a Resolvable is resolved (fetched) during a transition\n   *\n   * - `LAZY` (default)\n   *   - Resolved as the resolve's state is being entered\n   * - `EAGER`\n   *   - Resolved as the transition is starting\n   *\n   * #### Example:\n   * Resolves for `main` and `main.home` are fetched when each state is entered.\n   * All of `main` resolves are processed before fetching `main.home` resolves.\n   * ```js\n   * var state = {\n   *   name: 'main',\n   *   resolve: mainResolves, // defined elsewhere\n   *   resolvePolicy: { when: 'LAZY' }, // default\n   * }\n   *\n   * var state = {\n   *   name: 'main.home',\n   *   resolve: homeResolves, // defined elsewhere\n   *   resolvePolicy: { when: 'LAZY' }, // default\n   * }\n   * ```\n   *\n   * #### Example:\n   * Resolves for `main` and `main.home` are fetched at the same time when the transition starts.\n   * This happens earlier in the lifecycle than when states are entered.\n   * All of the `main` and `main.home` resolves are fetched as soon as possible.\n   * ```js\n   * var mainState = {\n   *   name: 'main',\n   *   resolve: mainResolves, // defined elsewhere\n   *   resolvePolicy: { when: 'EAGER' },\n   * }\n   *\n   * var homeState = {\n   *   name: 'main.home',\n   *   resolve: homeResolves, // defined elsewhere\n   *   resolvePolicy: { when: 'EAGER' },\n   * }\n   * ```\n   */\n  when?: PolicyWhen;\n\n  /**\n   * Determines the unwrapping behavior of asynchronous resolve values.\n   *\n   * - `WAIT` (default)\n   *   - If a promise is returned from the resolveFn, wait for the promise before proceeding\n   *   - The unwrapped value from the promise\n   * - `NOWAIT`\n   *   - If a promise is returned from the resolve, do not wait for the promise.\n   *   - Any other value returned is wrapped in a promise.\n   *   - The promise will not be unwrapped.\n   *   - The promise itself will be provided when the resolve is injected or bound elsewhere.\n   * - `RXWAIT`\n   *   - When an Observable is returned from the resolveFn, wait until the Observable emits at least one item.\n   *   - The Observable item will not be unwrapped.\n   *   - The Observable stream itself will be provided when the resolve is injected or bound elsewhere.\n   *\n   * #### Example:\n   * The `Transition` will not wait for the resolve promise(s) from `main` to settle before continuing.\n   * Resolves for `main` will be provided to components wrapped in a `Promise`.\n   *\n   * The `Transition` will wait for the `main.home` resolve promises.\n   * Resolved values will be unwrapped before being provided to components.\n   * ```js\n   * var mainState = {\n   *   name: 'main',\n   *   resolve: mainResolves, // defined elsewhere\n   *   resolvePolicy: { async: 'NOWAIT' },\n   * }\n   * var homeState = {\n   *   name: 'main.home',\n   *   resolve: homeResolves, // defined elsewhere\n   *   resolvePolicy: { async: 'WAIT' }, // default\n   * }\n   * ```\n   */\n  async?: PolicyAsync;\n}\n\nexport type PolicyWhen = 'LAZY' | 'EAGER';\nexport type PolicyAsync = 'WAIT' | 'NOWAIT' | 'RXWAIT';\n\n/** @internalapi */\nexport let resolvePolicies = {\n  when: {\n    LAZY: 'LAZY',\n    EAGER: 'EAGER',\n  },\n  async: {\n    WAIT: 'WAIT',\n    NOWAIT: 'NOWAIT',\n    RXWAIT: 'RXWAIT',\n  },\n};\n","/**\n * @coreapi\n * @module resolve\n */ /** for typedoc */\nimport { extend, equals, inArray, identity } from '../common/common';\nimport { services } from '../common/coreservices';\nimport { trace } from '../common/trace';\nimport { ResolvePolicy, ResolvableLiteral, resolvePolicies } from './interface';\n\nimport { ResolveContext } from './resolveContext';\nimport { stringify } from '../common/strings';\nimport { isFunction, isObject } from '../common/predicates';\nimport { Transition } from '../transition/transition';\nimport { StateObject } from '../state/stateObject';\nimport { PathNode } from '../path/pathNode';\nimport { isNullOrUndefined } from '../common/predicates';\n\n// TODO: explicitly make this user configurable\nexport let defaultResolvePolicy: ResolvePolicy = {\n  when: 'LAZY',\n  async: 'WAIT',\n};\n\n/**\n * The basic building block for the resolve system.\n *\n * Resolvables encapsulate a state's resolve's resolveFn, the resolveFn's declared dependencies, the wrapped (.promise),\n * and the unwrapped-when-complete (.data) result of the resolveFn.\n *\n * Resolvable.get() either retrieves the Resolvable's existing promise, or else invokes resolve() (which invokes the\n * resolveFn) and returns the resulting promise.\n *\n * Resolvable.get() and Resolvable.resolve() both execute within a context path, which is passed as the first\n * parameter to those fns.\n */\nexport class Resolvable implements ResolvableLiteral {\n  token: any;\n  policy: ResolvePolicy;\n  resolveFn: Function;\n  deps: any[];\n\n  data: any;\n  resolved = false;\n  promise: Promise<any> = undefined;\n\n  static fromData = (token: any, data: any) => new Resolvable(token, () => data, null, null, data);\n\n  /** This constructor creates a Resolvable copy */\n  constructor(resolvable: Resolvable);\n\n  /** This constructor creates a new Resolvable from the plain old [[ResolvableLiteral]] javascript object */\n  constructor(resolvable: ResolvableLiteral);\n\n  /**\n   * This constructor creates a new `Resolvable`\n   *\n   * #### Example:\n   * ```js\n   * var resolvable1 = new Resolvable('mytoken', http => http.get('foo.json').toPromise(), [Http]);\n   *\n   * var resolvable2 = new Resolvable(UserService, dep => new UserService(dep.data), [SomeDependency]);\n   *\n   * var resolvable1Clone = new Resolvable(resolvable1);\n   * ```\n   *\n   * @param token The new resolvable's injection token, such as `\"userList\"` (a string) or `UserService` (a class).\n   *              When this token is used during injection, the resolved value will be injected.\n   * @param resolveFn The function that returns the resolved value, or a promise for the resolved value\n   * @param deps An array of dependencies, which will be injected into the `resolveFn`\n   * @param policy the [[ResolvePolicy]] defines when and how the Resolvable is processed\n   * @param data Pre-resolved data. If the resolve value is already known, it may be provided here.\n   */\n  constructor(token: any, resolveFn: Function, deps?: any[], policy?: ResolvePolicy, data?: any);\n  constructor(arg1: any, resolveFn?: Function, deps?: any[], policy?: ResolvePolicy, data?: any) {\n    if (arg1 instanceof Resolvable) {\n      extend(this, arg1);\n    } else if (isFunction(resolveFn)) {\n      if (isNullOrUndefined(arg1)) throw new Error('new Resolvable(): token argument is required');\n      if (!isFunction(resolveFn)) throw new Error('new Resolvable(): resolveFn argument must be a function');\n\n      this.token = arg1;\n      this.policy = policy;\n      this.resolveFn = resolveFn;\n      this.deps = deps || [];\n\n      this.data = data;\n      this.resolved = data !== undefined;\n      this.promise = this.resolved ? services.$q.when(this.data) : undefined;\n    } else if (isObject(arg1) && arg1.token && (arg1.hasOwnProperty('resolveFn') || arg1.hasOwnProperty('data'))) {\n      const literal = <ResolvableLiteral>arg1;\n      return new Resolvable(literal.token, literal.resolveFn, literal.deps, literal.policy, literal.data);\n    }\n  }\n\n  getPolicy(state: StateObject): ResolvePolicy {\n    const thisPolicy = this.policy || {};\n    const statePolicy = (state && state.resolvePolicy) || {};\n    return {\n      when: thisPolicy.when || statePolicy.when || defaultResolvePolicy.when,\n      async: thisPolicy.async || statePolicy.async || defaultResolvePolicy.async,\n    };\n  }\n\n  /**\n   * Asynchronously resolve this Resolvable's data\n   *\n   * Given a ResolveContext that this Resolvable is found in:\n   * Wait for this Resolvable's dependencies, then invoke this Resolvable's function\n   * and update the Resolvable's state\n   */\n  resolve(resolveContext: ResolveContext, trans?: Transition) {\n    const $q = services.$q;\n\n    // Gets all dependencies from ResolveContext and wait for them to be resolved\n    const getResolvableDependencies = () =>\n      $q.all(resolveContext.getDependencies(this).map(resolvable => resolvable.get(resolveContext, trans))) as Promise<\n        any[]\n      >;\n\n    // Invokes the resolve function passing the resolved dependencies as arguments\n    const invokeResolveFn = (resolvedDeps: any[]) => this.resolveFn.apply(null, resolvedDeps);\n\n    /**\n     * For RXWAIT policy:\n     *\n     * Given an observable returned from a resolve function:\n     * - enables .cache() mode (this allows multicast subscribers)\n     * - then calls toPromise() (this triggers subscribe() and thus fetches)\n     * - Waits for the promise, then return the cached observable (not the first emitted value).\n     */\n    const waitForRx = (observable$: any) => {\n      const cached = observable$.cache(1);\n      return cached\n        .take(1)\n        .toPromise()\n        .then(() => cached);\n    };\n\n    // If the resolve policy is RXWAIT, wait for the observable to emit something. otherwise pass through.\n    const node: PathNode = resolveContext.findNode(this);\n    const state: StateObject = node && node.state;\n    const maybeWaitForRx = this.getPolicy(state).async === 'RXWAIT' ? waitForRx : identity;\n\n    // After the final value has been resolved, update the state of the Resolvable\n    const applyResolvedValue = (resolvedValue: any) => {\n      this.data = resolvedValue;\n      this.resolved = true;\n      this.resolveFn = null;\n      trace.traceResolvableResolved(this, trans);\n      return this.data;\n    };\n\n    // Sets the promise property first, then getsResolvableDependencies in the context of the promise chain. Always waits one tick.\n    return (this.promise = $q\n      .when()\n      .then(getResolvableDependencies)\n      .then(invokeResolveFn)\n      .then(maybeWaitForRx)\n      .then(applyResolvedValue));\n  }\n\n  /**\n   * Gets a promise for this Resolvable's data.\n   *\n   * Fetches the data and returns a promise.\n   * Returns the existing promise if it has already been fetched once.\n   */\n  get(resolveContext: ResolveContext, trans?: Transition): Promise<any> {\n    return this.promise || this.resolve(resolveContext, trans);\n  }\n\n  toString() {\n    return `Resolvable(token: ${stringify(this.token)}, requires: [${this.deps.map(stringify)}])`;\n  }\n\n  clone(): Resolvable {\n    return new Resolvable(this);\n  }\n}\n","/** @module resolve */\n/** for typedoc */\nimport { find, tail, uniqR, unnestR, inArray } from '../common/common';\nimport { propEq, not } from '../common/hof';\nimport { trace } from '../common/trace';\nimport { services, $InjectorLike } from '../common/coreservices';\nimport { resolvePolicies, PolicyWhen, ResolvePolicy } from './interface';\nimport { PathNode } from '../path/pathNode';\nimport { Resolvable } from './resolvable';\nimport { StateObject } from '../state/stateObject';\nimport { PathUtils } from '../path/pathUtils';\nimport { stringify } from '../common/strings';\nimport { Transition } from '../transition/transition';\nimport { UIInjector } from '../interface';\nimport { isUndefined } from '../common';\n\nconst whens = resolvePolicies.when;\nconst ALL_WHENS = [whens.EAGER, whens.LAZY];\nconst EAGER_WHENS = [whens.EAGER];\n\n// tslint:disable-next-line:no-inferrable-types\nexport const NATIVE_INJECTOR_TOKEN: string = 'Native Injector';\n\n/**\n * Encapsulates Dependency Injection for a path of nodes\n *\n * UI-Router states are organized as a tree.\n * A nested state has a path of ancestors to the root of the tree.\n * When a state is being activated, each element in the path is wrapped as a [[PathNode]].\n * A `PathNode` is a stateful object that holds things like parameters and resolvables for the state being activated.\n *\n * The ResolveContext closes over the [[PathNode]]s, and provides DI for the last node in the path.\n */\nexport class ResolveContext {\n  _injector: UIInjector;\n\n  constructor(private _path: PathNode[]) {}\n\n  /** Gets all the tokens found in the resolve context, de-duplicated */\n  getTokens(): any[] {\n    return this._path.reduce((acc, node) => acc.concat(node.resolvables.map(r => r.token)), []).reduce(uniqR, []);\n  }\n\n  /**\n   * Gets the Resolvable that matches the token\n   *\n   * Gets the last Resolvable that matches the token in this context, or undefined.\n   * Throws an error if it doesn't exist in the ResolveContext\n   */\n  getResolvable(token: any): Resolvable {\n    const matching = this._path\n      .map(node => node.resolvables)\n      .reduce(unnestR, [])\n      .filter((r: Resolvable) => r.token === token);\n    return tail(matching);\n  }\n\n  /** Returns the [[ResolvePolicy]] for the given [[Resolvable]] */\n  getPolicy(resolvable: Resolvable): ResolvePolicy {\n    const node = this.findNode(resolvable);\n    return resolvable.getPolicy(node.state);\n  }\n\n  /**\n   * Returns a ResolveContext that includes a portion of this one\n   *\n   * Given a state, this method creates a new ResolveContext from this one.\n   * The new context starts at the first node (root) and stops at the node for the `state` parameter.\n   *\n   * #### Why\n   *\n   * When a transition is created, the nodes in the \"To Path\" are injected from a ResolveContext.\n   * A ResolveContext closes over a path of [[PathNode]]s and processes the resolvables.\n   * The \"To State\" can inject values from its own resolvables, as well as those from all its ancestor state's (node's).\n   * This method is used to create a narrower context when injecting ancestor nodes.\n   *\n   * @example\n   * `let ABCD = new ResolveContext([A, B, C, D]);`\n   *\n   * Given a path `[A, B, C, D]`, where `A`, `B`, `C` and `D` are nodes for states `a`, `b`, `c`, `d`:\n   * When injecting `D`, `D` should have access to all resolvables from `A`, `B`, `C`, `D`.\n   * However, `B` should only be able to access resolvables from `A`, `B`.\n   *\n   * When resolving for the `B` node, first take the full \"To Path\" Context `[A,B,C,D]` and limit to the subpath `[A,B]`.\n   * `let AB = ABCD.subcontext(a)`\n   */\n  subContext(state: StateObject): ResolveContext {\n    return new ResolveContext(PathUtils.subPath(this._path, node => node.state === state));\n  }\n\n  /**\n   * Adds Resolvables to the node that matches the state\n   *\n   * This adds a [[Resolvable]] (generally one created on the fly; not declared on a [[StateDeclaration.resolve]] block).\n   * The resolvable is added to the node matching the `state` parameter.\n   *\n   * These new resolvables are not automatically fetched.\n   * The calling code should either fetch them, fetch something that depends on them,\n   * or rely on [[resolvePath]] being called when some state is being entered.\n   *\n   * Note: each resolvable's [[ResolvePolicy]] is merged with the state's policy, and the global default.\n   *\n   * @param newResolvables the new Resolvables\n   * @param state Used to find the node to put the resolvable on\n   */\n  addResolvables(newResolvables: Resolvable[], state: StateObject) {\n    const node = <PathNode>find(this._path, propEq('state', state));\n    const keys = newResolvables.map(r => r.token);\n    node.resolvables = node.resolvables.filter(r => keys.indexOf(r.token) === -1).concat(newResolvables);\n  }\n\n  /**\n   * Returns a promise for an array of resolved path Element promises\n   *\n   * @param when\n   * @param trans\n   * @returns {Promise<any>|any}\n   */\n  resolvePath(when: PolicyWhen = 'LAZY', trans?: Transition): Promise<{ token: any; value: any }[]> {\n    // This option determines which 'when' policy Resolvables we are about to fetch.\n    const whenOption: string = inArray(ALL_WHENS, when) ? when : 'LAZY';\n    // If the caller specified EAGER, only the EAGER Resolvables are fetched.\n    // if the caller specified LAZY, both EAGER and LAZY Resolvables are fetched.`\n    const matchedWhens = whenOption === resolvePolicies.when.EAGER ? EAGER_WHENS : ALL_WHENS;\n\n    // get the subpath to the state argument, if provided\n    trace.traceResolvePath(this._path, when, trans);\n\n    const matchesPolicy = (acceptedVals: string[], whenOrAsync: 'when' | 'async') => (resolvable: Resolvable) =>\n      inArray(acceptedVals, this.getPolicy(resolvable)[whenOrAsync]);\n\n    // Trigger all the (matching) Resolvables in the path\n    // Reduce all the \"WAIT\" Resolvables into an array\n    const promises: Promise<any>[] = this._path.reduce((acc, node) => {\n      const nodeResolvables = node.resolvables.filter(matchesPolicy(matchedWhens, 'when'));\n      const nowait = nodeResolvables.filter(matchesPolicy(['NOWAIT'], 'async'));\n      const wait = nodeResolvables.filter(not(matchesPolicy(['NOWAIT'], 'async')));\n\n      // For the matching Resolvables, start their async fetch process.\n      const subContext = this.subContext(node.state);\n      const getResult = (r: Resolvable) =>\n        r\n          .get(subContext, trans)\n          // Return a tuple that includes the Resolvable's token\n          .then(value => ({ token: r.token, value: value }));\n      nowait.forEach(getResult);\n      return acc.concat(wait.map(getResult));\n    }, []);\n\n    // Wait for all the \"WAIT\" resolvables\n    return services.$q.all(promises);\n  }\n\n  injector(): UIInjector {\n    return this._injector || (this._injector = new UIInjectorImpl(this));\n  }\n\n  findNode(resolvable: Resolvable): PathNode {\n    return find(this._path, (node: PathNode) => inArray(node.resolvables, resolvable));\n  }\n\n  /**\n   * Gets the async dependencies of a Resolvable\n   *\n   * Given a Resolvable, returns its dependencies as a Resolvable[]\n   */\n  getDependencies(resolvable: Resolvable): Resolvable[] {\n    const node = this.findNode(resolvable);\n    // Find which other resolvables are \"visible\" to the `resolvable` argument\n    // subpath stopping at resolvable's node, or the whole path (if the resolvable isn't in the path)\n    const subPath: PathNode[] = PathUtils.subPath(this._path, x => x === node) || this._path;\n    const availableResolvables: Resolvable[] = subPath\n      .reduce((acc, _node) => acc.concat(_node.resolvables), []) // all of subpath's resolvables\n      .filter(res => res !== resolvable); // filter out the `resolvable` argument\n\n    const getDependency = (token: any) => {\n      const matching = availableResolvables.filter(r => r.token === token);\n      if (matching.length) return tail(matching);\n\n      const fromInjector = this.injector().getNative(token);\n      if (isUndefined(fromInjector)) {\n        throw new Error('Could not find Dependency Injection token: ' + stringify(token));\n      }\n\n      return new Resolvable(token, () => fromInjector, [], fromInjector);\n    };\n\n    return resolvable.deps.map(getDependency);\n  }\n}\n\nclass UIInjectorImpl implements UIInjector {\n  native: $InjectorLike;\n\n  constructor(public context: ResolveContext) {\n    this.native = this.get(NATIVE_INJECTOR_TOKEN) || services.$injector;\n  }\n\n  get(token: any) {\n    const resolvable = this.context.getResolvable(token);\n    if (resolvable) {\n      if (this.context.getPolicy(resolvable).async === 'NOWAIT') {\n        return resolvable.get(this.context);\n      }\n\n      if (!resolvable.resolved) {\n        throw new Error('Resolvable async .get() not complete:' + stringify(resolvable.token));\n      }\n      return resolvable.data;\n    }\n\n    return this.getNative(token);\n  }\n\n  getAsync(token: any) {\n    const resolvable = this.context.getResolvable(token);\n    if (resolvable) return resolvable.get(this.context);\n    return services.$q.when(this.native.get(token));\n  }\n\n  getNative(token: any) {\n    return this.native && this.native.get(token);\n  }\n}\n","/** @module state */\n/** for typedoc */\nimport { applyPairs, extend, identity, inherit, mapObj, noop, Obj, omit, tail, values } from '../common/common';\nimport { isArray, isDefined, isFunction, isString } from '../common/predicates';\nimport { stringify } from '../common/strings';\nimport { is, pattern, pipe, prop, val } from '../common/hof';\nimport { StateDeclaration } from './interface';\n\nimport { StateObject } from './stateObject';\nimport { StateMatcher } from './stateMatcher';\nimport { Param } from '../params/param';\nimport { UrlMatcherFactory } from '../url/urlMatcherFactory';\nimport { UrlMatcher } from '../url/urlMatcher';\nimport { Resolvable } from '../resolve/resolvable';\nimport { services } from '../common/coreservices';\nimport { ResolvePolicy } from '../resolve/interface';\nimport { ParamDeclaration } from '../params';\nimport { ParamFactory } from '../url';\n\nconst parseUrl = (url: string): any => {\n  if (!isString(url)) return false;\n  const root = url.charAt(0) === '^';\n  return { val: root ? url.substring(1) : url, root };\n};\n\nexport type BuilderFunction = (state: StateObject, parent?: BuilderFunction) => any;\n\ninterface Builders {\n  [key: string]: BuilderFunction[];\n\n  name: BuilderFunction[];\n  parent: BuilderFunction[];\n  data: BuilderFunction[];\n  url: BuilderFunction[];\n  navigable: BuilderFunction[];\n  params: BuilderFunction[];\n  views: BuilderFunction[];\n  path: BuilderFunction[];\n  includes: BuilderFunction[];\n  resolvables: BuilderFunction[];\n}\n\nfunction nameBuilder(state: StateObject) {\n  return state.name;\n}\n\nfunction selfBuilder(state: StateObject) {\n  state.self.$$state = () => state;\n  return state.self;\n}\n\nfunction dataBuilder(state: StateObject) {\n  if (state.parent && state.parent.data) {\n    state.data = state.self.data = inherit(state.parent.data, state.data);\n  }\n  return state.data;\n}\n\nconst getUrlBuilder = ($urlMatcherFactoryProvider: UrlMatcherFactory, root: () => StateObject) =>\n  function urlBuilder(stateObject: StateObject) {\n    const state: StateDeclaration = stateObject.self;\n\n    // For future states, i.e., states whose name ends with `.**`,\n    // match anything that starts with the url prefix\n    if (state && state.url && state.name && state.name.match(/\\.\\*\\*$/)) {\n      state.url += '{remainder:any}'; // match any path (.*)\n    }\n\n    const parent = stateObject.parent;\n    const parsed = parseUrl(state.url);\n    const url = !parsed ? state.url : $urlMatcherFactoryProvider.compile(parsed.val, { state });\n\n    if (!url) return null;\n    if (!$urlMatcherFactoryProvider.isMatcher(url)) throw new Error(`Invalid url '${url}' in state '${stateObject}'`);\n    return parsed && parsed.root ? url : ((parent && parent.navigable) || root()).url.append(<UrlMatcher>url);\n  };\n\nconst getNavigableBuilder = (isRoot: (state: StateObject) => boolean) =>\n  function navigableBuilder(state: StateObject) {\n    return !isRoot(state) && state.url ? state : state.parent ? state.parent.navigable : null;\n  };\n\nconst getParamsBuilder = (paramFactory: ParamFactory) =>\n  function paramsBuilder(state: StateObject): { [key: string]: Param } {\n    const makeConfigParam = (config: ParamDeclaration, id: string) => paramFactory.fromConfig(id, null, state.self);\n    const urlParams: Param[] = (state.url && state.url.parameters({ inherit: false })) || [];\n    const nonUrlParams: Param[] = values(mapObj(omit(state.params || {}, urlParams.map(prop('id'))), makeConfigParam));\n    return urlParams\n      .concat(nonUrlParams)\n      .map(p => [p.id, p])\n      .reduce(applyPairs, {});\n  };\n\nfunction pathBuilder(state: StateObject) {\n  return state.parent ? state.parent.path.concat(state) : /*root*/ [state];\n}\n\nfunction includesBuilder(state: StateObject) {\n  const includes = state.parent ? extend({}, state.parent.includes) : {};\n  includes[state.name] = true;\n  return includes;\n}\n\n/**\n * This is a [[StateBuilder.builder]] function for the `resolve:` block on a [[StateDeclaration]].\n *\n * When the [[StateBuilder]] builds a [[StateObject]] object from a raw [[StateDeclaration]], this builder\n * validates the `resolve` property and converts it to a [[Resolvable]] array.\n *\n * resolve: input value can be:\n *\n * {\n *   // analyzed but not injected\n *   myFooResolve: function() { return \"myFooData\"; },\n *\n *   // function.toString() parsed, \"DependencyName\" dep as string (not min-safe)\n *   myBarResolve: function(DependencyName) { return DependencyName.fetchSomethingAsPromise() },\n *\n *   // Array split; \"DependencyName\" dep as string\n *   myBazResolve: [ \"DependencyName\", function(dep) { return dep.fetchSomethingAsPromise() },\n *\n *   // Array split; DependencyType dep as token (compared using ===)\n *   myQuxResolve: [ DependencyType, function(dep) { return dep.fetchSometingAsPromise() },\n *\n *   // val.$inject used as deps\n *   // where:\n *   //     corgeResolve.$inject = [\"DependencyName\"];\n *   //     function corgeResolve(dep) { dep.fetchSometingAsPromise() }\n *   // then \"DependencyName\" dep as string\n *   myCorgeResolve: corgeResolve,\n *\n *  // inject service by name\n *  // When a string is found, desugar creating a resolve that injects the named service\n *   myGraultResolve: \"SomeService\"\n * }\n *\n * or:\n *\n * [\n *   new Resolvable(\"myFooResolve\", function() { return \"myFooData\" }),\n *   new Resolvable(\"myBarResolve\", function(dep) { return dep.fetchSomethingAsPromise() }, [ \"DependencyName\" ]),\n *   { provide: \"myBazResolve\", useFactory: function(dep) { dep.fetchSomethingAsPromise() }, deps: [ \"DependencyName\" ] }\n * ]\n */\nexport function resolvablesBuilder(state: StateObject): Resolvable[] {\n  interface Tuple {\n    token: any;\n    val: any;\n    deps: any[];\n    policy: ResolvePolicy;\n  }\n\n  /** convert resolve: {} and resolvePolicy: {} objects to an array of tuples */\n  const objects2Tuples = (resolveObj: Obj, resolvePolicies: { [key: string]: ResolvePolicy }) =>\n    Object.keys(resolveObj || {}).map(token => ({\n      token,\n      val: resolveObj[token],\n      deps: undefined,\n      policy: resolvePolicies[token],\n    }));\n\n  /** fetch DI annotations from a function or ng1-style array */\n  const annotate = (fn: Function) => {\n    const $injector = services.$injector;\n    // ng1 doesn't have an $injector until runtime.\n    // If the $injector doesn't exist, use \"deferred\" literal as a\n    // marker indicating they should be annotated when runtime starts\n    return fn['$inject'] || ($injector && $injector.annotate(fn, $injector.strictDi)) || <any>'deferred';\n  };\n\n  /** true if the object has both `token` and `resolveFn`, and is probably a [[ResolveLiteral]] */\n  const isResolveLiteral = (obj: any) => !!(obj.token && obj.resolveFn);\n\n  /** true if the object looks like a provide literal, or a ng2 Provider */\n  const isLikeNg2Provider = (obj: any) =>\n    !!((obj.provide || obj.token) && (obj.useValue || obj.useFactory || obj.useExisting || obj.useClass));\n\n  /** true if the object looks like a tuple from obj2Tuples */\n  const isTupleFromObj = (obj: any) =>\n    !!(obj && obj.val && (isString(obj.val) || isArray(obj.val) || isFunction(obj.val)));\n\n  /** extracts the token from a Provider or provide literal */\n  const getToken = (p: any) => p.provide || p.token;\n\n  // prettier-ignore: Given a literal resolve or provider object, returns a Resolvable\n  const literal2Resolvable = pattern([\n    [prop('resolveFn'), p => new Resolvable(getToken(p), p.resolveFn, p.deps, p.policy)],\n    [prop('useFactory'), p => new Resolvable(getToken(p), p.useFactory, p.deps || p.dependencies, p.policy)],\n    [prop('useClass'), p => new Resolvable(getToken(p), () => new (<any>p.useClass)(), [], p.policy)],\n    [prop('useValue'), p => new Resolvable(getToken(p), () => p.useValue, [], p.policy, p.useValue)],\n    [prop('useExisting'), p => new Resolvable(getToken(p), identity, [p.useExisting], p.policy)],\n  ]);\n\n  // prettier-ignore\n  const tuple2Resolvable = pattern([\n    [pipe(prop('val'), isString),   (tuple: Tuple) => new Resolvable(tuple.token, identity, [tuple.val], tuple.policy)],\n    [pipe(prop('val'), isArray),    (tuple: Tuple) => new Resolvable(tuple.token, tail(<any[]>tuple.val), tuple.val.slice(0, -1), tuple.policy)],\n    [pipe(prop('val'), isFunction), (tuple: Tuple) => new Resolvable(tuple.token, tuple.val, annotate(tuple.val), tuple.policy)],\n  ]);\n\n  // prettier-ignore\n  const item2Resolvable = <(obj: any) => Resolvable>pattern([\n    [is(Resolvable), (r: Resolvable) => r],\n    [isResolveLiteral, literal2Resolvable],\n    [isLikeNg2Provider, literal2Resolvable],\n    [isTupleFromObj, tuple2Resolvable],\n    [val(true), (obj: any) => { throw new Error('Invalid resolve value: ' + stringify(obj)); }, ],\n  ]);\n\n  // If resolveBlock is already an array, use it as-is.\n  // Otherwise, assume it's an object and convert to an Array of tuples\n  const decl = state.resolve;\n  const items: any[] = isArray(decl) ? decl : objects2Tuples(decl, state.resolvePolicy || {});\n  return items.map(item2Resolvable);\n}\n\n/**\n * @internalapi A internal global service\n *\n * StateBuilder is a factory for the internal [[StateObject]] objects.\n *\n * When you register a state with the [[StateRegistry]], you register a plain old javascript object which\n * conforms to the [[StateDeclaration]] interface.  This factory takes that object and builds the corresponding\n * [[StateObject]] object, which has an API and is used internally.\n *\n * Custom properties or API may be added to the internal [[StateObject]] object by registering a decorator function\n * using the [[builder]] method.\n */\nexport class StateBuilder {\n  /** An object that contains all the BuilderFunctions registered, key'd by the name of the State property they build */\n  private builders: Builders;\n\n  constructor(private matcher: StateMatcher, urlMatcherFactory: UrlMatcherFactory) {\n    const self = this;\n\n    const root = () => matcher.find('');\n    const isRoot = (state: StateObject) => state.name === '';\n\n    function parentBuilder(state: StateObject) {\n      if (isRoot(state)) return null;\n      return matcher.find(self.parentName(state)) || root();\n    }\n\n    this.builders = {\n      name: [nameBuilder],\n      self: [selfBuilder],\n      parent: [parentBuilder],\n      data: [dataBuilder],\n      // Build a URLMatcher if necessary, either via a relative or absolute URL\n      url: [getUrlBuilder(urlMatcherFactory, root)],\n      // Keep track of the closest ancestor state that has a URL (i.e. is navigable)\n      navigable: [getNavigableBuilder(isRoot)],\n      params: [getParamsBuilder(urlMatcherFactory.paramFactory)],\n      // Each framework-specific ui-router implementation should define its own `views` builder\n      // e.g., src/ng1/statebuilders/views.ts\n      views: [],\n      // Keep a full path from the root down to this state as this is needed for state activation.\n      path: [pathBuilder],\n      // Speed up $state.includes() as it's used a lot\n      includes: [includesBuilder],\n      resolvables: [resolvablesBuilder],\n    };\n  }\n\n  /**\n   * Registers a [[BuilderFunction]] for a specific [[StateObject]] property (e.g., `parent`, `url`, or `path`).\n   * More than one BuilderFunction can be registered for a given property.\n   *\n   * The BuilderFunction(s) will be used to define the property on any subsequently built [[StateObject]] objects.\n   *\n   * @param name The name of the State property being registered for.\n   * @param fn The BuilderFunction which will be used to build the State property\n   * @returns a function which deregisters the BuilderFunction\n   */\n  builder(name: string, fn: BuilderFunction): BuilderFunction | BuilderFunction[] | Function {\n    const builders = this.builders;\n    const array = builders[name] || [];\n    // Backwards compat: if only one builder exists, return it, else return whole arary.\n    if (isString(name) && !isDefined(fn)) return array.length > 1 ? array : array[0];\n    if (!isString(name) || !isFunction(fn)) return;\n\n    builders[name] = array;\n    builders[name].push(fn);\n    return () => builders[name].splice(builders[name].indexOf(fn, 1)) && null;\n  }\n\n  /**\n   * Builds all of the properties on an essentially blank State object, returning a State object which has all its\n   * properties and API built.\n   *\n   * @param state an uninitialized State object\n   * @returns the built State object\n   */\n  build(state: StateObject): StateObject {\n    const { matcher, builders } = this;\n    const parent = this.parentName(state);\n\n    if (parent && !matcher.find(parent, undefined, false)) {\n      return null;\n    }\n\n    for (const key in builders) {\n      if (!builders.hasOwnProperty(key)) continue;\n      const chain = builders[key].reduce(\n        (parentFn: BuilderFunction, step: BuilderFunction) => _state => step(_state, parentFn),\n        noop\n      );\n      state[key] = chain(state);\n    }\n    return state;\n  }\n\n  parentName(state: StateObject) {\n    // name = 'foo.bar.baz.**'\n    const name = state.name || '';\n    // segments = ['foo', 'bar', 'baz', '.**']\n    const segments = name.split('.');\n    // segments = ['foo', 'bar', 'baz']\n    const lastSegment = segments.pop();\n    // segments = ['foo', 'bar'] (ignore .** segment for future states)\n    if (lastSegment === '**') segments.pop();\n\n    if (segments.length) {\n      if (state.parent) {\n        throw new Error(`States that specify the 'parent:' property should not have a '.' in their name (${name})`);\n      }\n\n      // 'foo.bar'\n      return segments.join('.');\n    }\n\n    if (!state.parent) return '';\n    return isString(state.parent) ? state.parent : state.parent.name;\n  }\n\n  name(state: StateObject) {\n    const name = state.name;\n    if (name.indexOf('.') !== -1 || !state.parent) return name;\n\n    const parentName = isString(state.parent) ? state.parent : state.parent.name;\n    return parentName ? parentName + '.' + name : name;\n  }\n}\n","/**\n * @coreapi\n * @module transition\n */ /** for typedoc */\nimport { StateDeclaration } from '../state/interface';\nimport { Predicate } from '../common/common';\n\nimport { Transition } from './transition';\nimport { StateObject } from '../state/stateObject';\nimport { PathNode } from '../path/pathNode';\nimport { TargetState } from '../state/targetState';\nimport { RegisteredHook } from './hookRegistry';\n\n/**\n * The TransitionOptions object can be used to change the behavior of a transition.\n *\n * It is passed as the third argument to [[StateService.go]], [[StateService.transitionTo]].\n * It can also be used with a `uiSref`.\n */\nexport interface TransitionOptions {\n  /**\n   * This option changes how the Transition interacts with the browser's location bar (URL).\n   *\n   * - If `true`, it will update the url in the location bar.\n   * - If `false`, it will not update the url in the location bar.\n   * - If it is the string `\"replace\"`, it will update the url and also replace the last history record.\n   *\n   * @default `true`\n   */\n  location?: boolean | string;\n\n  /**\n   * When transitioning to relative path (e.g '`^`'), this option defines which state to be relative from.\n   * @default `$state.current`\n   */\n  relative?: string | StateDeclaration | StateObject;\n\n  /**\n   * This option sets whether or not the transition's parameter values should be inherited from\n   * the current parameter values.\n   *\n   * - If `true`, it will inherit parameter values from the current parameter values.\n   * - If `false`, only the parameters which are provided to `transitionTo` will be used.\n   *\n   * @default `false`\n   */\n  inherit?: boolean;\n\n  /**\n   * @deprecated\n   */\n  notify?: boolean;\n\n  /**\n   * This option may be used to force states which are currently active to reload.\n   *\n   * During a normal transition, a state is \"retained\" if:\n   * - It was previously active\n   * - The state's parameter values have not changed\n   * - All the parent states' parameter values have not changed\n   *\n   * Forcing a reload of a state will cause it to be exited and entered, which will:\n   * - Refetch that state's resolve data\n   * - Exit the state (onExit hook)\n   * - Re-enter the state (onEnter hook)\n   * - Re-render the views (controllers and templates)\n   *\n   * - When `true`, the destination state (and all parent states) will be reloaded.\n   * - When it is a string and is the name of a state, or when it is a State object,\n   *   that state and any children states will be reloaded.\n   *\n   * @default `false`\n   */\n  reload?: boolean | string | StateDeclaration | StateObject;\n  /**\n   * You can define your own Transition Options inside this property and use them, e.g., from a Transition Hook\n   */\n  custom?: any;\n  /** @internalapi */\n  reloadState?: StateObject;\n  /** @internalapi\n   * If this transition is a redirect, this property should be the original Transition (which was redirected to this one)\n   */\n  redirectedFrom?: Transition;\n  /** @internalapi */\n  current?: () => Transition;\n  /** @internalapi */\n  source?: 'sref' | 'url' | 'redirect' | 'otherwise' | 'unknown';\n}\n\n/** @internalapi */\nexport interface TransitionHookOptions {\n  current?: () => Transition; // path?\n  transition?: Transition;\n  hookType?: string;\n  target?: any;\n  traceData?: any;\n  bind?: any;\n  stateHook?: boolean;\n}\n\n/**\n * TreeChanges encapsulates the various Paths that are involved in a Transition.\n *\n * Get a TreeChanges object using [[Transition.treeChanges]]\n *\n * A UI-Router Transition is from one Path in a State Tree to another Path.  For a given Transition,\n * this object stores the \"to\" and \"from\" paths, as well as subsets of those: the \"retained\",\n * \"exiting\" and \"entering\" paths.\n *\n * Each path in TreeChanges is an array of [[PathNode]] objects. Each PathNode in the array corresponds to a portion\n * of a nested state.\n *\n * For example, if you had a nested state named `foo.bar.baz`, it would have three\n * portions, `foo, bar, baz`.  If you transitioned **to** `foo.bar.baz` and inspected the [[TreeChanges.to]]\n * Path, you would find a node in the array for each portion: `foo`, `bar`, and `baz`.\n *\n * ---\n *\n * @todo show visual state tree\n */\nexport interface TreeChanges {\n  /** @nodoc */\n  [key: string]: PathNode[];\n\n  /** The path of nodes in the state tree that the transition is coming *from* */\n  from: PathNode[];\n\n  /** The path of nodes in the state tree that the transition is going *to* */\n  to: PathNode[];\n\n  /**\n   * The path of active nodes that the transition is retaining.\n   *\n   * These nodes are neither exited, nor entered.\n   * Before and after the transition is successful, these nodes are active.\n   */\n  retained: PathNode[];\n\n  /**\n   * The path of active nodes that the transition is retaining with updated \"to params\" applied.\n   *\n   * These nodes are neither exited, nor entered.\n   * Before and after the transition is successful, these nodes are active.\n   *\n   * This is a shallow copy of [[retained]], but with new (dynamic) parameter values from [[to]] applied.\n   */\n  retainedWithToParams: PathNode[];\n\n  /**\n   * The path of previously active nodes that the transition is exiting.\n   *\n   * After the Transition is successful, these nodes are no longer active.\n   *\n   * Note that a state that is being reloaded (due to parameter values changing, or `reload: true`) may be in both the\n   * `exiting` and `entering` paths.\n   */\n  exiting: PathNode[];\n\n  /**\n   * The path of nodes that the transition is entering.\n   *\n   * After the Transition is successful, these nodes will be active.\n   * Because they are entering, they have their resolves fetched, `onEnter` hooks run, and their views\n   * (component(s) or controller(s)+template(s)) refreshed.\n   *\n   * Note that a state that is reloaded (due to parameter values changing, or `reload: true`) may be in both the\n   * `exiting` and `entering` paths.\n   */\n  entering: PathNode[];\n}\n\nexport type IHookRegistration = (\n  matchCriteria: HookMatchCriteria,\n  callback: HookFn,\n  options?: HookRegOptions\n) => Function;\n\n/**\n * The signature for Transition Hooks.\n *\n * Transition hooks are callback functions that hook into the lifecycle of transitions.\n * As a transition runs, it reaches certain lifecycle events.\n * As each event occurs, the hooks which are registered for the event are called (in priority order).\n *\n * A transition hook may alter a Transition by returning a [[HookResult]].\n *\n * #### See:\n *\n * - [[IHookRegistry.onBefore]]\n * - [[IHookRegistry.onStart]]\n * - [[IHookRegistry.onFinish]]\n * - [[IHookRegistry.onSuccess]]\n * - [[IHookRegistry.onError]]\n *\n * @param transition the current [[Transition]]\n * @param injector (for ng1 or ng2 only) the injector service\n *\n * @returns a [[HookResult]] which may alter the transition\n *\n */\nexport interface TransitionHookFn {\n  (transition: Transition): HookResult;\n}\n\n/**\n * The signature for Transition State Hooks.\n *\n * A function which hooks into a lifecycle event for a specific state.\n *\n * Transition State Hooks are callback functions that hook into the lifecycle events of specific states during a transition.\n * As a transition runs, it may exit some states, retain (keep) states, and enter states.\n * As each lifecycle event occurs, the hooks which are registered for the event and that state are called (in priority order).\n *\n * #### See:\n *\n * - [[IHookRegistry.onExit]]\n * - [[IHookRegistry.onRetain]]\n * - [[IHookRegistry.onEnter]]\n *\n * @param transition the current [[Transition]]\n * @param state the [[StateObject]] that the hook is bound to\n * @param injector (for ng1 or ng2 only) the injector service\n *\n * @returns a [[HookResult]] which may alter the transition\n */\nexport interface TransitionStateHookFn {\n  (transition: Transition, state: StateDeclaration): HookResult;\n}\n\n/**\n * The signature for Transition onCreate Hooks.\n *\n * Transition onCreate Hooks are callbacks that allow customization or preprocessing of\n * a Transition before it is returned from [[TransitionService.create]]\n *\n * @param transition the [[Transition]] that was just created\n * @return a [[Transition]] which will then be returned from [[TransitionService.create]]\n */\nexport interface TransitionCreateHookFn {\n  (transition: Transition): void;\n}\n\nexport type HookFn = TransitionHookFn | TransitionStateHookFn | TransitionCreateHookFn;\n\n/**\n * The return value of a [[TransitionHookFn]] or [[TransitionStateHookFn]]\n *\n * When returned from a [[TransitionHookFn]] or [[TransitionStateHookFn]], these values alter the running [[Transition]]:\n *\n * - `false`: the transition will be cancelled.\n * - [[TargetState]]: the transition will be redirected to the new target state (see: [[StateService.target]])\n * - `Promise`: the transition will wait for the promise to resolve or reject\n *    - If the promise is rejected (or resolves to `false`), the transition will be cancelled\n *    - If the promise resolves to a [[TargetState]], the transition will be redirected\n *    - If the promise resolves to anything else, the transition will resume\n * - Anything else: the transition will resume\n */\nexport type HookResult = boolean | TargetState | void | Promise<boolean | TargetState | void>;\n\n/**\n * These options may be provided when registering a Transition Hook (such as `onStart`)\n */\nexport interface HookRegOptions {\n  /**\n   * Sets the priority of the registered hook\n   *\n   * Hooks of the same type (onBefore, onStart, etc) are invoked in priority order.  A hook with a higher priority\n   * is invoked before a hook with a lower priority.\n   *\n   * The default hook priority is 0\n   */\n  priority?: number;\n\n  /**\n   * Specifies what `this` is bound to during hook invocation.\n   */\n  bind?: any;\n\n  /**\n   * Limits the number of times that the hook will be invoked.\n   * Once the hook has been invoked this many times, it is automatically deregistered.\n   */\n  invokeLimit?: number;\n}\n\n/**\n * This interface specifies the api for registering Transition Hooks.  Both the\n * [[TransitionService]] and also the [[Transition]] object itself implement this interface.\n * Note: the Transition object only allows hooks to be registered before the Transition is started.\n */\nexport interface IHookRegistry {\n  /** @hidden place to store the hooks */\n  _registeredHooks: { [key: string]: RegisteredHook[] };\n\n  /**\n   * Registers a [[TransitionHookFn]], called *before a transition starts*.\n   *\n   * Registers a transition lifecycle hook, which is invoked before a transition even begins.\n   * This hook can be useful to implement logic which prevents a transition from even starting, such\n   * as authentication, redirection\n   *\n   * See [[TransitionHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onBefore` hooks are invoked *before a Transition starts*.\n   * No resolves have been fetched yet.\n   * Each `onBefore` hook is invoked synchronously, in the same call stack as [[StateService.transitionTo]].\n   * The registered `onBefore` hooks are invoked in priority order.\n   *\n   * Note: during the `onBefore` phase, additional hooks can be added to the specific [[Transition]] instance.\n   * These \"on-the-fly\" hooks only affect the currently running transition..\n   *\n   * ### Return value\n   *\n   * The hook's return value can be used to pause, cancel, or redirect the current Transition.\n   * See [[HookResult]] for more information.\n   *\n   * If any hook modifies the transition *synchronously* (by throwing, returning `false`, or returning\n   * a [[TargetState]]), the remainder of the hooks are skipped.\n   * If a hook returns a promise, the remainder of the `onBefore` hooks are still invoked synchronously.\n   * All promises are resolved, and processed asynchronously before the `onStart` phase of the Transition.\n   *\n   * ### Examples\n   *\n   * #### Default Substate\n   *\n   * This example redirects any transition from 'home' to 'home.dashboard'.  This is commonly referred to as a\n   * \"default substate\".\n   *\n   * @example\n   * ```js\n   * // ng2\n   * transitionService.onBefore({ to: 'home' }, (trans: Transition) =>\n   *     trans.router.stateService.target(\"home.dashboard\"));\n   * ```\n   *\n   * #### Data Driven Default Substate\n   *\n   * This example provides data-driven default substate functionality. It matches on a transition to any state\n   * which has `defaultSubstate: \"some.sub.state\"` defined.  See: [[Transition.to]] which returns the \"to state\"\n   * definition.\n   *\n   * @example\n   * ```js\n   * // ng1\n   * // state declaration\n   * {\n   *   name: 'home',\n   *   template: '<div ui-view/>',\n   *   defaultSubstate: 'home.dashboard'\n   * }\n   *\n   * var criteria = {\n   *   to: function(state) {\n   *     return state.defaultSubstate != null;\n   *   }\n   * }\n   *\n   * $transitions.onBefore(criteria, function(trans: Transition) {\n   *   var substate = trans.to().defaultSubstate;\n   *   return trans.router.stateService.target(substate);\n   * });\n   * ```\n   *\n   *\n   * #### Require authentication\n   *\n   * This example cancels a transition to a state which requires authentication, if the user is not currently authenticated.\n   *\n   * This example assumes a state tree where all states which require authentication are children of a parent `'requireauth'` state.\n   * This example assumes `MyAuthService` synchronously returns a boolean from `isAuthenticated()`.\n   *\n   * #### Example:\n   * ```js\n   * // ng1\n   * $transitions.onBefore( { to: 'requireauth.**' }, function(trans) {\n   *   var myAuthService = trans.injector().get('MyAuthService');\n   *   // If isAuthenticated returns false, the transition is cancelled.\n   *   return myAuthService.isAuthenticated();\n   * });\n   * ```\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onBefore(matchCriteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionHookFn]], called when a transition starts.\n   *\n   * Registers a transition lifecycle hook, which is invoked as a transition starts running.\n   * This hook can be useful to perform some asynchronous action before completing a transition.\n   *\n   * See [[TransitionHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onStart` hooks are invoked asynchronously when the Transition starts running.\n   * This happens after the `onBefore` phase is complete.\n   * At this point, the Transition has not yet exited nor entered any states.\n   * The registered `onStart` hooks are invoked in priority order.\n   *\n   * Note: A built-in `onStart` hook with high priority is used to fetch any eager resolve data.\n   *\n   * ### Return value\n   *\n   * The hook's return value can be used to pause, cancel, or redirect the current Transition.\n   * See [[HookResult]] for more information.\n   *\n   * ### Example\n   *\n   * #### Login during transition\n   *\n   * This example intercepts any transition to a state which requires authentication, when the user is\n   * not currently authenticated.  It allows the user to authenticate asynchronously, then resumes the\n   * transition.  If the user did not authenticate successfully, it redirects to the \"guest\" state, which\n   * does not require authentication.\n   *\n   * This example assumes:\n   * - a state tree where all states which require authentication are children of a parent `'auth'` state.\n   * - `MyAuthService.isAuthenticated()` synchronously returns a boolean.\n   * - `MyAuthService.authenticate()` presents a login dialog, and returns a promise which is resolved\n   *   or rejected, whether or not the login attempt was successful.\n   *\n   * #### Example:\n   * ```js\n   * // ng1\n   * $transitions.onStart( { to: 'auth.**' }, function(trans) {\n   *   var $state = trans.router.stateService;\n   *   var MyAuthService = trans.injector().get('MyAuthService');\n   *\n   *   // If the user is not authenticated\n   *   if (!MyAuthService.isAuthenticated()) {\n   *\n   *     // Then return a promise for a successful login.\n   *     // The transition will wait for this promise to settle\n   *\n   *     return MyAuthService.authenticate().catch(function() {\n   *\n   *       // If the authenticate() method failed for whatever reason,\n   *       // redirect to a 'guest' state which doesn't require auth.\n   *       return $state.target(\"guest\");\n   *     });\n   *   }\n   * });\n   * ```\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onStart(matchCriteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionStateHookFn]], called when a specific state is entered.\n   *\n   * Registers a lifecycle hook, which is invoked (during a transition) when a specific state is being entered.\n   *\n   * Since this hook is run only when the specific state is being *entered*, it can be useful for\n   * performing tasks when entering a submodule/feature area such as initializing a stateful service,\n   * or for guarding access to a submodule/feature area.\n   *\n   * See [[TransitionStateHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * `onEnter` hooks generally specify `{ entering: 'somestate' }`.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onEnter` hooks are invoked when the Transition is entering a state.\n   * States are entered after the `onRetain` phase is complete.\n   * If more than one state is being entered, the parent state is entered first.\n   * The registered `onEnter` hooks for a state are invoked in priority order.\n   *\n   * Note: A built-in `onEnter` hook with high priority is used to fetch lazy resolve data for states being entered.\n   *\n   * ### Return value\n   *\n   * The hook's return value can be used to pause, cancel, or redirect the current Transition.\n   * See [[HookResult]] for more information.\n   *\n   * ### Inside a state declaration\n   *\n   * Instead of registering `onEnter` hooks using the [[TransitionService]], you may define an `onEnter` hook\n   * directly on a state declaration (see: [[StateDeclaration.onEnter]]).\n   *\n   *\n   * ### Examples\n   *\n   * #### Audit Log\n   *\n   * This example uses a service to log that a user has entered the admin section of an app.\n   * This assumes that there are substates of the \"admin\" state, such as \"admin.users\", \"admin.pages\", etc.\n   * @example\n   * ```\n   *\n   * $transitions.onEnter({ entering: 'admin' }, function(transition, state) {\n   *   var AuditService = trans.injector().get('AuditService');\n   *   AuditService.log(\"Entered \" + state.name + \" module while transitioning to \" + transition.to().name);\n   * }\n   * ```\n   *\n   * #### Audit Log (inside a state declaration)\n   *\n   * The `onEnter` inside this state declaration is syntactic sugar for the previous Audit Log example.\n   * ```\n   * {\n   *   name: 'admin',\n   *   component: 'admin',\n   *   onEnter: function($transition$, $state$) {\n   *     var AuditService = $transition$.injector().get('AuditService');\n   *     AuditService.log(\"Entered \" + state.name + \" module while transitioning to \" + transition.to().name);\n   *   }\n   * }\n   * ```\n   *\n   * Note: A state declaration's `onEnter` function is injected for Angular 1 only.\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onEnter(matchCriteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionStateHookFn]], called when a specific state is retained/kept.\n   *\n   * Registers a lifecycle hook, which is invoked (during a transition) for\n   * a specific state that was previously active will remain active (is not being entered nor exited).\n   *\n   * This hook is invoked when a state is \"retained\" or \"kept\".\n   * It means the transition is coming *from* a substate of the retained state *to* a substate of the retained state.\n   * This hook can be used to perform actions when the user moves from one substate to another, such as between steps in a wizard.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * `onRetain` hooks generally specify `{ retained: 'somestate' }`.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onRetain` hooks are invoked after any `onExit` hooks have been fired.\n   * If more than one state is retained, the child states' `onRetain` hooks are invoked first.\n   * The registered `onRetain` hooks for a state are invoked in priority order.\n   *\n   * ### Return value\n   *\n   * The hook's return value can be used to pause, cancel, or redirect the current Transition.\n   * See [[HookResult]] for more information.\n   *\n   * ### Inside a state declaration\n   *\n   * Instead of registering `onRetain` hooks using the [[TransitionService]], you may define an `onRetain` hook\n   * directly on a state declaration (see: [[StateDeclaration.onRetain]]).\n   *\n   * Note: A state declaration's `onRetain` function is injected for Angular 1 only.\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onRetain(matchCriteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionStateHookFn]], called when a specific state is exited.\n   *\n   * Registers a lifecycle hook, which is invoked (during a transition) when a specific state is being exited.\n   *\n   * Since this hook is run only when the specific state is being *exited*, it can be useful for\n   * performing tasks when leaving a submodule/feature area such as cleaning up a stateful service,\n   * or for preventing the user from leaving a state or submodule until some criteria is satisfied.\n   *\n   * See [[TransitionStateHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * `onExit` hooks generally specify `{ exiting: 'somestate' }`.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onExit` hooks are invoked when the Transition is exiting a state.\n   * States are exited after any `onStart` phase is complete.\n   * If more than one state is being exited, the child states are exited first.\n   * The registered `onExit` hooks for a state are invoked in priority order.\n   *\n   * ### Return value\n   *\n   * The hook's return value can be used to pause, cancel, or redirect the current Transition.\n   * See [[HookResult]] for more information.\n   *\n   * ### Inside a state declaration\n   *\n   * Instead of registering `onExit` hooks using the [[TransitionService]], you may define an `onExit` hook\n   * directly on a state declaration (see: [[StateDeclaration.onExit]]).\n   *\n   * Note: A state declaration's `onExit` function is injected for Angular 1 only.\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onExit(matchCriteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionHookFn]], called *just before a transition finishes*.\n   *\n   * Registers a transition lifecycle hook, which is invoked just before a transition finishes.\n   * This hook is a last chance to cancel or redirect a transition.\n   *\n   * See [[TransitionHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onFinish` hooks are invoked after the `onEnter` phase is complete.\n   * These hooks are invoked just before the transition is \"committed\".\n   * Each hook is invoked in priority order.\n   *\n   * ### Return value\n   *\n   * The hook's return value can be used to pause, cancel, or redirect the current Transition.\n   * See [[HookResult]] for more information.\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onFinish(matchCriteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionHookFn]], called after a successful transition completed.\n   *\n   * Registers a transition lifecycle hook, which is invoked after a transition successfully completes.\n   *\n   * See [[TransitionHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * `onSuccess` hooks are chained off the Transition's promise (see [[Transition.promise]]).\n   * If the Transition is successful and its promise is resolved, then the `onSuccess` hooks are invoked.\n   * Since these hooks are run after the transition is over, their return value is ignored.\n   * The `onSuccess` hooks are invoked in priority order.\n   *\n   * ### Return value\n   *\n   * Since the Transition is already completed, the hook's return value is ignored\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onSuccess(matchCriteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Registers a [[TransitionHookFn]], called after a transition has errored.\n   *\n   * Registers a transition lifecycle hook, which is invoked after a transition has been rejected for any reason.\n   *\n   * See [[TransitionHookFn]] for the signature of the function.\n   *\n   * The [[HookMatchCriteria]] is used to determine which Transitions the hook should be invoked for.\n   * To match all Transitions, use an empty criteria object `{}`.\n   *\n   * ### Lifecycle\n   *\n   * The `onError` hooks are chained off the Transition's promise (see [[Transition.promise]]).\n   * If a Transition fails, its promise is rejected and the `onError` hooks are invoked.\n   * The `onError` hooks are invoked in priority order.\n   *\n   * Since these hooks are run after the transition is over, their return value is ignored.\n   *\n   * A transition \"errors\" if it was started, but failed to complete (for any reason).\n   * A *non-exhaustive list* of reasons a transition can error:\n   *\n   * - A transition was cancelled because a new transition started while it was still running (`Transition superseded`)\n   * - A transition was cancelled by a Transition Hook returning false\n   * - A transition was redirected by a Transition Hook returning a [[TargetState]]\n   * - A Transition Hook or resolve function threw an error\n   * - A Transition Hook returned a rejected promise\n   * - A resolve function returned a rejected promise\n   *\n   * To check the failure reason, inspect the return value of [[Transition.error]].\n   *\n   * Note: `onError` should be used for targeted error handling, or error recovery.\n   * For simple catch-all error reporting, use [[StateService.defaultErrorHandler]].\n   *\n   * ### Return value\n   *\n   * Since the Transition is already completed, the hook's return value is ignored\n   *\n   * @param matchCriteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be injected and invoked.\n   * @returns a function which deregisters the hook.\n   */\n  onError(matchCriteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function;\n\n  /**\n   * Returns all the registered hooks of a given `hookName` type\n   *\n   * #### Example:\n   * ```\n   * $transitions.getHooks(\"onEnter\")\n   * ```\n   */\n  getHooks(hookName: string): RegisteredHook[];\n}\n\n/** A predicate type which tests if a [[StateObject]] passes some test. Returns a boolean. */\nexport type IStateMatch = Predicate<StateObject>;\n\n/**\n * This object is used to configure whether or not a Transition Hook is invoked for a particular transition,\n * based on the Transition's \"to state\" and \"from state\".\n *\n * Each property (`to`, `from`, `exiting`, `retained`, and `entering`) can be a state [[Glob]] string,\n * a boolean, or a function that takes a state and returns a boolean (see [[HookMatchCriterion]])\n *\n * All properties are optional.  If any property is omitted, it is replaced with the value `true`, and always matches.\n * To match any transition, use an empty criteria object `{}`.\n *\n * #### Example:\n * ```js\n * // This matches a transition coming from the `parent` state and going to the `parent.child` state.\n * var match = {\n *   to: 'parent',\n *   from: 'parent.child'\n * }\n * ```\n *\n * #### Example:\n * ```js\n * // This matches a transition coming from any substate of `parent` and going directly to the `parent` state.\n * var match = {\n *   to: 'parent',\n *   from: 'parent.**'\n * }\n * ```\n *\n * #### Example:\n * ```js\n * // This matches a transition coming from any state and going to any substate of `mymodule`\n * var match = {\n *   to: 'mymodule.**'\n * }\n * ```\n *\n * #### Example:\n * ```js\n * // This matches a transition coming from any state and going to any state that has `data.authRequired`\n * // set to a truthy value.\n * var match = {\n *   to: function(state) {\n *     return state.data != null && state.data.authRequired === true;\n *   }\n * }\n * ```\n *\n * #### Example:\n * ```js\n * // This matches a transition that is exiting `parent.child`\n * var match = {\n *   exiting: 'parent.child'\n * }\n * ```\n */\nexport interface HookMatchCriteria {\n  [key: string]: HookMatchCriterion | undefined;\n\n  /** A [[HookMatchCriterion]] to match the destination state */\n  to?: HookMatchCriterion;\n  /** A [[HookMatchCriterion]] to match the original (from) state */\n  from?: HookMatchCriterion;\n  /** A [[HookMatchCriterion]] to match any state that would be exiting */\n  exiting?: HookMatchCriterion;\n  /** A [[HookMatchCriterion]] to match any state that would be retained */\n  retained?: HookMatchCriterion;\n  /** A [[HookMatchCriterion]] to match any state that would be entering */\n  entering?: HookMatchCriterion;\n}\n\nexport interface IMatchingNodes {\n  [key: string]: PathNode[];\n\n  to: PathNode[];\n  from: PathNode[];\n  exiting: PathNode[];\n  retained: PathNode[];\n  entering: PathNode[];\n}\n\n/** @hidden */\nexport interface RegisteredHooks {\n  [key: string]: RegisteredHook[];\n}\n\n/** @hidden */\nexport interface PathTypes {\n  [key: string]: PathType;\n\n  to: PathType;\n  from: PathType;\n  exiting: PathType;\n  retained: PathType;\n  entering: PathType;\n}\n\n/** @hidden */\nexport interface PathType {\n  name: string;\n  scope: TransitionHookScope;\n}\n\n/**\n * Hook Criterion used to match a transition.\n *\n * A [[Glob]] string that matches the name of a state.\n *\n * Or, a function with the signature `function(state) { return matches; }`\n * which should return a boolean to indicate if a state matches.\n *\n * Or, `true` to always match\n */\nexport type HookMatchCriterion = string | IStateMatch | boolean;\n\nenum TransitionHookPhase {\n  CREATE,\n  BEFORE,\n  RUN,\n  SUCCESS,\n  ERROR,\n}\nenum TransitionHookScope {\n  TRANSITION,\n  STATE,\n}\n\nexport { TransitionHookPhase, TransitionHookScope };\n","/**\n * @coreapi\n * @module state\n */\n/** for typedoc */\nimport { StateDeclaration, _ViewDeclaration, _StateDeclaration, LazyLoadResult } from './interface';\nimport { defaults, values, find, inherit } from '../common/common';\nimport { propEq } from '../common/hof';\nimport { Param } from '../params/param';\nimport { UrlMatcher } from '../url/urlMatcher';\nimport { Resolvable } from '../resolve/resolvable';\nimport { TransitionStateHookFn } from '../transition/interface';\nimport { TargetState } from './targetState';\nimport { Transition } from '../transition/transition';\nimport { Glob } from '../common/glob';\nimport { isObject, isFunction } from '../common/predicates';\n\n/**\n * Internal representation of a UI-Router state.\n *\n * Instances of this class are created when a [[StateDeclaration]] is registered with the [[StateRegistry]].\n *\n * A registered [[StateDeclaration]] is augmented with a getter ([[StateDeclaration.$$state]]) which returns the corresponding [[StateObject]] object.\n *\n * This class prototypally inherits from the corresponding [[StateDeclaration]].\n * Each of its own properties (i.e., `hasOwnProperty`) are built using builders from the [[StateBuilder]].\n */\nexport class StateObject {\n  /** The parent [[StateObject]] */\n  public parent: StateObject;\n\n  /** The name used to register the state */\n  public name: string;\n\n  /** Prototypally inherits from [[StateDeclaration.abstract]] */\n  public abstract: boolean;\n\n  /** Prototypally inherits from [[StateDeclaration.resolve]] */\n  public resolve: { [key: string]: string | any[] | Function } | any[];\n\n  /** A list of [[Resolvable]] objects.  The internal representation of [[resolve]]. */\n  public resolvables: Resolvable[];\n\n  /** Prototypally inherits from [[StateDeclaration.resolvePolicy]] */\n  public resolvePolicy: any;\n\n  /** A compiled URLMatcher which detects when the state's URL is matched */\n  public url: UrlMatcher;\n\n  /** The parameters for the state, built from the URL and [[StateDeclaration.params]] */\n  public params: { [key: string]: Param };\n\n  /**\n   * The views for the state.\n   * Note: `@uirouter/core` does not register a builder for views.\n   * The framework specific code should register a `views` builder.\n   */\n  public views: { [key: string]: _ViewDeclaration };\n\n  /**\n   * The original [[StateDeclaration]] used to build this [[StateObject]].\n   * Note: `this` object also prototypally inherits from the `self` declaration object.\n   */\n  public self: StateDeclaration;\n\n  /** The nearest parent [[StateObject]] which has a URL */\n  public navigable: StateObject;\n\n  /** The parent [[StateObject]] objects from this state up to the root */\n  public path: StateObject[];\n\n  /**\n   * Prototypally inherits from [[StateDeclaration.data]]\n   * Note: This is the only field on the [[StateDeclaration]] which is mutated.\n   * The definition object's `data` field is replaced with a new object\n   * which prototypally inherits from the parent state definition's `data` field.\n   */\n  public data: any;\n\n  /**\n   * An object containing the parent States' names as keys and\n   * true as their values.\n   */\n  public includes: { [name: string]: boolean };\n\n  /** Prototypally inherits from [[StateDeclaration.onExit]] */\n  public onExit: TransitionStateHookFn;\n  /** Prototypally inherits from [[StateDeclaration.onRetain]] */\n  public onRetain: TransitionStateHookFn;\n  /** Prototypally inherits from [[StateDeclaration.onEnter]] */\n  public onEnter: TransitionStateHookFn;\n\n  /** Prototypally inherits from [[StateDeclaration.lazyLoad]] */\n  public lazyLoad: (transition: Transition, state: StateDeclaration) => Promise<LazyLoadResult>;\n\n  /** Prototypally inherits from [[StateDeclaration.redirectTo]] */\n  redirectTo:\n    | string\n    | (($transition$: Transition) => TargetState)\n    | { state: string | StateDeclaration; params: { [key: string]: any } };\n\n  /** @hidden */\n  __stateObjectCache: {\n    /** Might be null */\n    nameGlob?: Glob;\n  };\n\n  /**\n   * Create a state object to put the private/internal implementation details onto.\n   * The object's prototype chain looks like:\n   * (Internal State Object) -> (Copy of State.prototype) -> (State Declaration object) -> (State Declaration's prototype...)\n   *\n   * @param stateDecl the user-supplied State Declaration\n   * @returns {StateObject} an internal State object\n   */\n  static create(stateDecl: _StateDeclaration): StateObject {\n    stateDecl = StateObject.isStateClass(stateDecl) ? new stateDecl() : stateDecl;\n\n    const state = inherit(inherit(stateDecl, StateObject.prototype)) as StateObject;\n    stateDecl.$$state = () => state;\n    state.self = stateDecl;\n    state.__stateObjectCache = {\n      nameGlob: Glob.fromString(state.name), // might return null\n    };\n    return state;\n  }\n\n  /** Predicate which returns true if the object is an class with @State() decorator */\n  static isStateClass = (stateDecl: _StateDeclaration): stateDecl is { new (): StateDeclaration } =>\n    isFunction(stateDecl) && stateDecl['__uiRouterState'] === true;\n\n  /** Predicate which returns true if the object is an internal [[StateObject]] object */\n  static isState = (obj: any): obj is StateObject => isObject(obj['__stateObjectCache']);\n\n  /** @deprecated use State.create() */\n  constructor(config?: StateDeclaration) {\n    return StateObject.create(config || {});\n  }\n\n  /**\n   * Returns true if the provided parameter is the same state.\n   *\n   * Compares the identity of the state against the passed value, which is either an object\n   * reference to the actual `State` instance, the original definition object passed to\n   * `$stateProvider.state()`, or the fully-qualified name.\n   *\n   * @param ref Can be one of (a) a `State` instance, (b) an object that was passed\n   *        into `$stateProvider.state()`, (c) the fully-qualified name of a state as a string.\n   * @returns Returns `true` if `ref` matches the current `State` instance.\n   */\n  is(ref: StateObject | StateDeclaration | string): boolean {\n    return this === ref || this.self === ref || this.fqn() === ref;\n  }\n\n  /**\n   * @deprecated this does not properly handle dot notation\n   * @returns Returns a dot-separated name of the state.\n   */\n  fqn(): string {\n    if (!this.parent || !(this.parent instanceof this.constructor)) return this.name;\n    const name = this.parent.fqn();\n    return name ? name + '.' + this.name : this.name;\n  }\n\n  /**\n   * Returns the root node of this state's tree.\n   *\n   * @returns The root of this state's tree.\n   */\n  root(): StateObject {\n    return (this.parent && this.parent.root()) || this;\n  }\n\n  /**\n   * Gets the state's `Param` objects\n   *\n   * Gets the list of [[Param]] objects owned by the state.\n   * If `opts.inherit` is true, it also includes the ancestor states' [[Param]] objects.\n   * If `opts.matchingKeys` exists, returns only `Param`s whose `id` is a key on the `matchingKeys` object\n   *\n   * @param opts options\n   */\n  parameters(opts?: { inherit?: boolean; matchingKeys?: any }): Param[] {\n    opts = defaults(opts, { inherit: true, matchingKeys: null });\n    const inherited = (opts.inherit && this.parent && this.parent.parameters()) || [];\n    return inherited\n      .concat(values(this.params))\n      .filter(param => !opts.matchingKeys || opts.matchingKeys.hasOwnProperty(param.id));\n  }\n\n  /**\n   * Returns a single [[Param]] that is owned by the state\n   *\n   * If `opts.inherit` is true, it also searches the ancestor states` [[Param]]s.\n   * @param id the name of the [[Param]] to return\n   * @param opts options\n   */\n  parameter(id: string, opts: { inherit?: boolean } = {}): Param {\n    return (\n      (this.url && this.url.parameter(id, opts)) ||\n      find(values(this.params), propEq('id', id)) ||\n      (opts.inherit && this.parent && this.parent.parameter(id))\n    );\n  }\n\n  toString() {\n    return this.fqn();\n  }\n}\n","/** @module state */ /** for typedoc */\nimport { isString } from '../common/predicates';\nimport { StateOrName } from './interface';\nimport { StateObject } from './stateObject';\nimport { values } from '../common/common';\n\nexport class StateMatcher {\n  constructor(private _states: { [key: string]: StateObject }) {}\n\n  isRelative(stateName: string) {\n    stateName = stateName || '';\n    return stateName.indexOf('.') === 0 || stateName.indexOf('^') === 0;\n  }\n\n  find(stateOrName: StateOrName, base?: StateOrName, matchGlob = true): StateObject {\n    if (!stateOrName && stateOrName !== '') return undefined;\n    const isStr = isString(stateOrName);\n    let name: string = isStr ? stateOrName : (<any>stateOrName).name;\n\n    if (this.isRelative(name)) name = this.resolvePath(name, base);\n    const state = this._states[name];\n\n    if (state && (isStr || (!isStr && (state === stateOrName || state.self === stateOrName)))) {\n      return state;\n    } else if (isStr && matchGlob) {\n      const _states = values(this._states);\n      const matches = _states.filter(\n        _state => _state.__stateObjectCache.nameGlob && _state.__stateObjectCache.nameGlob.matches(name)\n      );\n\n      if (matches.length > 1) {\n        // tslint:disable-next-line:no-console\n        console.log(\n          `stateMatcher.find: Found multiple matches for ${name} using glob: `,\n          matches.map(match => match.name)\n        );\n      }\n      return matches[0];\n    }\n    return undefined;\n  }\n\n  resolvePath(name: string, base: StateOrName) {\n    if (!base) throw new Error(`No reference point given for path '${name}'`);\n\n    const baseState: StateObject = this.find(base);\n\n    const splitName = name.split('.');\n    const pathLength = splitName.length;\n    let i = 0,\n      current = baseState;\n\n    for (; i < pathLength; i++) {\n      if (splitName[i] === '' && i === 0) {\n        current = baseState;\n        continue;\n      }\n      if (splitName[i] === '^') {\n        if (!current.parent) throw new Error(`Path '${name}' not valid for state '${baseState.name}'`);\n        current = current.parent;\n        continue;\n      }\n      break;\n    }\n    const relName = splitName.slice(i).join('.');\n    return current.name + (current.name && relName ? '.' : '') + relName;\n  }\n}\n","/** @module state */ /** for typedoc */\nimport { inArray } from '../common/common';\nimport { isString } from '../common/predicates';\nimport { StateDeclaration, _StateDeclaration } from './interface';\nimport { StateObject } from './stateObject';\nimport { StateBuilder } from './stateBuilder';\nimport { StateRegistryListener, StateRegistry } from './stateRegistry';\nimport { Disposable } from '../interface';\nimport { UrlRouter } from '../url/urlRouter';\nimport { prop } from '../common/hof';\nimport { StateMatcher } from './stateMatcher';\n\n/** @internalapi */\nexport class StateQueueManager implements Disposable {\n  queue: StateObject[];\n  matcher: StateMatcher;\n\n  constructor(\n    private $registry: StateRegistry,\n    private $urlRouter: UrlRouter,\n    public states: { [key: string]: StateObject },\n    public builder: StateBuilder,\n    public listeners: StateRegistryListener[]\n  ) {\n    this.queue = [];\n    this.matcher = $registry.matcher;\n  }\n\n  /** @internalapi */\n  dispose() {\n    this.queue = [];\n  }\n\n  register(stateDecl: _StateDeclaration) {\n    const queue = this.queue;\n    const state = StateObject.create(stateDecl);\n    const name = state.name;\n\n    if (!isString(name)) throw new Error('State must have a valid name');\n    if (this.states.hasOwnProperty(name) || inArray(queue.map(prop('name')), name))\n      throw new Error(`State '${name}' is already defined`);\n\n    queue.push(state);\n    this.flush();\n\n    return state;\n  }\n\n  flush() {\n    const { queue, states, builder } = this;\n    const registered: StateObject[] = [], // states that got registered\n      orphans: StateObject[] = [], // states that don't yet have a parent registered\n      previousQueueLength = {}; // keep track of how long the queue when an orphan was first encountered\n    const getState = name => this.states.hasOwnProperty(name) && this.states[name];\n    const notifyListeners = () => {\n      if (registered.length) {\n        this.listeners.forEach(listener => listener('registered', registered.map(s => s.self)));\n      }\n    };\n\n    while (queue.length > 0) {\n      const state: StateObject = queue.shift();\n      const name = state.name;\n      const result: StateObject = builder.build(state);\n      const orphanIdx: number = orphans.indexOf(state);\n\n      if (result) {\n        const existingState = getState(name);\n        if (existingState && existingState.name === name) {\n          throw new Error(`State '${name}' is already defined`);\n        }\n\n        const existingFutureState = getState(name + '.**');\n        if (existingFutureState) {\n          // Remove future state of the same name\n          this.$registry.deregister(existingFutureState);\n        }\n\n        states[name] = state;\n        this.attachRoute(state);\n        if (orphanIdx >= 0) orphans.splice(orphanIdx, 1);\n        registered.push(state);\n        continue;\n      }\n\n      const prev = previousQueueLength[name];\n      previousQueueLength[name] = queue.length;\n      if (orphanIdx >= 0 && prev === queue.length) {\n        // Wait until two consecutive iterations where no additional states were dequeued successfully.\n        // throw new Error(`Cannot register orphaned state '${name}'`);\n        queue.push(state);\n        notifyListeners();\n        return states;\n      } else if (orphanIdx < 0) {\n        orphans.push(state);\n      }\n\n      queue.push(state);\n    }\n\n    notifyListeners();\n    return states;\n  }\n\n  attachRoute(state: StateObject) {\n    if (state.abstract || !state.url) return;\n\n    this.$urlRouter.rule(this.$urlRouter.urlRuleFactory.create(state));\n  }\n}\n","/**\n * @coreapi\n * @module state\n */ /** for typedoc */\n\nimport { StateObject } from './stateObject';\nimport { StateMatcher } from './stateMatcher';\nimport { StateBuilder } from './stateBuilder';\nimport { StateQueueManager } from './stateQueueManager';\nimport { StateDeclaration, _StateDeclaration } from './interface';\nimport { BuilderFunction } from './stateBuilder';\nimport { StateOrName } from './interface';\nimport { removeFrom } from '../common/common';\nimport { UIRouter } from '../router';\nimport { propEq } from '../common/hof';\n\n/**\n * The signature for the callback function provided to [[StateRegistry.onStatesChanged]].\n *\n * This callback receives two parameters:\n *\n * @param event a string; either \"registered\" or \"deregistered\"\n * @param states the list of [[StateDeclaration]]s that were registered (or deregistered).\n */\nexport type StateRegistryListener = (event: 'registered' | 'deregistered', states: StateDeclaration[]) => void;\n\nexport class StateRegistry {\n  private _root: StateObject;\n  private states: { [key: string]: StateObject } = {};\n\n  matcher: StateMatcher;\n  private builder: StateBuilder;\n  stateQueue: StateQueueManager;\n\n  listeners: StateRegistryListener[] = [];\n\n  /** @internalapi */\n  constructor(private _router: UIRouter) {\n    this.matcher = new StateMatcher(this.states);\n    this.builder = new StateBuilder(this.matcher, _router.urlMatcherFactory);\n    this.stateQueue = new StateQueueManager(this, _router.urlRouter, this.states, this.builder, this.listeners);\n    this._registerRoot();\n  }\n\n  /** @internalapi */\n  private _registerRoot() {\n    const rootStateDef: StateDeclaration = {\n      name: '',\n      url: '^',\n      views: null,\n      params: {\n        '#': { value: null, type: 'hash', dynamic: true },\n      },\n      abstract: true,\n    };\n\n    const _root = (this._root = this.stateQueue.register(rootStateDef));\n    _root.navigable = null;\n  }\n\n  /** @internalapi */\n  dispose() {\n    this.stateQueue.dispose();\n    this.listeners = [];\n    this.get().forEach(state => this.get(state) && this.deregister(state));\n  }\n\n  /**\n   * Listen for a State Registry events\n   *\n   * Adds a callback that is invoked when states are registered or deregistered with the StateRegistry.\n   *\n   * #### Example:\n   * ```js\n   * let allStates = registry.get();\n   *\n   * // Later, invoke deregisterFn() to remove the listener\n   * let deregisterFn = registry.onStatesChanged((event, states) => {\n   *   switch(event) {\n   *     case: 'registered':\n   *       states.forEach(state => allStates.push(state));\n   *       break;\n   *     case: 'deregistered':\n   *       states.forEach(state => {\n   *         let idx = allStates.indexOf(state);\n   *         if (idx !== -1) allStates.splice(idx, 1);\n   *       });\n   *       break;\n   *   }\n   * });\n   * ```\n   *\n   * @param listener a callback function invoked when the registered states changes.\n   *        The function receives two parameters, `event` and `state`.\n   *        See [[StateRegistryListener]]\n   * @return a function that deregisters the listener\n   */\n  onStatesChanged(listener: StateRegistryListener): () => void {\n    this.listeners.push(listener);\n    return function deregisterListener() {\n      removeFrom(this.listeners)(listener);\n    }.bind(this);\n  }\n\n  /**\n   * Gets the implicit root state\n   *\n   * Gets the root of the state tree.\n   * The root state is implicitly created by UI-Router.\n   * Note: this returns the internal [[StateObject]] representation, not a [[StateDeclaration]]\n   *\n   * @return the root [[StateObject]]\n   */\n  root() {\n    return this._root;\n  }\n\n  /**\n   * Adds a state to the registry\n   *\n   * Registers a [[StateDeclaration]] or queues it for registration.\n   *\n   * Note: a state will be queued if the state's parent isn't yet registered.\n   *\n   * @param stateDefinition the definition of the state to register.\n   * @returns the internal [[StateObject]] object.\n   *          If the state was successfully registered, then the object is fully built (See: [[StateBuilder]]).\n   *          If the state was only queued, then the object is not fully built.\n   */\n  register(stateDefinition: _StateDeclaration): StateObject {\n    return this.stateQueue.register(stateDefinition);\n  }\n\n  /** @hidden */\n  private _deregisterTree(state: StateObject) {\n    const all = this.get().map(s => s.$$state());\n    const getChildren = (states: StateObject[]) => {\n      const _children = all.filter(s => states.indexOf(s.parent) !== -1);\n      return _children.length === 0 ? _children : _children.concat(getChildren(_children));\n    };\n\n    const children = getChildren([state]);\n    const deregistered: StateObject[] = [state].concat(children).reverse();\n\n    deregistered.forEach(_state => {\n      const $ur = this._router.urlRouter;\n      // Remove URL rule\n      $ur\n        .rules()\n        .filter(propEq('state', _state))\n        .forEach($ur.removeRule.bind($ur));\n      // Remove state from registry\n      delete this.states[_state.name];\n    });\n\n    return deregistered;\n  }\n\n  /**\n   * Removes a state from the registry\n   *\n   * This removes a state from the registry.\n   * If the state has children, they are are also removed from the registry.\n   *\n   * @param stateOrName the state's name or object representation\n   * @returns {StateObject[]} a list of removed states\n   */\n  deregister(stateOrName: StateOrName) {\n    const _state = this.get(stateOrName);\n    if (!_state) throw new Error(\"Can't deregister state; not found: \" + stateOrName);\n    const deregisteredStates = this._deregisterTree(_state.$$state());\n\n    this.listeners.forEach(listener => listener('deregistered', deregisteredStates.map(s => s.self)));\n    return deregisteredStates;\n  }\n\n  /**\n   * Gets all registered states\n   *\n   * Calling this method with no arguments will return a list of all the states that are currently registered.\n   * Note: this does not return states that are *queued* but not yet registered.\n   *\n   * @return a list of [[StateDeclaration]]s\n   */\n  get(): StateDeclaration[];\n\n  /**\n   * Gets a registered state\n   *\n   * Given a state or a name, finds and returns the [[StateDeclaration]] from the registry.\n   * Note: this does not return states that are *queued* but not yet registered.\n   *\n   * @param stateOrName either the name of a state, or a state object.\n   * @param base the base state to use when stateOrName is relative.\n   * @return a registered [[StateDeclaration]] that matched the `stateOrName`, or null if the state isn't registered.\n   */\n  get(stateOrName: StateOrName, base?: StateOrName): StateDeclaration;\n  get(stateOrName?: StateOrName, base?: StateOrName): any {\n    if (arguments.length === 0) return <StateDeclaration[]>Object.keys(this.states).map(name => this.states[name].self);\n    const found = this.matcher.find(stateOrName, base);\n    return (found && found.self) || null;\n  }\n\n  decorator(name: string, func: BuilderFunction) {\n    return this.builder.builder(name, func);\n  }\n}\n","/**\n * @coreapi\n * @module transition\n */\n/** for typedoc */\nimport { TransitionHookOptions, HookResult, TransitionHookPhase } from './interface';\nimport { defaults, noop, silentRejection } from '../common/common';\nimport { fnToString, maxLength } from '../common/strings';\nimport { isPromise } from '../common/predicates';\nimport { is, parse } from '../common/hof';\nimport { trace } from '../common/trace';\nimport { services } from '../common/coreservices';\nimport { Rejection } from './rejectFactory';\nimport { TargetState } from '../state/targetState';\nimport { Transition } from './transition';\nimport { TransitionEventType } from './transitionEventType';\nimport { RegisteredHook } from './hookRegistry';\nimport { StateDeclaration } from '../state/interface';\n\nconst defaultOptions: TransitionHookOptions = {\n  current: noop,\n  transition: null,\n  traceData: {},\n  bind: null,\n};\n\nexport type GetResultHandler = (hook: TransitionHook) => ResultHandler;\nexport type GetErrorHandler = (hook: TransitionHook) => ErrorHandler;\n\nexport type ResultHandler = (result: HookResult) => Promise<HookResult>;\nexport type ErrorHandler = (error: any) => Promise<any>;\n\n/** @hidden */\nexport class TransitionHook {\n  type: TransitionEventType;\n\n  /**\n   * These GetResultHandler(s) are used by [[invokeHook]] below\n   * Each HookType chooses a GetResultHandler (See: [[TransitionService._defineCoreEvents]])\n   */\n  static HANDLE_RESULT: GetResultHandler = (hook: TransitionHook) => (result: HookResult) =>\n    hook.handleHookResult(result);\n\n  /**\n   * If the result is a promise rejection, log it.\n   * Otherwise, ignore the result.\n   */\n  static LOG_REJECTED_RESULT: GetResultHandler = (hook: TransitionHook) => (result: HookResult) => {\n    isPromise(result) && result.catch(err => hook.logError(Rejection.normalize(err)));\n    return undefined;\n  };\n\n  /**\n   * These GetErrorHandler(s) are used by [[invokeHook]] below\n   * Each HookType chooses a GetErrorHandler (See: [[TransitionService._defineCoreEvents]])\n   */\n  static LOG_ERROR: GetErrorHandler = (hook: TransitionHook) => (error: any) => hook.logError(error);\n\n  static REJECT_ERROR: GetErrorHandler = (hook: TransitionHook) => (error: any) => silentRejection(error);\n\n  static THROW_ERROR: GetErrorHandler = (hook: TransitionHook) => (error: any) => {\n    throw error;\n  };\n\n  /**\n   * Chains together an array of TransitionHooks.\n   *\n   * Given a list of [[TransitionHook]] objects, chains them together.\n   * Each hook is invoked after the previous one completes.\n   *\n   * #### Example:\n   * ```js\n   * var hooks: TransitionHook[] = getHooks();\n   * let promise: Promise<any> = TransitionHook.chain(hooks);\n   *\n   * promise.then(handleSuccess, handleError);\n   * ```\n   *\n   * @param hooks the list of hooks to chain together\n   * @param waitFor if provided, the chain is `.then()`'ed off this promise\n   * @returns a `Promise` for sequentially invoking the hooks (in order)\n   */\n  static chain(hooks: TransitionHook[], waitFor?: Promise<any>): Promise<any> {\n    // Chain the next hook off the previous\n    const createHookChainR = (prev: Promise<any>, nextHook: TransitionHook) => prev.then(() => nextHook.invokeHook());\n    return hooks.reduce(createHookChainR, waitFor || services.$q.when());\n  }\n\n  /**\n   * Invokes all the provided TransitionHooks, in order.\n   * Each hook's return value is checked.\n   * If any hook returns a promise, then the rest of the hooks are chained off that promise, and the promise is returned.\n   * If no hook returns a promise, then all hooks are processed synchronously.\n   *\n   * @param hooks the list of TransitionHooks to invoke\n   * @param doneCallback a callback that is invoked after all the hooks have successfully completed\n   *\n   * @returns a promise for the async result, or the result of the callback\n   */\n  static invokeHooks<T>(hooks: TransitionHook[], doneCallback: (result?: HookResult) => T): Promise<any> | T {\n    for (let idx = 0; idx < hooks.length; idx++) {\n      const hookResult = hooks[idx].invokeHook();\n\n      if (isPromise(hookResult)) {\n        const remainingHooks = hooks.slice(idx + 1);\n\n        return TransitionHook.chain(remainingHooks, hookResult).then(doneCallback);\n      }\n    }\n\n    return doneCallback();\n  }\n\n  /**\n   * Run all TransitionHooks, ignoring their return value.\n   */\n  static runAllHooks(hooks: TransitionHook[]): void {\n    hooks.forEach(hook => hook.invokeHook());\n  }\n\n  constructor(\n    private transition: Transition,\n    private stateContext: StateDeclaration,\n    private registeredHook: RegisteredHook,\n    private options: TransitionHookOptions\n  ) {\n    this.options = defaults(options, defaultOptions);\n    this.type = registeredHook.eventType;\n  }\n\n  private isSuperseded = () => this.type.hookPhase === TransitionHookPhase.RUN && !this.options.transition.isActive();\n\n  logError(err): any {\n    this.transition.router.stateService.defaultErrorHandler()(err);\n  }\n\n  invokeHook(): Promise<HookResult> | void {\n    const hook = this.registeredHook;\n    if (hook._deregistered) return;\n\n    const notCurrent = this.getNotCurrentRejection();\n    if (notCurrent) return notCurrent;\n\n    const options = this.options;\n    trace.traceHookInvocation(this, this.transition, options);\n\n    const invokeCallback = () => hook.callback.call(options.bind, this.transition, this.stateContext);\n\n    const normalizeErr = err => Rejection.normalize(err).toPromise();\n\n    const handleError = err => hook.eventType.getErrorHandler(this)(err);\n\n    const handleResult = result => hook.eventType.getResultHandler(this)(result);\n\n    try {\n      const result = invokeCallback();\n\n      if (!this.type.synchronous && isPromise(result)) {\n        return result.catch(normalizeErr).then(handleResult, handleError);\n      } else {\n        return handleResult(result);\n      }\n    } catch (err) {\n      // If callback throws (synchronously)\n      return handleError(Rejection.normalize(err));\n    } finally {\n      if (hook.invokeLimit && ++hook.invokeCount >= hook.invokeLimit) {\n        hook.deregister();\n      }\n    }\n  }\n\n  /**\n   * This method handles the return value of a Transition Hook.\n   *\n   * A hook can return false (cancel), a TargetState (redirect),\n   * or a promise (which may later resolve to false or a redirect)\n   *\n   * This also handles \"transition superseded\" -- when a new transition\n   * was started while the hook was still running\n   */\n  handleHookResult(result: HookResult): Promise<HookResult> {\n    const notCurrent = this.getNotCurrentRejection();\n    if (notCurrent) return notCurrent;\n\n    // Hook returned a promise\n    if (isPromise(result)) {\n      // Wait for the promise, then reprocess with the resulting value\n      return result.then(val => this.handleHookResult(val));\n    }\n\n    trace.traceHookResult(result, this.transition, this.options);\n\n    // Hook returned false\n    if (result === false) {\n      // Abort this Transition\n      return Rejection.aborted('Hook aborted transition').toPromise();\n    }\n\n    const isTargetState = is(TargetState);\n    // hook returned a TargetState\n    if (isTargetState(result)) {\n      // Halt the current Transition and redirect (a new Transition) to the TargetState.\n      return Rejection.redirected(result).toPromise();\n    }\n  }\n\n  /**\n   * Return a Rejection promise if the transition is no longer current due\n   * to a stopped router (disposed), or a new transition has started and superseded this one.\n   */\n  private getNotCurrentRejection() {\n    const router = this.transition.router;\n\n    // The router is stopped\n    if (router._disposed) {\n      return Rejection.aborted(`UIRouter instance #${router.$id} has been stopped (disposed)`).toPromise();\n    }\n\n    if (this.transition._aborted) {\n      return Rejection.aborted().toPromise();\n    }\n\n    // This transition is no longer current.\n    // Another transition started while this hook was still running.\n    if (this.isSuperseded()) {\n      // Abort this transition\n      return Rejection.superseded(this.options.current()).toPromise();\n    }\n  }\n\n  toString() {\n    const { options, registeredHook } = this;\n    const event = parse('traceData.hookType')(options) || 'internal',\n      context = parse('traceData.context.state.name')(options) || parse('traceData.context')(options) || 'unknown',\n      name = fnToString(registeredHook.callback);\n    return `${event} context: ${context}, ${maxLength(200, name)}`;\n  }\n}\n","/**\n * @coreapi\n * @module transition\n */ /** for typedoc */\nimport { isString, isFunction, Glob, extend, removeFrom, tail, values, identity, mapObj } from '../common';\nimport { PathNode } from '../path/pathNode';\nimport {\n  TransitionStateHookFn,\n  TransitionHookFn,\n  TransitionHookPhase, // has or is using\n  TransitionHookScope,\n  IHookRegistry,\n  PathType,\n} from './interface';\n\nimport {\n  HookRegOptions,\n  HookMatchCriteria,\n  TreeChanges,\n  HookMatchCriterion,\n  IMatchingNodes,\n  HookFn,\n} from './interface';\nimport { StateObject } from '../state/stateObject';\nimport { TransitionEventType } from './transitionEventType';\nimport { TransitionService } from './transitionService';\n\n/**\n * Determines if the given state matches the matchCriteria\n *\n * @hidden\n *\n * @param state a State Object to test against\n * @param criterion\n * - If a string, matchState uses the string as a glob-matcher against the state name\n * - If an array (of strings), matchState uses each string in the array as a glob-matchers against the state name\n *   and returns a positive match if any of the globs match.\n * - If a function, matchState calls the function with the state and returns true if the function's result is truthy.\n * @returns {boolean}\n */\nexport function matchState(state: StateObject, criterion: HookMatchCriterion) {\n  const toMatch = isString(criterion) ? [criterion] : criterion;\n\n  function matchGlobs(_state: StateObject) {\n    const globStrings = <string[]>toMatch;\n    for (let i = 0; i < globStrings.length; i++) {\n      const glob = new Glob(globStrings[i]);\n\n      if ((glob && glob.matches(_state.name)) || (!glob && globStrings[i] === _state.name)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  const matchFn = <any>(isFunction(toMatch) ? toMatch : matchGlobs);\n  return !!matchFn(state);\n}\n\n/**\n * @internalapi\n * The registration data for a registered transition hook\n */\nexport class RegisteredHook {\n  priority: number;\n  bind: any;\n  invokeCount = 0;\n  invokeLimit: number;\n  _deregistered = false;\n\n  constructor(\n    public tranSvc: TransitionService,\n    public eventType: TransitionEventType,\n    public callback: HookFn,\n    public matchCriteria: HookMatchCriteria,\n    public removeHookFromRegistry: (hook: RegisteredHook) => void,\n    options: HookRegOptions = {} as any\n  ) {\n    this.priority = options.priority || 0;\n    this.bind = options.bind || null;\n    this.invokeLimit = options.invokeLimit;\n  }\n\n  /**\n   * Gets the matching [[PathNode]]s\n   *\n   * Given an array of [[PathNode]]s, and a [[HookMatchCriterion]], returns an array containing\n   * the [[PathNode]]s that the criteria matches, or `null` if there were no matching nodes.\n   *\n   * Returning `null` is significant to distinguish between the default\n   * \"match-all criterion value\" of `true` compared to a `() => true` function,\n   * when the nodes is an empty array.\n   *\n   * This is useful to allow a transition match criteria of `entering: true`\n   * to still match a transition, even when `entering === []`.  Contrast that\n   * with `entering: (state) => true` which only matches when a state is actually\n   * being entered.\n   */\n  private _matchingNodes(nodes: PathNode[], criterion: HookMatchCriterion): PathNode[] {\n    if (criterion === true) return nodes;\n    const matching = nodes.filter(node => matchState(node.state, criterion));\n    return matching.length ? matching : null;\n  }\n\n  /**\n   * Gets the default match criteria (all `true`)\n   *\n   * Returns an object which has all the criteria match paths as keys and `true` as values, i.e.:\n   *\n   * ```js\n   * {\n   *   to: true,\n   *   from: true,\n   *   entering: true,\n   *   exiting: true,\n   *   retained: true,\n   * }\n   */\n  private _getDefaultMatchCriteria(): HookMatchCriteria {\n    return mapObj(this.tranSvc._pluginapi._getPathTypes(), () => true);\n  }\n\n  /**\n   * Gets matching nodes as [[IMatchingNodes]]\n   *\n   * Create a IMatchingNodes object from the TransitionHookTypes that is roughly equivalent to:\n   *\n   * ```js\n   * let matches: IMatchingNodes = {\n   *   to:       _matchingNodes([tail(treeChanges.to)],   mc.to),\n   *   from:     _matchingNodes([tail(treeChanges.from)], mc.from),\n   *   exiting:  _matchingNodes(treeChanges.exiting,      mc.exiting),\n   *   retained: _matchingNodes(treeChanges.retained,     mc.retained),\n   *   entering: _matchingNodes(treeChanges.entering,     mc.entering),\n   * };\n   * ```\n   */\n  private _getMatchingNodes(treeChanges: TreeChanges): IMatchingNodes {\n    const criteria = extend(this._getDefaultMatchCriteria(), this.matchCriteria);\n    const paths: PathType[] = values(this.tranSvc._pluginapi._getPathTypes());\n\n    return paths.reduce(\n      (mn: IMatchingNodes, pathtype: PathType) => {\n        // STATE scope criteria matches against every node in the path.\n        // TRANSITION scope criteria matches against only the last node in the path\n        const isStateHook = pathtype.scope === TransitionHookScope.STATE;\n        const path = treeChanges[pathtype.name] || [];\n        const nodes: PathNode[] = isStateHook ? path : [tail(path)];\n\n        mn[pathtype.name] = this._matchingNodes(nodes, criteria[pathtype.name]);\n        return mn;\n      },\n      {} as IMatchingNodes\n    );\n  }\n\n  /**\n   * Determines if this hook's [[matchCriteria]] match the given [[TreeChanges]]\n   *\n   * @returns an IMatchingNodes object, or null. If an IMatchingNodes object is returned, its values\n   * are the matching [[PathNode]]s for each [[HookMatchCriterion]] (to, from, exiting, retained, entering)\n   */\n  matches(treeChanges: TreeChanges): IMatchingNodes {\n    const matches = this._getMatchingNodes(treeChanges);\n\n    // Check if all the criteria matched the TreeChanges object\n    const allMatched = values(matches).every(identity);\n    return allMatched ? matches : null;\n  }\n\n  deregister() {\n    this.removeHookFromRegistry(this);\n    this._deregistered = true;\n  }\n}\n\n/** @hidden Return a registration function of the requested type. */\nexport function makeEvent(\n  registry: IHookRegistry,\n  transitionService: TransitionService,\n  eventType: TransitionEventType\n) {\n  // Create the object which holds the registered transition hooks.\n  const _registeredHooks = (registry._registeredHooks = registry._registeredHooks || {});\n  const hooks = (_registeredHooks[eventType.name] = []);\n  const removeHookFn: (hook: RegisteredHook) => void = removeFrom(hooks);\n\n  // Create hook registration function on the IHookRegistry for the event\n  registry[eventType.name] = hookRegistrationFn;\n\n  function hookRegistrationFn(matchObject, callback, options = {}) {\n    const registeredHook = new RegisteredHook(\n      transitionService,\n      eventType,\n      callback,\n      matchObject,\n      removeHookFn,\n      options\n    );\n    hooks.push(registeredHook);\n    return registeredHook.deregister.bind(registeredHook);\n  }\n\n  return hookRegistrationFn;\n}\n","/**\n * @coreapi\n * @module transition\n */ /** for typedoc */\n\nimport { extend, tail, assertPredicate, unnestR, identity } from '../common/common';\nimport { isArray } from '../common/predicates';\n\nimport {\n  TransitionOptions,\n  TransitionHookOptions,\n  IHookRegistry,\n  TreeChanges,\n  IMatchingNodes,\n  TransitionHookPhase,\n  TransitionHookScope,\n} from './interface';\n\nimport { Transition } from './transition';\nimport { TransitionHook } from './transitionHook';\nimport { StateObject } from '../state/stateObject';\nimport { PathNode } from '../path/pathNode';\nimport { TransitionService } from './transitionService';\nimport { TransitionEventType } from './transitionEventType';\nimport { RegisteredHook } from './hookRegistry';\n\n/**\n * This class returns applicable TransitionHooks for a specific Transition instance.\n *\n * Hooks ([[RegisteredHook]]) may be registered globally, e.g., $transitions.onEnter(...), or locally, e.g.\n * myTransition.onEnter(...).  The HookBuilder finds matching RegisteredHooks (where the match criteria is\n * determined by the type of hook)\n *\n * The HookBuilder also converts RegisteredHooks objects to TransitionHook objects, which are used to run a Transition.\n *\n * The HookBuilder constructor is given the $transitions service and a Transition instance.  Thus, a HookBuilder\n * instance may only be used for one specific Transition object. (side note: the _treeChanges accessor is private\n * in the Transition class, so we must also provide the Transition's _treeChanges)\n *\n */\nexport class HookBuilder {\n  constructor(private transition: Transition) {}\n\n  buildHooksForPhase(phase: TransitionHookPhase): TransitionHook[] {\n    const $transitions = this.transition.router.transitionService;\n    return $transitions._pluginapi\n      ._getEvents(phase)\n      .map(type => this.buildHooks(type))\n      .reduce(unnestR, [])\n      .filter(identity);\n  }\n\n  /**\n   * Returns an array of newly built TransitionHook objects.\n   *\n   * - Finds all RegisteredHooks registered for the given `hookType` which matched the transition's [[TreeChanges]].\n   * - Finds [[PathNode]] (or `PathNode[]`) to use as the TransitionHook context(s)\n   * - For each of the [[PathNode]]s, creates a TransitionHook\n   *\n   * @param hookType the type of the hook registration function, e.g., 'onEnter', 'onFinish'.\n   */\n  buildHooks(hookType: TransitionEventType): TransitionHook[] {\n    const transition = this.transition;\n    const treeChanges = transition.treeChanges();\n\n    // Find all the matching registered hooks for a given hook type\n    const matchingHooks = this.getMatchingHooks(hookType, treeChanges);\n    if (!matchingHooks) return [];\n\n    const baseHookOptions = <TransitionHookOptions>{\n      transition: transition,\n      current: transition.options().current,\n    };\n\n    const makeTransitionHooks = (hook: RegisteredHook) => {\n      // Fetch the Nodes that caused this hook to match.\n      const matches: IMatchingNodes = hook.matches(treeChanges);\n      // Select the PathNode[] that will be used as TransitionHook context objects\n      const matchingNodes: PathNode[] = matches[hookType.criteriaMatchPath.name];\n\n      // Return an array of HookTuples\n      return matchingNodes.map(node => {\n        const _options = extend(\n          {\n            bind: hook.bind,\n            traceData: { hookType: hookType.name, context: node },\n          },\n          baseHookOptions\n        );\n\n        const state = hookType.criteriaMatchPath.scope === TransitionHookScope.STATE ? node.state.self : null;\n        const transitionHook = new TransitionHook(transition, state, hook, _options);\n        return <HookTuple>{ hook, node, transitionHook };\n      });\n    };\n\n    return matchingHooks\n      .map(makeTransitionHooks)\n      .reduce(unnestR, [])\n      .sort(tupleSort(hookType.reverseSort))\n      .map(tuple => tuple.transitionHook);\n  }\n\n  /**\n   * Finds all RegisteredHooks from:\n   * - The Transition object instance hook registry\n   * - The TransitionService ($transitions) global hook registry\n   *\n   * which matched:\n   * - the eventType\n   * - the matchCriteria (to, from, exiting, retained, entering)\n   *\n   * @returns an array of matched [[RegisteredHook]]s\n   */\n  public getMatchingHooks(hookType: TransitionEventType, treeChanges: TreeChanges): RegisteredHook[] {\n    const isCreate = hookType.hookPhase === TransitionHookPhase.CREATE;\n\n    // Instance and Global hook registries\n    const $transitions = this.transition.router.transitionService;\n    const registries = isCreate ? [$transitions] : [this.transition, $transitions];\n\n    return registries\n      .map((reg: IHookRegistry) => reg.getHooks(hookType.name)) // Get named hooks from registries\n      .filter(assertPredicate(isArray, `broken event named: ${hookType.name}`)) // Sanity check\n      .reduce(unnestR, []) // Un-nest RegisteredHook[][] to RegisteredHook[] array\n      .filter(hook => hook.matches(treeChanges)); // Only those satisfying matchCriteria\n  }\n}\n\ninterface HookTuple {\n  hook: RegisteredHook;\n  node: PathNode;\n  transitionHook: TransitionHook;\n}\n\n/**\n * A factory for a sort function for HookTuples.\n *\n * The sort function first compares the PathNode depth (how deep in the state tree a node is), then compares\n * the EventHook priority.\n *\n * @param reverseDepthSort a boolean, when true, reverses the sort order for the node depth\n * @returns a tuple sort function\n */\nfunction tupleSort(reverseDepthSort = false) {\n  return function nodeDepthThenPriority(l: HookTuple, r: HookTuple): number {\n    const factor = reverseDepthSort ? -1 : 1;\n    const depthDelta = (l.node.state.path.length - r.node.state.path.length) * factor;\n    return depthDelta !== 0 ? depthDelta : r.hook.priority - l.hook.priority;\n  };\n}\n","/**\n * @coreapi\n * @module transition\n */\n/** for typedoc */\nimport { trace } from '../common/trace';\nimport { services } from '../common/coreservices';\nimport { stringify } from '../common/strings';\nimport { map, find, extend, mergeR, tail, omit, arrayTuples, unnestR, identity, anyTrueR } from '../common/common';\nimport { isObject, isUndefined } from '../common/predicates';\nimport { prop, propEq, val, not, is } from '../common/hof';\nimport { StateDeclaration, StateOrName } from '../state/interface';\nimport {\n  TransitionOptions,\n  TreeChanges,\n  IHookRegistry,\n  TransitionHookPhase,\n  RegisteredHooks,\n  HookRegOptions,\n  HookMatchCriteria,\n  TransitionStateHookFn,\n  TransitionHookFn,\n} from './interface'; // has or is using\nimport { TransitionHook } from './transitionHook';\nimport { matchState, makeEvent, RegisteredHook } from './hookRegistry';\nimport { HookBuilder } from './hookBuilder';\nimport { PathNode } from '../path/pathNode';\nimport { PathUtils } from '../path/pathUtils';\nimport { StateObject } from '../state/stateObject';\nimport { TargetState } from '../state/targetState';\nimport { Param } from '../params/param';\nimport { Resolvable } from '../resolve/resolvable';\nimport { ViewConfig } from '../view/interface';\nimport { ResolveContext } from '../resolve/resolveContext';\nimport { UIRouter } from '../router';\nimport { UIInjector } from '../interface';\nimport { RawParams } from '../params/interface';\nimport { ResolvableLiteral } from '../resolve/interface';\nimport { Rejection } from './rejectFactory';\nimport { applyPairs, flattenR, uniqR } from '../common';\n\n/** @hidden */\nconst stateSelf: (_state: StateObject) => StateDeclaration = prop('self');\n\n/**\n * Represents a transition between two states.\n *\n * When navigating to a state, we are transitioning **from** the current state **to** the new state.\n *\n * This object contains all contextual information about the to/from states, parameters, resolves.\n * It has information about all states being entered and exited as a result of the transition.\n */\nexport class Transition implements IHookRegistry {\n  /** @hidden */\n  static diToken = Transition;\n\n  /**\n   * A unique identifier for the transition.\n   *\n   * This is an auto incrementing integer, starting from `0`.\n   */\n  $id: number;\n\n  /**\n   * A reference to the [[UIRouter]] instance\n   *\n   * This reference can be used to access the router services, such as the [[StateService]]\n   */\n  router: UIRouter;\n\n  /** @hidden */\n  private _deferred = services.$q.defer();\n  /**\n   * This promise is resolved or rejected based on the outcome of the Transition.\n   *\n   * When the transition is successful, the promise is resolved\n   * When the transition is unsuccessful, the promise is rejected with the [[Rejection]] or javascript error\n   */\n  promise: Promise<any> = this._deferred.promise;\n  /**\n   * A boolean which indicates if the transition was successful\n   *\n   * After a successful transition, this value is set to true.\n   * After an unsuccessful transition, this value is set to false.\n   *\n   * The value will be undefined if the transition is not complete\n   */\n  success: boolean;\n  /** @hidden */\n  _aborted: boolean;\n  /** @hidden */\n  private _error: Rejection;\n\n  /** @hidden Holds the hook registration functions such as those passed to Transition.onStart() */\n  _registeredHooks: RegisteredHooks = {};\n\n  /** @hidden */\n  private _options: TransitionOptions;\n  /** @hidden */\n  private _treeChanges: TreeChanges;\n  /** @hidden */\n  private _targetState: TargetState;\n  /** @hidden */\n  private _hookBuilder = new HookBuilder(this);\n\n  /** @hidden */\n  onBefore(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onStart(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onExit(criteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onRetain(criteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onEnter(criteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onFinish(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onSuccess(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onError(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n\n  /** @hidden\n   * Creates the transition-level hook registration functions\n   * (which can then be used to register hooks)\n   */\n  private createTransitionHookRegFns() {\n    this.router.transitionService._pluginapi\n      ._getEvents()\n      .filter(type => type.hookPhase !== TransitionHookPhase.CREATE)\n      .forEach(type => makeEvent(this, this.router.transitionService, type));\n  }\n\n  /** @internalapi */\n  getHooks(hookName: string): RegisteredHook[] {\n    return this._registeredHooks[hookName];\n  }\n\n  /**\n   * Creates a new Transition object.\n   *\n   * If the target state is not valid, an error is thrown.\n   *\n   * @internalapi\n   *\n   * @param fromPath The path of [[PathNode]]s from which the transition is leaving.  The last node in the `fromPath`\n   *        encapsulates the \"from state\".\n   * @param targetState The target state and parameters being transitioned to (also, the transition options)\n   * @param router The [[UIRouter]] instance\n   */\n  constructor(fromPath: PathNode[], targetState: TargetState, router: UIRouter) {\n    this.router = router;\n    this._targetState = targetState;\n\n    if (!targetState.valid()) {\n      throw new Error(targetState.error());\n    }\n\n    // current() is assumed to come from targetState.options, but provide a naive implementation otherwise.\n    this._options = extend({ current: val(this) }, targetState.options());\n    this.$id = router.transitionService._transitionCount++;\n    const toPath = PathUtils.buildToPath(fromPath, targetState);\n    this._treeChanges = PathUtils.treeChanges(fromPath, toPath, this._options.reloadState);\n    this.createTransitionHookRegFns();\n\n    const onCreateHooks = this._hookBuilder.buildHooksForPhase(TransitionHookPhase.CREATE);\n    TransitionHook.invokeHooks(onCreateHooks, () => null);\n\n    this.applyViewConfigs(router);\n  }\n\n  private applyViewConfigs(router: UIRouter) {\n    const enteringStates = this._treeChanges.entering.map(node => node.state);\n    PathUtils.applyViewConfigs(router.transitionService.$view, this._treeChanges.to, enteringStates);\n  }\n\n  /**\n   * @internalapi\n   *\n   * @returns the internal from [State] object\n   */\n  $from() {\n    return tail(this._treeChanges.from).state;\n  }\n\n  /**\n   * @internalapi\n   *\n   * @returns the internal to [State] object\n   */\n  $to() {\n    return tail(this._treeChanges.to).state;\n  }\n\n  /**\n   * Returns the \"from state\"\n   *\n   * Returns the state that the transition is coming *from*.\n   *\n   * @returns The state declaration object for the Transition's (\"from state\").\n   */\n  from(): StateDeclaration {\n    return this.$from().self;\n  }\n\n  /**\n   * Returns the \"to state\"\n   *\n   * Returns the state that the transition is going *to*.\n   *\n   * @returns The state declaration object for the Transition's target state (\"to state\").\n   */\n  to(): StateDeclaration {\n    return this.$to().self;\n  }\n\n  /**\n   * Gets the Target State\n   *\n   * A transition's [[TargetState]] encapsulates the [[to]] state, the [[params]], and the [[options]] as a single object.\n   *\n   * @returns the [[TargetState]] of this Transition\n   */\n  targetState() {\n    return this._targetState;\n  }\n\n  /**\n   * Determines whether two transitions are equivalent.\n   * @deprecated\n   */\n  is(compare: Transition | { to?: any; from?: any }): boolean {\n    if (compare instanceof Transition) {\n      // TODO: Also compare parameters\n      return this.is({ to: compare.$to().name, from: compare.$from().name });\n    }\n    return !(\n      (compare.to && !matchState(this.$to(), compare.to)) ||\n      (compare.from && !matchState(this.$from(), compare.from))\n    );\n  }\n\n  /**\n   * Gets transition parameter values\n   *\n   * Returns the parameter values for a transition as key/value pairs.\n   * This object is immutable.\n   *\n   * By default, returns the new parameter values (for the \"to state\").\n   *\n   * #### Example:\n   * ```js\n   * var toParams = transition.params();\n   * ```\n   *\n   * To return the previous parameter values,  supply `'from'` as the `pathname` argument.\n   *\n   * #### Example:\n   * ```js\n   * var fromParams = transition.params('from');\n   * ```\n   *\n   * @param pathname the name of the treeChanges path to get parameter values for:\n   *   (`'to'`, `'from'`, `'entering'`, `'exiting'`, `'retained'`)\n   *\n   * @returns transition parameter values for the desired path.\n   */\n  params(pathname?: string): { [paramName: string]: any };\n  params<T>(pathname?: string): T;\n  params(pathname = 'to') {\n    return Object.freeze(this._treeChanges[pathname].map(prop('paramValues')).reduce(mergeR, {}));\n  }\n\n  /**\n   * Gets the new values of any parameters that changed during this transition.\n   *\n   * Returns any parameter values that have changed during a transition, as key/value pairs.\n   *\n   * - Any parameter values that have changed will be present on the returned object reflecting the new value.\n   * - Any parameters that *not* have changed will not be present on the returned object.\n   * - Any new parameters that weren't present in the \"from\" state, but are now present in the \"to\" state will be present on the returned object.\n   * - Any previous parameters that are no longer present (because the \"to\" state doesn't have them) will be included with a value of `undefined`.\n   *\n   * The returned object is immutable.\n   *\n   * #### Examples:\n   *\n   * Given:\n   * ```js\n   * var stateA = { name: 'stateA', url: '/stateA/:param1/param2' }\n   * var stateB = { name: 'stateB', url: '/stateB/:param3' }\n   * var stateC = { name: 'stateB.nest', url: '/nest/:param4' }\n   * ```\n   *\n   * #### Example 1\n   *\n   * From `/stateA/abc/def` to `/stateA/abc/xyz`\n   *\n   * ```js\n   * var changed = transition.paramsChanged()\n   * // changed is { param2: 'xyz' }\n   * ```\n   *\n   * The value of `param2` changed to `xyz`.\n   * The value of `param1` stayed the same so its value is not present.\n   *\n   * #### Example 2\n   *\n   * From `/stateA/abc/def` to `/stateB/123`\n   *\n   * ```js\n   * var changed = transition.paramsChanged()\n   * // changed is { param1: undefined, param2: undefined, param3: '123' }\n   * ```\n   *\n   * The value `param3` is present because it is a new param.\n   * Both `param1` and `param2` are no longer present so their value is undefined.\n   *\n   * #### Example 3\n   *\n   * From `/stateB/123` to `/stateB/123/nest/456`\n   *\n   * ```js\n   * var changed = transition.paramsChanged()\n   * // changed is { param4: '456' }\n   * ```\n   *\n   * The value `param4` is present because it is a new param.\n   * The value of `param3` did not change, so its value is not present.\n   *\n   * @returns an immutable object with changed parameter keys/values.\n   */\n  paramsChanged(): { [paramName: string]: any };\n  paramsChanged<T>(): T;\n  paramsChanged() {\n    const fromParams = this.params('from');\n    const toParams = this.params('to');\n\n    // All the parameters declared on both the \"to\" and \"from\" paths\n    const allParamDescriptors: Param[] = []\n      .concat(this._treeChanges.to)\n      .concat(this._treeChanges.from)\n      .map(pathNode => pathNode.paramSchema)\n      .reduce(flattenR, [])\n      .reduce(uniqR, []);\n\n    const changedParamDescriptors = Param.changed(allParamDescriptors, fromParams, toParams);\n\n    return changedParamDescriptors.reduce((changedValues, descriptor) => {\n      changedValues[descriptor.id] = toParams[descriptor.id];\n      return changedValues;\n    }, {});\n  }\n\n  /**\n   * Creates a [[UIInjector]] Dependency Injector\n   *\n   * Returns a Dependency Injector for the Transition's target state (to state).\n   * The injector provides resolve values which the target state has access to.\n   *\n   * The `UIInjector` can also provide values from the native root/global injector (ng1/ng2).\n   *\n   * #### Example:\n   * ```js\n   * .onEnter({ entering: 'myState' }, trans => {\n   *   var myResolveValue = trans.injector().get('myResolve');\n   *   // Inject a global service from the global/native injector (if it exists)\n   *   var MyService = trans.injector().get('MyService');\n   * })\n   * ```\n   *\n   * In some cases (such as `onBefore`), you may need access to some resolve data but it has not yet been fetched.\n   * You can use [[UIInjector.getAsync]] to get a promise for the data.\n   * #### Example:\n   * ```js\n   * .onBefore({}, trans => {\n   *   return trans.injector().getAsync('myResolve').then(myResolveValue =>\n   *     return myResolveValue !== 'ABORT';\n   *   });\n   * });\n   * ```\n   *\n   * If a `state` is provided, the injector that is returned will be limited to resolve values that the provided state has access to.\n   * This can be useful if both a parent state `foo` and a child state `foo.bar` have both defined a resolve such as `data`.\n   * #### Example:\n   * ```js\n   * .onEnter({ to: 'foo.bar' }, trans => {\n   *   // returns result of `foo` state's `myResolve` resolve\n   *   // even though `foo.bar` also has a `myResolve` resolve\n   *   var fooData = trans.injector('foo').get('myResolve');\n   * });\n   * ```\n   *\n   * If you need resolve data from the exiting states, pass `'from'` as `pathName`.\n   * The resolve data from the `from` path will be returned.\n   * #### Example:\n   * ```js\n   * .onExit({ exiting: 'foo.bar' }, trans => {\n   *   // Gets the resolve value of `myResolve` from the state being exited\n   *   var fooData = trans.injector(null, 'from').get('myResolve');\n   * });\n   * ```\n   *\n   *\n   * @param state Limits the resolves provided to only the resolves the provided state has access to.\n   * @param pathName Default: `'to'`: Chooses the path for which to create the injector. Use this to access resolves for `exiting` states.\n   *\n   * @returns a [[UIInjector]]\n   */\n  injector(state?: StateOrName, pathName = 'to'): UIInjector {\n    let path: PathNode[] = this._treeChanges[pathName];\n    if (state) path = PathUtils.subPath(path, node => node.state === state || node.state.name === state);\n    return new ResolveContext(path).injector();\n  }\n\n  /**\n   * Gets all available resolve tokens (keys)\n   *\n   * This method can be used in conjunction with [[injector]] to inspect the resolve values\n   * available to the Transition.\n   *\n   * This returns all the tokens defined on [[StateDeclaration.resolve]] blocks, for the states\n   * in the Transition's [[TreeChanges.to]] path.\n   *\n   * #### Example:\n   * This example logs all resolve values\n   * ```js\n   * let tokens = trans.getResolveTokens();\n   * tokens.forEach(token => console.log(token + \" = \" + trans.injector().get(token)));\n   * ```\n   *\n   * #### Example:\n   * This example creates promises for each resolve value.\n   * This triggers fetches of resolves (if any have not yet been fetched).\n   * When all promises have all settled, it logs the resolve values.\n   * ```js\n   * let tokens = trans.getResolveTokens();\n   * let promise = tokens.map(token => trans.injector().getAsync(token));\n   * Promise.all(promises).then(values => console.log(\"Resolved values: \" + values));\n   * ```\n   *\n   * Note: Angular 1 users whould use `$q.all()`\n   *\n   * @param pathname resolve context's path name (e.g., `to` or `from`)\n   *\n   * @returns an array of resolve tokens (keys)\n   */\n  getResolveTokens(pathname = 'to'): any[] {\n    return new ResolveContext(this._treeChanges[pathname]).getTokens();\n  }\n\n  /**\n   * Dynamically adds a new [[Resolvable]] (i.e., [[StateDeclaration.resolve]]) to this transition.\n   *\n   * Allows a transition hook to dynamically add a Resolvable to this Transition.\n   *\n   * Use the [[Transition.injector]] to retrieve the resolved data in subsequent hooks ([[UIInjector.get]]).\n   *\n   * If a `state` argument is provided, the Resolvable is processed when that state is being entered.\n   * If no `state` is provided then the root state is used.\n   * If the given `state` has already been entered, the Resolvable is processed when any child state is entered.\n   * If no child states will be entered, the Resolvable is processed during the `onFinish` phase of the Transition.\n   *\n   * The `state` argument also scopes the resolved data.\n   * The resolved data is available from the injector for that `state` and any children states.\n   *\n   * #### Example:\n   * ```js\n   * transitionService.onBefore({}, transition => {\n   *   transition.addResolvable({\n   *     token: 'myResolve',\n   *     deps: ['MyService'],\n   *     resolveFn: myService => myService.getData()\n   *   });\n   * });\n   * ```\n   *\n   * @param resolvable a [[ResolvableLiteral]] object (or a [[Resolvable]])\n   * @param state the state in the \"to path\" which should receive the new resolve (otherwise, the root state)\n   */\n  addResolvable(resolvable: Resolvable | ResolvableLiteral, state: StateOrName = ''): void {\n    resolvable = is(Resolvable)(resolvable) ? resolvable : new Resolvable(resolvable);\n\n    const stateName: string = typeof state === 'string' ? state : state.name;\n    const topath = this._treeChanges.to;\n    const targetNode = find(topath, node => node.state.name === stateName);\n    const resolveContext: ResolveContext = new ResolveContext(topath);\n    resolveContext.addResolvables([resolvable as Resolvable], targetNode.state);\n  }\n\n  /**\n   * Gets the transition from which this transition was redirected.\n   *\n   * If the current transition is a redirect, this method returns the transition that was redirected.\n   *\n   * #### Example:\n   * ```js\n   * let transitionA = $state.go('A').transition\n   * transitionA.onStart({}, () => $state.target('B'));\n   * $transitions.onSuccess({ to: 'B' }, (trans) => {\n   *   trans.to().name === 'B'; // true\n   *   trans.redirectedFrom() === transitionA; // true\n   * });\n   * ```\n   *\n   * @returns The previous Transition, or null if this Transition is not the result of a redirection\n   */\n  redirectedFrom(): Transition {\n    return this._options.redirectedFrom || null;\n  }\n\n  /**\n   * Gets the original transition in a redirect chain\n   *\n   * A transition might belong to a long chain of multiple redirects.\n   * This method walks the [[redirectedFrom]] chain back to the original (first) transition in the chain.\n   *\n   * #### Example:\n   * ```js\n   * // states\n   * registry.register({ name: 'A', redirectTo: 'B' });\n   * registry.register({ name: 'B', redirectTo: 'C' });\n   * registry.register({ name: 'C', redirectTo: 'D' });\n   * registry.register({ name: 'D' });\n   *\n   * let transitionA = $state.go('A').transition\n   *\n   * $transitions.onSuccess({ to: 'D' }, (trans) => {\n   *   trans.to().name === 'D'; // true\n   *   trans.redirectedFrom().to().name === 'C'; // true\n   *   trans.originalTransition() === transitionA; // true\n   *   trans.originalTransition().to().name === 'A'; // true\n   * });\n   * ```\n   *\n   * @returns The original Transition that started a redirect chain\n   */\n  originalTransition(): Transition {\n    const rf = this.redirectedFrom();\n    return (rf && rf.originalTransition()) || this;\n  }\n\n  /**\n   * Get the transition options\n   *\n   * @returns the options for this Transition.\n   */\n  options(): TransitionOptions {\n    return this._options;\n  }\n\n  /**\n   * Gets the states being entered.\n   *\n   * @returns an array of states that will be entered during this transition.\n   */\n  entering(): StateDeclaration[] {\n    return map(this._treeChanges.entering, prop('state')).map(stateSelf);\n  }\n\n  /**\n   * Gets the states being exited.\n   *\n   * @returns an array of states that will be exited during this transition.\n   */\n  exiting(): StateDeclaration[] {\n    return map(this._treeChanges.exiting, prop('state'))\n      .map(stateSelf)\n      .reverse();\n  }\n\n  /**\n   * Gets the states being retained.\n   *\n   * @returns an array of states that are already entered from a previous Transition, that will not be\n   *    exited during this Transition\n   */\n  retained(): StateDeclaration[] {\n    return map(this._treeChanges.retained, prop('state')).map(stateSelf);\n  }\n\n  /**\n   * Get the [[ViewConfig]]s associated with this Transition\n   *\n   * Each state can define one or more views (template/controller), which are encapsulated as `ViewConfig` objects.\n   * This method fetches the `ViewConfigs` for a given path in the Transition (e.g., \"to\" or \"entering\").\n   *\n   * @param pathname the name of the path to fetch views for:\n   *   (`'to'`, `'from'`, `'entering'`, `'exiting'`, `'retained'`)\n   * @param state If provided, only returns the `ViewConfig`s for a single state in the path\n   *\n   * @returns a list of ViewConfig objects for the given path.\n   */\n  views(pathname = 'entering', state?: StateObject): ViewConfig[] {\n    let path = this._treeChanges[pathname];\n    path = !state ? path : path.filter(propEq('state', state));\n    return path\n      .map(prop('views'))\n      .filter(identity)\n      .reduce(unnestR, []);\n  }\n\n  /**\n   * Return the transition's tree changes\n   *\n   * A transition goes from one state/parameters to another state/parameters.\n   * During a transition, states are entered and/or exited.\n   *\n   * This function returns various branches (paths) which represent the changes to the\n   * active state tree that are caused by the transition.\n   *\n   * @param pathname The name of the tree changes path to get:\n   *   (`'to'`, `'from'`, `'entering'`, `'exiting'`, `'retained'`)\n   */\n  treeChanges(pathname: string): PathNode[];\n  treeChanges(): TreeChanges;\n  treeChanges(pathname?: string) {\n    return pathname ? this._treeChanges[pathname] : this._treeChanges;\n  }\n\n  /**\n   * Creates a new transition that is a redirection of the current one.\n   *\n   * This transition can be returned from a [[TransitionService]] hook to\n   * redirect a transition to a new state and/or set of parameters.\n   *\n   * @internalapi\n   *\n   * @returns Returns a new [[Transition]] instance.\n   */\n  redirect(targetState: TargetState): Transition {\n    let redirects = 1,\n      trans: Transition = this;\n    // tslint:disable-next-line:no-conditional-assignment\n    while ((trans = trans.redirectedFrom()) != null) {\n      if (++redirects > 20) throw new Error(`Too many consecutive Transition redirects (20+)`);\n    }\n\n    const redirectOpts: TransitionOptions = { redirectedFrom: this, source: 'redirect' };\n    // If the original transition was caused by URL sync, then use { location: 'replace' }\n    // on the new transition (unless the target state explicitly specifies location: false).\n    // This causes the original url to be replaced with the url for the redirect target\n    // so the original url disappears from the browser history.\n    if (this.options().source === 'url' && targetState.options().location !== false) {\n      redirectOpts.location = 'replace';\n    }\n\n    const newOptions = extend({}, this.options(), targetState.options(), redirectOpts);\n    targetState = targetState.withOptions(newOptions, true);\n\n    const newTransition = this.router.transitionService.create(this._treeChanges.from, targetState);\n    const originalEnteringNodes = this._treeChanges.entering;\n    const redirectEnteringNodes = newTransition._treeChanges.entering;\n\n    // --- Re-use resolve data from original transition ---\n    // When redirecting from a parent state to a child state where the parent parameter values haven't changed\n    // (because of the redirect), the resolves fetched by the original transition are still valid in the\n    // redirected transition.\n    //\n    // This allows you to define a redirect on a parent state which depends on an async resolve value.\n    // You can wait for the resolve, then redirect to a child state based on the result.\n    // The redirected transition does not have to re-fetch the resolve.\n    // ---------------------------------------------------------\n\n    const nodeIsReloading = (reloadState: StateObject) => (node: PathNode) => {\n      return reloadState && node.state.includes[reloadState.name];\n    };\n\n    // Find any \"entering\" nodes in the redirect path that match the original path and aren't being reloaded\n    const matchingEnteringNodes: PathNode[] = PathUtils.matching(\n      redirectEnteringNodes,\n      originalEnteringNodes,\n      PathUtils.nonDynamicParams\n    ).filter(not(nodeIsReloading(targetState.options().reloadState)));\n\n    // Use the existing (possibly pre-resolved) resolvables for the matching entering nodes.\n    matchingEnteringNodes.forEach((node, idx) => {\n      node.resolvables = originalEnteringNodes[idx].resolvables;\n    });\n\n    return newTransition;\n  }\n\n  /** @hidden If a transition doesn't exit/enter any states, returns any [[Param]] whose value changed */\n  private _changedParams(): Param[] {\n    const tc = this._treeChanges;\n\n    /** Return undefined if it's not a \"dynamic\" transition, for the following reasons */\n    // If user explicitly wants a reload\n    if (this._options.reload) return undefined;\n    // If any states are exiting or entering\n    if (tc.exiting.length || tc.entering.length) return undefined;\n    // If to/from path lengths differ\n    if (tc.to.length !== tc.from.length) return undefined;\n    // If the to/from paths are different\n    const pathsDiffer: boolean = arrayTuples(tc.to, tc.from)\n      .map(tuple => tuple[0].state !== tuple[1].state)\n      .reduce(anyTrueR, false);\n    if (pathsDiffer) return undefined;\n\n    // Find any parameter values that differ\n    const nodeSchemas: Param[][] = tc.to.map((node: PathNode) => node.paramSchema);\n    const [toValues, fromValues] = [tc.to, tc.from].map(path => path.map(x => x.paramValues));\n    const tuples = arrayTuples(nodeSchemas, toValues, fromValues);\n\n    return tuples.map(([schema, toVals, fromVals]) => Param.changed(schema, toVals, fromVals)).reduce(unnestR, []);\n  }\n\n  /**\n   * Returns true if the transition is dynamic.\n   *\n   * A transition is dynamic if no states are entered nor exited, but at least one dynamic parameter has changed.\n   *\n   * @returns true if the Transition is dynamic\n   */\n  dynamic(): boolean {\n    const changes = this._changedParams();\n    return !changes ? false : changes.map(x => x.dynamic).reduce(anyTrueR, false);\n  }\n\n  /**\n   * Returns true if the transition is ignored.\n   *\n   * A transition is ignored if no states are entered nor exited, and no parameter values have changed.\n   *\n   * @returns true if the Transition is ignored.\n   */\n  ignored(): boolean {\n    return !!this._ignoredReason();\n  }\n\n  /** @hidden */\n  _ignoredReason(): 'SameAsCurrent' | 'SameAsPending' | undefined {\n    const pending = this.router.globals.transition;\n    const reloadState = this._options.reloadState;\n\n    const same = (pathA, pathB) => {\n      if (pathA.length !== pathB.length) return false;\n      const matching = PathUtils.matching(pathA, pathB);\n      return pathA.length === matching.filter(node => !reloadState || !node.state.includes[reloadState.name]).length;\n    };\n\n    const newTC = this.treeChanges();\n    const pendTC = pending && pending.treeChanges();\n\n    if (pendTC && same(pendTC.to, newTC.to) && same(pendTC.exiting, newTC.exiting)) return 'SameAsPending';\n    if (newTC.exiting.length === 0 && newTC.entering.length === 0 && same(newTC.from, newTC.to)) return 'SameAsCurrent';\n  }\n\n  /**\n   * Runs the transition\n   *\n   * This method is generally called from the [[StateService.transitionTo]]\n   *\n   * @internalapi\n   *\n   * @returns a promise for a successful transition.\n   */\n  run(): Promise<any> {\n    const runAllHooks = TransitionHook.runAllHooks;\n\n    // Gets transition hooks array for the given phase\n    const getHooksFor = (phase: TransitionHookPhase) => this._hookBuilder.buildHooksForPhase(phase);\n\n    // When the chain is complete, then resolve or reject the deferred\n    const transitionSuccess = () => {\n      trace.traceSuccess(this.$to(), this);\n      this.success = true;\n      this._deferred.resolve(this.to());\n      runAllHooks(getHooksFor(TransitionHookPhase.SUCCESS));\n    };\n\n    const transitionError = (reason: Rejection) => {\n      trace.traceError(reason, this);\n      this.success = false;\n      this._deferred.reject(reason);\n      this._error = reason;\n      runAllHooks(getHooksFor(TransitionHookPhase.ERROR));\n    };\n\n    const runTransition = () => {\n      // Wait to build the RUN hook chain until the BEFORE hooks are done\n      // This allows a BEFORE hook to dynamically add additional RUN hooks via the Transition object.\n      const allRunHooks = getHooksFor(TransitionHookPhase.RUN);\n      const done = () => services.$q.when(undefined);\n      return TransitionHook.invokeHooks(allRunHooks, done);\n    };\n\n    const startTransition = () => {\n      const globals = this.router.globals;\n\n      globals.lastStartedTransitionId = this.$id;\n      globals.transition = this;\n      globals.transitionHistory.enqueue(this);\n\n      trace.traceTransitionStart(this);\n\n      return services.$q.when(undefined);\n    };\n\n    const allBeforeHooks = getHooksFor(TransitionHookPhase.BEFORE);\n    TransitionHook.invokeHooks(allBeforeHooks, startTransition)\n      .then(runTransition)\n      .then(transitionSuccess, transitionError);\n\n    return this.promise;\n  }\n\n  /** Checks if this transition is currently active/running. */\n  isActive = () => this.router.globals.transition === this;\n\n  /**\n   * Checks if the Transition is valid\n   *\n   * @returns true if the Transition is valid\n   */\n  valid() {\n    return !this.error() || this.success !== undefined;\n  }\n\n  /**\n   * Aborts this transition\n   *\n   * Imperative API to abort a Transition.\n   * This only applies to Transitions that are not yet complete.\n   */\n  abort() {\n    // Do not set flag if the transition is already complete\n    if (isUndefined(this.success)) {\n      this._aborted = true;\n    }\n  }\n\n  /**\n   * The Transition error reason.\n   *\n   * If the transition is invalid (and could not be run), returns the reason the transition is invalid.\n   * If the transition was valid and ran, but was not successful, returns the reason the transition failed.\n   *\n   * @returns a transition rejection explaining why the transition is invalid, or the reason the transition failed.\n   */\n  error(): Rejection {\n    const state: StateObject = this.$to();\n\n    if (state.self.abstract) {\n      return Rejection.invalid(`Cannot transition to abstract state '${state.name}'`);\n    }\n\n    const paramDefs = state.parameters();\n    const values = this.params();\n    const invalidParams = paramDefs.filter(param => !param.validates(values[param.id]));\n\n    if (invalidParams.length) {\n      const invalidValues = invalidParams.map(param => `[${param.id}:${stringify(values[param.id])}]`).join(', ');\n      const detail = `The following parameter values are not valid for state '${state.name}': ${invalidValues}`;\n      return Rejection.invalid(detail);\n    }\n\n    if (this.success === false) return this._error;\n  }\n\n  /**\n   * A string representation of the Transition\n   *\n   * @returns A string representation of the Transition\n   */\n  toString() {\n    const fromStateOrName = this.from();\n    const toStateOrName = this.to();\n\n    const avoidEmptyHash = (params: RawParams) =>\n      params['#'] !== null && params['#'] !== undefined ? params : omit(params, ['#']);\n\n    // (X) means the to state is invalid.\n    const id = this.$id,\n      from = isObject(fromStateOrName) ? fromStateOrName.name : fromStateOrName,\n      fromParams = stringify(avoidEmptyHash(this._treeChanges.from.map(prop('paramValues')).reduce(mergeR, {}))),\n      toValid = this.valid() ? '' : '(X) ',\n      to = isObject(toStateOrName) ? toStateOrName.name : toStateOrName,\n      toParams = stringify(avoidEmptyHash(this.params()));\n\n    return `Transition#${id}( '${from}'${fromParams} -> ${toValid}'${to}'${toParams} )`;\n  }\n}\n","/**\n * @coreapi\n * @module url\n */\n/** for typedoc */\nimport { map, inherit, identity, unnest, tail, find, Obj, allTrueR, unnestR, arrayTuples } from '../common/common';\nimport { prop, propEq } from '../common/hof';\nimport { isArray, isString, isDefined } from '../common/predicates';\nimport { Param, DefType } from '../params/param';\nimport { ParamTypes } from '../params/paramTypes';\nimport { RawParams } from '../params/interface';\nimport { UrlMatcherCompileConfig } from './interface';\nimport { joinNeighborsR, splitOnDelim } from '../common/strings';\nimport { ParamType } from '../params';\nimport { defaults } from '../common';\nimport { ParamFactory } from './urlMatcherFactory';\n\n/** @hidden */\nfunction quoteRegExp(str: any, param?: any) {\n  let surroundPattern = ['', ''],\n    result = str.replace(/[\\\\\\[\\]\\^$*+?.()|{}]/g, '\\\\$&');\n  if (!param) return result;\n\n  switch (param.squash) {\n    case false:\n      surroundPattern = ['(', ')' + (param.isOptional ? '?' : '')];\n      break;\n    case true:\n      result = result.replace(/\\/$/, '');\n      surroundPattern = ['(?:/(', ')|/)?'];\n      break;\n    default:\n      surroundPattern = [`(${param.squash}|`, ')?'];\n      break;\n  }\n  return result + surroundPattern[0] + param.type.pattern.source + surroundPattern[1];\n}\n\n/** @hidden */\nconst memoizeTo = (obj: Obj, _prop: string, fn: Function) => (obj[_prop] = obj[_prop] || fn());\n\n/** @hidden */\nconst splitOnSlash = splitOnDelim('/');\n\n/** @hidden */\ninterface UrlMatcherCache {\n  segments?: any[];\n  weights?: number[];\n  path?: UrlMatcher[];\n  parent?: UrlMatcher;\n  pattern?: RegExp;\n}\n\n/** @hidden */\ninterface MatchDetails {\n  id: string;\n  regexp: string;\n  segment: string;\n  type: ParamType;\n}\n\nconst defaultConfig: UrlMatcherCompileConfig = {\n  state: { params: {} },\n  strict: true,\n  caseInsensitive: true,\n};\n\n/**\n * Matches URLs against patterns.\n *\n * Matches URLs against patterns and extracts named parameters from the path or the search\n * part of the URL.\n *\n * A URL pattern consists of a path pattern, optionally followed by '?' and a list of search (query)\n * parameters. Multiple search parameter names are separated by '&'. Search parameters\n * do not influence whether or not a URL is matched, but their values are passed through into\n * the matched parameters returned by [[UrlMatcher.exec]].\n *\n * - *Path parameters* are defined using curly brace placeholders (`/somepath/{param}`)\n * or colon placeholders (`/somePath/:param`).\n *\n * - *A parameter RegExp* may be defined for a param after a colon\n * (`/somePath/{param:[a-zA-Z0-9]+}`) in a curly brace placeholder.\n * The regexp must match for the url to be matched.\n * Should the regexp itself contain curly braces, they must be in matched pairs or escaped with a backslash.\n *\n * Note: a RegExp parameter will encode its value using either [[ParamTypes.path]] or [[ParamTypes.query]].\n *\n * - *Custom parameter types* may also be specified after a colon (`/somePath/{param:int}`) in curly brace parameters.\n *   See [[UrlMatcherFactory.type]] for more information.\n *\n * - *Catch-all parameters* are defined using an asterisk placeholder (`/somepath/*catchallparam`).\n *   A catch-all * parameter value will contain the remainder of the URL.\n *\n * ---\n *\n * Parameter names may contain only word characters (latin letters, digits, and underscore) and\n * must be unique within the pattern (across both path and search parameters).\n * A path parameter matches any number of characters other than '/'. For catch-all\n * placeholders the path parameter matches any number of characters.\n *\n * Examples:\n *\n * * `'/hello/'` - Matches only if the path is exactly '/hello/'. There is no special treatment for\n *   trailing slashes, and patterns have to match the entire path, not just a prefix.\n * * `'/user/:id'` - Matches '/user/bob' or '/user/1234!!!' or even '/user/' but not '/user' or\n *   '/user/bob/details'. The second path segment will be captured as the parameter 'id'.\n * * `'/user/{id}'` - Same as the previous example, but using curly brace syntax.\n * * `'/user/{id:[^/]*}'` - Same as the previous example.\n * * `'/user/{id:[0-9a-fA-F]{1,8}}'` - Similar to the previous example, but only matches if the id\n *   parameter consists of 1 to 8 hex digits.\n * * `'/files/{path:.*}'` - Matches any URL starting with '/files/' and captures the rest of the\n *   path into the parameter 'path'.\n * * `'/files/*path'` - ditto.\n * * `'/calendar/{start:date}'` - Matches \"/calendar/2014-11-12\" (because the pattern defined\n *   in the built-in  `date` ParamType matches `2014-11-12`) and provides a Date object in $stateParams.start\n *\n */\nexport class UrlMatcher {\n  /** @hidden */\n  static nameValidator: RegExp = /^\\w+([-.]+\\w+)*(?:\\[\\])?$/;\n\n  /** @hidden */\n  private _cache: UrlMatcherCache = { path: [this] };\n  /** @hidden */\n  private _children: UrlMatcher[] = [];\n  /** @hidden */\n  private _params: Param[] = [];\n  /** @hidden */\n  private _segments: string[] = [];\n  /** @hidden */\n  private _compiled: string[] = [];\n  /** @hidden */\n  private readonly config: UrlMatcherCompileConfig;\n\n  /** The pattern that was passed into the constructor */\n  public pattern: string;\n\n  /** @hidden */\n  static encodeDashes(str: string) {\n    // Replace dashes with encoded \"\\-\"\n    return encodeURIComponent(str).replace(\n      /-/g,\n      c =>\n        `%5C%${c\n          .charCodeAt(0)\n          .toString(16)\n          .toUpperCase()}`\n    );\n  }\n\n  /** @hidden Given a matcher, return an array with the matcher's path segments and path params, in order */\n  static pathSegmentsAndParams(matcher: UrlMatcher) {\n    const staticSegments = matcher._segments;\n    const pathParams = matcher._params.filter(p => p.location === DefType.PATH);\n    return arrayTuples(staticSegments, pathParams.concat(undefined))\n      .reduce(unnestR, [])\n      .filter(x => x !== '' && isDefined(x));\n  }\n\n  /** @hidden Given a matcher, return an array with the matcher's query params */\n  static queryParams(matcher: UrlMatcher): Param[] {\n    return matcher._params.filter(p => p.location === DefType.SEARCH);\n  }\n\n  /**\n   * Compare two UrlMatchers\n   *\n   * This comparison function converts a UrlMatcher into static and dynamic path segments.\n   * Each static path segment is a static string between a path separator (slash character).\n   * Each dynamic segment is a path parameter.\n   *\n   * The comparison function sorts static segments before dynamic ones.\n   */\n  static compare(a: UrlMatcher, b: UrlMatcher): number {\n    /**\n     * Turn a UrlMatcher and all its parent matchers into an array\n     * of slash literals '/', string literals, and Param objects\n     *\n     * This example matcher matches strings like \"/foo/:param/tail\":\n     * var matcher = $umf.compile(\"/foo\").append($umf.compile(\"/:param\")).append($umf.compile(\"/\")).append($umf.compile(\"tail\"));\n     * var result = segments(matcher); // [ '/', 'foo', '/', Param, '/', 'tail' ]\n     *\n     * Caches the result as `matcher._cache.segments`\n     */\n    const segments = (matcher: UrlMatcher) =>\n      (matcher._cache.segments =\n        matcher._cache.segments ||\n        matcher._cache.path\n          .map(UrlMatcher.pathSegmentsAndParams)\n          .reduce(unnestR, [])\n          .reduce(joinNeighborsR, [])\n          .map(x => (isString(x) ? splitOnSlash(x) : x))\n          .reduce(unnestR, []));\n\n    /**\n     * Gets the sort weight for each segment of a UrlMatcher\n     *\n     * Caches the result as `matcher._cache.weights`\n     */\n    const weights = (matcher: UrlMatcher) =>\n      (matcher._cache.weights =\n        matcher._cache.weights ||\n        segments(matcher).map(segment => {\n          // Sort slashes first, then static strings, the Params\n          if (segment === '/') return 1;\n          if (isString(segment)) return 2;\n          if (segment instanceof Param) return 3;\n        }));\n\n    /**\n     * Pads shorter array in-place (mutates)\n     */\n    const padArrays = (l: any[], r: any[], padVal: any) => {\n      const len = Math.max(l.length, r.length);\n      while (l.length < len) l.push(padVal);\n      while (r.length < len) r.push(padVal);\n    };\n\n    const weightsA = weights(a),\n      weightsB = weights(b);\n    padArrays(weightsA, weightsB, 0);\n\n    const _pairs = arrayTuples(weightsA, weightsB);\n    let cmp, i;\n\n    for (i = 0; i < _pairs.length; i++) {\n      cmp = _pairs[i][0] - _pairs[i][1];\n      if (cmp !== 0) return cmp;\n    }\n\n    return 0;\n  }\n\n  /**\n   * @param pattern The pattern to compile into a matcher.\n   * @param paramTypes The [[ParamTypes]] registry\n   * @param paramFactory A [[ParamFactory]] object\n   * @param config  A [[UrlMatcherCompileConfig]] configuration object\n   */\n  constructor(pattern: string, paramTypes: ParamTypes, paramFactory: ParamFactory, config?: UrlMatcherCompileConfig) {\n    this.config = config = defaults(config, defaultConfig);\n    this.pattern = pattern;\n\n    // Find all placeholders and create a compiled pattern, using either classic or curly syntax:\n    //   '*' name\n    //   ':' name\n    //   '{' name '}'\n    //   '{' name ':' regexp '}'\n    // The regular expression is somewhat complicated due to the need to allow curly braces\n    // inside the regular expression. The placeholder regexp breaks down as follows:\n    //    ([:*])([\\w\\[\\]]+)              - classic placeholder ($1 / $2) (search version has - for snake-case)\n    //    \\{([\\w\\[\\]]+)(?:\\:\\s*( ... ))?\\}  - curly brace placeholder ($3) with optional regexp/type ... ($4) (search version has - for snake-case\n    //    (?: ... | ... | ... )+         - the regexp consists of any number of atoms, an atom being either\n    //    [^{}\\\\]+                       - anything other than curly braces or backslash\n    //    \\\\.                            - a backslash escape\n    //    \\{(?:[^{}\\\\]+|\\\\.)*\\}          - a matched set of curly braces containing other atoms\n    const placeholder = /([:*])([\\w\\[\\]]+)|\\{([\\w\\[\\]]+)(?:\\:\\s*((?:[^{}\\\\]+|\\\\.|\\{(?:[^{}\\\\]+|\\\\.)*\\})+))?\\}/g;\n    const searchPlaceholder = /([:]?)([\\w\\[\\].-]+)|\\{([\\w\\[\\].-]+)(?:\\:\\s*((?:[^{}\\\\]+|\\\\.|\\{(?:[^{}\\\\]+|\\\\.)*\\})+))?\\}/g;\n    const patterns: any[][] = [];\n    let last = 0;\n    let matchArray: RegExpExecArray;\n\n    const checkParamErrors = (id: string) => {\n      if (!UrlMatcher.nameValidator.test(id)) throw new Error(`Invalid parameter name '${id}' in pattern '${pattern}'`);\n      if (find(this._params, propEq('id', id)))\n        throw new Error(`Duplicate parameter name '${id}' in pattern '${pattern}'`);\n    };\n\n    // Split into static segments separated by path parameter placeholders.\n    // The number of segments is always 1 more than the number of parameters.\n    const matchDetails = (m: RegExpExecArray, isSearch: boolean): MatchDetails => {\n      // IE[78] returns '' for unmatched groups instead of null\n      const id: string = m[2] || m[3];\n      const regexp: string = isSearch ? m[4] : m[4] || (m[1] === '*' ? '[\\\\s\\\\S]*' : null);\n\n      const makeRegexpType = str =>\n        inherit(paramTypes.type(isSearch ? 'query' : 'path'), {\n          pattern: new RegExp(str, this.config.caseInsensitive ? 'i' : undefined),\n        });\n\n      return {\n        id,\n        regexp,\n        segment: pattern.substring(last, m.index),\n        type: !regexp ? null : paramTypes.type(regexp) || makeRegexpType(regexp),\n      };\n    };\n\n    let details: MatchDetails;\n    let segment: string;\n\n    // tslint:disable-next-line:no-conditional-assignment\n    while ((matchArray = placeholder.exec(pattern))) {\n      details = matchDetails(matchArray, false);\n      if (details.segment.indexOf('?') >= 0) break; // we're into the search part\n\n      checkParamErrors(details.id);\n      this._params.push(paramFactory.fromPath(details.id, details.type, config.state));\n      this._segments.push(details.segment);\n      patterns.push([details.segment, tail(this._params)]);\n      last = placeholder.lastIndex;\n    }\n    segment = pattern.substring(last);\n\n    // Find any search parameter names and remove them from the last segment\n    const i = segment.indexOf('?');\n\n    if (i >= 0) {\n      const search = segment.substring(i);\n      segment = segment.substring(0, i);\n\n      if (search.length > 0) {\n        last = 0;\n\n        // tslint:disable-next-line:no-conditional-assignment\n        while ((matchArray = searchPlaceholder.exec(search))) {\n          details = matchDetails(matchArray, true);\n          checkParamErrors(details.id);\n          this._params.push(paramFactory.fromSearch(details.id, details.type, config.state));\n          last = placeholder.lastIndex;\n          // check if ?&\n        }\n      }\n    }\n\n    this._segments.push(segment);\n    this._compiled = patterns.map(_pattern => quoteRegExp.apply(null, _pattern)).concat(quoteRegExp(segment));\n  }\n\n  /**\n   * Creates a new concatenated UrlMatcher\n   *\n   * Builds a new UrlMatcher by appending another UrlMatcher to this one.\n   *\n   * @param url A `UrlMatcher` instance to append as a child of the current `UrlMatcher`.\n   */\n  append(url: UrlMatcher): UrlMatcher {\n    this._children.push(url);\n    url._cache = {\n      path: this._cache.path.concat(url),\n      parent: this,\n      pattern: null,\n    };\n    return url;\n  }\n\n  /** @hidden */\n  isRoot(): boolean {\n    return this._cache.path[0] === this;\n  }\n\n  /** Returns the input pattern string */\n  toString(): string {\n    return this.pattern;\n  }\n\n  /**\n   * Tests the specified url/path against this matcher.\n   *\n   * Tests if the given url matches this matcher's pattern, and returns an object containing the captured\n   * parameter values.  Returns null if the path does not match.\n   *\n   * The returned object contains the values\n   * of any search parameters that are mentioned in the pattern, but their value may be null if\n   * they are not present in `search`. This means that search parameters are always treated\n   * as optional.\n   *\n   * #### Example:\n   * ```js\n   * new UrlMatcher('/user/{id}?q&r').exec('/user/bob', {\n   *   x: '1', q: 'hello'\n   * });\n   * // returns { id: 'bob', q: 'hello', r: null }\n   * ```\n   *\n   * @param path    The URL path to match, e.g. `$location.path()`.\n   * @param search  URL search parameters, e.g. `$location.search()`.\n   * @param hash    URL hash e.g. `$location.hash()`.\n   * @param options\n   *\n   * @returns The captured parameter values.\n   */\n  exec(path: string, search: any = {}, hash?: string, options: any = {}): RawParams {\n    const match = memoizeTo(this._cache, 'pattern', () => {\n      return new RegExp(\n        [\n          '^',\n          unnest(this._cache.path.map(prop('_compiled'))).join(''),\n          this.config.strict === false ? '/?' : '',\n          '$',\n        ].join(''),\n        this.config.caseInsensitive ? 'i' : undefined\n      );\n    }).exec(path);\n\n    if (!match) return null;\n\n    // options = defaults(options, { isolate: false });\n\n    const allParams: Param[] = this.parameters(),\n      pathParams: Param[] = allParams.filter(param => !param.isSearch()),\n      searchParams: Param[] = allParams.filter(param => param.isSearch()),\n      nPathSegments = this._cache.path.map(urlm => urlm._segments.length - 1).reduce((a, x) => a + x),\n      values: RawParams = {};\n\n    if (nPathSegments !== match.length - 1) throw new Error(`Unbalanced capture group in route '${this.pattern}'`);\n\n    function decodePathArray(paramVal: string) {\n      const reverseString = (str: string) =>\n        str\n          .split('')\n          .reverse()\n          .join('');\n      const unquoteDashes = (str: string) => str.replace(/\\\\-/g, '-');\n\n      const split = reverseString(paramVal).split(/-(?!\\\\)/);\n      const allReversed = map(split, reverseString);\n      return map(allReversed, unquoteDashes).reverse();\n    }\n\n    for (let i = 0; i < nPathSegments; i++) {\n      const param: Param = pathParams[i];\n      let value: any | any[] = match[i + 1];\n\n      // if the param value matches a pre-replace pair, replace the value before decoding.\n      for (let j = 0; j < param.replace.length; j++) {\n        if (param.replace[j].from === value) value = param.replace[j].to;\n      }\n      if (value && param.array === true) value = decodePathArray(value);\n      if (isDefined(value)) value = param.type.decode(value);\n      values[param.id] = param.value(value);\n    }\n    searchParams.forEach(param => {\n      let value = search[param.id];\n      for (let j = 0; j < param.replace.length; j++) {\n        if (param.replace[j].from === value) value = param.replace[j].to;\n      }\n      if (isDefined(value)) value = param.type.decode(value);\n      values[param.id] = param.value(value);\n    });\n\n    if (hash) values['#'] = hash;\n\n    return values;\n  }\n\n  /**\n   * @hidden\n   * Returns all the [[Param]] objects of all path and search parameters of this pattern in order of appearance.\n   *\n   * @returns {Array.<Param>}  An array of [[Param]] objects. Must be treated as read-only. If the\n   *    pattern has no parameters, an empty array is returned.\n   */\n  parameters(opts: any = {}): Param[] {\n    if (opts.inherit === false) return this._params;\n    return unnest(this._cache.path.map(matcher => matcher._params));\n  }\n\n  /**\n   * @hidden\n   * Returns a single parameter from this UrlMatcher by id\n   *\n   * @param id\n   * @param opts\n   * @returns {T|Param|any|boolean|UrlMatcher|null}\n   */\n  parameter(id: string, opts: any = {}): Param {\n    const findParam = () => {\n      for (const param of this._params) {\n        if (param.id === id) return param;\n      }\n    };\n\n    const parent = this._cache.parent;\n    return findParam() || (opts.inherit !== false && parent && parent.parameter(id, opts)) || null;\n  }\n\n  /**\n   * Validates the input parameter values against this UrlMatcher\n   *\n   * Checks an object hash of parameters to validate their correctness according to the parameter\n   * types of this `UrlMatcher`.\n   *\n   * @param params The object hash of parameters to validate.\n   * @returns Returns `true` if `params` validates, otherwise `false`.\n   */\n  validates(params: RawParams): boolean {\n    const validParamVal = (param: Param, val: any) => !param || param.validates(val);\n\n    params = params || {};\n\n    // I'm not sure why this checks only the param keys passed in, and not all the params known to the matcher\n    const paramSchema = this.parameters().filter(paramDef => params.hasOwnProperty(paramDef.id));\n    return paramSchema.map(paramDef => validParamVal(paramDef, params[paramDef.id])).reduce(allTrueR, true);\n  }\n\n  /**\n   * Given a set of parameter values, creates a URL from this UrlMatcher.\n   *\n   * Creates a URL that matches this pattern by substituting the specified values\n   * for the path and search parameters.\n   *\n   * #### Example:\n   * ```js\n   * new UrlMatcher('/user/{id}?q').format({ id:'bob', q:'yes' });\n   * // returns '/user/bob?q=yes'\n   * ```\n   *\n   * @param values  the values to substitute for the parameters in this pattern.\n   * @returns the formatted URL (path and optionally search part).\n   */\n  format(values: RawParams = {}) {\n    // Build the full path of UrlMatchers (including all parent UrlMatchers)\n    const urlMatchers = this._cache.path;\n\n    // Extract all the static segments and Params (processed as ParamDetails)\n    // into an ordered array\n    const pathSegmentsAndParams: Array<string | ParamDetails> = urlMatchers\n      .map(UrlMatcher.pathSegmentsAndParams)\n      .reduce(unnestR, [])\n      .map(x => (isString(x) ? x : getDetails(x)));\n\n    // Extract the query params into a separate array\n    const queryParams: Array<ParamDetails> = urlMatchers\n      .map(UrlMatcher.queryParams)\n      .reduce(unnestR, [])\n      .map(getDetails);\n\n    const isInvalid = (param: ParamDetails) => param.isValid === false;\n    if (pathSegmentsAndParams.concat(queryParams).filter(isInvalid).length) {\n      return null;\n    }\n\n    /**\n     * Given a Param, applies the parameter value, then returns detailed information about it\n     */\n    function getDetails(param: Param): ParamDetails {\n      // Normalize to typed value\n      const value = param.value(values[param.id]);\n      const isValid = param.validates(value);\n      const isDefaultValue = param.isDefaultValue(value);\n      // Check if we're in squash mode for the parameter\n      const squash = isDefaultValue ? param.squash : false;\n      // Allow the Parameter's Type to encode the value\n      const encoded = param.type.encode(value);\n\n      return { param, value, isValid, isDefaultValue, squash, encoded };\n    }\n\n    // Build up the path-portion from the list of static segments and parameters\n    const pathString = pathSegmentsAndParams.reduce((acc: string, x: string | ParamDetails) => {\n      // The element is a static segment (a raw string); just append it\n      if (isString(x)) return acc + x;\n\n      // Otherwise, it's a ParamDetails.\n      const { squash, encoded, param } = x;\n\n      // If squash is === true, try to remove a slash from the path\n      if (squash === true) return acc.match(/\\/$/) ? acc.slice(0, -1) : acc;\n      // If squash is a string, use the string for the param value\n      if (isString(squash)) return acc + squash;\n      if (squash !== false) return acc; // ?\n      if (encoded == null) return acc;\n      // If this parameter value is an array, encode the value using encodeDashes\n      if (isArray(encoded)) return acc + map(<string[]>encoded, UrlMatcher.encodeDashes).join('-');\n      // If the parameter type is \"raw\", then do not encodeURIComponent\n      if (param.raw) return acc + encoded;\n      // Encode the value\n      return acc + encodeURIComponent(<string>encoded);\n    }, '');\n\n    // Build the query string by applying parameter values (array or regular)\n    // then mapping to key=value, then flattening and joining using \"&\"\n    const queryString = queryParams\n      .map((paramDetails: ParamDetails) => {\n        let { param, squash, encoded, isDefaultValue } = paramDetails;\n        if (encoded == null || (isDefaultValue && squash !== false)) return;\n        if (!isArray(encoded)) encoded = [<string>encoded];\n        if (encoded.length === 0) return;\n        if (!param.raw) encoded = map(<string[]>encoded, encodeURIComponent);\n\n        return (<string[]>encoded).map(val => `${param.id}=${val}`);\n      })\n      .filter(identity)\n      .reduce(unnestR, [])\n      .join('&');\n\n    // Concat the pathstring with the queryString (if exists) and the hashString (if exists)\n    return pathString + (queryString ? `?${queryString}` : '') + (values['#'] ? '#' + values['#'] : '');\n  }\n}\n\n/** @hidden */\ninterface ParamDetails {\n  param: Param;\n  value: any;\n  isValid: boolean;\n  isDefaultValue: boolean;\n  squash: boolean | string;\n  encoded: string | string[];\n}\n","/**\n * @internalapi\n * @module url\n */ /** for typedoc */\nimport { forEach, extend } from '../common/common';\nimport { isObject, isDefined, isFunction, isString } from '../common/predicates';\nimport { UrlMatcher } from './urlMatcher';\nimport { Param, DefType } from '../params/param';\nimport { ParamTypes } from '../params/paramTypes';\nimport { ParamTypeDefinition } from '../params/interface';\nimport { Disposable } from '../interface';\nimport { ParamType } from '../params/paramType';\nimport { UrlMatcherCompileConfig, UrlMatcherConfig } from './interface';\nimport { StateDeclaration } from '../state';\n\n/** @internalapi */\nexport class ParamFactory {\n  fromConfig(id: string, type: ParamType, state: StateDeclaration) {\n    return new Param(id, type, DefType.CONFIG, this.umf, state);\n  }\n\n  fromPath(id: string, type: ParamType, state: StateDeclaration) {\n    return new Param(id, type, DefType.PATH, this.umf, state);\n  }\n\n  fromSearch(id: string, type: ParamType, state: StateDeclaration) {\n    return new Param(id, type, DefType.SEARCH, this.umf, state);\n  }\n\n  constructor(private umf: UrlMatcherFactory) {}\n}\n\n/**\n * Factory for [[UrlMatcher]] instances.\n *\n * The factory is available to ng1 services as\n * `$urlMatcherFactory` or ng1 providers as `$urlMatcherFactoryProvider`.\n */\nexport class UrlMatcherFactory implements Disposable, UrlMatcherConfig {\n  /** @hidden */ paramTypes = new ParamTypes();\n  /** @hidden */ _isCaseInsensitive = false;\n  /** @hidden */ _isStrictMode = true;\n  /** @hidden */ _defaultSquashPolicy: boolean | string = false;\n\n  /** @internalapi Creates a new [[Param]] for a given location (DefType) */\n  paramFactory = new ParamFactory(this);\n\n  constructor() {\n    extend(this, { UrlMatcher, Param });\n  }\n\n  /** @inheritdoc */\n  caseInsensitive(value?: boolean): boolean {\n    return (this._isCaseInsensitive = isDefined(value) ? value : this._isCaseInsensitive);\n  }\n\n  /** @inheritdoc */\n  strictMode(value?: boolean): boolean {\n    return (this._isStrictMode = isDefined(value) ? value : this._isStrictMode);\n  }\n\n  /** @inheritdoc */\n  defaultSquashPolicy(value?: boolean | string) {\n    if (isDefined(value) && value !== true && value !== false && !isString(value))\n      throw new Error(`Invalid squash policy: ${value}. Valid policies: false, true, arbitrary-string`);\n    return (this._defaultSquashPolicy = isDefined(value) ? value : this._defaultSquashPolicy);\n  }\n\n  /**\n   * Creates a [[UrlMatcher]] for the specified pattern.\n   *\n   * @param pattern  The URL pattern.\n   * @param config  The config object hash.\n   * @returns The UrlMatcher.\n   */\n  compile(pattern: string, config?: UrlMatcherCompileConfig) {\n    // backward-compatible support for config.params -> config.state.params\n    const params = config && !config.state && (config as any).params;\n    config = params ? { state: { params }, ...config } : config;\n    const globalConfig = { strict: this._isStrictMode, caseInsensitive: this._isCaseInsensitive };\n    return new UrlMatcher(pattern, this.paramTypes, this.paramFactory, extend(globalConfig, config));\n  }\n\n  /**\n   * Returns true if the specified object is a [[UrlMatcher]], or false otherwise.\n   *\n   * @param object  The object to perform the type check against.\n   * @returns `true` if the object matches the `UrlMatcher` interface, by\n   *          implementing all the same methods.\n   */\n  isMatcher(object: any): boolean {\n    // TODO: typeof?\n    if (!isObject(object)) return false;\n    let result = true;\n\n    forEach(UrlMatcher.prototype, (val, name) => {\n      if (isFunction(val)) result = result && (isDefined(object[name]) && isFunction(object[name]));\n    });\n    return result;\n  }\n\n  /**\n   * Creates and registers a custom [[ParamType]] object\n   *\n   * A [[ParamType]] can be used to generate URLs with typed parameters.\n   *\n   * @param name  The type name.\n   * @param definition The type definition. See [[ParamTypeDefinition]] for information on the values accepted.\n   * @param definitionFn A function that is injected before the app runtime starts.\n   *        The result of this function should be a [[ParamTypeDefinition]].\n   *        The result is merged into the existing `definition`.\n   *        See [[ParamType]] for information on the values accepted.\n   *\n   * @returns - if a type was registered: the [[UrlMatcherFactory]]\n   *   - if only the `name` parameter was specified: the currently registered [[ParamType]] object, or undefined\n   *\n   * Note: Register custom types *before using them* in a state definition.\n   *\n   * See [[ParamTypeDefinition]] for examples\n   */\n  type(name: string, definition?: ParamTypeDefinition, definitionFn?: () => ParamTypeDefinition) {\n    const type = this.paramTypes.type(name, definition, definitionFn);\n    return !isDefined(definition) ? type : this;\n  }\n\n  /** @hidden */\n  $get() {\n    this.paramTypes.enqueue = false;\n    this.paramTypes._flushTypeQueue();\n    return this;\n  }\n\n  /** @internalapi */\n  dispose() {\n    this.paramTypes.dispose();\n  }\n}\n","/**\n * @coreapi\n * @module url\n */ /** */\nimport { UrlMatcher } from './urlMatcher';\nimport { isString, isDefined, isFunction } from '../common/predicates';\nimport { UIRouter } from '../router';\nimport { identity, extend } from '../common/common';\nimport { is, pattern } from '../common/hof';\nimport { StateObject } from '../state/stateObject';\nimport { RawParams } from '../params/interface';\nimport {\n  UrlRule,\n  UrlRuleMatchFn,\n  UrlRuleHandlerFn,\n  UrlRuleType,\n  UrlParts,\n  MatcherUrlRule,\n  StateRule,\n  RegExpRule,\n} from './interface';\n\n/**\n * Creates a [[UrlRule]]\n *\n * Creates a [[UrlRule]] from a:\n *\n * - `string`\n * - [[UrlMatcher]]\n * - `RegExp`\n * - [[StateObject]]\n * @internalapi\n */\nexport class UrlRuleFactory {\n  static isUrlRule = obj => obj && ['type', 'match', 'handler'].every(key => isDefined(obj[key]));\n\n  constructor(public router: UIRouter) {}\n\n  compile(str: string) {\n    return this.router.urlMatcherFactory.compile(str);\n  }\n\n  create(\n    what: string | UrlMatcher | StateObject | RegExp | UrlRuleMatchFn,\n    handler?: string | UrlRuleHandlerFn\n  ): UrlRule {\n    const isState = StateObject.isState;\n    const makeRule = pattern([\n      [isString, (_what: string) => makeRule(this.compile(_what))],\n      [is(UrlMatcher), (_what: UrlMatcher) => this.fromUrlMatcher(_what, handler)],\n      [isState, (_what: StateObject) => this.fromState(_what, this.router)],\n      [is(RegExp), (_what: RegExp) => this.fromRegExp(_what, handler)],\n      [isFunction, (_what: UrlRuleMatchFn) => new BaseUrlRule(_what, handler as UrlRuleHandlerFn)],\n    ]);\n\n    const rule = makeRule(what);\n    if (!rule) throw new Error(\"invalid 'what' in when()\");\n    return rule;\n  }\n\n  /**\n   * A UrlRule which matches based on a UrlMatcher\n   *\n   * The `handler` may be either a `string`, a [[UrlRuleHandlerFn]] or another [[UrlMatcher]]\n   *\n   * ## Handler as a function\n   *\n   * If `handler` is a function, the function is invoked with:\n   *\n   * - matched parameter values ([[RawParams]] from [[UrlMatcher.exec]])\n   * - url: the current Url ([[UrlParts]])\n   * - router: the router object ([[UIRouter]])\n   *\n   * #### Example:\n   * ```js\n   * var urlMatcher = $umf.compile(\"/foo/:fooId/:barId\");\n   * var rule = factory.fromUrlMatcher(urlMatcher, match => \"/home/\" + match.fooId + \"/\" + match.barId);\n   * var match = rule.match('/foo/123/456'); // results in { fooId: '123', barId: '456' }\n   * var result = rule.handler(match); // '/home/123/456'\n   * ```\n   *\n   * ## Handler as UrlMatcher\n   *\n   * If `handler` is a UrlMatcher, the handler matcher is used to create the new url.\n   * The `handler` UrlMatcher is formatted using the matched param from the first matcher.\n   * The url is replaced with the result.\n   *\n   * #### Example:\n   * ```js\n   * var urlMatcher = $umf.compile(\"/foo/:fooId/:barId\");\n   * var handler = $umf.compile(\"/home/:fooId/:barId\");\n   * var rule = factory.fromUrlMatcher(urlMatcher, handler);\n   * var match = rule.match('/foo/123/456'); // results in { fooId: '123', barId: '456' }\n   * var result = rule.handler(match); // '/home/123/456'\n   * ```\n   */\n  fromUrlMatcher(urlMatcher: UrlMatcher, handler: string | UrlMatcher | UrlRuleHandlerFn): MatcherUrlRule {\n    let _handler: UrlRuleHandlerFn = handler as any;\n    if (isString(handler)) handler = this.router.urlMatcherFactory.compile(handler);\n    if (is(UrlMatcher)(handler)) _handler = (match: RawParams) => (handler as UrlMatcher).format(match);\n\n    function matchUrlParamters(url: UrlParts): RawParams {\n      const params = urlMatcher.exec(url.path, url.search, url.hash);\n      return urlMatcher.validates(params) && params;\n    }\n\n    // Prioritize URLs, lowest to highest:\n    // - Some optional URL parameters, but none matched\n    // - No optional parameters in URL\n    // - Some optional parameters, some matched\n    // - Some optional parameters, all matched\n    function matchPriority(params: RawParams): number {\n      const optional = urlMatcher.parameters().filter(param => param.isOptional);\n      if (!optional.length) return 0.000001;\n      const matched = optional.filter(param => params[param.id]);\n      return matched.length / optional.length;\n    }\n\n    const details = { urlMatcher, matchPriority, type: 'URLMATCHER' };\n    return extend(new BaseUrlRule(matchUrlParamters, _handler), details) as MatcherUrlRule;\n  }\n\n  /**\n   * A UrlRule which matches a state by its url\n   *\n   * #### Example:\n   * ```js\n   * var rule = factory.fromState($state.get('foo'), router);\n   * var match = rule.match('/foo/123/456'); // results in { fooId: '123', barId: '456' }\n   * var result = rule.handler(match);\n   * // Starts a transition to 'foo' with params: { fooId: '123', barId: '456' }\n   * ```\n   */\n  fromState(state: StateObject, router: UIRouter): StateRule {\n    /**\n     * Handles match by transitioning to matched state\n     *\n     * First checks if the router should start a new transition.\n     * A new transition is not required if the current state's URL\n     * and the new URL are already identical\n     */\n    const handler = (match: RawParams) => {\n      const $state = router.stateService;\n      const globals = router.globals;\n      if ($state.href(state, match) !== $state.href(globals.current, globals.params)) {\n        $state.transitionTo(state, match, { inherit: true, source: 'url' });\n      }\n    };\n\n    const details = { state, type: 'STATE' };\n    return extend(this.fromUrlMatcher(state.url, handler), details) as StateRule;\n  }\n\n  /**\n   * A UrlRule which matches based on a regular expression\n   *\n   * The `handler` may be either a [[UrlRuleHandlerFn]] or a string.\n   *\n   * ## Handler as a function\n   *\n   * If `handler` is a function, the function is invoked with:\n   *\n   * - regexp match array (from `regexp`)\n   * - url: the current Url ([[UrlParts]])\n   * - router: the router object ([[UIRouter]])\n   *\n   * #### Example:\n   * ```js\n   * var rule = factory.fromRegExp(/^\\/foo\\/(bar|baz)$/, match => \"/home/\" + match[1])\n   * var match = rule.match('/foo/bar'); // results in [ '/foo/bar', 'bar' ]\n   * var result = rule.handler(match); // '/home/bar'\n   * ```\n   *\n   * ## Handler as string\n   *\n   * If `handler` is a string, the url is *replaced by the string* when the Rule is invoked.\n   * The string is first interpolated using `string.replace()` style pattern.\n   *\n   * #### Example:\n   * ```js\n   * var rule = factory.fromRegExp(/^\\/foo\\/(bar|baz)$/, \"/home/$1\")\n   * var match = rule.match('/foo/bar'); // results in [ '/foo/bar', 'bar' ]\n   * var result = rule.handler(match); // '/home/bar'\n   * ```\n   */\n  fromRegExp(regexp: RegExp, handler: string | UrlRuleHandlerFn): RegExpRule {\n    if (regexp.global || regexp.sticky) throw new Error('Rule RegExp must not be global or sticky');\n\n    /**\n     * If handler is a string, the url will be replaced by the string.\n     * If the string has any String.replace() style variables in it (like `$2`),\n     * they will be replaced by the captures from [[match]]\n     */\n    const redirectUrlTo = (match: RegExpExecArray) =>\n      // Interpolates matched values into $1 $2, etc using a String.replace()-style pattern\n      (handler as string).replace(/\\$(\\$|\\d{1,2})/, (m, what) => match[what === '$' ? 0 : Number(what)]);\n\n    const _handler = isString(handler) ? redirectUrlTo : handler;\n\n    const matchParamsFromRegexp = (url: UrlParts): RegExpExecArray => regexp.exec(url.path);\n\n    const details = { regexp, type: 'REGEXP' };\n    return extend(new BaseUrlRule(matchParamsFromRegexp, _handler), details) as RegExpRule;\n  }\n}\n\n/**\n * A base rule which calls `match`\n *\n * The value from the `match` function is passed through to the `handler`.\n * @internalapi\n */\nexport class BaseUrlRule implements UrlRule {\n  $id: number;\n  priority: number;\n  type: UrlRuleType = 'RAW';\n  handler: UrlRuleHandlerFn;\n  matchPriority = match => 0 - this.$id;\n\n  constructor(public match: UrlRuleMatchFn, handler?: UrlRuleHandlerFn) {\n    this.handler = handler || identity;\n  }\n}\n","/**\n * @internalapi\n * @module url\n */\n/** for typedoc */\nimport { createProxyFunctions, extend, removeFrom } from '../common/common';\nimport { isDefined, isFunction, isString } from '../common/predicates';\nimport { UrlMatcher } from './urlMatcher';\nimport { RawParams } from '../params/interface';\nimport { Disposable } from '../interface';\nimport { UIRouter } from '../router';\nimport { is, pattern, val } from '../common/hof';\nimport { UrlRuleFactory } from './urlRule';\nimport { TargetState } from '../state/targetState';\nimport {\n  MatcherUrlRule,\n  MatchResult,\n  UrlParts,\n  UrlRule,\n  UrlRuleHandlerFn,\n  UrlRuleMatchFn,\n  UrlRulesApi,\n  UrlSyncApi,\n} from './interface';\nimport { TargetStateDef } from '../state/interface';\nimport { stripLastPathElement } from '../common';\n\n/** @hidden */\nfunction appendBasePath(url: string, isHtml5: boolean, absolute: boolean, baseHref: string): string {\n  if (baseHref === '/') return url;\n  if (isHtml5) return stripLastPathElement(baseHref) + url;\n  if (absolute) return baseHref.slice(1) + url;\n  return url;\n}\n\n/** @hidden */\nconst prioritySort = (a: UrlRule, b: UrlRule) => (b.priority || 0) - (a.priority || 0);\n\n/** @hidden */\nconst typeSort = (a: UrlRule, b: UrlRule) => {\n  const weights = { STATE: 4, URLMATCHER: 4, REGEXP: 3, RAW: 2, OTHER: 1 };\n  return (weights[a.type] || 0) - (weights[b.type] || 0);\n};\n\n/** @hidden */\nconst urlMatcherSort = (a: MatcherUrlRule, b: MatcherUrlRule) =>\n  !a.urlMatcher || !b.urlMatcher ? 0 : UrlMatcher.compare(a.urlMatcher, b.urlMatcher);\n\n/** @hidden */\nconst idSort = (a: UrlRule, b: UrlRule) => {\n  // Identically sorted STATE and URLMATCHER best rule will be chosen by `matchPriority` after each rule matches the URL\n  const useMatchPriority = { STATE: true, URLMATCHER: true };\n  const equal = useMatchPriority[a.type] && useMatchPriority[b.type];\n  return equal ? 0 : (a.$id || 0) - (b.$id || 0);\n};\n\n/**\n * Default rule priority sorting function.\n *\n * Sorts rules by:\n *\n * - Explicit priority (set rule priority using [[UrlRulesApi.when]])\n * - Rule type (STATE: 4, URLMATCHER: 4, REGEXP: 3, RAW: 2, OTHER: 1)\n * - `UrlMatcher` specificity ([[UrlMatcher.compare]]): works for STATE and URLMATCHER types to pick the most specific rule.\n * - Rule registration order (for rule types other than STATE and URLMATCHER)\n *   - Equally sorted State and UrlMatcher rules will each match the URL.\n *     Then, the *best* match is chosen based on how many parameter values were matched.\n *\n * @coreapi\n */\nlet defaultRuleSortFn: (a: UrlRule, b: UrlRule) => number;\ndefaultRuleSortFn = (a, b) => {\n  let cmp = prioritySort(a, b);\n  if (cmp !== 0) return cmp;\n\n  cmp = typeSort(a, b);\n  if (cmp !== 0) return cmp;\n\n  cmp = urlMatcherSort(a as MatcherUrlRule, b as MatcherUrlRule);\n  if (cmp !== 0) return cmp;\n\n  return idSort(a, b);\n};\n\n/**\n * Updates URL and responds to URL changes\n *\n * ### Deprecation warning:\n * This class is now considered to be an internal API\n * Use the [[UrlService]] instead.\n * For configuring URL rules, use the [[UrlRulesApi]] which can be found as [[UrlService.rules]].\n *\n * This class updates the URL when the state changes.\n * It also responds to changes in the URL.\n */\nexport class UrlRouter implements UrlRulesApi, UrlSyncApi, Disposable {\n  /** used to create [[UrlRule]] objects for common cases */\n  public urlRuleFactory: UrlRuleFactory;\n\n  /** @hidden */ private _router: UIRouter;\n  /** @hidden */ private location: string;\n  /** @hidden */ private _sortFn = defaultRuleSortFn;\n  /** @hidden */ private _stopFn: Function;\n  /** @hidden */ _rules: UrlRule[] = [];\n  /** @hidden */ private _otherwiseFn: UrlRule;\n  /** @hidden */ interceptDeferred = false;\n  /** @hidden */ private _id = 0;\n  /** @hidden */ private _sorted = false;\n\n  /** @hidden */\n  constructor(router: UIRouter) {\n    this._router = router;\n    this.urlRuleFactory = new UrlRuleFactory(router);\n    createProxyFunctions(val(UrlRouter.prototype), this, val(this));\n  }\n\n  /** @internalapi */\n  dispose() {\n    this.listen(false);\n    this._rules = [];\n    delete this._otherwiseFn;\n  }\n\n  /** @inheritdoc */\n  sort(compareFn?: (a: UrlRule, b: UrlRule) => number) {\n    this._rules = this.stableSort(this._rules, (this._sortFn = compareFn || this._sortFn));\n    this._sorted = true;\n  }\n\n  private ensureSorted() {\n    this._sorted || this.sort();\n  }\n\n  private stableSort(arr, compareFn) {\n    const arrOfWrapper = arr.map((elem, idx) => ({ elem, idx }));\n\n    arrOfWrapper.sort((wrapperA, wrapperB) => {\n      const cmpDiff = compareFn(wrapperA.elem, wrapperB.elem);\n      return cmpDiff === 0 ? wrapperA.idx - wrapperB.idx : cmpDiff;\n    });\n\n    return arrOfWrapper.map(wrapper => wrapper.elem);\n  }\n\n  /**\n   * Given a URL, check all rules and return the best [[MatchResult]]\n   * @param url\n   * @returns {MatchResult}\n   */\n  match(url: UrlParts): MatchResult {\n    this.ensureSorted();\n\n    url = extend({ path: '', search: {}, hash: '' }, url);\n    const rules = this.rules();\n    if (this._otherwiseFn) rules.push(this._otherwiseFn);\n\n    // Checks a single rule. Returns { rule: rule, match: match, weight: weight } if it matched, or undefined\n\n    const checkRule = (rule: UrlRule): MatchResult => {\n      const match = rule.match(url, this._router);\n      return match && { match, rule, weight: rule.matchPriority(match) };\n    };\n\n    // The rules are pre-sorted.\n    // - Find the first matching rule.\n    // - Find any other matching rule that sorted *exactly the same*, according to `.sort()`.\n    // - Choose the rule with the highest match weight.\n    let best: MatchResult;\n    for (let i = 0; i < rules.length; i++) {\n      // Stop when there is a 'best' rule and the next rule sorts differently than it.\n      if (best && this._sortFn(rules[i], best.rule) !== 0) break;\n\n      const current = checkRule(rules[i]);\n      // Pick the best MatchResult\n      best = !best || (current && current.weight > best.weight) ? current : best;\n    }\n\n    return best;\n  }\n\n  /** @inheritdoc */\n  sync(evt?) {\n    if (evt && evt.defaultPrevented) return;\n\n    const router = this._router,\n      $url = router.urlService,\n      $state = router.stateService;\n\n    const url: UrlParts = {\n      path: $url.path(),\n      search: $url.search(),\n      hash: $url.hash(),\n    };\n\n    const best = this.match(url);\n\n    const applyResult = pattern([\n      [isString, (newurl: string) => $url.url(newurl, true)],\n      [TargetState.isDef, (def: TargetStateDef) => $state.go(def.state, def.params, def.options)],\n      [is(TargetState), (target: TargetState) => $state.go(target.state(), target.params(), target.options())],\n    ]);\n\n    applyResult(best && best.rule.handler(best.match, url, router));\n  }\n\n  /** @inheritdoc */\n  listen(enabled?: boolean): Function {\n    if (enabled === false) {\n      this._stopFn && this._stopFn();\n      delete this._stopFn;\n    } else {\n      return (this._stopFn = this._stopFn || this._router.urlService.onChange(evt => this.sync(evt)));\n    }\n  }\n\n  /**\n   * Internal API.\n   * @internalapi\n   */\n  update(read?: boolean) {\n    const $url = this._router.locationService;\n    if (read) {\n      this.location = $url.url();\n      return;\n    }\n    if ($url.url() === this.location) return;\n\n    $url.url(this.location, true);\n  }\n\n  /**\n   * Internal API.\n   *\n   * Pushes a new location to the browser history.\n   *\n   * @internalapi\n   * @param urlMatcher\n   * @param params\n   * @param options\n   */\n  push(urlMatcher: UrlMatcher, params?: RawParams, options?: { replace?: string | boolean }) {\n    const replace = options && !!options.replace;\n    this._router.urlService.url(urlMatcher.format(params || {}), replace);\n  }\n\n  /**\n   * Builds and returns a URL with interpolated parameters\n   *\n   * #### Example:\n   * ```js\n   * matcher = $umf.compile(\"/about/:person\");\n   * params = { person: \"bob\" };\n   * $bob = $urlRouter.href(matcher, params);\n   * // $bob == \"/about/bob\";\n   * ```\n   *\n   * @param urlMatcher The [[UrlMatcher]] object which is used as the template of the URL to generate.\n   * @param params An object of parameter values to fill the matcher's required parameters.\n   * @param options Options object. The options are:\n   *\n   * - **`absolute`** - {boolean=false},  If true will generate an absolute url, e.g. \"http://www.example.com/fullurl\".\n   *\n   * @returns Returns the fully compiled URL, or `null` if `params` fail validation against `urlMatcher`\n   */\n  href(urlMatcher: UrlMatcher, params?: any, options?: { absolute: boolean }): string {\n    let url = urlMatcher.format(params);\n    if (url == null) return null;\n\n    options = options || { absolute: false };\n\n    const cfg = this._router.urlService.config;\n    const isHtml5 = cfg.html5Mode();\n    if (!isHtml5 && url !== null) {\n      url = '#' + cfg.hashPrefix() + url;\n    }\n    url = appendBasePath(url, isHtml5, options.absolute, cfg.baseHref());\n\n    if (!options.absolute || !url) {\n      return url;\n    }\n\n    const slash = !isHtml5 && url ? '/' : '';\n    const cfgPort = cfg.port();\n    const port = <any>(cfgPort === 80 || cfgPort === 443 ? '' : ':' + cfgPort);\n\n    return [cfg.protocol(), '://', cfg.host(), port, slash, url].join('');\n  }\n\n  /**\n   * Manually adds a URL Rule.\n   *\n   * Usually, a url rule is added using [[StateDeclaration.url]] or [[when]].\n   * This api can be used directly for more control (to register a [[BaseUrlRule]], for example).\n   * Rules can be created using [[UrlRouter.urlRuleFactory]], or create manually as simple objects.\n   *\n   * A rule should have a `match` function which returns truthy if the rule matched.\n   * It should also have a `handler` function which is invoked if the rule is the best match.\n   *\n   * @return a function that deregisters the rule\n   */\n  rule(rule: UrlRule): Function {\n    if (!UrlRuleFactory.isUrlRule(rule)) throw new Error('invalid rule');\n    rule.$id = this._id++;\n    rule.priority = rule.priority || 0;\n\n    this._rules.push(rule);\n    this._sorted = false;\n\n    return () => this.removeRule(rule);\n  }\n\n  /** @inheritdoc */\n  removeRule(rule): void {\n    removeFrom(this._rules, rule);\n  }\n\n  /** @inheritdoc */\n  rules(): UrlRule[] {\n    this.ensureSorted();\n    return this._rules.slice();\n  }\n\n  /** @inheritdoc */\n  otherwise(handler: string | UrlRuleHandlerFn | TargetState | TargetStateDef) {\n    const handlerFn: UrlRuleHandlerFn = getHandlerFn(handler);\n\n    this._otherwiseFn = this.urlRuleFactory.create(val(true), handlerFn);\n    this._sorted = false;\n  }\n\n  /** @inheritdoc */\n  initial(handler: string | UrlRuleHandlerFn | TargetState | TargetStateDef) {\n    const handlerFn: UrlRuleHandlerFn = getHandlerFn(handler);\n\n    const matchFn: UrlRuleMatchFn = (urlParts, router) =>\n      router.globals.transitionHistory.size() === 0 && !!/^\\/?$/.exec(urlParts.path);\n\n    this.rule(this.urlRuleFactory.create(matchFn, handlerFn));\n  }\n\n  /** @inheritdoc */\n  when(\n    matcher: RegExp | UrlMatcher | string,\n    handler: string | UrlRuleHandlerFn,\n    options?: { priority: number }\n  ): UrlRule {\n    const rule = this.urlRuleFactory.create(matcher, handler);\n    if (isDefined(options && options.priority)) rule.priority = options.priority;\n    this.rule(rule);\n    return rule;\n  }\n\n  /** @inheritdoc */\n  deferIntercept(defer?: boolean) {\n    if (defer === undefined) defer = true;\n    this.interceptDeferred = defer;\n  }\n}\n\nfunction getHandlerFn(handler: string | UrlRuleHandlerFn | TargetState | TargetStateDef): UrlRuleHandlerFn {\n  if (!isFunction(handler) && !isString(handler) && !is(TargetState)(handler) && !TargetState.isDef(handler)) {\n    throw new Error(\"'handler' must be a string, function, TargetState, or have a state: 'newtarget' property\");\n  }\n  return isFunction(handler) ? (handler as UrlRuleHandlerFn) : val(handler);\n}\n","/**\n * @coreapi\n * @module view\n */ /** for typedoc */\nimport { equals, applyPairs, removeFrom, TypedMap, inArray, find } from '../common/common';\nimport { curry, prop } from '../common/hof';\nimport { isString, isArray } from '../common/predicates';\nimport { trace } from '../common/trace';\nimport { PathNode } from '../path/pathNode';\nimport { ActiveUIView, ViewContext, ViewConfig } from './interface';\nimport { _ViewDeclaration } from '../state/interface';\nimport { UIRouter } from '../router';\n\nexport type ViewConfigFactory = (path: PathNode[], decl: _ViewDeclaration) => ViewConfig | ViewConfig[];\n\nexport interface ViewServicePluginAPI {\n  _rootViewContext(context?: ViewContext): ViewContext;\n  _viewConfigFactory(viewType: string, factory: ViewConfigFactory);\n  /** @param id router.$id + \".\" + uiView.id */\n  _registeredUIView(id: string): ActiveUIView;\n  _registeredUIViews(): ActiveUIView[];\n  _activeViewConfigs(): ViewConfig[];\n  _onSync(listener: ViewSyncListener): Function;\n}\n\n// A uiView and its matching viewConfig\nexport interface ViewTuple {\n  uiView: ActiveUIView;\n  viewConfig: ViewConfig;\n}\n\nexport interface ViewSyncListener {\n  (viewTuples: ViewTuple[]): void;\n}\n\n/**\n * The View service\n *\n * This service pairs existing `ui-view` components (which live in the DOM)\n * with view configs (from the state declaration objects: [[StateDeclaration.views]]).\n *\n * - After a successful Transition, the views from the newly entered states are activated via [[activateViewConfig]].\n *   The views from exited states are deactivated via [[deactivateViewConfig]].\n *   (See: the [[registerActivateViews]] Transition Hook)\n *\n * - As `ui-view` components pop in and out of existence, they register themselves using [[registerUIView]].\n *\n * - When the [[sync]] function is called, the registered `ui-view`(s) ([[ActiveUIView]])\n * are configured with the matching [[ViewConfig]](s)\n *\n */\nexport class ViewService {\n  private _uiViews: ActiveUIView[] = [];\n  private _viewConfigs: ViewConfig[] = [];\n  private _rootContext: ViewContext;\n  private _viewConfigFactories: { [key: string]: ViewConfigFactory } = {};\n  private _listeners: ViewSyncListener[] = [];\n\n  public _pluginapi: ViewServicePluginAPI = {\n    _rootViewContext: this._rootViewContext.bind(this),\n    _viewConfigFactory: this._viewConfigFactory.bind(this),\n    _registeredUIView: (id: string) => find(this._uiViews, view => `${this.router.$id}.${view.id}` === id),\n    _registeredUIViews: () => this._uiViews,\n    _activeViewConfigs: () => this._viewConfigs,\n    _onSync: (listener: ViewSyncListener) => {\n      this._listeners.push(listener);\n      return () => removeFrom(this._listeners, listener);\n    },\n  };\n\n  /**\n   * Given a ui-view and a ViewConfig, determines if they \"match\".\n   *\n   * A ui-view has a fully qualified name (fqn) and a context object.  The fqn is built from its overall location in\n   * the DOM, describing its nesting relationship to any parent ui-view tags it is nested inside of.\n   *\n   * A ViewConfig has a target ui-view name and a context anchor.  The ui-view name can be a simple name, or\n   * can be a segmented ui-view path, describing a portion of a ui-view fqn.\n   *\n   * In order for a ui-view to match ViewConfig, ui-view's $type must match the ViewConfig's $type\n   *\n   * If the ViewConfig's target ui-view name is a simple name (no dots), then a ui-view matches if:\n   * - the ui-view's name matches the ViewConfig's target name\n   * - the ui-view's context matches the ViewConfig's anchor\n   *\n   * If the ViewConfig's target ui-view name is a segmented name (with dots), then a ui-view matches if:\n   * - There exists a parent ui-view where:\n   *    - the parent ui-view's name matches the first segment (index 0) of the ViewConfig's target name\n   *    - the parent ui-view's context matches the ViewConfig's anchor\n   * - And the remaining segments (index 1..n) of the ViewConfig's target name match the tail of the ui-view's fqn\n   *\n   * Example:\n   *\n   * DOM:\n   * <ui-view>                        <!-- created in the root context (name: \"\") -->\n   *   <ui-view name=\"foo\">                <!-- created in the context named: \"A\"      -->\n   *     <ui-view>                    <!-- created in the context named: \"A.B\"    -->\n   *       <ui-view name=\"bar\">            <!-- created in the context named: \"A.B.C\"  -->\n   *       </ui-view>\n   *     </ui-view>\n   *   </ui-view>\n   * </ui-view>\n   *\n   * uiViews: [\n   *  { fqn: \"$default\",                  creationContext: { name: \"\" } },\n   *  { fqn: \"$default.foo\",              creationContext: { name: \"A\" } },\n   *  { fqn: \"$default.foo.$default\",     creationContext: { name: \"A.B\" } }\n   *  { fqn: \"$default.foo.$default.bar\", creationContext: { name: \"A.B.C\" } }\n   * ]\n   *\n   * These four view configs all match the ui-view with the fqn: \"$default.foo.$default.bar\":\n   *\n   * - ViewConfig1: { uiViewName: \"bar\",                       uiViewContextAnchor: \"A.B.C\" }\n   * - ViewConfig2: { uiViewName: \"$default.bar\",              uiViewContextAnchor: \"A.B\" }\n   * - ViewConfig3: { uiViewName: \"foo.$default.bar\",          uiViewContextAnchor: \"A\" }\n   * - ViewConfig4: { uiViewName: \"$default.foo.$default.bar\", uiViewContextAnchor: \"\" }\n   *\n   * Using ViewConfig3 as an example, it matches the ui-view with fqn \"$default.foo.$default.bar\" because:\n   * - The ViewConfig's segmented target name is: [ \"foo\", \"$default\", \"bar\" ]\n   * - There exists a parent ui-view (which has fqn: \"$default.foo\") where:\n   *    - the parent ui-view's name \"foo\" matches the first segment \"foo\" of the ViewConfig's target name\n   *    - the parent ui-view's context \"A\" matches the ViewConfig's anchor context \"A\"\n   * - And the remaining segments [ \"$default\", \"bar\" ].join(\".\"_ of the ViewConfig's target name match\n   *   the tail of the ui-view's fqn \"default.bar\"\n   *\n   * @internalapi\n   */\n  static matches = (uiViewsByFqn: TypedMap<ActiveUIView>, uiView: ActiveUIView) => (viewConfig: ViewConfig) => {\n    // Don't supply an ng1 ui-view with an ng2 ViewConfig, etc\n    if (uiView.$type !== viewConfig.viewDecl.$type) return false;\n\n    // Split names apart from both viewConfig and uiView into segments\n    const vc = viewConfig.viewDecl;\n    const vcSegments = vc.$uiViewName.split('.');\n    const uivSegments = uiView.fqn.split('.');\n\n    // Check if the tails of the segment arrays match. ex, these arrays' tails match:\n    // vc: [\"foo\", \"bar\"], uiv fqn: [\"$default\", \"foo\", \"bar\"]\n    if (!equals(vcSegments, uivSegments.slice(0 - vcSegments.length))) return false;\n\n    // Now check if the fqn ending at the first segment of the viewConfig matches the context:\n    // [\"$default\", \"foo\"].join(\".\") == \"$default.foo\", does the ui-view $default.foo context match?\n    const negOffset = 1 - vcSegments.length || undefined;\n    const fqnToFirstSegment = uivSegments.slice(0, negOffset).join('.');\n    const uiViewContext = uiViewsByFqn[fqnToFirstSegment].creationContext;\n    return vc.$uiViewContextAnchor === (uiViewContext && uiViewContext.name);\n  };\n\n  /**\n   * Normalizes a view's name from a state.views configuration block.\n   *\n   * This should be used by a framework implementation to calculate the values for\n   * [[_ViewDeclaration.$uiViewName]] and [[_ViewDeclaration.$uiViewContextAnchor]].\n   *\n   * @param context the context object (state declaration) that the view belongs to\n   * @param rawViewName the name of the view, as declared in the [[StateDeclaration.views]]\n   *\n   * @returns the normalized uiViewName and uiViewContextAnchor that the view targets\n   */\n  static normalizeUIViewTarget(context: ViewContext, rawViewName = '') {\n    // TODO: Validate incoming view name with a regexp to allow:\n    // ex: \"view.name@foo.bar\" , \"^.^.view.name\" , \"view.name@^.^\" , \"\" ,\n    // \"@\" , \"$default@^\" , \"!$default.$default\" , \"!foo.bar\"\n    const viewAtContext: string[] = rawViewName.split('@');\n    let uiViewName = viewAtContext[0] || '$default'; // default to unnamed view\n    let uiViewContextAnchor = isString(viewAtContext[1]) ? viewAtContext[1] : '^'; // default to parent context\n\n    // Handle relative view-name sugar syntax.\n    // Matches rawViewName \"^.^.^.foo.bar\" into array: [\"^.^.^.foo.bar\", \"^.^.^\", \"foo.bar\"],\n    const relativeViewNameSugar = /^(\\^(?:\\.\\^)*)\\.(.*$)/.exec(uiViewName);\n    if (relativeViewNameSugar) {\n      // Clobbers existing contextAnchor (rawViewName validation will fix this)\n      uiViewContextAnchor = relativeViewNameSugar[1]; // set anchor to \"^.^.^\"\n      uiViewName = relativeViewNameSugar[2]; // set view-name to \"foo.bar\"\n    }\n\n    if (uiViewName.charAt(0) === '!') {\n      uiViewName = uiViewName.substr(1);\n      uiViewContextAnchor = ''; // target absolutely from root\n    }\n\n    // handle parent relative targeting \"^.^.^\"\n    const relativeMatch = /^(\\^(?:\\.\\^)*)$/;\n    if (relativeMatch.exec(uiViewContextAnchor)) {\n      const anchorState = uiViewContextAnchor.split('.').reduce((anchor, x) => anchor.parent, context);\n      uiViewContextAnchor = anchorState.name;\n    } else if (uiViewContextAnchor === '.') {\n      uiViewContextAnchor = context.name;\n    }\n\n    return { uiViewName, uiViewContextAnchor };\n  }\n\n  constructor(private router: UIRouter) {}\n\n  private _rootViewContext(context?: ViewContext): ViewContext {\n    return (this._rootContext = context || this._rootContext);\n  }\n\n  private _viewConfigFactory(viewType: string, factory: ViewConfigFactory) {\n    this._viewConfigFactories[viewType] = factory;\n  }\n\n  createViewConfig(path: PathNode[], decl: _ViewDeclaration): ViewConfig[] {\n    const cfgFactory = this._viewConfigFactories[decl.$type];\n    if (!cfgFactory) throw new Error('ViewService: No view config factory registered for type ' + decl.$type);\n    const cfgs = cfgFactory(path, decl);\n    return isArray(cfgs) ? cfgs : [cfgs];\n  }\n\n  /**\n   * Deactivates a ViewConfig.\n   *\n   * This function deactivates a `ViewConfig`.\n   * After calling [[sync]], it will un-pair from any `ui-view` with which it is currently paired.\n   *\n   * @param viewConfig The ViewConfig view to deregister.\n   */\n  deactivateViewConfig(viewConfig: ViewConfig) {\n    trace.traceViewServiceEvent('<- Removing', viewConfig);\n    removeFrom(this._viewConfigs, viewConfig);\n  }\n\n  activateViewConfig(viewConfig: ViewConfig) {\n    trace.traceViewServiceEvent('-> Registering', <any>viewConfig);\n    this._viewConfigs.push(viewConfig);\n  }\n\n  sync() {\n    const uiViewsByFqn: TypedMap<ActiveUIView> = this._uiViews.map(uiv => [uiv.fqn, uiv]).reduce(applyPairs, <any>{});\n\n    // Return a weighted depth value for a uiView.\n    // The depth is the nesting depth of ui-views (based on FQN; times 10,000)\n    // plus the depth of the state that is populating the uiView\n    function uiViewDepth(uiView: ActiveUIView) {\n      const stateDepth = (context: ViewContext) => (context && context.parent ? stateDepth(context.parent) + 1 : 1);\n      return uiView.fqn.split('.').length * 10000 + stateDepth(uiView.creationContext);\n    }\n\n    // Return the ViewConfig's context's depth in the context tree.\n    function viewConfigDepth(config: ViewConfig) {\n      let context: ViewContext = config.viewDecl.$context,\n        count = 0;\n      while (++count && context.parent) context = context.parent;\n      return count;\n    }\n\n    // Given a depth function, returns a compare function which can return either ascending or descending order\n    const depthCompare = curry((depthFn, posNeg, left, right) => posNeg * (depthFn(left) - depthFn(right)));\n\n    const matchingConfigPair = (uiView: ActiveUIView): ViewTuple => {\n      const matchingConfigs = this._viewConfigs.filter(ViewService.matches(uiViewsByFqn, uiView));\n      if (matchingConfigs.length > 1) {\n        // This is OK.  Child states can target a ui-view that the parent state also targets (the child wins)\n        // Sort by depth and return the match from the deepest child\n        // console.log(`Multiple matching view configs for ${uiView.fqn}`, matchingConfigs);\n        matchingConfigs.sort(depthCompare(viewConfigDepth, -1)); // descending\n      }\n      return { uiView, viewConfig: matchingConfigs[0] };\n    };\n\n    const configureUIView = (tuple: ViewTuple) => {\n      // If a parent ui-view is reconfigured, it could destroy child ui-views.\n      // Before configuring a child ui-view, make sure it's still in the active uiViews array.\n      if (this._uiViews.indexOf(tuple.uiView) !== -1) tuple.uiView.configUpdated(tuple.viewConfig);\n    };\n\n    // Sort views by FQN and state depth. Process uiviews nearest the root first.\n    const uiViewTuples = this._uiViews.sort(depthCompare(uiViewDepth, 1)).map(matchingConfigPair);\n    const matchedViewConfigs = uiViewTuples.map(tuple => tuple.viewConfig);\n    const unmatchedConfigTuples = this._viewConfigs\n      .filter(config => !inArray(matchedViewConfigs, config))\n      .map(viewConfig => ({ uiView: undefined, viewConfig }));\n\n    uiViewTuples.forEach(configureUIView);\n\n    const allTuples: ViewTuple[] = uiViewTuples.concat(unmatchedConfigTuples);\n    this._listeners.forEach(cb => cb(allTuples));\n    trace.traceViewSync(allTuples);\n  }\n\n  /**\n   * Registers a `ui-view` component\n   *\n   * When a `ui-view` component is created, it uses this method to register itself.\n   * After registration the [[sync]] method is used to ensure all `ui-view` are configured with the proper [[ViewConfig]].\n   *\n   * Note: the `ui-view` component uses the `ViewConfig` to determine what view should be loaded inside the `ui-view`,\n   * and what the view's state context is.\n   *\n   * Note: There is no corresponding `deregisterUIView`.\n   *       A `ui-view` should hang on to the return value of `registerUIView` and invoke it to deregister itself.\n   *\n   * @param uiView The metadata for a UIView\n   * @return a de-registration function used when the view is destroyed.\n   */\n  registerUIView(uiView: ActiveUIView) {\n    trace.traceViewServiceUIViewEvent('-> Registering', uiView);\n    const uiViews = this._uiViews;\n    const fqnAndTypeMatches = (uiv: ActiveUIView) => uiv.fqn === uiView.fqn && uiv.$type === uiView.$type;\n    if (uiViews.filter(fqnAndTypeMatches).length)\n      trace.traceViewServiceUIViewEvent('!!!! duplicate uiView named:', uiView);\n\n    uiViews.push(uiView);\n    this.sync();\n\n    return () => {\n      const idx = uiViews.indexOf(uiView);\n      if (idx === -1) {\n        trace.traceViewServiceUIViewEvent('Tried removing non-registered uiView', uiView);\n        return;\n      }\n      trace.traceViewServiceUIViewEvent('<- Deregistering', uiView);\n      removeFrom(uiViews)(uiView);\n    };\n  }\n\n  /**\n   * Returns the list of views currently available on the page, by fully-qualified name.\n   *\n   * @return {Array} Returns an array of fully-qualified view names.\n   */\n  available() {\n    return this._uiViews.map(prop('fqn'));\n  }\n\n  /**\n   * Returns the list of views on the page containing loaded content.\n   *\n   * @return {Array} Returns an array of fully-qualified view names.\n   */\n  active() {\n    return this._uiViews.filter(prop('$config')).map(prop('name'));\n  }\n}\n","/**\n * @coreapi\n * @module core\n */ /** */\nimport { StateParams } from './params/stateParams';\nimport { StateDeclaration } from './state/interface';\nimport { StateObject } from './state/stateObject';\nimport { Transition } from './transition/transition';\nimport { Queue } from './common/queue';\nimport { Disposable } from './interface';\n\n/**\n * Global router state\n *\n * This is where we hold the global mutable state such as current state, current\n * params, current transition, etc.\n */\nexport class UIRouterGlobals implements Disposable {\n  /**\n   * Current parameter values\n   *\n   * The parameter values from the latest successful transition\n   */\n  params: StateParams = new StateParams();\n\n  /**\n   * Current state\n   *\n   * The to-state from the latest successful transition\n   */\n  current: StateDeclaration;\n\n  /**\n   * Current state (internal object)\n   *\n   * The to-state from the latest successful transition\n   * @internalapi\n   */\n  $current: StateObject;\n\n  /**\n   * The current started/running transition.\n   * This transition has reached at least the onStart phase, but is not yet complete\n   */\n  transition: Transition;\n\n  /** @internalapi */\n  lastStartedTransitionId = -1;\n\n  /** @internalapi */\n  transitionHistory = new Queue<Transition>([], 1);\n\n  /** @internalapi */\n  successfulTransitions = new Queue<Transition>([], 1);\n\n  dispose() {\n    this.transitionHistory.clear();\n    this.successfulTransitions.clear();\n    this.transition = null;\n  }\n}\n","/**\n * @coreapi\n * @module url\n */ /** */\n\nimport { UIRouter } from '../router';\nimport { LocationServices, notImplemented, LocationConfig } from '../common/coreservices';\nimport { noop, createProxyFunctions } from '../common/common';\nimport { UrlConfigApi, UrlSyncApi, UrlRulesApi, UrlParts, MatchResult } from './interface';\n\n/** @hidden */\nconst makeStub = (keys: string[]): any =>\n  keys.reduce((acc, key) => ((acc[key] = notImplemented(key)), acc), { dispose: noop });\n\n/** @hidden */\nconst locationServicesFns = ['url', 'path', 'search', 'hash', 'onChange'];\n/** @hidden */\nconst locationConfigFns = ['port', 'protocol', 'host', 'baseHref', 'html5Mode', 'hashPrefix'];\n/** @hidden */\nconst umfFns = ['type', 'caseInsensitive', 'strictMode', 'defaultSquashPolicy'];\n/** @hidden */\nconst rulesFns = ['sort', 'when', 'initial', 'otherwise', 'rules', 'rule', 'removeRule'];\n/** @hidden */\nconst syncFns = ['deferIntercept', 'listen', 'sync', 'match'];\n\n/**\n * API for URL management\n */\nexport class UrlService implements LocationServices, UrlSyncApi {\n  /** @hidden */\n  static locationServiceStub: LocationServices = makeStub(locationServicesFns);\n  /** @hidden */\n  static locationConfigStub: LocationConfig = makeStub(locationConfigFns);\n\n  /**\n   * A nested API for managing URL rules and rewrites\n   *\n   * See: [[UrlRulesApi]] for details\n   */\n  rules: UrlRulesApi;\n\n  /**\n   * A nested API to configure the URL and retrieve URL information\n   *\n   * See: [[UrlConfigApi]] for details\n   */\n  config: UrlConfigApi;\n\n  /** @hidden */\n  private router: UIRouter;\n\n  /** @hidden */\n  constructor(router: UIRouter, lateBind = true) {\n    this.router = router;\n    this.rules = {} as any;\n    this.config = {} as any;\n\n    // proxy function calls from UrlService to the LocationService/LocationConfig\n    const locationServices = () => router.locationService;\n    createProxyFunctions(locationServices, this, locationServices, locationServicesFns, lateBind);\n\n    const locationConfig = () => router.locationConfig;\n    createProxyFunctions(locationConfig, this.config, locationConfig, locationConfigFns, lateBind);\n\n    const umf = () => router.urlMatcherFactory;\n    createProxyFunctions(umf, this.config, umf, umfFns);\n\n    const urlRouter = () => router.urlRouter;\n    createProxyFunctions(urlRouter, this.rules, urlRouter, rulesFns);\n    createProxyFunctions(urlRouter, this, urlRouter, syncFns);\n  }\n\n  /** @inheritdoc */\n  url(): string;\n  /** @inheritdoc */\n  url(newurl: string, replace?: boolean, state?): void;\n  url(newurl?, replace?, state?): any {\n    return;\n  }\n  /** @inheritdoc */\n  path(): string {\n    return;\n  }\n  /** @inheritdoc */\n  search(): { [key: string]: any } {\n    return;\n  }\n  /** @inheritdoc */\n  hash(): string {\n    return;\n  }\n  /** @inheritdoc */\n  onChange(callback: Function): Function {\n    return;\n  }\n\n  /**\n   * Returns the current URL parts\n   *\n   * This method returns the current URL components as a [[UrlParts]] object.\n   *\n   * @returns the current url parts\n   */\n  parts(): UrlParts {\n    return { path: this.path(), search: this.search(), hash: this.hash() };\n  }\n\n  dispose() {}\n\n  /** @inheritdoc */\n  sync(evt?) {\n    return;\n  }\n  /** @inheritdoc */\n  listen(enabled?: boolean): Function {\n    return;\n  }\n  /** @inheritdoc */\n  deferIntercept(defer?: boolean) {\n    return;\n  }\n  /** @inheritdoc */\n  match(urlParts: UrlParts): MatchResult {\n    return;\n  }\n}\n","/**\n * @coreapi\n * @module core\n */ /** */\nimport { UrlMatcherFactory } from './url/urlMatcherFactory';\nimport { UrlRouter } from './url/urlRouter';\nimport { TransitionService } from './transition/transitionService';\nimport { ViewService } from './view/view';\nimport { StateRegistry } from './state/stateRegistry';\nimport { StateService } from './state/stateService';\nimport { UIRouterGlobals } from './globals';\nimport { UIRouterPlugin, Disposable } from './interface';\nimport { values, removeFrom } from './common/common';\nimport { isFunction } from './common/predicates';\nimport { UrlService } from './url/urlService';\nimport { LocationServices, LocationConfig } from './common/coreservices';\nimport { Trace, trace } from './common/trace';\n\n/** @hidden */\nlet _routerInstance = 0;\n\n/**\n * The master class used to instantiate an instance of UI-Router.\n *\n * UI-Router (for each specific framework) will create an instance of this class during bootstrap.\n * This class instantiates and wires the UI-Router services together.\n *\n * After a new instance of the UIRouter class is created, it should be configured for your app.\n * For instance, app states should be registered with the [[UIRouter.stateRegistry]].\n *\n * ---\n *\n * Normally the framework code will bootstrap UI-Router.\n * If you are bootstrapping UIRouter manually, tell it to monitor the URL by calling\n * [[UrlService.listen]] then [[UrlService.sync]].\n */\nexport class UIRouter {\n  /** @hidden */ $id = _routerInstance++;\n  /** @hidden */ _disposed = false;\n  /** @hidden */ private _disposables: Disposable[] = [];\n\n  /** Provides trace information to the console */\n  trace: Trace = trace;\n\n  /** Provides services related to ui-view synchronization */\n  viewService = new ViewService(this);\n\n  /** Global router state */\n  globals: UIRouterGlobals = new UIRouterGlobals();\n\n  /** Provides services related to Transitions */\n  transitionService: TransitionService = new TransitionService(this);\n\n  /**\n   * Deprecated for public use. Use [[urlService]] instead.\n   * @deprecated Use [[urlService]] instead\n   */\n  urlMatcherFactory: UrlMatcherFactory = new UrlMatcherFactory();\n\n  /**\n   * Deprecated for public use. Use [[urlService]] instead.\n   * @deprecated Use [[urlService]] instead\n   */\n  urlRouter: UrlRouter = new UrlRouter(this);\n\n  /** Provides a registry for states, and related registration services */\n  stateRegistry: StateRegistry = new StateRegistry(this);\n\n  /** Provides services related to states */\n  stateService = new StateService(this);\n\n  /** Provides services related to the URL */\n  urlService: UrlService = new UrlService(this);\n\n  /** @hidden plugin instances are registered here */\n  private _plugins: { [key: string]: UIRouterPlugin } = {};\n\n  /** Registers an object to be notified when the router is disposed */\n  disposable(disposable: Disposable) {\n    this._disposables.push(disposable);\n  }\n\n  /**\n   * Disposes this router instance\n   *\n   * When called, clears resources retained by the router by calling `dispose(this)` on all\n   * registered [[disposable]] objects.\n   *\n   * Or, if a `disposable` object is provided, calls `dispose(this)` on that object only.\n   *\n   * @param disposable (optional) the disposable to dispose\n   */\n  dispose(disposable?: any): void {\n    if (disposable && isFunction(disposable.dispose)) {\n      disposable.dispose(this);\n      return undefined;\n    }\n\n    this._disposed = true;\n    this._disposables.slice().forEach(d => {\n      try {\n        typeof d.dispose === 'function' && d.dispose(this);\n        removeFrom(this._disposables, d);\n      } catch (ignored) {}\n    });\n  }\n\n  /**\n   * Creates a new `UIRouter` object\n   *\n   * @param locationService a [[LocationServices]] implementation\n   * @param locationConfig a [[LocationConfig]] implementation\n   * @internalapi\n   */\n  constructor(\n    public locationService: LocationServices = UrlService.locationServiceStub,\n    public locationConfig: LocationConfig = UrlService.locationConfigStub\n  ) {\n    this.viewService._pluginapi._rootViewContext(this.stateRegistry.root());\n    this.globals.$current = this.stateRegistry.root();\n    this.globals.current = this.globals.$current.self;\n\n    this.disposable(this.globals);\n    this.disposable(this.stateService);\n    this.disposable(this.stateRegistry);\n    this.disposable(this.transitionService);\n    this.disposable(this.urlRouter);\n    this.disposable(locationService);\n    this.disposable(locationConfig);\n  }\n\n  /** Add plugin (as ES6 class) */\n  plugin<T extends UIRouterPlugin>(plugin: { new (router: UIRouter, options?: any): T }, options?: any): T;\n  /** Add plugin (as javascript constructor function) */\n  plugin<T extends UIRouterPlugin>(plugin: { (router: UIRouter, options?: any): void }, options?: any): T;\n  /** Add plugin (as javascript factory function) */\n  plugin<T extends UIRouterPlugin>(plugin: PluginFactory<T>, options?: any): T;\n  /**\n   * Adds a plugin to UI-Router\n   *\n   * This method adds a UI-Router Plugin.\n   * A plugin can enhance or change UI-Router behavior using any public API.\n   *\n   * #### Example:\n   * ```js\n   * import { MyCoolPlugin } from \"ui-router-cool-plugin\";\n   *\n   * var plugin = router.addPlugin(MyCoolPlugin);\n   * ```\n   *\n   * ### Plugin authoring\n   *\n   * A plugin is simply a class (or constructor function) which accepts a [[UIRouter]] instance and (optionally) an options object.\n   *\n   * The plugin can implement its functionality using any of the public APIs of [[UIRouter]].\n   * For example, it may configure router options or add a Transition Hook.\n   *\n   * The plugin can then be published as a separate module.\n   *\n   * #### Example:\n   * ```js\n   * export class MyAuthPlugin implements UIRouterPlugin {\n   *   constructor(router: UIRouter, options: any) {\n   *     this.name = \"MyAuthPlugin\";\n   *     let $transitions = router.transitionService;\n   *     let $state = router.stateService;\n   *\n   *     let authCriteria = {\n   *       to: (state) => state.data && state.data.requiresAuth\n   *     };\n   *\n   *     function authHook(transition: Transition) {\n   *       let authService = transition.injector().get('AuthService');\n   *       if (!authService.isAuthenticated()) {\n   *         return $state.target('login');\n   *       }\n   *     }\n   *\n   *     $transitions.onStart(authCriteria, authHook);\n   *   }\n   * }\n   * ```\n   *\n   * @param plugin one of:\n   *        - a plugin class which implements [[UIRouterPlugin]]\n   *        - a constructor function for a [[UIRouterPlugin]] which accepts a [[UIRouter]] instance\n   *        - a factory function which accepts a [[UIRouter]] instance and returns a [[UIRouterPlugin]] instance\n   * @param options options to pass to the plugin class/factory\n   * @returns the registered plugin instance\n   */\n  plugin<T extends UIRouterPlugin>(plugin: any, options: any = {}): T {\n    const pluginInstance = new plugin(this, options);\n    if (!pluginInstance.name) throw new Error('Required property `name` missing on plugin: ' + pluginInstance);\n    this._disposables.push(pluginInstance);\n    return (this._plugins[pluginInstance.name] = pluginInstance);\n  }\n\n  /**\n   * Returns registered plugins\n   *\n   * Returns the registered plugin of the given `pluginName`.\n   * If no `pluginName` is given, returns all registered plugins\n   *\n   * @param pluginName (optional) the name of the plugin to get\n   * @return the named plugin (undefined if not found), or all plugins (if `pluginName` is omitted)\n   */\n  getPlugin(pluginName: string): UIRouterPlugin;\n  getPlugin(): UIRouterPlugin[];\n  getPlugin(pluginName?: string): UIRouterPlugin | UIRouterPlugin[] {\n    return pluginName ? this._plugins[pluginName] : values(this._plugins);\n  }\n}\n\n/** @internalapi */\nexport type PluginFactory<T> = (router: UIRouter, options?: any) => T;\n","/** @module hooks */ /** */\nimport { Transition } from '../transition/transition';\nimport { UIRouter } from '../router';\nimport { TransitionService } from '../transition/transitionService';\nimport { Resolvable } from '../resolve';\nimport { inArray, uniqR, unnestR, values } from '../common';\nimport { PathNode } from '../path';\n\nfunction addCoreResolvables(trans: Transition) {\n  trans.addResolvable(Resolvable.fromData(UIRouter, trans.router), '');\n  trans.addResolvable(Resolvable.fromData(Transition, trans), '');\n  trans.addResolvable(Resolvable.fromData('$transition$', trans), '');\n  trans.addResolvable(Resolvable.fromData('$stateParams', trans.params()), '');\n\n  trans.entering().forEach(state => {\n    trans.addResolvable(Resolvable.fromData('$state$', state), state);\n  });\n}\n\nexport const registerAddCoreResolvables = (transitionService: TransitionService) =>\n  transitionService.onCreate({}, addCoreResolvables);\n\nconst TRANSITION_TOKENS = ['$transition$', Transition];\nconst isTransition = inArray(TRANSITION_TOKENS);\n\n// References to Transition in the treeChanges pathnodes makes all\n// previous Transitions reachable in memory, causing a memory leak\n// This function removes resolves for '$transition$' and `Transition` from the treeChanges.\n// Do not use this on current transitions, only on old ones.\nexport const treeChangesCleanup = (trans: Transition) => {\n  const nodes = values(trans.treeChanges())\n    .reduce(unnestR, [])\n    .reduce(uniqR, []);\n\n  // If the resolvable is a Transition, return a new resolvable with null data\n  const replaceTransitionWithNull = (r: Resolvable): Resolvable => {\n    return isTransition(r.token) ? Resolvable.fromData(r.token, null) : r;\n  };\n\n  nodes.forEach((node: PathNode) => {\n    node.resolvables = node.resolvables.map(replaceTransitionWithNull);\n  });\n};\n","/** @module hooks */ /** */\nimport { isString, isFunction } from '../common/predicates';\nimport { Transition } from '../transition/transition';\nimport { services } from '../common/coreservices';\nimport { TargetState } from '../state/targetState';\nimport { TransitionService } from '../transition/transitionService';\nimport { TransitionHookFn } from '../transition/interface';\n\n/**\n * A [[TransitionHookFn]] that redirects to a different state or params\n *\n * Registered using `transitionService.onStart({ to: (state) => !!state.redirectTo }, redirectHook);`\n *\n * See [[StateDeclaration.redirectTo]]\n */\nconst redirectToHook: TransitionHookFn = (trans: Transition) => {\n  const redirect = trans.to().redirectTo;\n  if (!redirect) return;\n\n  const $state = trans.router.stateService;\n\n  function handleResult(result: any) {\n    if (!result) return;\n    if (result instanceof TargetState) return result;\n    if (isString(result)) return $state.target(<any>result, trans.params(), trans.options());\n    if (result['state'] || result['params'])\n      return $state.target(result['state'] || trans.to(), result['params'] || trans.params(), trans.options());\n  }\n\n  if (isFunction(redirect)) {\n    return services.$q.when(redirect(trans)).then(handleResult);\n  }\n  return handleResult(redirect);\n};\n\nexport const registerRedirectToHook = (transitionService: TransitionService) =>\n  transitionService.onStart({ to: state => !!state.redirectTo }, redirectToHook);\n","/** @module hooks */\n/** for typedoc */\nimport { TransitionStateHookFn } from '../transition/interface';\nimport { Transition } from '../transition/transition';\nimport { TransitionService } from '../transition/transitionService';\nimport { StateDeclaration } from '../state/interface';\nimport { StateObject } from '../state/stateObject';\n\n/**\n * A factory which creates an onEnter, onExit or onRetain transition hook function\n *\n * The returned function invokes the (for instance) state.onEnter hook when the\n * state is being entered.\n *\n * @hidden\n */\nfunction makeEnterExitRetainHook(hookName: string): TransitionStateHookFn {\n  return (transition: Transition, state: StateDeclaration) => {\n    const _state: StateObject = state.$$state();\n    const hookFn: TransitionStateHookFn = _state[hookName];\n    return hookFn(transition, state);\n  };\n}\n\n/**\n * The [[TransitionStateHookFn]] for onExit\n *\n * When the state is being exited, the state's .onExit function is invoked.\n *\n * Registered using `transitionService.onExit({ exiting: (state) => !!state.onExit }, onExitHook);`\n *\n * See: [[IHookRegistry.onExit]]\n */\nconst onExitHook: TransitionStateHookFn = makeEnterExitRetainHook('onExit');\nexport const registerOnExitHook = (transitionService: TransitionService) =>\n  transitionService.onExit({ exiting: state => !!state.onExit }, onExitHook);\n\n/**\n * The [[TransitionStateHookFn]] for onRetain\n *\n * When the state was already entered, and is not being exited or re-entered, the state's .onRetain function is invoked.\n *\n * Registered using `transitionService.onRetain({ retained: (state) => !!state.onRetain }, onRetainHook);`\n *\n * See: [[IHookRegistry.onRetain]]\n */\nconst onRetainHook: TransitionStateHookFn = makeEnterExitRetainHook('onRetain');\nexport const registerOnRetainHook = (transitionService: TransitionService) =>\n  transitionService.onRetain({ retained: state => !!state.onRetain }, onRetainHook);\n\n/**\n * The [[TransitionStateHookFn]] for onEnter\n *\n * When the state is being entered, the state's .onEnter function is invoked.\n *\n * Registered using `transitionService.onEnter({ entering: (state) => !!state.onEnter }, onEnterHook);`\n *\n * See: [[IHookRegistry.onEnter]]\n */\nconst onEnterHook: TransitionStateHookFn = makeEnterExitRetainHook('onEnter');\nexport const registerOnEnterHook = (transitionService: TransitionService) =>\n  transitionService.onEnter({ entering: state => !!state.onEnter }, onEnterHook);\n","/** @module hooks */\n/** for typedoc */\nimport { noop } from '../common/common';\nimport { Transition } from '../transition/transition';\nimport { ResolveContext } from '../resolve/resolveContext';\nimport { TransitionStateHookFn, TransitionHookFn } from '../transition/interface';\nimport { TransitionService } from '../transition/transitionService';\nimport { val } from '../common/hof';\nimport { StateDeclaration } from '../state/interface';\n\nexport const RESOLVE_HOOK_PRIORITY = 1000;\n\n/**\n * A [[TransitionHookFn]] which resolves all EAGER Resolvables in the To Path\n *\n * Registered using `transitionService.onStart({}, eagerResolvePath, { priority: 1000 });`\n *\n * When a Transition starts, this hook resolves all the EAGER Resolvables, which the transition then waits for.\n *\n * See [[StateDeclaration.resolve]]\n */\nconst eagerResolvePath: TransitionHookFn = (trans: Transition) =>\n  new ResolveContext(trans.treeChanges().to).resolvePath('EAGER', trans).then(noop);\n\nexport const registerEagerResolvePath = (transitionService: TransitionService) =>\n  transitionService.onStart({}, eagerResolvePath, { priority: RESOLVE_HOOK_PRIORITY });\n\n/**\n * A [[TransitionHookFn]] which resolves all LAZY Resolvables for the state (and all its ancestors) in the To Path\n *\n * Registered using `transitionService.onEnter({ entering: () => true }, lazyResolveState, { priority: 1000 });`\n *\n * When a State is being entered, this hook resolves all the Resolvables for this state, which the transition then waits for.\n *\n * See [[StateDeclaration.resolve]]\n */\nconst lazyResolveState: TransitionStateHookFn = (trans: Transition, state: StateDeclaration) =>\n  new ResolveContext(trans.treeChanges().to)\n    .subContext(state.$$state())\n    .resolvePath('LAZY', trans)\n    .then(noop);\n\nexport const registerLazyResolveState = (transitionService: TransitionService) =>\n  transitionService.onEnter({ entering: val(true) }, lazyResolveState, { priority: RESOLVE_HOOK_PRIORITY });\n\n/**\n * A [[TransitionHookFn]] which resolves any dynamically added (LAZY or EAGER) Resolvables.\n *\n * Registered using `transitionService.onFinish({}, eagerResolvePath, { priority: 1000 });`\n *\n * After all entering states have been entered, this hook resolves any remaining Resolvables.\n * These are typically dynamic resolves which were added by some Transition Hook using [[Transition.addResolvable]].\n *\n * See [[StateDeclaration.resolve]]\n */\nconst resolveRemaining: TransitionHookFn = (trans: Transition) =>\n  new ResolveContext(trans.treeChanges().to).resolvePath('LAZY', trans).then(noop);\n\nexport const registerResolveRemaining = (transitionService: TransitionService) =>\n  transitionService.onFinish({}, resolveRemaining, { priority: RESOLVE_HOOK_PRIORITY });\n","/** @module hooks */ /** for typedoc */\nimport { noop } from '../common/common';\nimport { services } from '../common/coreservices';\nimport { Transition } from '../transition/transition';\nimport { ViewService } from '../view/view';\nimport { ViewConfig } from '../view/interface';\nimport { TransitionHookFn } from '../transition/interface';\nimport { TransitionService } from '../transition/transitionService';\n\n/**\n * A [[TransitionHookFn]] which waits for the views to load\n *\n * Registered using `transitionService.onStart({}, loadEnteringViews);`\n *\n * Allows the views to do async work in [[ViewConfig.load]] before the transition continues.\n * In angular 1, this includes loading the templates.\n */\nconst loadEnteringViews: TransitionHookFn = (transition: Transition) => {\n  const $q = services.$q;\n  const enteringViews = transition.views('entering');\n  if (!enteringViews.length) return;\n  return $q.all(enteringViews.map(view => $q.when(view.load()))).then(noop);\n};\n\nexport const registerLoadEnteringViews = (transitionService: TransitionService) =>\n  transitionService.onFinish({}, loadEnteringViews);\n\n/**\n * A [[TransitionHookFn]] which activates the new views when a transition is successful.\n *\n * Registered using `transitionService.onSuccess({}, activateViews);`\n *\n * After a transition is complete, this hook deactivates the old views from the previous state,\n * and activates the new views from the destination state.\n *\n * See [[ViewService]]\n */\nconst activateViews: TransitionHookFn = (transition: Transition) => {\n  const enteringViews = transition.views('entering');\n  const exitingViews = transition.views('exiting');\n  if (!enteringViews.length && !exitingViews.length) return;\n\n  const $view: ViewService = transition.router.viewService;\n\n  exitingViews.forEach((vc: ViewConfig) => $view.deactivateViewConfig(vc));\n  enteringViews.forEach((vc: ViewConfig) => $view.activateViewConfig(vc));\n\n  $view.sync();\n};\n\nexport const registerActivateViews = (transitionService: TransitionService) =>\n  transitionService.onSuccess({}, activateViews);\n","/** @module hooks */\n/** for typedoc */\nimport { Transition } from '../transition/transition';\nimport { copy } from '../common/common';\nimport { TransitionService } from '../transition/transitionService';\n\n/**\n * A [[TransitionHookFn]] which updates global UI-Router state\n *\n * Registered using `transitionService.onBefore({}, updateGlobalState);`\n *\n * Before a [[Transition]] starts, updates the global value of \"the current transition\" ([[Globals.transition]]).\n * After a successful [[Transition]], updates the global values of \"the current state\"\n * ([[Globals.current]] and [[Globals.$current]]) and \"the current param values\" ([[Globals.params]]).\n *\n * See also the deprecated properties:\n * [[StateService.transition]], [[StateService.current]], [[StateService.params]]\n */\nconst updateGlobalState = (trans: Transition) => {\n  const globals = trans.router.globals;\n\n  const transitionSuccessful = () => {\n    globals.successfulTransitions.enqueue(trans);\n    globals.$current = trans.$to();\n    globals.current = globals.$current.self;\n\n    copy(trans.params(), globals.params);\n  };\n\n  const clearCurrentTransition = () => {\n    // Do not clear globals.transition if a different transition has started in the meantime\n    if (globals.transition === trans) globals.transition = null;\n  };\n\n  trans.onSuccess({}, transitionSuccessful, { priority: 10000 });\n  trans.promise.then(clearCurrentTransition, clearCurrentTransition);\n};\n\nexport const registerUpdateGlobalState = (transitionService: TransitionService) =>\n  transitionService.onCreate({}, updateGlobalState);\n","/** @module hooks */ /** */\nimport { UrlRouter } from '../url/urlRouter';\nimport { StateService } from '../state/stateService';\nimport { Transition } from '../transition/transition';\nimport { TransitionHookFn } from '../transition/interface';\nimport { TransitionService } from '../transition/transitionService';\n\n/**\n * A [[TransitionHookFn]] which updates the URL after a successful transition\n *\n * Registered using `transitionService.onSuccess({}, updateUrl);`\n */\nconst updateUrl: TransitionHookFn = (transition: Transition) => {\n  const options = transition.options();\n  const $state: StateService = transition.router.stateService;\n  const $urlRouter: UrlRouter = transition.router.urlRouter;\n\n  // Dont update the url in these situations:\n  // The transition was triggered by a URL sync (options.source === 'url')\n  // The user doesn't want the url to update (options.location === false)\n  // The destination state, and all parents have no navigable url\n  if (options.source !== 'url' && options.location && $state.$current.navigable) {\n    const urlOptions = { replace: options.location === 'replace' };\n    $urlRouter.push($state.$current.navigable.url, $state.params, urlOptions);\n  }\n\n  $urlRouter.update(true);\n};\n\nexport const registerUpdateUrl = (transitionService: TransitionService) =>\n  transitionService.onSuccess({}, updateUrl, { priority: 9999 });\n","/** @module hooks */ /** */\nimport { Transition } from '../transition/transition';\nimport { TransitionService } from '../transition/transitionService';\nimport { TransitionHookFn } from '../transition/interface';\nimport { StateDeclaration, LazyLoadResult } from '../state/interface';\nimport { services } from '../common/coreservices';\nimport { StateRule } from '../url/interface';\n\n/**\n * A [[TransitionHookFn]] that performs lazy loading\n *\n * When entering a state \"abc\" which has a `lazyLoad` function defined:\n * - Invoke the `lazyLoad` function (unless it is already in process)\n *   - Flag the hook function as \"in process\"\n *   - The function should return a promise (that resolves when lazy loading is complete)\n * - Wait for the promise to settle\n *   - If the promise resolves to a [[LazyLoadResult]], then register those states\n *   - Flag the hook function as \"not in process\"\n * - If the hook was successful\n *   - Remove the `lazyLoad` function from the state declaration\n * - If all the hooks were successful\n *   - Retry the transition (by returning a TargetState)\n *\n * ```\n * .state('abc', {\n *   component: 'fooComponent',\n *   lazyLoad: () => System.import('./fooComponent')\n *   });\n * ```\n *\n * See [[StateDeclaration.lazyLoad]]\n */\nconst lazyLoadHook: TransitionHookFn = (transition: Transition) => {\n  const router = transition.router;\n\n  function retryTransition() {\n    if (transition.originalTransition().options().source !== 'url') {\n      // The original transition was not triggered via url sync\n      // The lazy state should be loaded now, so re-try the original transition\n      const orig = transition.targetState();\n      return router.stateService.target(orig.identifier(), orig.params(), orig.options());\n    }\n\n    // The original transition was triggered via url sync\n    // Run the URL rules and find the best match\n    const $url = router.urlService;\n    const result = $url.match($url.parts());\n    const rule = result && result.rule;\n\n    // If the best match is a state, redirect the transition (instead\n    // of calling sync() which supersedes the current transition)\n    if (rule && rule.type === 'STATE') {\n      const state = (rule as StateRule).state;\n      const params = result.match;\n      return router.stateService.target(state, params, transition.options());\n    }\n\n    // No matching state found, so let .sync() choose the best non-state match/otherwise\n    router.urlService.sync();\n  }\n\n  const promises = transition\n    .entering()\n    .filter(state => !!state.$$state().lazyLoad)\n    .map(state => lazyLoadState(transition, state));\n\n  return services.$q.all(promises).then(retryTransition);\n};\n\nexport const registerLazyLoadHook = (transitionService: TransitionService) =>\n  transitionService.onBefore({ entering: state => !!state.lazyLoad }, lazyLoadHook);\n\n/**\n * Invokes a state's lazy load function\n *\n * @param transition a Transition context\n * @param state the state to lazy load\n * @returns A promise for the lazy load result\n */\nexport function lazyLoadState(transition: Transition, state: StateDeclaration): Promise<LazyLoadResult> {\n  const lazyLoadFn = state.$$state().lazyLoad;\n\n  // Store/get the lazy load promise on/from the hookfn so it doesn't get re-invoked\n  let promise = lazyLoadFn['_promise'];\n  if (!promise) {\n    const success = result => {\n      delete state.lazyLoad;\n      delete state.$$state().lazyLoad;\n      delete lazyLoadFn['_promise'];\n      return result;\n    };\n\n    const error = err => {\n      delete lazyLoadFn['_promise'];\n      return services.$q.reject(err);\n    };\n\n    promise = lazyLoadFn['_promise'] = services.$q\n      .when(lazyLoadFn(transition, state))\n      .then(updateStateRegistry)\n      .then(success, error);\n  }\n\n  /** Register any lazy loaded state definitions */\n  function updateStateRegistry(result: LazyLoadResult) {\n    if (result && Array.isArray(result.states)) {\n      result.states.forEach(_state => transition.router.stateRegistry.register(_state));\n    }\n    return result;\n  }\n\n  return promise;\n}\n","/** @module transition */ /** */\nimport { TransitionHookPhase, PathType } from './interface';\nimport { GetErrorHandler, GetResultHandler, TransitionHook } from './transitionHook';\n/**\n * This class defines a type of hook, such as `onBefore` or `onEnter`.\n * Plugins can define custom hook types, such as sticky states does for `onInactive`.\n *\n * @interalapi\n */\nexport class TransitionEventType {\n  /* tslint:disable:no-inferrable-types */\n  constructor(\n    public name: string,\n    public hookPhase: TransitionHookPhase,\n    public hookOrder: number,\n    public criteriaMatchPath: PathType,\n    public reverseSort: boolean = false,\n    public getResultHandler: GetResultHandler = TransitionHook.HANDLE_RESULT,\n    public getErrorHandler: GetErrorHandler = TransitionHook.REJECT_ERROR,\n    public synchronous: boolean = false\n  ) {}\n}\n","/** @module hooks */ /** */\n\nimport { trace } from '../common/trace';\nimport { Rejection } from '../transition/rejectFactory';\nimport { TransitionService } from '../transition/transitionService';\nimport { Transition } from '../transition/transition';\n\n/**\n * A [[TransitionHookFn]] that skips a transition if it should be ignored\n *\n * This hook is invoked at the end of the onBefore phase.\n *\n * If the transition should be ignored (because no parameter or states changed)\n * then the transition is ignored and not processed.\n */\nfunction ignoredHook(trans: Transition) {\n  const ignoredReason = trans._ignoredReason();\n  if (!ignoredReason) return;\n\n  trace.traceTransitionIgnored(trans);\n\n  const pending = trans.router.globals.transition;\n\n  // The user clicked a link going back to the *current state* ('A')\n  // However, there is also a pending transition in flight (to 'B')\n  // Abort the transition to 'B' because the user now wants to be back at 'A'.\n  if (ignoredReason === 'SameAsCurrent' && pending) {\n    pending.abort();\n  }\n\n  return Rejection.ignored().toPromise();\n}\n\nexport const registerIgnoredTransitionHook = (transitionService: TransitionService) =>\n  transitionService.onBefore({}, ignoredHook, { priority: -9999 });\n","/** @module hooks */ /** */\n\nimport { TransitionService } from '../transition/transitionService';\nimport { Transition } from '../transition/transition';\n\n/**\n * A [[TransitionHookFn]] that rejects the Transition if it is invalid\n *\n * This hook is invoked at the end of the onBefore phase.\n * If the transition is invalid (for example, param values do not validate)\n * then the transition is rejected.\n */\nfunction invalidTransitionHook(trans: Transition) {\n  if (!trans.valid()) {\n    throw new Error(trans.error().toString());\n  }\n}\n\nexport const registerInvalidTransitionHook = (transitionService: TransitionService) =>\n  transitionService.onBefore({}, invalidTransitionHook, { priority: -10000 });\n","/**\n * @coreapi\n * @module transition\n */\n/** for typedoc */\nimport {\n  IHookRegistry,\n  TransitionOptions,\n  TransitionHookScope,\n  TransitionHookPhase,\n  TransitionCreateHookFn,\n  HookMatchCriteria,\n  HookRegOptions,\n  PathTypes,\n  PathType,\n  RegisteredHooks,\n  TransitionHookFn,\n  TransitionStateHookFn,\n} from './interface';\nimport { Transition } from './transition';\nimport { makeEvent, RegisteredHook } from './hookRegistry';\nimport { TargetState } from '../state/targetState';\nimport { PathNode } from '../path/pathNode';\nimport { ViewService } from '../view/view';\nimport { UIRouter } from '../router';\nimport { registerAddCoreResolvables, treeChangesCleanup } from '../hooks/coreResolvables';\nimport { registerRedirectToHook } from '../hooks/redirectTo';\nimport { registerOnExitHook, registerOnRetainHook, registerOnEnterHook } from '../hooks/onEnterExitRetain';\nimport { registerEagerResolvePath, registerLazyResolveState, registerResolveRemaining } from '../hooks/resolve';\nimport { registerLoadEnteringViews, registerActivateViews } from '../hooks/views';\nimport { registerUpdateGlobalState } from '../hooks/updateGlobals';\nimport { registerUpdateUrl } from '../hooks/url';\nimport { registerLazyLoadHook } from '../hooks/lazyLoad';\nimport { TransitionEventType } from './transitionEventType';\nimport { TransitionHook, GetResultHandler, GetErrorHandler } from './transitionHook';\nimport { isDefined } from '../common/predicates';\nimport { removeFrom, values, createProxyFunctions } from '../common/common';\nimport { Disposable } from '../interface'; // has or is using\nimport { val } from '../common/hof';\nimport { registerIgnoredTransitionHook } from '../hooks/ignoredTransition';\nimport { registerInvalidTransitionHook } from '../hooks/invalidTransition';\n\n/**\n * The default [[Transition]] options.\n *\n * Include this object when applying custom defaults:\n * let reloadOpts = { reload: true, notify: true }\n * let options = defaults(theirOpts, customDefaults, defaultOptions);\n */\nexport let defaultTransOpts: TransitionOptions = {\n  location: true,\n  relative: null,\n  inherit: false,\n  notify: true,\n  reload: false,\n  custom: {},\n  current: () => null,\n  source: 'unknown',\n};\n\n/**\n * Plugin API for Transition Service\n * @internalapi\n */\nexport interface TransitionServicePluginAPI {\n  /**\n   * Adds a Path to be used as a criterion against a TreeChanges path\n   *\n   * For example: the `exiting` path in [[HookMatchCriteria]] is a STATE scoped path.\n   * It was defined by calling `defineTreeChangesCriterion('exiting', TransitionHookScope.STATE)`\n   * Each state in the exiting path is checked against the criteria and returned as part of the match.\n   *\n   * Another example: the `to` path in [[HookMatchCriteria]] is a TRANSITION scoped path.\n   * It was defined by calling `defineTreeChangesCriterion('to', TransitionHookScope.TRANSITION)`\n   * Only the tail of the `to` path is checked against the criteria and returned as part of the match.\n   */\n  _definePathType(name: string, hookScope: TransitionHookScope);\n\n  /**\n   * Gets a Path definition used as a criterion against a TreeChanges path\n   */\n  _getPathTypes(): PathTypes;\n\n  /**\n   * Defines a transition hook type and returns a transition hook registration\n   * function (which can then be used to register hooks of this type).\n   */\n  _defineEvent(\n    name: string,\n    hookPhase: TransitionHookPhase,\n    hookOrder: number,\n    criteriaMatchPath: PathType,\n    reverseSort?: boolean,\n    getResultHandler?: GetResultHandler,\n    getErrorHandler?: GetErrorHandler,\n    rejectIfSuperseded?: boolean\n  );\n\n  /**\n   * Returns the known event types, such as `onBefore`\n   * If a phase argument is provided, returns only events for the given phase.\n   */\n  _getEvents(phase?: TransitionHookPhase): TransitionEventType[];\n\n  /** Returns the hooks registered for the given hook name */\n  getHooks(hookName: string): RegisteredHook[];\n}\n\n/**\n * This class provides services related to Transitions.\n *\n * - Most importantly, it allows global Transition Hooks to be registered.\n * - It allows the default transition error handler to be set.\n * - It also has a factory function for creating new [[Transition]] objects, (used internally by the [[StateService]]).\n *\n * At bootstrap, [[UIRouter]] creates a single instance (singleton) of this class.\n */\nexport class TransitionService implements IHookRegistry, Disposable {\n  /** @hidden */\n  _transitionCount = 0;\n\n  /** @hidden */\n  public $view: ViewService;\n\n  /** @hidden The transition hook types, such as `onEnter`, `onStart`, etc */\n  private _eventTypes: TransitionEventType[] = [];\n  /** @hidden The registered transition hooks */\n  _registeredHooks = {} as RegisteredHooks;\n  /** @hidden The  paths on a criteria object */\n  private _criteriaPaths = {} as PathTypes;\n  /** @hidden */\n  private _router: UIRouter;\n\n  /** @internalapi */\n  _pluginapi: TransitionServicePluginAPI;\n\n  /**\n   * This object has hook de-registration functions for the built-in hooks.\n   * This can be used by third parties libraries that wish to customize the behaviors\n   *\n   * @hidden\n   */\n  _deregisterHookFns: {\n    addCoreResolves: Function;\n    ignored: Function;\n    invalid: Function;\n    redirectTo: Function;\n    onExit: Function;\n    onRetain: Function;\n    onEnter: Function;\n    eagerResolve: Function;\n    lazyResolve: Function;\n    resolveAll: Function;\n    loadViews: Function;\n    activateViews: Function;\n    updateGlobals: Function;\n    updateUrl: Function;\n    lazyLoad: Function;\n  };\n\n  /** @hidden */\n  constructor(_router: UIRouter) {\n    this._router = _router;\n    this.$view = _router.viewService;\n    this._deregisterHookFns = <any>{};\n    this._pluginapi = <TransitionServicePluginAPI>createProxyFunctions(val(this), {}, val(this), [\n      '_definePathType',\n      '_defineEvent',\n      '_getPathTypes',\n      '_getEvents',\n      'getHooks',\n    ]);\n\n    this._defineCorePaths();\n    this._defineCoreEvents();\n    this._registerCoreTransitionHooks();\n    _router.globals.successfulTransitions.onEvict(treeChangesCleanup);\n  }\n\n  /**\n   * Registers a [[TransitionHookFn]], called *while a transition is being constructed*.\n   *\n   * Registers a transition lifecycle hook, which is invoked during transition construction.\n   *\n   * This low level hook should only be used by plugins.\n   * This can be a useful time for plugins to add resolves or mutate the transition as needed.\n   * The Sticky States plugin uses this hook to modify the treechanges.\n   *\n   * ### Lifecycle\n   *\n   * `onCreate` hooks are invoked *while a transition is being constructed*.\n   *\n   * ### Return value\n   *\n   * The hook's return value is ignored\n   *\n   * @internalapi\n   * @param criteria defines which Transitions the Hook should be invoked for.\n   * @param callback the hook function which will be invoked.\n   * @param options the registration options\n   * @returns a function which deregisters the hook.\n   */\n  onCreate(criteria: HookMatchCriteria, callback: TransitionCreateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onBefore(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onStart(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onExit(criteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onRetain(criteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onEnter(criteria: HookMatchCriteria, callback: TransitionStateHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onFinish(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onSuccess(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n  /** @inheritdoc */\n  onError(criteria: HookMatchCriteria, callback: TransitionHookFn, options?: HookRegOptions): Function {\n    return;\n  }\n\n  /**\n   * dispose\n   * @internalapi\n   */\n  dispose(router: UIRouter) {\n    values(this._registeredHooks).forEach((hooksArray: RegisteredHook[]) =>\n      hooksArray.forEach(hook => {\n        hook._deregistered = true;\n        removeFrom(hooksArray, hook);\n      })\n    );\n  }\n\n  /**\n   * Creates a new [[Transition]] object\n   *\n   * This is a factory function for creating new Transition objects.\n   * It is used internally by the [[StateService]] and should generally not be called by application code.\n   *\n   * @param fromPath the path to the current state (the from state)\n   * @param targetState the target state (destination)\n   * @returns a Transition\n   */\n  create(fromPath: PathNode[], targetState: TargetState): Transition {\n    return new Transition(fromPath, targetState, this._router);\n  }\n\n  /** @hidden */\n  private _defineCoreEvents() {\n    const Phase = TransitionHookPhase;\n    const TH = TransitionHook;\n    const paths = this._criteriaPaths;\n    const NORMAL_SORT = false,\n      REVERSE_SORT = true;\n    const SYNCHRONOUS = true;\n\n    this._defineEvent(\n      'onCreate',\n      Phase.CREATE,\n      0,\n      paths.to,\n      NORMAL_SORT,\n      TH.LOG_REJECTED_RESULT,\n      TH.THROW_ERROR,\n      SYNCHRONOUS\n    );\n\n    this._defineEvent('onBefore', Phase.BEFORE, 0, paths.to);\n\n    this._defineEvent('onStart', Phase.RUN, 0, paths.to);\n    this._defineEvent('onExit', Phase.RUN, 100, paths.exiting, REVERSE_SORT);\n    this._defineEvent('onRetain', Phase.RUN, 200, paths.retained);\n    this._defineEvent('onEnter', Phase.RUN, 300, paths.entering);\n    this._defineEvent('onFinish', Phase.RUN, 400, paths.to);\n\n    this._defineEvent(\n      'onSuccess',\n      Phase.SUCCESS,\n      0,\n      paths.to,\n      NORMAL_SORT,\n      TH.LOG_REJECTED_RESULT,\n      TH.LOG_ERROR,\n      SYNCHRONOUS\n    );\n    this._defineEvent(\n      'onError',\n      Phase.ERROR,\n      0,\n      paths.to,\n      NORMAL_SORT,\n      TH.LOG_REJECTED_RESULT,\n      TH.LOG_ERROR,\n      SYNCHRONOUS\n    );\n  }\n\n  /** @hidden */\n  private _defineCorePaths() {\n    const { STATE, TRANSITION } = TransitionHookScope;\n\n    this._definePathType('to', TRANSITION);\n    this._definePathType('from', TRANSITION);\n    this._definePathType('exiting', STATE);\n    this._definePathType('retained', STATE);\n    this._definePathType('entering', STATE);\n  }\n\n  /** @hidden */\n  _defineEvent(\n    name: string,\n    hookPhase: TransitionHookPhase,\n    hookOrder: number,\n    criteriaMatchPath: PathType,\n    reverseSort = false,\n    getResultHandler: GetResultHandler = TransitionHook.HANDLE_RESULT,\n    getErrorHandler: GetErrorHandler = TransitionHook.REJECT_ERROR,\n    synchronous = false\n  ) {\n    const eventType = new TransitionEventType(\n      name,\n      hookPhase,\n      hookOrder,\n      criteriaMatchPath,\n      reverseSort,\n      getResultHandler,\n      getErrorHandler,\n      synchronous\n    );\n\n    this._eventTypes.push(eventType);\n    makeEvent(this, this, eventType);\n  }\n\n  /** @hidden */\n  // tslint:disable-next-line\n  private _getEvents(phase?: TransitionHookPhase): TransitionEventType[] {\n    const transitionHookTypes = isDefined(phase)\n      ? this._eventTypes.filter(type => type.hookPhase === phase)\n      : this._eventTypes.slice();\n\n    return transitionHookTypes.sort((l, r) => {\n      const cmpByPhase = l.hookPhase - r.hookPhase;\n      return cmpByPhase === 0 ? l.hookOrder - r.hookOrder : cmpByPhase;\n    });\n  }\n\n  /**\n   * Adds a Path to be used as a criterion against a TreeChanges path\n   *\n   * For example: the `exiting` path in [[HookMatchCriteria]] is a STATE scoped path.\n   * It was defined by calling `defineTreeChangesCriterion('exiting', TransitionHookScope.STATE)`\n   * Each state in the exiting path is checked against the criteria and returned as part of the match.\n   *\n   * Another example: the `to` path in [[HookMatchCriteria]] is a TRANSITION scoped path.\n   * It was defined by calling `defineTreeChangesCriterion('to', TransitionHookScope.TRANSITION)`\n   * Only the tail of the `to` path is checked against the criteria and returned as part of the match.\n   *\n   * @hidden\n   */\n  private _definePathType(name: string, hookScope: TransitionHookScope) {\n    this._criteriaPaths[name] = { name, scope: hookScope };\n  }\n\n  /** * @hidden */\n  // tslint:disable-next-line\n  private _getPathTypes(): PathTypes {\n    return this._criteriaPaths;\n  }\n\n  /** @hidden */\n  public getHooks(hookName: string): RegisteredHook[] {\n    return this._registeredHooks[hookName];\n  }\n\n  /** @hidden */\n  private _registerCoreTransitionHooks() {\n    const fns = this._deregisterHookFns;\n\n    fns.addCoreResolves = registerAddCoreResolvables(this);\n    fns.ignored = registerIgnoredTransitionHook(this);\n    fns.invalid = registerInvalidTransitionHook(this);\n\n    // Wire up redirectTo hook\n    fns.redirectTo = registerRedirectToHook(this);\n\n    // Wire up onExit/Retain/Enter state hooks\n    fns.onExit = registerOnExitHook(this);\n    fns.onRetain = registerOnRetainHook(this);\n    fns.onEnter = registerOnEnterHook(this);\n\n    // Wire up Resolve hooks\n    fns.eagerResolve = registerEagerResolvePath(this);\n    fns.lazyResolve = registerLazyResolveState(this);\n    fns.resolveAll = registerResolveRemaining(this);\n\n    // Wire up the View management hooks\n    fns.loadViews = registerLoadEnteringViews(this);\n    fns.activateViews = registerActivateViews(this);\n\n    // Updates global state after a transition\n    fns.updateGlobals = registerUpdateGlobalState(this);\n\n    // After globals.current is updated at priority: 10000\n    fns.updateUrl = registerUpdateUrl(this);\n\n    // Lazy load state trees\n    fns.lazyLoad = registerLazyLoadHook(this);\n  }\n}\n","/**\n * @coreapi\n * @module state\n */\n/** */\nimport {\n  createProxyFunctions,\n  defaults,\n  extend,\n  inArray,\n  noop,\n  removeFrom,\n  silenceUncaughtInPromise,\n  silentRejection,\n} from '../common/common';\nimport { isDefined, isObject, isString } from '../common/predicates';\nimport { Queue } from '../common/queue';\nimport { services } from '../common/coreservices';\n\nimport { PathUtils } from '../path/pathUtils';\nimport { PathNode } from '../path/pathNode';\n\nimport { HookResult, TransitionOptions } from '../transition/interface';\nimport { defaultTransOpts } from '../transition/transitionService';\nimport { Rejection, RejectType } from '../transition/rejectFactory';\nimport { Transition } from '../transition/transition';\n\nimport { HrefOptions, LazyLoadResult, StateDeclaration, StateOrName, TransitionPromise } from './interface';\nimport { StateObject } from './stateObject';\nimport { TargetState } from './targetState';\n\nimport { RawParams } from '../params/interface';\nimport { Param } from '../params/param';\nimport { Glob } from '../common/glob';\nimport { UIRouter } from '../router';\nimport { UIInjector } from '../interface';\nimport { ResolveContext } from '../resolve/resolveContext';\nimport { lazyLoadState } from '../hooks/lazyLoad';\nimport { not, val } from '../common/hof';\nimport { StateParams } from '../params/stateParams';\n\nexport type OnInvalidCallback = (toState?: TargetState, fromState?: TargetState, injector?: UIInjector) => HookResult;\n\n/**\n * Provides state related service functions\n *\n * This class provides services related to ui-router states.\n * An instance of this class is located on the global [[UIRouter]] object.\n */\nexport class StateService {\n  /** @internalapi */\n  invalidCallbacks: OnInvalidCallback[] = [];\n\n  /**\n   * The [[Transition]] currently in progress (or null)\n   *\n   * This is a passthrough through to [[UIRouterGlobals.transition]]\n   */\n  get transition() {\n    return this.router.globals.transition;\n  }\n  /**\n   * The latest successful state parameters\n   *\n   * This is a passthrough through to [[UIRouterGlobals.params]]\n   */\n  get params(): StateParams {\n    return this.router.globals.params;\n  }\n  /**\n   * The current [[StateDeclaration]]\n   *\n   * This is a passthrough through to [[UIRouterGlobals.current]]\n   */\n  get current() {\n    return this.router.globals.current;\n  }\n  /**\n   * The current [[StateObject]]\n   *\n   * This is a passthrough through to [[UIRouterGlobals.$current]]\n   */\n  get $current() {\n    return this.router.globals.$current;\n  }\n\n  /** @internalapi */\n  constructor(private router: UIRouter) {\n    const getters = ['current', '$current', 'params', 'transition'];\n    const boundFns = Object.keys(StateService.prototype).filter(not(inArray(getters)));\n    createProxyFunctions(val(StateService.prototype), this, val(this), boundFns);\n  }\n\n  /** @internalapi */\n  dispose() {\n    this.defaultErrorHandler(noop);\n    this.invalidCallbacks = [];\n  }\n\n  /**\n   * Handler for when [[transitionTo]] is called with an invalid state.\n   *\n   * Invokes the [[onInvalid]] callbacks, in natural order.\n   * Each callback's return value is checked in sequence until one of them returns an instance of TargetState.\n   * The results of the callbacks are wrapped in $q.when(), so the callbacks may return promises.\n   *\n   * If a callback returns an TargetState, then it is used as arguments to $state.transitionTo() and the result returned.\n   *\n   * @internalapi\n   */\n  private _handleInvalidTargetState(fromPath: PathNode[], toState: TargetState) {\n    const fromState = PathUtils.makeTargetState(this.router.stateRegistry, fromPath);\n    const globals = this.router.globals;\n    const latestThing = () => globals.transitionHistory.peekTail();\n    const latest = latestThing();\n    const callbackQueue = new Queue<OnInvalidCallback>(this.invalidCallbacks.slice());\n    const injector = new ResolveContext(fromPath).injector();\n\n    const checkForRedirect = (result: HookResult) => {\n      if (!(result instanceof TargetState)) {\n        return;\n      }\n\n      let target = <TargetState>result;\n      // Recreate the TargetState, in case the state is now defined.\n      target = this.target(target.identifier(), target.params(), target.options());\n\n      if (!target.valid()) {\n        return Rejection.invalid(target.error()).toPromise();\n      }\n\n      if (latestThing() !== latest) {\n        return Rejection.superseded().toPromise();\n      }\n\n      return this.transitionTo(target.identifier(), target.params(), target.options());\n    };\n\n    function invokeNextCallback() {\n      const nextCallback = callbackQueue.dequeue();\n      if (nextCallback === undefined) return Rejection.invalid(toState.error()).toPromise();\n\n      const callbackResult = services.$q.when(nextCallback(toState, fromState, injector));\n      return callbackResult.then(checkForRedirect).then(result => result || invokeNextCallback());\n    }\n\n    return invokeNextCallback();\n  }\n\n  /**\n   * Registers an Invalid State handler\n   *\n   * Registers a [[OnInvalidCallback]] function to be invoked when [[StateService.transitionTo]]\n   * has been called with an invalid state reference parameter\n   *\n   * Example:\n   * ```js\n   * stateService.onInvalid(function(to, from, injector) {\n   *   if (to.name() === 'foo') {\n   *     let lazyLoader = injector.get('LazyLoadService');\n   *     return lazyLoader.load('foo')\n   *         .then(() => stateService.target('foo'));\n   *   }\n   * });\n   * ```\n   *\n   * @param {function} callback invoked when the toState is invalid\n   *   This function receives the (invalid) toState, the fromState, and an injector.\n   *   The function may optionally return a [[TargetState]] or a Promise for a TargetState.\n   *   If one is returned, it is treated as a redirect.\n   *\n   * @returns a function which deregisters the callback\n   */\n  onInvalid(callback: OnInvalidCallback): Function {\n    this.invalidCallbacks.push(callback);\n    return function deregisterListener() {\n      removeFrom(this.invalidCallbacks)(callback);\n    }.bind(this);\n  }\n\n  /**\n   * Reloads the current state\n   *\n   * A method that force reloads the current state, or a partial state hierarchy.\n   * All resolves are re-resolved, and components reinstantiated.\n   *\n   * #### Example:\n   * ```js\n   * let app angular.module('app', ['ui.router']);\n   *\n   * app.controller('ctrl', function ($scope, $state) {\n   *   $scope.reload = function(){\n   *     $state.reload();\n   *   }\n   * });\n   * ```\n   *\n   * Note: `reload()` is just an alias for:\n   *\n   * ```js\n   * $state.transitionTo($state.current, $state.params, {\n   *   reload: true, inherit: false\n   * });\n   * ```\n   *\n   * @param reloadState A state name or a state object.\n   *    If present, this state and all its children will be reloaded, but ancestors will not reload.\n   *\n   * #### Example:\n   * ```js\n   * //assuming app application consists of 3 states: 'contacts', 'contacts.detail', 'contacts.detail.item'\n   * //and current state is 'contacts.detail.item'\n   * let app angular.module('app', ['ui.router']);\n   *\n   * app.controller('ctrl', function ($scope, $state) {\n   *   $scope.reload = function(){\n   *     //will reload 'contact.detail' and nested 'contact.detail.item' states\n   *     $state.reload('contact.detail');\n   *   }\n   * });\n   * ```\n   *\n   * @returns A promise representing the state of the new transition. See [[StateService.go]]\n   */\n  reload(reloadState?: StateOrName): Promise<StateObject> {\n    return this.transitionTo(this.current, this.params, {\n      reload: isDefined(reloadState) ? reloadState : true,\n      inherit: false,\n      notify: false,\n    });\n  }\n\n  /**\n   * Transition to a different state and/or parameters\n   *\n   * Convenience method for transitioning to a new state.\n   *\n   * `$state.go` calls `$state.transitionTo` internally but automatically sets options to\n   * `{ location: true, inherit: true, relative: router.globals.$current, notify: true }`.\n   * This allows you to use either an absolute or relative `to` argument (because of `relative: router.globals.$current`).\n   * It also allows you to specify * only the parameters you'd like to update, while letting unspecified parameters\n   * inherit from the current parameter values (because of `inherit: true`).\n   *\n   * #### Example:\n   * ```js\n   * let app = angular.module('app', ['ui.router']);\n   *\n   * app.controller('ctrl', function ($scope, $state) {\n   *   $scope.changeState = function () {\n   *     $state.go('contact.detail');\n   *   };\n   * });\n   * ```\n   *\n   * @param to Absolute state name, state object, or relative state path (relative to current state).\n   *\n   * Some examples:\n   *\n   * - `$state.go('contact.detail')` - will go to the `contact.detail` state\n   * - `$state.go('^')` - will go to the parent state\n   * - `$state.go('^.sibling')` - if current state is `home.child`, will go to the `home.sibling` state\n   * - `$state.go('.child.grandchild')` - if current state is home, will go to the `home.child.grandchild` state\n   *\n   * @param params A map of the parameters that will be sent to the state, will populate $stateParams.\n   *\n   *    Any parameters that are not specified will be inherited from current parameter values (because of `inherit: true`).\n   *    This allows, for example, going to a sibling state that shares parameters defined by a parent state.\n   *\n   * @param options Transition options\n   *\n   * @returns {promise} A promise representing the state of the new transition.\n   */\n  go(to: StateOrName, params?: RawParams, options?: TransitionOptions): TransitionPromise {\n    const defautGoOpts = { relative: this.$current, inherit: true };\n    const transOpts = defaults(options, defautGoOpts, defaultTransOpts);\n    return this.transitionTo(to, params, transOpts);\n  }\n\n  /**\n   * Creates a [[TargetState]]\n   *\n   * This is a factory method for creating a TargetState\n   *\n   * This may be returned from a Transition Hook to redirect a transition, for example.\n   */\n  target(identifier: StateOrName, params?: RawParams, options: TransitionOptions = {}): TargetState {\n    // If we're reloading, find the state object to reload from\n    if (isObject(options.reload) && !(<any>options.reload).name) throw new Error('Invalid reload state object');\n    const reg = this.router.stateRegistry;\n    options.reloadState =\n      options.reload === true ? reg.root() : reg.matcher.find(<any>options.reload, options.relative);\n\n    if (options.reload && !options.reloadState)\n      throw new Error(\n        `No such reload state '${isString(options.reload) ? options.reload : (<any>options.reload).name}'`\n      );\n\n    return new TargetState(this.router.stateRegistry, identifier, params, options);\n  }\n\n  private getCurrentPath(): PathNode[] {\n    const globals = this.router.globals;\n    const latestSuccess: Transition = globals.successfulTransitions.peekTail();\n    const rootPath = () => [new PathNode(this.router.stateRegistry.root())];\n    return latestSuccess ? latestSuccess.treeChanges().to : rootPath();\n  }\n\n  /**\n   * Low-level method for transitioning to a new state.\n   *\n   * The [[go]] method (which uses `transitionTo` internally) is recommended in most situations.\n   *\n   * #### Example:\n   * ```js\n   * let app = angular.module('app', ['ui.router']);\n   *\n   * app.controller('ctrl', function ($scope, $state) {\n   *   $scope.changeState = function () {\n   *     $state.transitionTo('contact.detail');\n   *   };\n   * });\n   * ```\n   *\n   * @param to State name or state object.\n   * @param toParams A map of the parameters that will be sent to the state,\n   *      will populate $stateParams.\n   * @param options Transition options\n   *\n   * @returns A promise representing the state of the new transition. See [[go]]\n   */\n  transitionTo(to: StateOrName, toParams: RawParams = {}, options: TransitionOptions = {}): TransitionPromise {\n    const router = this.router;\n    const globals = router.globals;\n    options = defaults(options, defaultTransOpts);\n    const getCurrent = () => globals.transition;\n    options = extend(options, { current: getCurrent });\n\n    const ref: TargetState = this.target(to, toParams, options);\n    const currentPath = this.getCurrentPath();\n\n    if (!ref.exists()) return this._handleInvalidTargetState(currentPath, ref);\n\n    if (!ref.valid()) return <TransitionPromise>silentRejection(ref.error());\n\n    /**\n     * Special handling for Ignored, Aborted, and Redirected transitions\n     *\n     * The semantics for the transition.run() promise and the StateService.transitionTo()\n     * promise differ. For instance, the run() promise may be rejected because it was\n     * IGNORED, but the transitionTo() promise is resolved because from the user perspective\n     * no error occurred.  Likewise, the transition.run() promise may be rejected because of\n     * a Redirect, but the transitionTo() promise is chained to the new Transition's promise.\n     */\n    const rejectedTransitionHandler = (trans: Transition) => (error: any): Promise<any> => {\n      if (error instanceof Rejection) {\n        const isLatest = router.globals.lastStartedTransitionId === trans.$id;\n\n        if (error.type === RejectType.IGNORED) {\n          isLatest && router.urlRouter.update();\n          // Consider ignored `Transition.run()` as a successful `transitionTo`\n          return services.$q.when(globals.current);\n        }\n\n        const detail: any = error.detail;\n        if (error.type === RejectType.SUPERSEDED && error.redirected && detail instanceof TargetState) {\n          // If `Transition.run()` was redirected, allow the `transitionTo()` promise to resolve successfully\n          // by returning the promise for the new (redirect) `Transition.run()`.\n          const redirect: Transition = trans.redirect(detail);\n          return redirect.run().catch(rejectedTransitionHandler(redirect));\n        }\n\n        if (error.type === RejectType.ABORTED) {\n          isLatest && router.urlRouter.update();\n          return services.$q.reject(error);\n        }\n      }\n\n      const errorHandler = this.defaultErrorHandler();\n      errorHandler(error);\n\n      return services.$q.reject(error);\n    };\n\n    const transition = this.router.transitionService.create(currentPath, ref);\n    const transitionToPromise = transition.run().catch(rejectedTransitionHandler(transition));\n    silenceUncaughtInPromise(transitionToPromise); // issue #2676\n\n    // Return a promise for the transition, which also has the transition object on it.\n    return extend(transitionToPromise, { transition });\n  }\n\n  /**\n   * Checks if the current state *is* the provided state\n   *\n   * Similar to [[includes]] but only checks for the full state name.\n   * If params is supplied then it will be tested for strict equality against the current\n   * active params object, so all params must match with none missing and no extras.\n   *\n   * #### Example:\n   * ```js\n   * $state.$current.name = 'contacts.details.item';\n   *\n   * // absolute name\n   * $state.is('contact.details.item'); // returns true\n   * $state.is(contactDetailItemStateObject); // returns true\n   * ```\n   *\n   * // relative name (. and ^), typically from a template\n   * // E.g. from the 'contacts.details' template\n   * ```html\n   * <div ng-class=\"{highlighted: $state.is('.item')}\">Item</div>\n   * ```\n   *\n   * @param stateOrName The state name (absolute or relative) or state object you'd like to check.\n   * @param params A param object, e.g. `{sectionId: section.id}`, that you'd like\n   * to test against the current active state.\n   * @param options An options object. The options are:\n   *   - `relative`: If `stateOrName` is a relative state name and `options.relative` is set, .is will\n   *     test relative to `options.relative` state (or name).\n   *\n   * @returns Returns true if it is the state.\n   */\n  is(stateOrName: StateOrName, params?: RawParams, options?: { relative?: StateOrName }): boolean {\n    options = defaults(options, { relative: this.$current });\n    const state = this.router.stateRegistry.matcher.find(stateOrName, options.relative);\n    if (!isDefined(state)) return undefined;\n    if (this.$current !== state) return false;\n    if (!params) return true;\n\n    const schema: Param[] = state.parameters({ inherit: true, matchingKeys: params });\n    return Param.equals(schema, Param.values(schema, params), this.params);\n  }\n\n  /**\n   * Checks if the current state *includes* the provided state\n   *\n   * A method to determine if the current active state is equal to or is the child of the\n   * state stateName. If any params are passed then they will be tested for a match as well.\n   * Not all the parameters need to be passed, just the ones you'd like to test for equality.\n   *\n   * #### Example when `$state.$current.name === 'contacts.details.item'`\n   * ```js\n   * // Using partial names\n   * $state.includes(\"contacts\"); // returns true\n   * $state.includes(\"contacts.details\"); // returns true\n   * $state.includes(\"contacts.details.item\"); // returns true\n   * $state.includes(\"contacts.list\"); // returns false\n   * $state.includes(\"about\"); // returns false\n   * ```\n   *\n   * #### Glob Examples when `* $state.$current.name === 'contacts.details.item.url'`:\n   * ```js\n   * $state.includes(\"*.details.*.*\"); // returns true\n   * $state.includes(\"*.details.**\"); // returns true\n   * $state.includes(\"**.item.**\"); // returns true\n   * $state.includes(\"*.details.item.url\"); // returns true\n   * $state.includes(\"*.details.*.url\"); // returns true\n   * $state.includes(\"*.details.*\"); // returns false\n   * $state.includes(\"item.**\"); // returns false\n   * ```\n   *\n   * @param stateOrName A partial name, relative name, glob pattern,\n   *   or state object to be searched for within the current state name.\n   * @param params A param object, e.g. `{sectionId: section.id}`,\n   *   that you'd like to test against the current active state.\n   * @param options An options object. The options are:\n   *   - `relative`: If `stateOrName` is a relative state name and `options.relative` is set, .is will\n   *     test relative to `options.relative` state (or name).\n   *\n   * @returns {boolean} Returns true if it does include the state\n   */\n  includes(stateOrName: StateOrName, params?: RawParams, options?: TransitionOptions): boolean {\n    options = defaults(options, { relative: this.$current });\n    const glob = isString(stateOrName) && Glob.fromString(<string>stateOrName);\n\n    if (glob) {\n      if (!glob.matches(this.$current.name)) return false;\n      stateOrName = this.$current.name;\n    }\n    const state = this.router.stateRegistry.matcher.find(stateOrName, options.relative),\n      include = this.$current.includes;\n\n    if (!isDefined(state)) return undefined;\n    if (!isDefined(include[state.name])) return false;\n    if (!params) return true;\n\n    const schema: Param[] = state.parameters({ inherit: true, matchingKeys: params });\n    return Param.equals(schema, Param.values(schema, params), this.params);\n  }\n\n  /**\n   * Generates a URL for a state and parameters\n   *\n   * Returns the url for the given state populated with the given params.\n   *\n   * #### Example:\n   * ```js\n   * expect($state.href(\"about.person\", { person: \"bob\" })).toEqual(\"/about/bob\");\n   * ```\n   *\n   * @param stateOrName The state name or state object you'd like to generate a url from.\n   * @param params An object of parameter values to fill the state's required parameters.\n   * @param options Options object. The options are:\n   *\n   * @returns {string} compiled state url\n   */\n  href(stateOrName: StateOrName, params: RawParams, options?: HrefOptions): string {\n    const defaultHrefOpts = {\n      lossy: true,\n      inherit: true,\n      absolute: false,\n      relative: this.$current,\n    };\n    options = defaults(options, defaultHrefOpts);\n    params = params || {};\n\n    const state = this.router.stateRegistry.matcher.find(stateOrName, options.relative);\n\n    if (!isDefined(state)) return null;\n    if (options.inherit) params = <any>this.params.$inherit(params, this.$current, state);\n\n    const nav = state && options.lossy ? state.navigable : state;\n\n    if (!nav || nav.url === undefined || nav.url === null) {\n      return null;\n    }\n    return this.router.urlRouter.href(nav.url, params, {\n      absolute: options.absolute,\n    });\n  }\n\n  /** @hidden */\n  private _defaultErrorHandler: ((_error: any) => void) = function $defaultErrorHandler($error$) {\n    if ($error$ instanceof Error && $error$.stack) {\n      console.error($error$);\n      console.error($error$.stack);\n    } else if ($error$ instanceof Rejection) {\n      console.error($error$.toString());\n      if ($error$.detail && $error$.detail.stack) console.error($error$.detail.stack);\n    } else {\n      console.error($error$);\n    }\n  };\n\n  /**\n   * Sets or gets the default [[transitionTo]] error handler.\n   *\n   * The error handler is called when a [[Transition]] is rejected or when any error occurred during the Transition.\n   * This includes errors caused by resolves and transition hooks.\n   *\n   * Note:\n   * This handler does not receive certain Transition rejections.\n   * Redirected and Ignored Transitions are not considered to be errors by [[StateService.transitionTo]].\n   *\n   * The built-in default error handler logs the error to the console.\n   *\n   * You can provide your own custom handler.\n   *\n   * #### Example:\n   * ```js\n   * stateService.defaultErrorHandler(function() {\n   *   // Do not log transitionTo errors\n   * });\n   * ```\n   *\n   * @param handler a global error handler function\n   * @returns the current global error handler\n   */\n  defaultErrorHandler(handler?: (error: any) => void): (error: any) => void {\n    return (this._defaultErrorHandler = handler || this._defaultErrorHandler);\n  }\n\n  /**\n   * Gets a registered [[StateDeclaration]] object\n   *\n   * Returns the state declaration object for any specific state, or for all registered states.\n   *\n   * @param stateOrName (absolute or relative) If provided, will only get the declaration object for the requested state.\n   * If not provided, returns an array of ALL states.\n   * @param base When `stateOrName` is a relative state reference (such as `.bar.baz`), the state will be retrieved relative to this state.\n   *\n   * @returns a [[StateDeclaration]] object (or array of all registered [[StateDeclaration]] objects.)\n   */\n  get(stateOrName: StateOrName, base: StateOrName): StateDeclaration;\n  get(stateOrName: StateOrName): StateDeclaration;\n  get(): StateDeclaration[];\n  get(stateOrName?: StateOrName, base?: StateOrName): any {\n    const reg = this.router.stateRegistry;\n    if (arguments.length === 0) return reg.get();\n    return reg.get(stateOrName, base || this.$current);\n  }\n\n  /**\n   * Lazy loads a state\n   *\n   * Explicitly runs a state's [[StateDeclaration.lazyLoad]] function.\n   *\n   * @param stateOrName the state that should be lazy loaded\n   * @param transition the optional Transition context to use (if the lazyLoad function requires an injector, etc)\n   * Note: If no transition is provided, a noop transition is created using the from the current state to the current state.\n   * This noop transition is not actually run.\n   *\n   * @returns a promise to lazy load\n   */\n  lazyLoad(stateOrName: StateOrName, transition?: Transition): Promise<LazyLoadResult> {\n    const state: StateDeclaration = this.get(stateOrName);\n    if (!state || !state.lazyLoad) throw new Error('Can not lazy load ' + stateOrName);\n\n    const currentPath = this.getCurrentPath();\n    const target = PathUtils.makeTargetState(this.router.stateRegistry, currentPath);\n    transition = transition || this.router.transitionService.create(currentPath, target);\n\n    return lazyLoadState(transition, state);\n  }\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { isArray, isObject, $QLike } from '../common/index';\n\n/**\n * An angular1-like promise api\n *\n * This object implements four methods similar to the\n * [angular 1 promise api](https://docs.angularjs.org/api/ng/service/$q)\n *\n * UI-Router evolved from an angular 1 library to a framework agnostic library.\n * However, some of the `@uirouter/core` code uses these ng1 style APIs to support ng1 style dependency injection.\n *\n * This API provides native ES6 promise support wrapped as a $q-like API.\n * Internally, UI-Router uses this $q object to perform promise operations.\n * The `angular-ui-router` (ui-router for angular 1) uses the $q API provided by angular.\n *\n * $q-like promise api\n */\nexport const $q = {\n  /** Normalizes a value as a promise */\n  when: val => new Promise((resolve, reject) => resolve(val)),\n\n  /** Normalizes a value as a promise rejection */\n  reject: val =>\n    new Promise((resolve, reject) => {\n      reject(val);\n    }),\n\n  /** @returns a deferred object, which has `resolve` and `reject` functions */\n  defer: () => {\n    const deferred: any = {};\n    deferred.promise = new Promise((resolve, reject) => {\n      deferred.resolve = resolve;\n      deferred.reject = reject;\n    });\n    return deferred;\n  },\n\n  /** Like Promise.all(), but also supports object key/promise notation like $q */\n  all: (promises: { [key: string]: Promise<any> } | Promise<any>[]) => {\n    if (isArray(promises)) {\n      return Promise.all(promises);\n    }\n\n    if (isObject(promises)) {\n      // Convert promises map to promises array.\n      // When each promise resolves, map it to a tuple { key: key, val: val }\n      const chain = Object.keys(promises).map(key => promises[key].then(val => ({ key, val })));\n\n      // Then wait for all promises to resolve, and convert them back to an object\n      return $q.all(chain).then(values =>\n        values.reduce((acc, tuple) => {\n          acc[tuple.key] = tuple.val;\n          return acc;\n        }, {})\n      );\n    }\n  },\n} as $QLike;\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport {\n  extend,\n  assertPredicate,\n  isFunction,\n  isArray,\n  isInjectable,\n  $InjectorLike,\n  IInjectable,\n} from '../common/index';\n\n// globally available injectables\nconst globals = {};\nconst STRIP_COMMENTS = /((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/gm;\nconst ARGUMENT_NAMES = /([^\\s,]+)/g;\n\n/**\n * A basic angular1-like injector api\n *\n * This object implements four methods similar to the\n * [angular 1 dependency injector](https://docs.angularjs.org/api/auto/service/$injector)\n *\n * UI-Router evolved from an angular 1 library to a framework agnostic library.\n * However, some of the `@uirouter/core` code uses these ng1 style APIs to support ng1 style dependency injection.\n *\n * This object provides a naive implementation of a globally scoped dependency injection system.\n * It supports the following DI approaches:\n *\n * ### Function parameter names\n *\n * A function's `.toString()` is called, and the parameter names are parsed.\n * This only works when the parameter names aren't \"mangled\" by a minifier such as UglifyJS.\n *\n * ```js\n * function injectedFunction(FooService, BarService) {\n *   // FooService and BarService are injected\n * }\n * ```\n *\n * ### Function annotation\n *\n * A function may be annotated with an array of dependency names as the `$inject` property.\n *\n * ```js\n * injectedFunction.$inject = [ 'FooService', 'BarService' ];\n * function injectedFunction(fs, bs) {\n *   // FooService and BarService are injected as fs and bs parameters\n * }\n * ```\n *\n * ### Array notation\n *\n * An array provides the names of the dependencies to inject (as strings).\n * The function is the last element of the array.\n *\n * ```js\n * [ 'FooService', 'BarService', function (fs, bs) {\n *   // FooService and BarService are injected as fs and bs parameters\n * }]\n * ```\n *\n * @type {$InjectorLike}\n */\nexport const $injector = {\n  /** Gets an object from DI based on a string token */\n  get: name => globals[name],\n\n  /** Returns true if an object named `name` exists in global DI */\n  has: name => $injector.get(name) != null,\n\n  /**\n   * Injects a function\n   *\n   * @param fn the function to inject\n   * @param context the function's `this` binding\n   * @param locals An object with additional DI tokens and values, such as `{ someToken: { foo: 1 } }`\n   */\n  invoke: (fn: IInjectable, context?, locals?) => {\n    const all = extend({}, globals, locals || {});\n    const params = $injector.annotate(fn);\n    const ensureExist = assertPredicate(\n      (key: string) => all.hasOwnProperty(key),\n      key => `DI can't find injectable: '${key}'`\n    );\n    const args = params.filter(ensureExist).map(x => all[x]);\n    if (isFunction(fn)) return fn.apply(context, args);\n    else return (fn as any[]).slice(-1)[0].apply(context, args);\n  },\n\n  /**\n   * Returns a function's dependencies\n   *\n   * Analyzes a function (or array) and returns an array of DI tokens that the function requires.\n   * @return an array of `string`s\n   */\n  annotate: (fn: IInjectable): any[] => {\n    if (!isInjectable(fn)) throw new Error(`Not an injectable function: ${fn}`);\n    if (fn && (fn as any).$inject) return (fn as any).$inject;\n    if (isArray(fn)) return fn.slice(0, -1);\n    const fnStr = fn.toString().replace(STRIP_COMMENTS, '');\n    const result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);\n    return result || [];\n  },\n} as $InjectorLike;\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport {\n  LocationConfig,\n  LocationServices,\n  identity,\n  unnestR,\n  isArray,\n  splitEqual,\n  splitHash,\n  splitQuery,\n} from '../common';\nimport { UIRouter } from '../router';\n\nexport const keyValsToObjectR = (accum, [key, val]) => {\n  if (!accum.hasOwnProperty(key)) {\n    accum[key] = val;\n  } else if (isArray(accum[key])) {\n    accum[key].push(val);\n  } else {\n    accum[key] = [accum[key], val];\n  }\n  return accum;\n};\n\nexport const getParams = (queryString: string): any =>\n  queryString\n    .split('&')\n    .filter(identity)\n    .map(splitEqual)\n    .reduce(keyValsToObjectR, {});\n\nexport function parseUrl(url: string) {\n  const orEmptyString = x => x || '';\n  const [beforehash, hash] = splitHash(url).map(orEmptyString);\n  const [path, search] = splitQuery(beforehash).map(orEmptyString);\n\n  return { path, search, hash, url };\n}\n\nexport const buildUrl = (loc: LocationServices) => {\n  const path = loc.path();\n  const searchObject = loc.search();\n  const hash = loc.hash();\n\n  const search = Object.keys(searchObject)\n    .map(key => {\n      const param = searchObject[key];\n      const vals = isArray(param) ? param : [param];\n      return vals.map(val => key + '=' + val);\n    })\n    .reduce(unnestR, [])\n    .join('&');\n\n  return path + (search ? '?' + search : '') + (hash ? '#' + hash : '');\n};\n\nexport function locationPluginFactory(\n  name: string,\n  isHtml5: boolean,\n  serviceClass: { new (uiRouter?: UIRouter): LocationServices },\n  configurationClass: { new (uiRouter?: UIRouter, isHtml5?: boolean): LocationConfig }\n) {\n  return function(uiRouter: UIRouter) {\n    const service = (uiRouter.locationService = new serviceClass(uiRouter));\n    const configuration = (uiRouter.locationConfig = new configurationClass(uiRouter, isHtml5));\n\n    function dispose(router: UIRouter) {\n      router.dispose(service);\n      router.dispose(configuration);\n    }\n\n    return { name, service, configuration, dispose };\n  };\n}\n","/**\n * @internalapi\n * @module vanilla\n */ /** */\n\nimport { deregAll, isDefined, LocationServices, removeFrom, root } from '../common';\nimport { Disposable } from '../interface';\nimport { UIRouter } from '../router';\nimport { HistoryLike, LocationLike } from './interface';\nimport { buildUrl, getParams, parseUrl } from './utils';\n\n/** A base `LocationServices` */\nexport abstract class BaseLocationServices implements LocationServices, Disposable {\n  private _listeners: Function[] = [];\n  _location: LocationLike;\n  _history: HistoryLike;\n\n  _listener = evt => this._listeners.forEach(cb => cb(evt));\n\n  constructor(router: UIRouter, public fireAfterUpdate: boolean) {\n    this._location = root.location;\n    this._history = root.history;\n  }\n\n  /**\n   * This should return the current internal URL representation.\n   *\n   * The internal URL includes only the portion that UI-Router matches.\n   * It does not include:\n   * - protocol\n   * - server\n   * - port\n   * - base href or hash\n   */\n  protected abstract _get(): string;\n\n  /**\n   * This should set the current URL.\n   *\n   * The `url` param should include only the portion that UI-Router matches on.\n   * It should not include:\n   * - protocol\n   * - server\n   * - port\n   * - base href or hash\n   *\n   * However, after this function completes, the browser URL should reflect the entire (fully qualified)\n   * HREF including those data.\n   */\n  protected abstract _set(state: any, title: string, url: string, replace: boolean);\n\n  hash = () => parseUrl(this._get()).hash;\n  path = () => parseUrl(this._get()).path;\n  search = () => getParams(parseUrl(this._get()).search);\n\n  url(url?: string, replace = true): string {\n    if (isDefined(url) && url !== this._get()) {\n      this._set(null, null, url, replace);\n\n      if (this.fireAfterUpdate) {\n        this._listeners.forEach(cb => cb({ url }));\n      }\n    }\n\n    return buildUrl(this);\n  }\n\n  onChange(cb: EventListener) {\n    this._listeners.push(cb);\n    return () => removeFrom(this._listeners, cb);\n  }\n\n  dispose(router: UIRouter) {\n    deregAll(this._listeners);\n  }\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { root, trimHashVal } from '../common';\nimport { UIRouter } from '../router';\nimport { BaseLocationServices } from './baseLocationService';\n\n/** A `LocationServices` that uses the browser hash \"#\" to get/set the current location */\nexport class HashLocationService extends BaseLocationServices {\n  constructor(router: UIRouter) {\n    super(router, false);\n    root.addEventListener('hashchange', this._listener, false);\n  }\n\n  _get() {\n    return trimHashVal(this._location.hash);\n  }\n  _set(state: any, title: string, url: string, replace: boolean) {\n    this._location.hash = url;\n  }\n\n  dispose(router: UIRouter) {\n    super.dispose(router);\n    root.removeEventListener('hashchange', this._listener);\n  }\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { BaseLocationServices } from './baseLocationService';\nimport { UIRouter } from '../router';\n\n/** A `LocationServices` that gets/sets the current location from an in-memory object */\nexport class MemoryLocationService extends BaseLocationServices {\n  _url: string;\n\n  constructor(router: UIRouter) {\n    super(router, true);\n  }\n\n  _get() {\n    return this._url;\n  }\n\n  _set(state: any, title: string, url: string, replace: boolean) {\n    this._url = url;\n  }\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { UIRouter } from '../router';\nimport { BaseLocationServices } from './baseLocationService';\nimport { LocationConfig, root, splitHash, splitQuery, stripLastPathElement } from '../common';\n\n/**\n * A `LocationServices` that gets/sets the current location using the browser's `location` and `history` apis\n *\n * Uses `history.pushState` and `history.replaceState`\n */\nexport class PushStateLocationService extends BaseLocationServices {\n  _config: LocationConfig;\n\n  constructor(router: UIRouter) {\n    super(router, true);\n    this._config = router.urlService.config;\n    root.addEventListener('popstate', this._listener, false);\n  }\n\n  /**\n   * Gets the base prefix without:\n   * - trailing slash\n   * - trailing filename\n   * - protocol and hostname\n   *\n   * If <base href='/base/'>, this returns '/base'.\n   * If <base href='/foo/base/'>, this returns '/foo/base'.\n   * If <base href='/base/index.html'>, this returns '/base'.\n   * If <base href='http://localhost:8080/base/index.html'>, this returns '/base'.\n   * If <base href='/base'>, this returns ''.\n   * If <base href='http://localhost:8080'>, this returns ''.\n   * If <base href='http://localhost:8080/'>, this returns ''.\n   *\n   * See: https://html.spec.whatwg.org/dev/semantics.html#the-base-element\n   */\n  private _getBasePrefix() {\n    return stripLastPathElement(this._config.baseHref());\n  }\n\n  protected _get() {\n    let { pathname, hash, search } = this._location;\n    search = splitQuery(search)[1]; // strip ? if found\n    hash = splitHash(hash)[1]; // strip # if found\n\n    const basePrefix = this._getBasePrefix();\n    const exactBaseHrefMatch = pathname === this._config.baseHref();\n    const startsWithBase = pathname.substr(0, basePrefix.length) === basePrefix;\n    pathname = exactBaseHrefMatch ? '/' : startsWithBase ? pathname.substring(basePrefix.length) : pathname;\n\n    return pathname + (search ? '?' + search : '') + (hash ? '#' + hash : '');\n  }\n\n  protected _set(state: any, title: string, url: string, replace: boolean) {\n    const basePrefix = this._getBasePrefix();\n    const slash = url && url[0] !== '/' ? '/' : '';\n    const fullUrl = url === '' || url === '/' ? this._config.baseHref() : basePrefix + slash + url;\n\n    if (replace) {\n      this._history.replaceState(state, title, fullUrl);\n    } else {\n      this._history.pushState(state, title, fullUrl);\n    }\n  }\n\n  public dispose(router: UIRouter) {\n    super.dispose(router);\n    root.removeEventListener('popstate', this._listener);\n  }\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { LocationConfig } from '../common/coreservices';\nimport { isDefined } from '../common/predicates';\nimport { noop } from '../common/common';\n\n/** A `LocationConfig` mock that gets/sets all config from an in-memory object */\nexport class MemoryLocationConfig implements LocationConfig {\n  dispose = noop;\n\n  _baseHref = '';\n  _port = 80;\n  _protocol = 'http';\n  _host = 'localhost';\n  _hashPrefix = '';\n\n  port = () => this._port;\n  protocol = () => this._protocol;\n  host = () => this._host;\n  baseHref = () => this._baseHref;\n  html5Mode = () => false;\n  hashPrefix = (newval?) => (isDefined(newval) ? (this._hashPrefix = newval) : this._hashPrefix);\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { isDefined, isUndefined } from '../common/predicates';\nimport { LocationConfig } from '../common/coreservices';\n\n/** A `LocationConfig` that delegates to the browser's `location` object */\nexport class BrowserLocationConfig implements LocationConfig {\n  private _baseHref = undefined;\n  private _hashPrefix = '';\n\n  constructor(router?, private _isHtml5 = false) {}\n\n  port(): number {\n    if (location.port) {\n      return Number(location.port);\n    }\n\n    return this.protocol() === 'https' ? 443 : 80;\n  }\n\n  protocol(): string {\n    return location.protocol.replace(/:/g, '');\n  }\n\n  host(): string {\n    return location.hostname;\n  }\n\n  html5Mode(): boolean {\n    return this._isHtml5;\n  }\n\n  hashPrefix(): string;\n  hashPrefix(newprefix?: string): string {\n    return isDefined(newprefix) ? (this._hashPrefix = newprefix) : this._hashPrefix;\n  }\n\n  baseHref(href?: string): string {\n    if (isDefined(href)) this._baseHref = href;\n    if (isUndefined(this._baseHref)) this._baseHref = this.getBaseHref();\n    return this._baseHref;\n  }\n\n  private getBaseHref() {\n    const baseTag: HTMLBaseElement = document.getElementsByTagName('base')[0];\n    if (!baseTag || !baseTag.href) return location.pathname || '/';\n    return baseTag.href.replace(/^(https?:)?\\/\\/[^/]*/, '');\n  }\n\n  dispose() {}\n}\n","/**\n * @internalapi\n * @module vanilla\n */\n/** */\nimport { BrowserLocationConfig } from './browserLocationConfig';\nimport { HashLocationService } from './hashLocationService';\nimport { locationPluginFactory } from './utils';\nimport { LocationPlugin, ServicesPlugin } from './interface';\nimport { UIRouter } from '../router';\nimport { PushStateLocationService } from './pushStateLocationService';\nimport { MemoryLocationService } from './memoryLocationService';\nimport { MemoryLocationConfig } from './memoryLocationConfig';\nimport { $injector } from './injector';\nimport { $q } from './q';\nimport { services } from '../common/coreservices';\n\nexport function servicesPlugin(router: UIRouter): ServicesPlugin {\n  services.$injector = $injector;\n  services.$q = $q;\n\n  return { name: 'vanilla.services', $q, $injector, dispose: () => null };\n}\n\n/** A `UIRouterPlugin` uses the browser hash to get/set the current location */\nexport const hashLocationPlugin: (router: UIRouter) => LocationPlugin = locationPluginFactory(\n  'vanilla.hashBangLocation',\n  false,\n  HashLocationService,\n  BrowserLocationConfig\n);\n\n/** A `UIRouterPlugin` that gets/sets the current location using the browser's `location` and `history` apis */\nexport const pushStateLocationPlugin: (router: UIRouter) => LocationPlugin = locationPluginFactory(\n  'vanilla.pushStateLocation',\n  true,\n  PushStateLocationService,\n  BrowserLocationConfig\n);\n\n/** A `UIRouterPlugin` that gets/sets the current location from an in-memory object */\nexport const memoryLocationPlugin: (router: UIRouter) => LocationPlugin = locationPluginFactory(\n  'vanilla.memoryLocation',\n  false,\n  MemoryLocationService,\n  MemoryLocationConfig\n);\n","/**\n * # Core classes and interfaces\n *\n * The classes and interfaces that are core to ui-router and do not belong\n * to a more specific subsystem (such as resolve).\n *\n * @coreapi\n * @preferred\n * @module core\n */ /** for typedoc */\n\n// Need to import or export at least one concrete something\nimport { noop } from './common/common';\nimport { UIRouter } from './router';\n\n/**\n * An interface for getting values from dependency injection.\n *\n * This is primarily used to get resolve values for a given token.\n * An instance of the `UIInjector` can be retrieved from the current transition using [[Transition.injector]].\n *\n * ---\n *\n * If no resolve is found for a token, then it will delegate to the native injector.\n * The native injector may be Angular 1 `$injector`, Angular 2 `Injector`, or a simple polyfill.\n *\n * In Angular 2, the native injector might be the root Injector,\n * or it might be a lazy loaded `NgModule` injector scoped to a lazy load state tree.\n */\nexport interface UIInjector {\n  /**\n   * Gets a value from the injector.\n   *\n   * For a given token, returns the value from the injector that matches the token.\n   * If the token is for a resolve that has not yet been fetched, this throws an error.\n   *\n   * #### Example:\n   * ```js\n   * var myResolve = injector.get('myResolve');\n   * ```\n   *\n   * #### ng1 Example:\n   * ```js\n   * // Fetch StateService\n   * injector.get('$state').go('home');\n   * ```\n   *\n   * #### ng2 Example:\n   * ```js\n   * import {StateService} from \"ui-router-ng2\";\n   * // Fetch StateService\n   * injector.get(StateService).go('home');\n   * ```\n   *\n   * #### Typescript Example:\n   * ```js\n   * var stringArray = injector.get<string[]>('myStringArray');\n   * ```\n   *\n   * ### `NOWAIT` policy\n   *\n   * When using [[ResolvePolicy.async]] === `NOWAIT`, the value returned from `get()` is a promise for the result.\n   * The promise is not automatically unwrapped.\n   *\n   * @param token the key for the value to get.  May be a string, a class, or any arbitrary object.\n   * @return the Dependency Injection value that matches the token\n   */\n  get(token: any): any;\n  /** Gets a value as type `T` (generics parameter) */\n  get<T>(token: any): T;\n\n  /**\n   * Asynchronously gets a value from the injector\n   *\n   * For a given token, returns a promise for the value from the injector that matches the token.\n   * If the token is for a resolve that has not yet been fetched, this triggers the resolve to load.\n   *\n   * #### Example:\n   * ```js\n   * return injector.getAsync('myResolve').then(value => {\n   *   if (value === 'declined') return false;\n   * });\n   * ```\n   *\n   * @param token the key for the value to get.  May be a string or arbitrary object.\n   * @return a Promise for the Dependency Injection value that matches the token\n   */\n  getAsync(token: any): Promise<any>;\n  /** Asynchronously gets a value as type `T` (generics parameter) */\n  getAsync<T>(token: any): Promise<T>;\n\n  /**\n   * Gets a value from the native injector\n   *\n   * Returns a value from the native injector, bypassing anything in the [[ResolveContext]].\n   *\n   * Example:\n   * ```js\n   * let someThing = injector.getNative(SomeToken);\n   * ```\n   *\n   * @param token the key for the value to get.  May be a string or arbitrary object.\n   * @return the Dependency Injection value that matches the token\n   */\n  getNative(token: any): any;\n  getNative<T>(token: any): T;\n}\n\n/** @internalapi */\nexport interface UIRouterPlugin extends Disposable {\n  name: string;\n}\n\n/** @internalapi */\nexport abstract class UIRouterPluginBase implements UIRouterPlugin, Disposable {\n  abstract name: string;\n  dispose(router: UIRouter) {}\n}\n\n/** @internalapi */\nexport interface Disposable {\n  /** Instructs the Disposable to clean up any resources */\n  dispose(router?: UIRouter);\n}\n","import { pushStateLocationPlugin, servicesPlugin, UIRouter } from '@uirouter/core';\nimport { Visualizer } from '@uirouter/visualizer';\n\nfunction naiveRenderIntoDom(stateDef, shadowRoot) {\n  var state = stateDef.$$state();\n  var parentId = state.parent.name || 'root';\n  console.log(`rendering into ${parentId}`)\n  var parent = shadowRoot.getElementById(parentId);\n  parent.innerHTML = state.html;\n}\n\nfunction naiveClearRenderedDom(stateDef, shadowRoot) {\n  var state = stateDef.$$state();\n  var parentId = state.parent.name || 'root';\n  console.log(`clearing ${parentId}`)\n  var parent = shadowRoot.getElementById(parentId);\n  parent.innerHTML = ``;\n}\n\nexport function createRouter(shadowRoot) {\n  const router = new UIRouter();\n\n  router.plugin(Visualizer);\n  router.plugin(pushStateLocationPlugin);\n  router.plugin(servicesPlugin);\n\n  // This transition hook renders each active states' html property\n  router.transitionService.onSuccess({}, (trans, state) => {\n    trans.exiting().forEach(stateDef => naiveClearRenderedDom(stateDef, shadowRoot));\n    trans.entering().forEach(stateDef => naiveRenderIntoDom(stateDef, shadowRoot));\n  });\n\n  // Register states\n  router.stateRegistry.register({ name: 'intro', url: '/bike-app', html:  'INTRO <a href=\"javascript:void(0)\" data-path=\"page1\">page 1</a>' });\n  router.stateRegistry.register({ name: 'page1', url: '/bike-app/page1', html: 'PAGE 1 <a href=\"javascript:void(0)\" data-path=\"intro\">back to intro</a>' });\n\n  // Start the router\n  router.trace.enable(1);\n  router.urlService.rules.initial({ state: 'intro' });\n  router.urlService.listen();\n  router.urlService.sync();\n\n  return router;\n}\n","import { createRouter } from './router';\n\nexport class BikeApp extends HTMLElement {\n  router;\n\n  constructor() {\n    super();\n\n    const shadow = this.attachShadow({mode: 'open'});\n    const div = document.createElement('div');\n    div.innerHTML = '<ui-view id=\"root\"></ui-view>';\n    shadow.appendChild(div);\n  }\n\n  connectedCallback() {\n    console.log('bike-app custom element connected with window', window);\n\n    this.router = createRouter(this.shadowRoot);\n\n    this.shadowRoot.addEventListener('click', event => {\n      const path = event.path[0].dataset.path;\n      if (path) {\n        this.navigate(path);\n      }\n    });\n\n    this.addEventListener('navigate', (event) => {\n      this.router.stateService.go(event.detail.path);\n    });\n  }\n\n  navigate(path) {\n    this.dispatchEvent(new CustomEvent('navigate', { detail: { path }}));\n  }\n}\n","import { BikeApp } from './bike-app';\n\nexport function bootstrap() {\n  return Promise.resolve();\n}\n\nexport function mount() {\n  customElements.define('bike-app', BikeApp);\n  return Promise.resolve()\n    .then(() => document.getElementById('content').innerHTML = '<bike-app></bike-app>');\n}\n\nexport function unmount() {\n  return Promise.resolve()\n    .then(() => {\n      document.getElementById('content').innerHTML = '';\n    });\n}\n","/**\n * Random utility functions used in the UI-Router code\n *\n * These functions are exported, but are subject to change without notice.\n *\n * @preferred\n * @module common\n */\n/** for typedoc */\nimport { isFunction, isString, isArray, isRegExp, isDate } from './predicates';\nimport { all, any, prop, curry, not } from './hof';\nimport { services } from './coreservices';\nimport { StateObject } from '../state/stateObject';\n\ndeclare const global;\nexport const root: any =\n  (typeof self === 'object' && self.self === self && self) ||\n  (typeof global === 'object' && global.global === global && global) ||\n  this;\nconst angular = root.angular || {};\n\nexport const fromJson = angular.fromJson || JSON.parse.bind(JSON);\nexport const toJson = angular.toJson || JSON.stringify.bind(JSON);\nexport const forEach = angular.forEach || _forEach;\nexport const extend = Object.assign || _extend;\nexport const equals = angular.equals || _equals;\nexport function identity(x: any) {\n  return x;\n}\nexport function noop(): any {}\n\nexport type Mapper<X, T> = (x: X, key?: string | number) => T;\nexport interface TypedMap<T> {\n  [key: string]: T;\n}\nexport type Predicate<X> = (x?: X) => boolean;\n/**\n * An ng1-style injectable\n *\n * This could be a (non-minified) function such as:\n * ```js\n * function injectableFunction(SomeDependency) {\n *\n * }\n * ```\n *\n * or an explicitly annotated function (minify safe)\n * ```js\n * injectableFunction.$inject = [ 'SomeDependency' ];\n * function injectableFunction(SomeDependency) {\n *\n * }\n * ```\n *\n * or an array style annotated function (minify safe)\n * ```js\n * ['SomeDependency', function injectableFunction(SomeDependency) {\n *\n * }];\n * ```\n *\n * @publicapi\n */\nexport type IInjectable = Function | any[];\n\nexport interface Obj extends Object {\n  [key: string]: any;\n}\n\n/**\n * Builds proxy functions on the `to` object which pass through to the `from` object.\n *\n * For each key in `fnNames`, creates a proxy function on the `to` object.\n * The proxy function calls the real function on the `from` object.\n *\n *\n * #### Example:\n * This example creates an new class instance whose functions are prebound to the new'd object.\n * ```js\n * class Foo {\n *   constructor(data) {\n *     // Binds all functions from Foo.prototype to 'this',\n *     // then copies them to 'this'\n *     bindFunctions(Foo.prototype, this, this);\n *     this.data = data;\n *   }\n *\n *   log() {\n *     console.log(this.data);\n *   }\n * }\n *\n * let myFoo = new Foo([1,2,3]);\n * var logit = myFoo.log;\n * logit(); // logs [1, 2, 3] from the myFoo 'this' instance\n * ```\n *\n * #### Example:\n * This example creates a bound version of a service function, and copies it to another object\n * ```\n *\n * var SomeService = {\n *   this.data = [3, 4, 5];\n *   this.log = function() {\n *     console.log(this.data);\n *   }\n * }\n *\n * // Constructor fn\n * function OtherThing() {\n *   // Binds all functions from SomeService to SomeService,\n *   // then copies them to 'this'\n *   bindFunctions(SomeService, this, SomeService);\n * }\n *\n * let myOtherThing = new OtherThing();\n * myOtherThing.log(); // logs [3, 4, 5] from SomeService's 'this'\n * ```\n *\n * @param source A function that returns the source object which contains the original functions to be bound\n * @param target A function that returns the target object which will receive the bound functions\n * @param bind A function that returns the object which the functions will be bound to\n * @param fnNames The function names which will be bound (Defaults to all the functions found on the 'from' object)\n * @param latebind If true, the binding of the function is delayed until the first time it's invoked\n */\nexport function createProxyFunctions(\n  source: Function,\n  target: Obj,\n  bind: Function,\n  fnNames?: string[],\n  latebind = false\n): Obj {\n  const bindFunction = fnName => source()[fnName].bind(bind());\n\n  const makeLateRebindFn = fnName =>\n    function lateRebindFunction() {\n      target[fnName] = bindFunction(fnName);\n      return target[fnName].apply(null, arguments);\n    };\n\n  fnNames = fnNames || Object.keys(source());\n\n  return fnNames.reduce((acc, name) => {\n    acc[name] = latebind ? makeLateRebindFn(name) : bindFunction(name);\n    return acc;\n  }, target);\n}\n\n/**\n * prototypal inheritance helper.\n * Creates a new object which has `parent` object as its prototype, and then copies the properties from `extra` onto it\n */\nexport const inherit = (parent: Obj, extra?: Obj) => extend(Object.create(parent), extra);\n\n/** Given an array, returns true if the object is found in the array, (using indexOf) */\nexport const inArray: typeof _inArray = curry(_inArray) as any;\nexport function _inArray(array: any[], obj: any): boolean;\nexport function _inArray(array: any[]): (obj: any) => boolean;\nexport function _inArray(array, obj?): any {\n  return array.indexOf(obj) !== -1;\n}\n\n/**\n * Given an array, and an item, if the item is found in the array, it removes it (in-place).\n * The same array is returned\n */\nexport const removeFrom: typeof _removeFrom = curry(_removeFrom) as any;\nexport function _removeFrom<T>(array: T[], obj: T): T[];\nexport function _removeFrom<T>(array: T[]): (obj: T) => T[];\nexport function _removeFrom(array, obj?) {\n  const idx = array.indexOf(obj);\n  if (idx >= 0) array.splice(idx, 1);\n  return array;\n}\n\n/** pushes a values to an array and returns the value */\nexport const pushTo: typeof _pushTo = curry(_pushTo) as any;\nexport function _pushTo<T>(arr: T[], val: T): T;\nexport function _pushTo<T>(arr: T[]): (val: T) => T;\nexport function _pushTo(arr, val?): any {\n  return arr.push(val), val;\n}\n\n/** Given an array of (deregistration) functions, calls all functions and removes each one from the source array */\nexport const deregAll = (functions: Function[]) =>\n  functions.slice().forEach(fn => {\n    typeof fn === 'function' && fn();\n    removeFrom(functions, fn);\n  });\n/**\n * Applies a set of defaults to an options object.  The options object is filtered\n * to only those properties of the objects in the defaultsList.\n * Earlier objects in the defaultsList take precedence when applying defaults.\n */\nexport function defaults(opts, ...defaultsList: Obj[]) {\n  const defaultVals = extend({}, ...defaultsList.reverse());\n  return extend(defaultVals, pick(opts || {}, Object.keys(defaultVals)));\n}\n\n/** Reduce function that merges each element of the list into a single object, using extend */\nexport const mergeR = (memo: Obj, item: Obj) => extend(memo, item);\n\n/**\n * Finds the common ancestor path between two states.\n *\n * @param {Object} first The first state.\n * @param {Object} second The second state.\n * @return {Array} Returns an array of state names in descending order, not including the root.\n */\nexport function ancestors(first: StateObject, second: StateObject) {\n  const path: StateObject[] = [];\n\n  // tslint:disable-next-line:forin\n  for (const n in first.path) {\n    if (first.path[n] !== second.path[n]) break;\n    path.push(first.path[n]);\n  }\n  return path;\n}\n\n/**\n * Return a copy of the object only containing the whitelisted properties.\n *\n * #### Example:\n * ```\n * var foo = { a: 1, b: 2, c: 3 };\n * var ab = pick(foo, ['a', 'b']); // { a: 1, b: 2 }\n * ```\n * @param obj the source object\n * @param propNames an Array of strings, which are the whitelisted property names\n */\nexport function pick(obj: Obj, propNames: string[]): Obj {\n  const objCopy = {};\n  for (const _prop in obj) {\n    if (propNames.indexOf(_prop) !== -1) {\n      objCopy[_prop] = obj[_prop];\n    }\n  }\n  return objCopy;\n}\n\n/**\n * Return a copy of the object omitting the blacklisted properties.\n *\n * @example\n * ```\n *\n * var foo = { a: 1, b: 2, c: 3 };\n * var ab = omit(foo, ['a', 'b']); // { c: 3 }\n * ```\n * @param obj the source object\n * @param propNames an Array of strings, which are the blacklisted property names\n */\nexport function omit(obj: Obj, propNames: string[]): Obj {\n  return Object.keys(obj)\n    .filter(not(inArray(propNames)))\n    .reduce((acc, key) => ((acc[key] = obj[key]), acc), {});\n}\n\n/** Given an array of objects, maps each element to a named property of the element. */\nexport function pluck<T>(collection: Obj[], propName: string): T[];\n/** Given an object, maps each property of the object to a named property of the property. */\nexport function pluck(collection: { [key: string]: any }, propName: string): { [key: string]: any };\n/**\n * Maps an array, or object to a property (by name)\n */\nexport function pluck(collection: any, propName: string): any {\n  return map(collection, <Mapper<any, string>>prop(propName));\n}\n\n/** Given an array of objects, returns a new array containing only the elements which passed the callback predicate */\nexport function filter<T>(collection: T[], callback: (t: T, key?: number) => boolean): T[];\n/** Given an object, returns a new object with only those properties that passed the callback predicate */\nexport function filter<T>(collection: TypedMap<T>, callback: (t: T, key?: string) => boolean): TypedMap<T>;\n/** Filters an Array or an Object's properties based on a predicate */\nexport function filter<T>(collection: any, callback: Function): T {\n  const arr = isArray(collection),\n    result: any = arr ? [] : {};\n  const accept = arr ? x => result.push(x) : (x, key) => (result[key] = x);\n  forEach(collection, function(item, i) {\n    if (callback(item, i)) accept(item, i);\n  });\n  return <T>result;\n}\n\n/** Given an object, return the first property of that object which passed the callback predicate */\nexport function find<T>(collection: TypedMap<T>, callback: Predicate<T>): T;\n/** Given an array of objects, returns the first object which passed the callback predicate */\nexport function find<T>(collection: T[], callback: Predicate<T>): T;\n/** Finds an object from an array, or a property of an object, that matches a predicate */\nexport function find(collection: any, callback: any) {\n  let result;\n\n  forEach(collection, function(item, i) {\n    if (result) return;\n    if (callback(item, i)) result = item;\n  });\n\n  return result;\n}\n\n/** Given an object, returns a new object, where each property is transformed by the callback function */\nexport let mapObj: <T, U>(\n  collection: { [key: string]: T },\n  callback: Mapper<T, U>,\n  target?: typeof collection\n) => { [key: string]: U } = map;\n/** Given an array, returns a new array, where each element is transformed by the callback function */\nexport function map<T, U>(collection: T[], callback: Mapper<T, U>, target?: typeof collection): U[];\nexport function map<T, U>(\n  collection: { [key: string]: T },\n  callback: Mapper<T, U>,\n  target?: typeof collection\n): { [key: string]: U };\n/** Maps an array or object properties using a callback function */\nexport function map(collection: any, callback: any, target: typeof collection): any {\n  target = target || (isArray(collection) ? [] : {});\n  forEach(collection, (item, i) => (target[i] = callback(item, i)));\n  return target;\n}\n\n/**\n * Given an object, return its enumerable property values\n *\n * @example\n * ```\n *\n * let foo = { a: 1, b: 2, c: 3 }\n * let vals = values(foo); // [ 1, 2, 3 ]\n * ```\n */\nexport const values: (<T>(obj: TypedMap<T>) => T[]) = (obj: Obj) => Object.keys(obj).map(key => obj[key]);\n\n/**\n * Reduce function that returns true if all of the values are truthy.\n *\n * @example\n * ```\n *\n * let vals = [ 1, true, {}, \"hello world\"];\n * vals.reduce(allTrueR, true); // true\n *\n * vals.push(0);\n * vals.reduce(allTrueR, true); // false\n * ```\n */\nexport const allTrueR = (memo: boolean, elem: any) => memo && elem;\n\n/**\n * Reduce function that returns true if any of the values are truthy.\n *\n *  * @example\n * ```\n *\n * let vals = [ 0, null, undefined ];\n * vals.reduce(anyTrueR, true); // false\n *\n * vals.push(\"hello world\");\n * vals.reduce(anyTrueR, true); // true\n * ```\n */\nexport const anyTrueR = (memo: boolean, elem: any) => memo || elem;\n\n/**\n * Reduce function which un-nests a single level of arrays\n * @example\n * ```\n *\n * let input = [ [ \"a\", \"b\" ], [ \"c\", \"d\" ], [ [ \"double\", \"nested\" ] ] ];\n * input.reduce(unnestR, []) // [ \"a\", \"b\", \"c\", \"d\", [ \"double, \"nested\" ] ]\n * ```\n */\nexport const unnestR = (memo: any[], elem: any[]) => memo.concat(elem);\n\n/**\n * Reduce function which recursively un-nests all arrays\n *\n * @example\n * ```\n *\n * let input = [ [ \"a\", \"b\" ], [ \"c\", \"d\" ], [ [ \"double\", \"nested\" ] ] ];\n * input.reduce(unnestR, []) // [ \"a\", \"b\", \"c\", \"d\", \"double, \"nested\" ]\n * ```\n */\nexport const flattenR = (memo: any[], elem: any) =>\n  isArray(elem) ? memo.concat(elem.reduce(flattenR, [])) : pushR(memo, elem);\n\n/**\n * Reduce function that pushes an object to an array, then returns the array.\n * Mostly just for [[flattenR]] and [[uniqR]]\n */\nexport function pushR(arr: any[], obj: any) {\n  arr.push(obj);\n  return arr;\n}\n\n/** Reduce function that filters out duplicates */\nexport const uniqR = <T>(acc: T[], token: T): T[] => (inArray(acc, token) ? acc : pushR(acc, token));\n\n/**\n * Return a new array with a single level of arrays unnested.\n *\n * @example\n * ```\n *\n * let input = [ [ \"a\", \"b\" ], [ \"c\", \"d\" ], [ [ \"double\", \"nested\" ] ] ];\n * unnest(input) // [ \"a\", \"b\", \"c\", \"d\", [ \"double, \"nested\" ] ]\n * ```\n */\nexport const unnest = (arr: any[]) => arr.reduce(unnestR, []);\n/**\n * Return a completely flattened version of an array.\n *\n * @example\n * ```\n *\n * let input = [ [ \"a\", \"b\" ], [ \"c\", \"d\" ], [ [ \"double\", \"nested\" ] ] ];\n * flatten(input) // [ \"a\", \"b\", \"c\", \"d\", \"double, \"nested\" ]\n * ```\n */\nexport const flatten = (arr: any[]) => arr.reduce(flattenR, []);\n\n/**\n * Given a .filter Predicate, builds a .filter Predicate which throws an error if any elements do not pass.\n * @example\n * ```\n *\n * let isNumber = (obj) => typeof(obj) === 'number';\n * let allNumbers = [ 1, 2, 3, 4, 5 ];\n * allNumbers.filter(assertPredicate(isNumber)); //OK\n *\n * let oneString = [ 1, 2, 3, 4, \"5\" ];\n * oneString.filter(assertPredicate(isNumber, \"Not all numbers\")); // throws Error(\"\"Not all numbers\"\");\n * ```\n */\nexport const assertPredicate: <T>(predicate: Predicate<T>, errMsg: string | Function) => Predicate<T> = assertFn;\n/**\n * Given a .map function, builds a .map function which throws an error if any mapped elements do not pass a truthyness test.\n * @example\n * ```\n *\n * var data = { foo: 1, bar: 2 };\n *\n * let keys = [ 'foo', 'bar' ]\n * let values = keys.map(assertMap(key => data[key], \"Key not found\"));\n * // values is [1, 2]\n *\n * let keys = [ 'foo', 'bar', 'baz' ]\n * let values = keys.map(assertMap(key => data[key], \"Key not found\"));\n * // throws Error(\"Key not found\")\n * ```\n */\nexport const assertMap: <T, U>(mapFn: (t: T) => U, errMsg: string | Function) => (t: T) => U = assertFn;\nexport function assertFn(predicateOrMap: Function, errMsg: string | Function = 'assert failure'): any {\n  return obj => {\n    const result = predicateOrMap(obj);\n    if (!result) {\n      throw new Error(isFunction(errMsg) ? (<Function>errMsg)(obj) : errMsg);\n    }\n    return result;\n  };\n}\n\n/**\n * Like _.pairs: Given an object, returns an array of key/value pairs\n *\n * @example\n * ```\n *\n * pairs({ foo: \"FOO\", bar: \"BAR }) // [ [ \"foo\", \"FOO\" ], [ \"bar\": \"BAR\" ] ]\n * ```\n */\nexport const pairs = (obj: Obj) => Object.keys(obj).map(key => [key, obj[key]]);\n\n/**\n * Given two or more parallel arrays, returns an array of tuples where\n * each tuple is composed of [ a[i], b[i], ... z[i] ]\n *\n * @example\n * ```\n *\n * let foo = [ 0, 2, 4, 6 ];\n * let bar = [ 1, 3, 5, 7 ];\n * let baz = [ 10, 30, 50, 70 ];\n * arrayTuples(foo, bar);       // [ [0, 1], [2, 3], [4, 5], [6, 7] ]\n * arrayTuples(foo, bar, baz);  // [ [0, 1, 10], [2, 3, 30], [4, 5, 50], [6, 7, 70] ]\n * ```\n */\nexport function arrayTuples(...args: any[]): any[] {\n  if (args.length === 0) return [];\n  const maxArrayLen = args.reduce((min, arr) => Math.min(arr.length, min), 9007199254740991); // aka 2^53  1 aka Number.MAX_SAFE_INTEGER\n  const result = [];\n\n  for (let i = 0; i < maxArrayLen; i++) {\n    // This is a hot function\n    // Unroll when there are 1-4 arguments\n    switch (args.length) {\n      case 1:\n        result.push([args[0][i]]);\n        break;\n      case 2:\n        result.push([args[0][i], args[1][i]]);\n        break;\n      case 3:\n        result.push([args[0][i], args[1][i], args[2][i]]);\n        break;\n      case 4:\n        result.push([args[0][i], args[1][i], args[2][i], args[3][i]]);\n        break;\n      default:\n        result.push(args.map(array => array[i]));\n        break;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Reduce function which builds an object from an array of [key, value] pairs.\n *\n * Each iteration sets the key/val pair on the memo object, then returns the memo for the next iteration.\n *\n * Each keyValueTuple should be an array with values [ key: string, value: any ]\n *\n * @example\n * ```\n *\n * var pairs = [ [\"fookey\", \"fooval\"], [\"barkey\", \"barval\"] ]\n *\n * var pairsToObj = pairs.reduce((memo, pair) => applyPairs(memo, pair), {})\n * // pairsToObj == { fookey: \"fooval\", barkey: \"barval\" }\n *\n * // Or, more simply:\n * var pairsToObj = pairs.reduce(applyPairs, {})\n * // pairsToObj == { fookey: \"fooval\", barkey: \"barval\" }\n * ```\n */\nexport function applyPairs(memo: TypedMap<any>, keyValTuple: any[]) {\n  let key: string, value: any;\n  if (isArray(keyValTuple)) [key, value] = keyValTuple;\n  if (!isString(key)) throw new Error('invalid parameters to applyPairs');\n  memo[key] = value;\n  return memo;\n}\n\n/** Get the last element of an array */\nexport function tail<T>(arr: T[]): T {\n  return (arr.length && arr[arr.length - 1]) || undefined;\n}\n\n/**\n * shallow copy from src to dest\n */\nexport function copy(src: Obj, dest?: Obj) {\n  if (dest) Object.keys(dest).forEach(key => delete dest[key]);\n  if (!dest) dest = {};\n  return extend(dest, src);\n}\n\n/** Naive forEach implementation works with Objects or Arrays */\nfunction _forEach(obj: any[] | any, cb: (el, idx?) => void, _this: Obj) {\n  if (isArray(obj)) return obj.forEach(cb, _this);\n  Object.keys(obj).forEach(key => cb(obj[key], key));\n}\n\n/** Like Object.assign() */\nexport function _extend(toObj: Obj, ...fromObjs: Obj[]): any;\nexport function _extend(toObj: Obj): any {\n  for (let i = 1; i < arguments.length; i++) {\n    const obj = arguments[i];\n    if (!obj) continue;\n    const keys = Object.keys(obj);\n\n    for (let j = 0; j < keys.length; j++) {\n      toObj[keys[j]] = obj[keys[j]];\n    }\n  }\n\n  return toObj;\n}\n\nfunction _equals(o1: any, o2: any): boolean {\n  if (o1 === o2) return true;\n  if (o1 === null || o2 === null) return false;\n  if (o1 !== o1 && o2 !== o2) return true; // NaN === NaN\n  const t1 = typeof o1,\n    t2 = typeof o2;\n  if (t1 !== t2 || t1 !== 'object') return false;\n\n  const tup = [o1, o2];\n  if (all(isArray)(tup)) return _arraysEq(o1, o2);\n  if (all(isDate)(tup)) return o1.getTime() === o2.getTime();\n  if (all(isRegExp)(tup)) return o1.toString() === o2.toString();\n  if (all(isFunction)(tup)) return true; // meh\n\n  const predicates = [isFunction, isArray, isDate, isRegExp];\n  if (predicates.map(any).reduce((b, fn) => b || !!fn(tup), false)) return false;\n\n  const keys: { [i: string]: boolean } = {};\n  // tslint:disable-next-line:forin\n  for (const key in o1) {\n    if (!_equals(o1[key], o2[key])) return false;\n    keys[key] = true;\n  }\n  for (const key in o2) {\n    if (!keys[key]) return false;\n  }\n\n  return true;\n}\n\nfunction _arraysEq(a1: any[], a2: any[]) {\n  if (a1.length !== a2.length) return false;\n  return arrayTuples(a1, a2).reduce((b, t) => b && _equals(t[0], t[1]), true);\n}\n\n// issue #2676\nexport const silenceUncaughtInPromise = (promise: Promise<any>) => promise.catch(e => 0) && promise;\nexport const silentRejection = (error: any) => silenceUncaughtInPromise(services.$q.reject(error));\n","/** Predicates\n *\n * These predicates return true/false based on the input.\n * Although these functions are exported, they are subject to change without notice.\n *\n * @module common_predicates\n */\n/** */\nimport { and, not, pipe, prop, or } from './hof';\nimport { Predicate } from './common'; // has or is using\nimport { StateObject } from '../state/stateObject';\n\nconst toStr = Object.prototype.toString;\nconst tis = (t: string) => (x: any) => typeof x === t;\nexport const isUndefined = tis('undefined');\nexport const isDefined = not(isUndefined);\nexport const isNull = (o: any) => o === null;\nexport const isNullOrUndefined = or(isNull, isUndefined);\nexport const isFunction: (x: any) => x is Function = <any>tis('function');\nexport const isNumber: (x: any) => x is number = <any>tis('number');\nexport const isString = <(x: any) => x is string>tis('string');\nexport const isObject = (x: any) => x !== null && typeof x === 'object';\nexport const isArray = Array.isArray;\nexport const isDate: (x: any) => x is Date = <any>((x: any) => toStr.call(x) === '[object Date]');\nexport const isRegExp: (x: any) => x is RegExp = <any>((x: any) => toStr.call(x) === '[object RegExp]');\n\n/**\n * Predicate which checks if a value is injectable\n *\n * A value is \"injectable\" if it is a function, or if it is an ng1 array-notation-style array\n * where all the elements in the array are Strings, except the last one, which is a Function\n */\nexport function isInjectable(val: any) {\n  if (isArray(val) && val.length) {\n    const head = val.slice(0, -1),\n      tail = val.slice(-1);\n    return !(head.filter(not(isString)).length || tail.filter(not(isFunction)).length);\n  }\n  return isFunction(val);\n}\n\n/**\n * Predicate which checks if a value looks like a Promise\n *\n * It is probably a Promise if it's an object, and it has a `then` property which is a Function\n */\nexport const isPromise = <(x: any) => x is Promise<any>>and(\n  isObject,\n  pipe(\n    prop('then'),\n    isFunction\n  )\n);\n","/**\n * Higher order functions\n *\n * These utility functions are exported, but are subject to change without notice.\n *\n * @module common_hof\n */ /** */\n\nimport { Predicate } from './common';\n/**\n * Returns a new function for [Partial Application](https://en.wikipedia.org/wiki/Partial_application) of the original function.\n *\n * Given a function with N parameters, returns a new function that supports partial application.\n * The new function accepts anywhere from 1 to N parameters.  When that function is called with M parameters,\n * where M is less than N, it returns a new function that accepts the remaining parameters.  It continues to\n * accept more parameters until all N parameters have been supplied.\n *\n *\n * This contrived example uses a partially applied function as an predicate, which returns true\n * if an object is found in both arrays.\n * @example\n * ```\n * // returns true if an object is in both of the two arrays\n * function inBoth(array1, array2, object) {\n *   return array1.indexOf(object) !== -1 &&\n *          array2.indexOf(object) !== 1;\n * }\n * let obj1, obj2, obj3, obj4, obj5, obj6, obj7\n * let foos = [obj1, obj3]\n * let bars = [obj3, obj4, obj5]\n *\n * // A curried \"copy\" of inBoth\n * let curriedInBoth = curry(inBoth);\n * // Partially apply both the array1 and array2\n * let inFoosAndBars = curriedInBoth(foos, bars);\n *\n * // Supply the final argument; since all arguments are\n * // supplied, the original inBoth function is then called.\n * let obj1InBoth = inFoosAndBars(obj1); // false\n *\n * // Use the inFoosAndBars as a predicate.\n * // Filter, on each iteration, supplies the final argument\n * let allObjs = [ obj1, obj2, obj3, obj4, obj5, obj6, obj7 ];\n * let foundInBoth = allObjs.filter(inFoosAndBars); // [ obj3 ]\n *\n * ```\n *\n * Stolen from: http://stackoverflow.com/questions/4394747/javascript-curry-function\n *\n * @param fn\n * @returns {*|function(): (*|any)}\n */\nexport function curry(fn: Function): Function {\n  const initial_args = [].slice.apply(arguments, [1]);\n  const func_args_length = fn.length;\n\n  function curried(args: any[]) {\n    if (args.length >= func_args_length) return fn.apply(null, args);\n    return function() {\n      return curried(args.concat([].slice.apply(arguments)));\n    };\n  }\n  return curried(initial_args);\n}\n\n/**\n * Given a varargs list of functions, returns a function that composes the argument functions, right-to-left\n * given: f(x), g(x), h(x)\n * let composed = compose(f,g,h)\n * then, composed is: f(g(h(x)))\n */\nexport function compose() {\n  const args = arguments;\n  const start = args.length - 1;\n  return function() {\n    let i = start,\n      result = args[start].apply(this, arguments);\n    while (i--) result = args[i].call(this, result);\n    return result;\n  };\n}\n\n/**\n * Given a varargs list of functions, returns a function that is composes the argument functions, left-to-right\n * given: f(x), g(x), h(x)\n * let piped = pipe(f,g,h);\n * then, piped is: h(g(f(x)))\n */\nexport function pipe(...funcs: Function[]): (obj: any) => any {\n  return compose.apply(null, [].slice.call(arguments).reverse());\n}\n\n/**\n * Given a property name, returns a function that returns that property from an object\n * let obj = { foo: 1, name: \"blarg\" };\n * let getName = prop(\"name\");\n * getName(obj) === \"blarg\"\n */\nexport const prop = (name: string) => (obj: any) => obj && obj[name];\n\n/**\n * Given a property name and a value, returns a function that returns a boolean based on whether\n * the passed object has a property that matches the value\n * let obj = { foo: 1, name: \"blarg\" };\n * let getName = propEq(\"name\", \"blarg\");\n * getName(obj) === true\n */\nexport const propEq = curry((name: string, _val: any, obj: any) => obj && obj[name] === _val);\n\n/**\n * Given a dotted property name, returns a function that returns a nested property from an object, or undefined\n * let obj = { id: 1, nestedObj: { foo: 1, name: \"blarg\" }, };\n * let getName = prop(\"nestedObj.name\");\n * getName(obj) === \"blarg\"\n * let propNotFound = prop(\"this.property.doesnt.exist\");\n * propNotFound(obj) === undefined\n */\nexport const parse = (name: string) => pipe.apply(null, name.split('.').map(prop));\n\n/**\n * Given a function that returns a truthy or falsey value, returns a\n * function that returns the opposite (falsey or truthy) value given the same inputs\n */\nexport const not: (fn: Predicate<any>) => Predicate<any> = (fn: Predicate<any>) => (...args: any[]) =>\n  !fn.apply(null, args);\n\n/**\n * Given two functions that return truthy or falsey values, returns a function that returns truthy\n * if both functions return truthy for the given arguments\n */\nexport function and(fn1: Predicate<any>, fn2: Predicate<any>): Predicate<any> {\n  return (...args: any[]) => fn1.apply(null, args) && fn2.apply(null, args);\n}\n\n/**\n * Given two functions that return truthy or falsey values, returns a function that returns truthy\n * if at least one of the functions returns truthy for the given arguments\n */\nexport function or(fn1: Predicate<any>, fn2: Predicate<any>): Predicate<any> {\n  return (...args: any[]) => fn1.apply(null, args) || fn2.apply(null, args);\n}\n\n/**\n * Check if all the elements of an array match a predicate function\n *\n * @param fn1 a predicate function `fn1`\n * @returns a function which takes an array and returns true if `fn1` is true for all elements of the array\n */\nexport const all = (fn1: Predicate<any>) => (arr: any[]) => arr.reduce((b, x) => b && !!fn1(x), true) as boolean;\n\n// tslint:disable-next-line:variable-name\nexport const any = (fn1: Predicate<any>) => (arr: any[]) => arr.reduce((b, x) => b || !!fn1(x), false) as boolean;\n\n/** Given a class, returns a Predicate function that returns true if the object is of that class */\nexport const is = <T>(ctor: { new (...args): T }) => (obj: any): obj is T =>\n  (obj != null && obj.constructor === ctor) || obj instanceof ctor;\n\n/** Given a value, returns a Predicate function that returns true if another value is === equal to the original value */\nexport const eq: (comp: any) => Predicate<any> = (value: any) => (other: any) => value === other;\n\n/** Given a value, returns a function which returns the value */\nexport const val = <T>(v: T) => () => v;\n\nexport function invoke(fnName: string): Function;\nexport function invoke(fnName: string, args: any[]): Function;\nexport function invoke(fnName: string, args?: any[]): Function {\n  return (obj: any) => obj[fnName].apply(obj, args);\n}\n\n/**\n * Sorta like Pattern Matching (a functional programming conditional construct)\n *\n * See http://c2.com/cgi/wiki?PatternMatching\n *\n * This is a conditional construct which allows a series of predicates and output functions\n * to be checked and then applied.  Each predicate receives the input.  If the predicate\n * returns truthy, then its matching output function (mapping function) is provided with\n * the input and, then the result is returned.\n *\n * Each combination (2-tuple) of predicate + output function should be placed in an array\n * of size 2: [ predicate, mapFn ]\n *\n * These 2-tuples should be put in an outer array.\n *\n * @example\n * ```\n *\n * // Here's a 2-tuple where the first element is the isString predicate\n * // and the second element is a function that returns a description of the input\n * let firstTuple = [ angular.isString, (input) => `Heres your string ${input}` ];\n *\n * // Second tuple: predicate \"isNumber\", mapfn returns a description\n * let secondTuple = [ angular.isNumber, (input) => `(${input}) That's a number!` ];\n *\n * let third = [ (input) => input === null,  (input) => `Oh, null...` ];\n *\n * let fourth = [ (input) => input === undefined,  (input) => `notdefined` ];\n *\n * let descriptionOf = pattern([ firstTuple, secondTuple, third, fourth ]);\n *\n * console.log(descriptionOf(undefined)); // 'notdefined'\n * console.log(descriptionOf(55)); // '(55) That's a number!'\n * console.log(descriptionOf(\"foo\")); // 'Here's your string foo'\n * ```\n *\n * @param struct A 2D array.  Each element of the array should be an array, a 2-tuple,\n * with a Predicate and a mapping/output function\n * @returns {function(any): *}\n */\nexport function pattern(struct: Function[][]): Function {\n  return function(x: any) {\n    for (let i = 0; i < struct.length; i++) {\n      if (struct[i][0](x)) return struct[i][1](x);\n    }\n  };\n}\n","/**\n * This module is a stub for core services such as Dependency Injection or Browser Location.\n * Core services may be implemented by a specific framework, such as ng1 or ng2, or be pure javascript.\n *\n * @module common\n */\n/** for typedoc */\nimport { IInjectable, Obj } from './common';\nimport { Disposable } from '../interface';\nimport { UrlParts } from '../url/interface';\n\nexport let notImplemented = (fnname: string) => () => {\n  throw new Error(`${fnname}(): No coreservices implementation for UI-Router is loaded.`);\n};\n\nconst services: CoreServices = {\n  $q: undefined,\n  $injector: undefined,\n};\n\nexport interface $QLikeDeferred {\n  resolve: (val?: any) => void;\n  reject: (reason?: any) => void;\n  promise: Promise<any>;\n}\n\nexport interface $QLike {\n  when<T>(value?: T | PromiseLike<T>): Promise<T>;\n  reject<T>(reason: any): Promise<T>;\n  defer(): $QLikeDeferred;\n  all(promises: { [key: string]: Promise<any> }): Promise<any>;\n  all(promises: Promise<any>[]): Promise<any[]>;\n}\n\nexport interface $InjectorLike {\n  strictDi?: boolean;\n  get(token: any): any;\n  get<T>(token: any): T;\n  has(token: any): boolean;\n  invoke(fn: IInjectable, context?: any, locals?: Obj): any;\n  annotate(fn: IInjectable, strictDi?: boolean): any[];\n}\n\nexport interface CoreServices {\n  $q: $QLike;\n  $injector: $InjectorLike;\n}\n\nexport interface LocationServices extends Disposable {\n  /**\n   * Gets the current url string\n   *\n   * The URL is normalized using the internal [[path]]/[[search]]/[[hash]] values.\n   *\n   * For example, the URL may be stored in the hash ([[HashLocationServices]]) or\n   * have a base HREF prepended ([[PushStateLocationServices]]).\n   *\n   * The raw URL in the browser might be:\n   *\n   * ```\n   * http://mysite.com/somepath/index.html#/internal/path/123?param1=foo#anchor\n   * ```\n   *\n   * or\n   *\n   * ```\n   * http://mysite.com/basepath/internal/path/123?param1=foo#anchor\n   * ```\n   *\n   * then this method returns:\n   *\n   * ```\n   * /internal/path/123?param1=foo#anchor\n   * ```\n   *\n   *\n   * #### Example:\n   * ```js\n   * locationServices.url(); // \"/some/path?query=value#anchor\"\n   * ```\n   *\n   * @returns the current value of the url, as a string.\n   */\n  url(): string;\n\n  /**\n   * Updates the url, or gets the current url\n   *\n   * Updates the url, changing it to the value in `newurl`\n   *\n   * #### Example:\n   * ```js\n   * locationServices.url(\"/some/path?query=value#anchor\", true);\n   * ```\n   *\n   * @param newurl The new value for the URL.\n   *               This url should reflect only the new internal [[path]], [[search]], and [[hash]] values.\n   *               It should not include the protocol, site, port, or base path of an absolute HREF.\n   * @param replace When true, replaces the current history entry (instead of appending it) with this new url\n   * @param state The history's state object, i.e., pushState (if the LocationServices implementation supports it)\n   * @return the url (after potentially being processed)\n   */\n  url(newurl: string, replace?: boolean, state?: any): string;\n\n  /**\n   * Gets the path part of the current url\n   *\n   * If the current URL is `/some/path?query=value#anchor`, this returns `/some/path`\n   *\n   * @return the path portion of the url\n   */\n  path(): string;\n\n  /**\n   * Gets the search part of the current url as an object\n   *\n   * If the current URL is `/some/path?query=value#anchor`, this returns `{ query: 'value' }`\n   *\n   * @return the search (querystring) portion of the url, as an object\n   */\n  search(): { [key: string]: any };\n\n  /**\n   * Gets the hash part of the current url\n   *\n   * If the current URL is `/some/path?query=value#anchor`, this returns `anchor`\n   *\n   * @return the hash (anchor) portion of the url\n   */\n  hash(): string;\n\n  /**\n   * Registers a url change handler\n   *\n   * #### Example:\n   * ```js\n   * let deregisterFn = locationServices.onChange((evt) => console.log(\"url change\", evt));\n   * ```\n   *\n   * @param callback a function that will be called when the url is changing\n   * @return a function that de-registers the callback\n   */\n  onChange(callback: Function): Function;\n}\n\n/**\n * This service returns the location configuration\n *\n * This service returns information about the location configuration.\n * This service is primarily used when building URLs (e.g., for `hrefs`)\n */\nexport interface LocationConfig extends Disposable {\n  /**\n   * Gets the port, e.g., `80`\n   *\n   * @return the port number\n   */\n  port(): number;\n  /**\n   * Gets the protocol, e.g., `http`\n   *\n   * @return the protocol\n   */\n  protocol(): string;\n  /**\n   * Gets the host, e.g., `localhost`\n   *\n   * @return the protocol\n   */\n  host(): string;\n  /**\n   * Gets the base Href, e.g., `http://localhost/approot/`\n   *\n   * @return the application's base href\n   */\n  baseHref(): string;\n  /**\n   * Returns true when running in pushstate mode\n   *\n   * @return true when running in pushstate mode\n   */\n  html5Mode(): boolean;\n  /**\n   * Gets the hashPrefix (when not running in pushstate mode)\n   *\n   * If the current url is `http://localhost/app#!/uirouter/path/#anchor`, it returns `!` which is the prefix for the \"hashbang\" portion.\n   *\n   * @return the hash prefix\n   */\n  hashPrefix(): string;\n  /**\n   * Sets the hashPrefix (when not running in pushstate mode)\n   *\n   * @return the new hash prefix\n   */\n  hashPrefix(newprefix: string): string;\n}\n\nexport { services };\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@uirouter/visualizer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@uirouter/visualizer\"] = factory();\n\telse\n\t\troot[\"@uirouter/visualizer\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/_bundles/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","/** Virtual DOM Node */\nfunction VNode() {}\n\n/** Global options\n *\t@public\n *\t@namespace options {Object}\n */\nvar options = {\n\n\t/** If `true`, `prop` changes trigger synchronous component updates.\n  *\t@name syncComponentUpdates\n  *\t@type Boolean\n  *\t@default true\n  */\n\t//syncComponentUpdates: true,\n\n\t/** Processes all created VNodes.\n  *\t@param {VNode} vnode\tA newly-created VNode to normalize/process\n  */\n\t//vnode(vnode) { }\n\n\t/** Hook invoked after a component is mounted. */\n\t// afterMount(component) { }\n\n\t/** Hook invoked after the DOM is updated with a component's latest render. */\n\t// afterUpdate(component) { }\n\n\t/** Hook invoked immediately before a component is unmounted. */\n\t// beforeUnmount(component) { }\n};\n\nvar stack = [];\n\nvar EMPTY_CHILDREN = [];\n\n/**\n * JSX/hyperscript reviver.\n * @see http://jasonformat.com/wtf-is-jsx\n * Benchmarks: https://esbench.com/bench/57ee8f8e330ab09900a1a1a0\n *\n * Note: this is exported as both `h()` and `createElement()` for compatibility reasons.\n *\n * Creates a VNode (virtual DOM element). A tree of VNodes can be used as a lightweight representation\n * of the structure of a DOM tree. This structure can be realized by recursively comparing it against\n * the current _actual_ DOM structure, and applying only the differences.\n *\n * `h()`/`createElement()` accepts an element name, a list of attributes/props,\n * and optionally children to append to the element.\n *\n * @example The following DOM tree\n *\n * `<div id=\"foo\" name=\"bar\">Hello!</div>`\n *\n * can be constructed using this function as:\n *\n * `h('div', { id: 'foo', name : 'bar' }, 'Hello!');`\n *\n * @param {string} nodeName\tAn element name. Ex: `div`, `a`, `span`, etc.\n * @param {Object} attributes\tAny attributes/props to set on the created element.\n * @param rest\t\t\tAdditional arguments are taken to be children to append. Can be infinitely nested Arrays.\n *\n * @public\n */\nfunction h(nodeName, attributes) {\n\tvar children = EMPTY_CHILDREN,\n\t    lastSimple,\n\t    child,\n\t    simple,\n\t    i;\n\tfor (i = arguments.length; i-- > 2;) {\n\t\tstack.push(arguments[i]);\n\t}\n\tif (attributes && attributes.children != null) {\n\t\tif (!stack.length) stack.push(attributes.children);\n\t\tdelete attributes.children;\n\t}\n\twhile (stack.length) {\n\t\tif ((child = stack.pop()) && child.pop !== undefined) {\n\t\t\tfor (i = child.length; i--;) {\n\t\t\t\tstack.push(child[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tif (typeof child === 'boolean') child = null;\n\n\t\t\tif (simple = typeof nodeName !== 'function') {\n\t\t\t\tif (child == null) child = '';else if (typeof child === 'number') child = String(child);else if (typeof child !== 'string') simple = false;\n\t\t\t}\n\n\t\t\tif (simple && lastSimple) {\n\t\t\t\tchildren[children.length - 1] += child;\n\t\t\t} else if (children === EMPTY_CHILDREN) {\n\t\t\t\tchildren = [child];\n\t\t\t} else {\n\t\t\t\tchildren.push(child);\n\t\t\t}\n\n\t\t\tlastSimple = simple;\n\t\t}\n\t}\n\n\tvar p = new VNode();\n\tp.nodeName = nodeName;\n\tp.children = children;\n\tp.attributes = attributes == null ? undefined : attributes;\n\tp.key = attributes == null ? undefined : attributes.key;\n\n\t// if a \"vnode hook\" is defined, pass every created VNode to it\n\tif (options.vnode !== undefined) options.vnode(p);\n\n\treturn p;\n}\n\n/**\n *  Copy all properties from `props` onto `obj`.\n *  @param {Object} obj\t\tObject onto which properties should be copied.\n *  @param {Object} props\tObject from which to copy properties.\n *  @returns obj\n *  @private\n */\nfunction extend(obj, props) {\n  for (var i in props) {\n    obj[i] = props[i];\n  }return obj;\n}\n\n/**\n * Call a function asynchronously, as soon as possible. Makes\n * use of HTML Promise to schedule the callback if available,\n * otherwise falling back to `setTimeout` (mainly for IE<11).\n *\n * @param {Function} callback\n */\nvar defer = typeof Promise == 'function' ? Promise.resolve().then.bind(Promise.resolve()) : setTimeout;\n\n/**\n * Clones the given VNode, optionally adding attributes/props and replacing its children.\n * @param {VNode} vnode\t\tThe virtual DOM element to clone\n * @param {Object} props\tAttributes/props to add when cloning\n * @param {VNode} rest\t\tAny additional arguments will be used as replacement children.\n */\nfunction cloneElement(vnode, props) {\n  return h(vnode.nodeName, extend(extend({}, vnode.attributes), props), arguments.length > 2 ? [].slice.call(arguments, 2) : vnode.children);\n}\n\n// DOM properties that should NOT have \"px\" added when numeric\nvar IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;\n\n/** Managed queue of dirty components to be re-rendered */\n\nvar items = [];\n\nfunction enqueueRender(component) {\n\tif (!component._dirty && (component._dirty = true) && items.push(component) == 1) {\n\t\t(options.debounceRendering || defer)(rerender);\n\t}\n}\n\nfunction rerender() {\n\tvar p,\n\t    list = items;\n\titems = [];\n\twhile (p = list.pop()) {\n\t\tif (p._dirty) renderComponent(p);\n\t}\n}\n\n/**\n * Check if two nodes are equivalent.\n *\n * @param {Node} node\t\t\tDOM Node to compare\n * @param {VNode} vnode\t\t\tVirtual DOM node to compare\n * @param {boolean} [hydrating=false]\tIf true, ignores component constructors when comparing.\n * @private\n */\nfunction isSameNodeType(node, vnode, hydrating) {\n  if (typeof vnode === 'string' || typeof vnode === 'number') {\n    return node.splitText !== undefined;\n  }\n  if (typeof vnode.nodeName === 'string') {\n    return !node._componentConstructor && isNamedNode(node, vnode.nodeName);\n  }\n  return hydrating || node._componentConstructor === vnode.nodeName;\n}\n\n/**\n * Check if an Element has a given nodeName, case-insensitively.\n *\n * @param {Element} node\tA DOM Element to inspect the name of.\n * @param {String} nodeName\tUnnormalized name to compare against.\n */\nfunction isNamedNode(node, nodeName) {\n  return node.normalizedNodeName === nodeName || node.nodeName.toLowerCase() === nodeName.toLowerCase();\n}\n\n/**\n * Reconstruct Component-style `props` from a VNode.\n * Ensures default/fallback values from `defaultProps`:\n * Own-properties of `defaultProps` not present in `vnode.attributes` are added.\n *\n * @param {VNode} vnode\n * @returns {Object} props\n */\nfunction getNodeProps(vnode) {\n  var props = extend({}, vnode.attributes);\n  props.children = vnode.children;\n\n  var defaultProps = vnode.nodeName.defaultProps;\n  if (defaultProps !== undefined) {\n    for (var i in defaultProps) {\n      if (props[i] === undefined) {\n        props[i] = defaultProps[i];\n      }\n    }\n  }\n\n  return props;\n}\n\n/** Create an element with the given nodeName.\n *\t@param {String} nodeName\n *\t@param {Boolean} [isSvg=false]\tIf `true`, creates an element within the SVG namespace.\n *\t@returns {Element} node\n */\nfunction createNode(nodeName, isSvg) {\n\tvar node = isSvg ? document.createElementNS('http://www.w3.org/2000/svg', nodeName) : document.createElement(nodeName);\n\tnode.normalizedNodeName = nodeName;\n\treturn node;\n}\n\n/** Remove a child node from its parent if attached.\n *\t@param {Element} node\t\tThe node to remove\n */\nfunction removeNode(node) {\n\tvar parentNode = node.parentNode;\n\tif (parentNode) parentNode.removeChild(node);\n}\n\n/** Set a named attribute on the given Node, with special behavior for some names and event handlers.\n *\tIf `value` is `null`, the attribute/handler will be removed.\n *\t@param {Element} node\tAn element to mutate\n *\t@param {string} name\tThe name/key to set, such as an event or attribute name\n *\t@param {any} old\tThe last value that was set for this name/node pair\n *\t@param {any} value\tAn attribute value, such as a function to be used as an event handler\n *\t@param {Boolean} isSvg\tAre we currently diffing inside an svg?\n *\t@private\n */\nfunction setAccessor(node, name, old, value, isSvg) {\n\tif (name === 'className') name = 'class';\n\n\tif (name === 'key') {\n\t\t// ignore\n\t} else if (name === 'ref') {\n\t\tif (old) old(null);\n\t\tif (value) value(node);\n\t} else if (name === 'class' && !isSvg) {\n\t\tnode.className = value || '';\n\t} else if (name === 'style') {\n\t\tif (!value || typeof value === 'string' || typeof old === 'string') {\n\t\t\tnode.style.cssText = value || '';\n\t\t}\n\t\tif (value && typeof value === 'object') {\n\t\t\tif (typeof old !== 'string') {\n\t\t\t\tfor (var i in old) {\n\t\t\t\t\tif (!(i in value)) node.style[i] = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i in value) {\n\t\t\t\tnode.style[i] = typeof value[i] === 'number' && IS_NON_DIMENSIONAL.test(i) === false ? value[i] + 'px' : value[i];\n\t\t\t}\n\t\t}\n\t} else if (name === 'dangerouslySetInnerHTML') {\n\t\tif (value) node.innerHTML = value.__html || '';\n\t} else if (name[0] == 'o' && name[1] == 'n') {\n\t\tvar useCapture = name !== (name = name.replace(/Capture$/, ''));\n\t\tname = name.toLowerCase().substring(2);\n\t\tif (value) {\n\t\t\tif (!old) node.addEventListener(name, eventProxy, useCapture);\n\t\t} else {\n\t\t\tnode.removeEventListener(name, eventProxy, useCapture);\n\t\t}\n\t\t(node._listeners || (node._listeners = {}))[name] = value;\n\t} else if (name !== 'list' && name !== 'type' && !isSvg && name in node) {\n\t\tsetProperty(node, name, value == null ? '' : value);\n\t\tif (value == null || value === false) node.removeAttribute(name);\n\t} else {\n\t\tvar ns = isSvg && name !== (name = name.replace(/^xlink:?/, ''));\n\t\tif (value == null || value === false) {\n\t\t\tif (ns) node.removeAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase());else node.removeAttribute(name);\n\t\t} else if (typeof value !== 'function') {\n\t\t\tif (ns) node.setAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase(), value);else node.setAttribute(name, value);\n\t\t}\n\t}\n}\n\n/** Attempt to set a DOM property to the given value.\n *\tIE & FF throw for certain property-value combinations.\n */\nfunction setProperty(node, name, value) {\n\ttry {\n\t\tnode[name] = value;\n\t} catch (e) {}\n}\n\n/** Proxy an event to hooked event handlers\n *\t@private\n */\nfunction eventProxy(e) {\n\treturn this._listeners[e.type](options.event && options.event(e) || e);\n}\n\n/** Queue of components that have been mounted and are awaiting componentDidMount */\nvar mounts = [];\n\n/** Diff recursion count, used to track the end of the diff cycle. */\nvar diffLevel = 0;\n\n/** Global flag indicating if the diff is currently within an SVG */\nvar isSvgMode = false;\n\n/** Global flag indicating if the diff is performing hydration */\nvar hydrating = false;\n\n/** Invoke queued componentDidMount lifecycle methods */\nfunction flushMounts() {\n\tvar c;\n\twhile (c = mounts.pop()) {\n\t\tif (options.afterMount) options.afterMount(c);\n\t\tif (c.componentDidMount) c.componentDidMount();\n\t}\n}\n\n/** Apply differences in a given vnode (and it's deep children) to a real DOM Node.\n *\t@param {Element} [dom=null]\t\tA DOM node to mutate into the shape of the `vnode`\n *\t@param {VNode} vnode\t\t\tA VNode (with descendants forming a tree) representing the desired DOM structure\n *\t@returns {Element} dom\t\t\tThe created/mutated element\n *\t@private\n */\nfunction diff(dom, vnode, context, mountAll, parent, componentRoot) {\n\t// diffLevel having been 0 here indicates initial entry into the diff (not a subdiff)\n\tif (!diffLevel++) {\n\t\t// when first starting the diff, check if we're diffing an SVG or within an SVG\n\t\tisSvgMode = parent != null && parent.ownerSVGElement !== undefined;\n\n\t\t// hydration is indicated by the existing element to be diffed not having a prop cache\n\t\thydrating = dom != null && !('__preactattr_' in dom);\n\t}\n\n\tvar ret = idiff(dom, vnode, context, mountAll, componentRoot);\n\n\t// append the element if its a new parent\n\tif (parent && ret.parentNode !== parent) parent.appendChild(ret);\n\n\t// diffLevel being reduced to 0 means we're exiting the diff\n\tif (! --diffLevel) {\n\t\thydrating = false;\n\t\t// invoke queued componentDidMount lifecycle methods\n\t\tif (!componentRoot) flushMounts();\n\t}\n\n\treturn ret;\n}\n\n/** Internals of `diff()`, separated to allow bypassing diffLevel / mount flushing. */\nfunction idiff(dom, vnode, context, mountAll, componentRoot) {\n\tvar out = dom,\n\t    prevSvgMode = isSvgMode;\n\n\t// empty values (null, undefined, booleans) render as empty Text nodes\n\tif (vnode == null || typeof vnode === 'boolean') vnode = '';\n\n\t// Fast case: Strings & Numbers create/update Text nodes.\n\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\n\t\t// update if it's already a Text node:\n\t\tif (dom && dom.splitText !== undefined && dom.parentNode && (!dom._component || componentRoot)) {\n\t\t\t/* istanbul ignore if */ /* Browser quirk that can't be covered: https://github.com/developit/preact/commit/fd4f21f5c45dfd75151bd27b4c217d8003aa5eb9 */\n\t\t\tif (dom.nodeValue != vnode) {\n\t\t\t\tdom.nodeValue = vnode;\n\t\t\t}\n\t\t} else {\n\t\t\t// it wasn't a Text node: replace it with one and recycle the old Element\n\t\t\tout = document.createTextNode(vnode);\n\t\t\tif (dom) {\n\t\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\t\t\t\trecollectNodeTree(dom, true);\n\t\t\t}\n\t\t}\n\n\t\tout['__preactattr_'] = true;\n\n\t\treturn out;\n\t}\n\n\t// If the VNode represents a Component, perform a component diff:\n\tvar vnodeName = vnode.nodeName;\n\tif (typeof vnodeName === 'function') {\n\t\treturn buildComponentFromVNode(dom, vnode, context, mountAll);\n\t}\n\n\t// Tracks entering and exiting SVG namespace when descending through the tree.\n\tisSvgMode = vnodeName === 'svg' ? true : vnodeName === 'foreignObject' ? false : isSvgMode;\n\n\t// If there's no existing element or it's the wrong type, create a new one:\n\tvnodeName = String(vnodeName);\n\tif (!dom || !isNamedNode(dom, vnodeName)) {\n\t\tout = createNode(vnodeName, isSvgMode);\n\n\t\tif (dom) {\n\t\t\t// move children into the replacement node\n\t\t\twhile (dom.firstChild) {\n\t\t\t\tout.appendChild(dom.firstChild);\n\t\t\t} // if the previous Element was mounted into the DOM, replace it inline\n\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\n\t\t\t// recycle the old element (skips non-Element node types)\n\t\t\trecollectNodeTree(dom, true);\n\t\t}\n\t}\n\n\tvar fc = out.firstChild,\n\t    props = out['__preactattr_'],\n\t    vchildren = vnode.children;\n\n\tif (props == null) {\n\t\tprops = out['__preactattr_'] = {};\n\t\tfor (var a = out.attributes, i = a.length; i--;) {\n\t\t\tprops[a[i].name] = a[i].value;\n\t\t}\n\t}\n\n\t// Optimization: fast-path for elements containing a single TextNode:\n\tif (!hydrating && vchildren && vchildren.length === 1 && typeof vchildren[0] === 'string' && fc != null && fc.splitText !== undefined && fc.nextSibling == null) {\n\t\tif (fc.nodeValue != vchildren[0]) {\n\t\t\tfc.nodeValue = vchildren[0];\n\t\t}\n\t}\n\t// otherwise, if there are existing or new children, diff them:\n\telse if (vchildren && vchildren.length || fc != null) {\n\t\t\tinnerDiffNode(out, vchildren, context, mountAll, hydrating || props.dangerouslySetInnerHTML != null);\n\t\t}\n\n\t// Apply attributes/props from VNode to the DOM Element:\n\tdiffAttributes(out, vnode.attributes, props);\n\n\t// restore previous SVG mode: (in case we're exiting an SVG namespace)\n\tisSvgMode = prevSvgMode;\n\n\treturn out;\n}\n\n/** Apply child and attribute changes between a VNode and a DOM Node to the DOM.\n *\t@param {Element} dom\t\t\tElement whose children should be compared & mutated\n *\t@param {Array} vchildren\t\tArray of VNodes to compare to `dom.childNodes`\n *\t@param {Object} context\t\t\tImplicitly descendant context object (from most recent `getChildContext()`)\n *\t@param {Boolean} mountAll\n *\t@param {Boolean} isHydrating\tIf `true`, consumes externally created elements similar to hydration\n */\nfunction innerDiffNode(dom, vchildren, context, mountAll, isHydrating) {\n\tvar originalChildren = dom.childNodes,\n\t    children = [],\n\t    keyed = {},\n\t    keyedLen = 0,\n\t    min = 0,\n\t    len = originalChildren.length,\n\t    childrenLen = 0,\n\t    vlen = vchildren ? vchildren.length : 0,\n\t    j,\n\t    c,\n\t    f,\n\t    vchild,\n\t    child;\n\n\t// Build up a map of keyed children and an Array of unkeyed children:\n\tif (len !== 0) {\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tvar _child = originalChildren[i],\n\t\t\t    props = _child['__preactattr_'],\n\t\t\t    key = vlen && props ? _child._component ? _child._component.__key : props.key : null;\n\t\t\tif (key != null) {\n\t\t\t\tkeyedLen++;\n\t\t\t\tkeyed[key] = _child;\n\t\t\t} else if (props || (_child.splitText !== undefined ? isHydrating ? _child.nodeValue.trim() : true : isHydrating)) {\n\t\t\t\tchildren[childrenLen++] = _child;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (vlen !== 0) {\n\t\tfor (var i = 0; i < vlen; i++) {\n\t\t\tvchild = vchildren[i];\n\t\t\tchild = null;\n\n\t\t\t// attempt to find a node based on key matching\n\t\t\tvar key = vchild.key;\n\t\t\tif (key != null) {\n\t\t\t\tif (keyedLen && keyed[key] !== undefined) {\n\t\t\t\t\tchild = keyed[key];\n\t\t\t\t\tkeyed[key] = undefined;\n\t\t\t\t\tkeyedLen--;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// attempt to pluck a node of the same type from the existing children\n\t\t\telse if (!child && min < childrenLen) {\n\t\t\t\t\tfor (j = min; j < childrenLen; j++) {\n\t\t\t\t\t\tif (children[j] !== undefined && isSameNodeType(c = children[j], vchild, isHydrating)) {\n\t\t\t\t\t\t\tchild = c;\n\t\t\t\t\t\t\tchildren[j] = undefined;\n\t\t\t\t\t\t\tif (j === childrenLen - 1) childrenLen--;\n\t\t\t\t\t\t\tif (j === min) min++;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t// morph the matched/found/created DOM child to match vchild (deep)\n\t\t\tchild = idiff(child, vchild, context, mountAll);\n\n\t\t\tf = originalChildren[i];\n\t\t\tif (child && child !== dom && child !== f) {\n\t\t\t\tif (f == null) {\n\t\t\t\t\tdom.appendChild(child);\n\t\t\t\t} else if (child === f.nextSibling) {\n\t\t\t\t\tremoveNode(f);\n\t\t\t\t} else {\n\t\t\t\t\tdom.insertBefore(child, f);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// remove unused keyed children:\n\tif (keyedLen) {\n\t\tfor (var i in keyed) {\n\t\t\tif (keyed[i] !== undefined) recollectNodeTree(keyed[i], false);\n\t\t}\n\t}\n\n\t// remove orphaned unkeyed children:\n\twhile (min <= childrenLen) {\n\t\tif ((child = children[childrenLen--]) !== undefined) recollectNodeTree(child, false);\n\t}\n}\n\n/** Recursively recycle (or just unmount) a node and its descendants.\n *\t@param {Node} node\t\t\t\t\t\tDOM node to start unmount/removal from\n *\t@param {Boolean} [unmountOnly=false]\tIf `true`, only triggers unmount lifecycle, skips removal\n */\nfunction recollectNodeTree(node, unmountOnly) {\n\tvar component = node._component;\n\tif (component) {\n\t\t// if node is owned by a Component, unmount that component (ends up recursing back here)\n\t\tunmountComponent(component);\n\t} else {\n\t\t// If the node's VNode had a ref function, invoke it with null here.\n\t\t// (this is part of the React spec, and smart for unsetting references)\n\t\tif (node['__preactattr_'] != null && node['__preactattr_'].ref) node['__preactattr_'].ref(null);\n\n\t\tif (unmountOnly === false || node['__preactattr_'] == null) {\n\t\t\tremoveNode(node);\n\t\t}\n\n\t\tremoveChildren(node);\n\t}\n}\n\n/** Recollect/unmount all children.\n *\t- we use .lastChild here because it causes less reflow than .firstChild\n *\t- it's also cheaper than accessing the .childNodes Live NodeList\n */\nfunction removeChildren(node) {\n\tnode = node.lastChild;\n\twhile (node) {\n\t\tvar next = node.previousSibling;\n\t\trecollectNodeTree(node, true);\n\t\tnode = next;\n\t}\n}\n\n/** Apply differences in attributes from a VNode to the given DOM Element.\n *\t@param {Element} dom\t\tElement with attributes to diff `attrs` against\n *\t@param {Object} attrs\t\tThe desired end-state key-value attribute pairs\n *\t@param {Object} old\t\t\tCurrent/previous attributes (from previous VNode or element's prop cache)\n */\nfunction diffAttributes(dom, attrs, old) {\n\tvar name;\n\n\t// remove attributes no longer present on the vnode by setting them to undefined\n\tfor (name in old) {\n\t\tif (!(attrs && attrs[name] != null) && old[name] != null) {\n\t\t\tsetAccessor(dom, name, old[name], old[name] = undefined, isSvgMode);\n\t\t}\n\t}\n\n\t// add new & update changed attributes\n\tfor (name in attrs) {\n\t\tif (name !== 'children' && name !== 'innerHTML' && (!(name in old) || attrs[name] !== (name === 'value' || name === 'checked' ? dom[name] : old[name]))) {\n\t\t\tsetAccessor(dom, name, old[name], old[name] = attrs[name], isSvgMode);\n\t\t}\n\t}\n}\n\n/** Retains a pool of Components for re-use, keyed on component name.\n *\tNote: since component names are not unique or even necessarily available, these are primarily a form of sharding.\n *\t@private\n */\nvar components = {};\n\n/** Reclaim a component for later re-use by the recycler. */\nfunction collectComponent(component) {\n\tvar name = component.constructor.name;\n\t(components[name] || (components[name] = [])).push(component);\n}\n\n/** Create a component. Normalizes differences between PFC's and classful Components. */\nfunction createComponent(Ctor, props, context) {\n\tvar list = components[Ctor.name],\n\t    inst;\n\n\tif (Ctor.prototype && Ctor.prototype.render) {\n\t\tinst = new Ctor(props, context);\n\t\tComponent.call(inst, props, context);\n\t} else {\n\t\tinst = new Component(props, context);\n\t\tinst.constructor = Ctor;\n\t\tinst.render = doRender;\n\t}\n\n\tif (list) {\n\t\tfor (var i = list.length; i--;) {\n\t\t\tif (list[i].constructor === Ctor) {\n\t\t\t\tinst.nextBase = list[i].nextBase;\n\t\t\t\tlist.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn inst;\n}\n\n/** The `.render()` method for a PFC backing instance. */\nfunction doRender(props, state, context) {\n\treturn this.constructor(props, context);\n}\n\n/** Set a component's `props` (generally derived from JSX attributes).\n *\t@param {Object} props\n *\t@param {Object} [opts]\n *\t@param {boolean} [opts.renderSync=false]\tIf `true` and {@link options.syncComponentUpdates} is `true`, triggers synchronous rendering.\n *\t@param {boolean} [opts.render=true]\t\t\tIf `false`, no render will be triggered.\n */\nfunction setComponentProps(component, props, opts, context, mountAll) {\n\tif (component._disable) return;\n\tcomponent._disable = true;\n\n\tif (component.__ref = props.ref) delete props.ref;\n\tif (component.__key = props.key) delete props.key;\n\n\tif (!component.base || mountAll) {\n\t\tif (component.componentWillMount) component.componentWillMount();\n\t} else if (component.componentWillReceiveProps) {\n\t\tcomponent.componentWillReceiveProps(props, context);\n\t}\n\n\tif (context && context !== component.context) {\n\t\tif (!component.prevContext) component.prevContext = component.context;\n\t\tcomponent.context = context;\n\t}\n\n\tif (!component.prevProps) component.prevProps = component.props;\n\tcomponent.props = props;\n\n\tcomponent._disable = false;\n\n\tif (opts !== 0) {\n\t\tif (opts === 1 || options.syncComponentUpdates !== false || !component.base) {\n\t\t\trenderComponent(component, 1, mountAll);\n\t\t} else {\n\t\t\tenqueueRender(component);\n\t\t}\n\t}\n\n\tif (component.__ref) component.__ref(component);\n}\n\n/** Render a Component, triggering necessary lifecycle events and taking High-Order Components into account.\n *\t@param {Component} component\n *\t@param {Object} [opts]\n *\t@param {boolean} [opts.build=false]\t\tIf `true`, component will build and store a DOM node if not already associated with one.\n *\t@private\n */\nfunction renderComponent(component, opts, mountAll, isChild) {\n\tif (component._disable) return;\n\n\tvar props = component.props,\n\t    state = component.state,\n\t    context = component.context,\n\t    previousProps = component.prevProps || props,\n\t    previousState = component.prevState || state,\n\t    previousContext = component.prevContext || context,\n\t    isUpdate = component.base,\n\t    nextBase = component.nextBase,\n\t    initialBase = isUpdate || nextBase,\n\t    initialChildComponent = component._component,\n\t    skip = false,\n\t    rendered,\n\t    inst,\n\t    cbase;\n\n\t// if updating\n\tif (isUpdate) {\n\t\tcomponent.props = previousProps;\n\t\tcomponent.state = previousState;\n\t\tcomponent.context = previousContext;\n\t\tif (opts !== 2 && component.shouldComponentUpdate && component.shouldComponentUpdate(props, state, context) === false) {\n\t\t\tskip = true;\n\t\t} else if (component.componentWillUpdate) {\n\t\t\tcomponent.componentWillUpdate(props, state, context);\n\t\t}\n\t\tcomponent.props = props;\n\t\tcomponent.state = state;\n\t\tcomponent.context = context;\n\t}\n\n\tcomponent.prevProps = component.prevState = component.prevContext = component.nextBase = null;\n\tcomponent._dirty = false;\n\n\tif (!skip) {\n\t\trendered = component.render(props, state, context);\n\n\t\t// context to pass to the child, can be updated via (grand-)parent component\n\t\tif (component.getChildContext) {\n\t\t\tcontext = extend(extend({}, context), component.getChildContext());\n\t\t}\n\n\t\tvar childComponent = rendered && rendered.nodeName,\n\t\t    toUnmount,\n\t\t    base;\n\n\t\tif (typeof childComponent === 'function') {\n\t\t\t// set up high order component link\n\n\t\t\tvar childProps = getNodeProps(rendered);\n\t\t\tinst = initialChildComponent;\n\n\t\t\tif (inst && inst.constructor === childComponent && childProps.key == inst.__key) {\n\t\t\t\tsetComponentProps(inst, childProps, 1, context, false);\n\t\t\t} else {\n\t\t\t\ttoUnmount = inst;\n\n\t\t\t\tcomponent._component = inst = createComponent(childComponent, childProps, context);\n\t\t\t\tinst.nextBase = inst.nextBase || nextBase;\n\t\t\t\tinst._parentComponent = component;\n\t\t\t\tsetComponentProps(inst, childProps, 0, context, false);\n\t\t\t\trenderComponent(inst, 1, mountAll, true);\n\t\t\t}\n\n\t\t\tbase = inst.base;\n\t\t} else {\n\t\t\tcbase = initialBase;\n\n\t\t\t// destroy high order component link\n\t\t\ttoUnmount = initialChildComponent;\n\t\t\tif (toUnmount) {\n\t\t\t\tcbase = component._component = null;\n\t\t\t}\n\n\t\t\tif (initialBase || opts === 1) {\n\t\t\t\tif (cbase) cbase._component = null;\n\t\t\t\tbase = diff(cbase, rendered, context, mountAll || !isUpdate, initialBase && initialBase.parentNode, true);\n\t\t\t}\n\t\t}\n\n\t\tif (initialBase && base !== initialBase && inst !== initialChildComponent) {\n\t\t\tvar baseParent = initialBase.parentNode;\n\t\t\tif (baseParent && base !== baseParent) {\n\t\t\t\tbaseParent.replaceChild(base, initialBase);\n\n\t\t\t\tif (!toUnmount) {\n\t\t\t\t\tinitialBase._component = null;\n\t\t\t\t\trecollectNodeTree(initialBase, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (toUnmount) {\n\t\t\tunmountComponent(toUnmount);\n\t\t}\n\n\t\tcomponent.base = base;\n\t\tif (base && !isChild) {\n\t\t\tvar componentRef = component,\n\t\t\t    t = component;\n\t\t\twhile (t = t._parentComponent) {\n\t\t\t\t(componentRef = t).base = base;\n\t\t\t}\n\t\t\tbase._component = componentRef;\n\t\t\tbase._componentConstructor = componentRef.constructor;\n\t\t}\n\t}\n\n\tif (!isUpdate || mountAll) {\n\t\tmounts.unshift(component);\n\t} else if (!skip) {\n\t\t// Ensure that pending componentDidMount() hooks of child components\n\t\t// are called before the componentDidUpdate() hook in the parent.\n\t\t// Note: disabled as it causes duplicate hooks, see https://github.com/developit/preact/issues/750\n\t\t// flushMounts();\n\n\t\tif (component.componentDidUpdate) {\n\t\t\tcomponent.componentDidUpdate(previousProps, previousState, previousContext);\n\t\t}\n\t\tif (options.afterUpdate) options.afterUpdate(component);\n\t}\n\n\tif (component._renderCallbacks != null) {\n\t\twhile (component._renderCallbacks.length) {\n\t\t\tcomponent._renderCallbacks.pop().call(component);\n\t\t}\n\t}\n\n\tif (!diffLevel && !isChild) flushMounts();\n}\n\n/** Apply the Component referenced by a VNode to the DOM.\n *\t@param {Element} dom\tThe DOM node to mutate\n *\t@param {VNode} vnode\tA Component-referencing VNode\n *\t@returns {Element} dom\tThe created/mutated element\n *\t@private\n */\nfunction buildComponentFromVNode(dom, vnode, context, mountAll) {\n\tvar c = dom && dom._component,\n\t    originalComponent = c,\n\t    oldDom = dom,\n\t    isDirectOwner = c && dom._componentConstructor === vnode.nodeName,\n\t    isOwner = isDirectOwner,\n\t    props = getNodeProps(vnode);\n\twhile (c && !isOwner && (c = c._parentComponent)) {\n\t\tisOwner = c.constructor === vnode.nodeName;\n\t}\n\n\tif (c && isOwner && (!mountAll || c._component)) {\n\t\tsetComponentProps(c, props, 3, context, mountAll);\n\t\tdom = c.base;\n\t} else {\n\t\tif (originalComponent && !isDirectOwner) {\n\t\t\tunmountComponent(originalComponent);\n\t\t\tdom = oldDom = null;\n\t\t}\n\n\t\tc = createComponent(vnode.nodeName, props, context);\n\t\tif (dom && !c.nextBase) {\n\t\t\tc.nextBase = dom;\n\t\t\t// passing dom/oldDom as nextBase will recycle it if unused, so bypass recycling on L229:\n\t\t\toldDom = null;\n\t\t}\n\t\tsetComponentProps(c, props, 1, context, mountAll);\n\t\tdom = c.base;\n\n\t\tif (oldDom && dom !== oldDom) {\n\t\t\toldDom._component = null;\n\t\t\trecollectNodeTree(oldDom, false);\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n/** Remove a component from the DOM and recycle it.\n *\t@param {Component} component\tThe Component instance to unmount\n *\t@private\n */\nfunction unmountComponent(component) {\n\tif (options.beforeUnmount) options.beforeUnmount(component);\n\n\tvar base = component.base;\n\n\tcomponent._disable = true;\n\n\tif (component.componentWillUnmount) component.componentWillUnmount();\n\n\tcomponent.base = null;\n\n\t// recursively tear down & recollect high-order component children:\n\tvar inner = component._component;\n\tif (inner) {\n\t\tunmountComponent(inner);\n\t} else if (base) {\n\t\tif (base['__preactattr_'] && base['__preactattr_'].ref) base['__preactattr_'].ref(null);\n\n\t\tcomponent.nextBase = base;\n\n\t\tremoveNode(base);\n\t\tcollectComponent(component);\n\n\t\tremoveChildren(base);\n\t}\n\n\tif (component.__ref) component.__ref(null);\n}\n\n/** Base Component class.\n *\tProvides `setState()` and `forceUpdate()`, which trigger rendering.\n *\t@public\n *\n *\t@example\n *\tclass MyFoo extends Component {\n *\t\trender(props, state) {\n *\t\t\treturn <div />;\n *\t\t}\n *\t}\n */\nfunction Component(props, context) {\n\tthis._dirty = true;\n\n\t/** @public\n  *\t@type {object}\n  */\n\tthis.context = context;\n\n\t/** @public\n  *\t@type {object}\n  */\n\tthis.props = props;\n\n\t/** @public\n  *\t@type {object}\n  */\n\tthis.state = this.state || {};\n}\n\nextend(Component.prototype, {\n\n\t/** Returns a `boolean` indicating if the component should re-render when receiving the given `props` and `state`.\n  *\t@param {object} nextProps\n  *\t@param {object} nextState\n  *\t@param {object} nextContext\n  *\t@returns {Boolean} should the component re-render\n  *\t@name shouldComponentUpdate\n  *\t@function\n  */\n\n\t/** Update component state by copying properties from `state` to `this.state`.\n  *\t@param {object} state\t\tA hash of state properties to update with new values\n  *\t@param {function} callback\tA function to be called once component state is updated\n  */\n\tsetState: function setState(state, callback) {\n\t\tvar s = this.state;\n\t\tif (!this.prevState) this.prevState = extend({}, s);\n\t\textend(s, typeof state === 'function' ? state(s, this.props) : state);\n\t\tif (callback) (this._renderCallbacks = this._renderCallbacks || []).push(callback);\n\t\tenqueueRender(this);\n\t},\n\n\n\t/** Immediately perform a synchronous re-render of the component.\n  *\t@param {function} callback\t\tA function to be called after component is re-rendered.\n  *\t@private\n  */\n\tforceUpdate: function forceUpdate(callback) {\n\t\tif (callback) (this._renderCallbacks = this._renderCallbacks || []).push(callback);\n\t\trenderComponent(this, 2);\n\t},\n\n\n\t/** Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n  *\tVirtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n  *\t@param {object} props\t\tProps (eg: JSX attributes) received from parent element/component\n  *\t@param {object} state\t\tThe component's current state\n  *\t@param {object} context\t\tContext object (if a parent component has provided context)\n  *\t@returns VNode\n  */\n\trender: function render() {}\n});\n\n/** Render JSX into a `parent` Element.\n *\t@param {VNode} vnode\t\tA (JSX) VNode to render\n *\t@param {Element} parent\t\tDOM element to render into\n *\t@param {Element} [merge]\tAttempt to re-use an existing DOM tree rooted at `merge`\n *\t@public\n *\n *\t@example\n *\t// render a div into <body>:\n *\trender(<div id=\"hello\">hello!</div>, document.body);\n *\n *\t@example\n *\t// render a \"Thing\" component into #foo:\n *\tconst Thing = ({ name }) => <span>{ name }</span>;\n *\trender(<Thing name=\"one\" />, document.querySelector('#foo'));\n */\nfunction render(vnode, parent, merge) {\n  return diff(merge, vnode, {}, false, parent, false);\n}\n\nvar preact = {\n\th: h,\n\tcreateElement: h,\n\tcloneElement: cloneElement,\n\tComponent: Component,\n\trender: render,\n\trerender: rerender,\n\toptions: options\n};\n\nexport default preact;\nexport { h, h as createElement, cloneElement, Component, render, rerender, options };\n//# sourceMappingURL=preact.esm.js.map\n","/* ============================================================\n * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/\n *\n * Open source under the BSD License.\n *\n * Copyright  2008 George McGinley Smith\n * All rights reserved.\n * https://raw.github.com/danro/jquery-easing/master/LICENSE\n * ======================================================== */\n// prettier-ignore\nexport const easing = {\n  // time, begin, change, duration\n  easeInOutQuad: function (t, b, c, d) {\n    if ((t /= d / 2) < 1) return c / 2 * t * t + b;\n    return -c / 2 * ((--t) * (t - 2) - 1) + b;\n  },\n  easeInOutCubic: function (t, b, c, d) {\n    if ((t /= d / 2) < 1) return c / 2 * t * t * t + b;\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  },\n  easeInOutQuart: function (t, b, c, d) {\n    if ((t/=d/2) < 1) return c/2*t*t*t*t + b;\n    return -c/2 * ((t-=2)*t*t*t - 2) + b;\n  },\n  easeInOutQuint: function (t, b, c, d) {\n    if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;\n    return c/2*((t-=2)*t*t*t*t + 2) + b;\n  },\n  easeInOutSine: function (t, b, c, d) {\n    return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;\n  },\n  easeInOutExpo: function (t, b, c, d) {\n    if (t==0) return b;\n    if (t==d) return b+c;\n    if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;\n    return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  },\n  easeInOutCirc: function (t, b, c, d) {\n    if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;\n    return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;\n  },\n  easeInElastic: function (t, b, c, d) {\n    var s=1.70158;var p=0;var a=c;\n    if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;\n    if (a < Math.abs(c)) { a=c; var s=p/4; }\n    else var s = p/(2*Math.PI) * Math.asin (c/a);\n    return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;\n  },\n  easeOutElastic: function (t, b, c, d) {\n    var s=1.70158;var p=0;var a=c;\n    if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;\n    if (a < Math.abs(c)) { a=c; var s=p/4; }\n    else var s = p/(2*Math.PI) * Math.asin (c/a);\n    return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;\n  },\n  easeInOutElastic: function (t, b, c, d) {\n    var s=1.70158;var p=0;var a=c;\n    if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);\n    if (a < Math.abs(c)) { a=c; var s=p/4; }\n    else var s = p/(2*Math.PI) * Math.asin (c/a);\n    if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;\n    return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;\n  },\n  easeInOutBack: function (t, b, c, d, s) {\n    if (s == undefined) s = 1.70158;\n    if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;\n    return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;\n  },\n};\n","import { h } from 'preact';\nimport { Renderer } from './interface';\nimport { hierarchy, cluster as d3cluster, tree as d3tree, HierarchyPointNode } from 'd3-hierarchy';\nimport { StateVisNode } from './tree/stateVisNode'; // has or is using\n\nexport const RENDERER_PRESETS = {\n  Tree: {\n    layoutFn: TREE_LAYOUT,\n    sortNodesFn: TOP_TO_BOTTOM_SORT,\n    labelRenderFn: SLANTED_TEXT,\n    edgeRenderFn: TREE_EDGE,\n  },\n  Cluster: {\n    layoutFn: CLUSTER_LAYOUT,\n    sortNodesFn: TOP_TO_BOTTOM_SORT,\n    labelRenderFn: SLANTED_TEXT,\n    edgeRenderFn: TREE_EDGE,\n  },\n  Radial: {\n    layoutFn: RADIAL_LAYOUT,\n    sortNodesFn: BOTTOM_TO_TOP_SORT,\n    labelRenderFn: RADIAL_TEXT,\n    edgeRenderFn: RADIAL_EDGE,\n  },\n};\n\nconst tree = RENDERER_PRESETS.Tree;\n\nexport const DEFAULT_RENDERER: Renderer = {\n  baseRadius: 10,\n  baseFontSize: 12,\n  baseStrokeWidth: 2,\n  baseNodeStrokeWidth: 2,\n  zoom: 1.0,\n\n  layoutFn: tree.layoutFn,\n  sortNodesFn: tree.sortNodesFn,\n  labelRenderFn: tree.labelRenderFn,\n  edgeRenderFn: tree.edgeRenderFn,\n};\n\n///////////////////////////////////////////\n// NODE RENDER ORDER\n///////////////////////////////////////////\n\nexport function BOTTOM_TO_TOP_SORT(a: StateVisNode, b: StateVisNode) {\n  let b2t = b.layoutY - a.layoutY; // bottom to top\n  if (b2t !== 0) return b2t;\n  let l2r = a.layoutX - b.layoutX; // left to right\n  return l2r;\n}\n\nexport function TOP_TO_BOTTOM_SORT(a: StateVisNode, b: StateVisNode) {\n  let t2b = a.layoutY - b.layoutY; // top to bottom\n  if (t2b !== 0) return t2b;\n  let l2r = a.layoutX - b.layoutX; // left to right\n  return l2r;\n}\n\n///////////////////////////////////////////\n// LAYOUTS\n///////////////////////////////////////////\n\nexport function TREE_LAYOUT(rootNode: StateVisNode) {\n  let root = hierarchy(rootNode);\n  let tree = d3tree<StateVisNode>();\n  return updateNodes(tree(root));\n}\n\nexport function CLUSTER_LAYOUT(rootNode: StateVisNode) {\n  let root = hierarchy(rootNode);\n  let tree = d3cluster<StateVisNode>();\n  return updateNodes(tree(root));\n}\n\n/** For RADIAL_LAYOUT: projects x/y coords from a cluster layout to circular layout */\nfunction project(x, y) {\n  let angle = (x - 90) / 180 * Math.PI,\n    radius = y;\n  const CENTER = 0.5;\n  return { x: CENTER + radius * Math.cos(angle), y: CENTER + radius * Math.sin(angle) };\n}\n\nexport function RADIAL_LAYOUT(rootNode: StateVisNode) {\n  let root = hierarchy(rootNode);\n\n  let layout = d3cluster<StateVisNode>()\n    .size([360, 0.4])\n    .separation(function(a, b) {\n      return (a.parent == b.parent ? 1 : 2) / a.depth;\n    });\n\n  let nodes = layout(root);\n\n  nodes.each(function(node) {\n    let projected = project(node.x, node.y);\n    let visNode: StateVisNode = node.data;\n    visNode.layoutX = node.x;\n    visNode.layoutY = node.y;\n    visNode.x = projected.x;\n    visNode.y = projected.y;\n  });\n}\n\n/** Mutates each StateVisNode by copying the new x/y values from the d3 HierarchyPointNode structure */\nfunction updateNodes(nodes: HierarchyPointNode<StateVisNode>) {\n  nodes.each(node => {\n    node.data.layoutX = node.data.x = node.x;\n    node.data.layoutY = node.data.y = node.y;\n  });\n  return nodes;\n}\n\n///////////////////////////////////////////\n// STATE NAME LABEL\n///////////////////////////////////////////\n\nexport function RADIAL_TEXT(x, y, node: StateVisNode, renderer: Renderer) {\n  let { baseFontSize, zoom } = renderer;\n  let fontSize = baseFontSize * zoom;\n\n  let segments = node.name.split('.');\n  let name = segments.pop();\n  if (name == '**') name = segments.pop() + '.**';\n\n  let angle = node.layoutX || 0;\n\n  let textAnchor: string = angle < 180 === !!node.children ? 'start' : 'end';\n  let rotation = angle < 180 ? angle - 90 : angle + 90;\n  let translation = (textAnchor === 'start' ? 15 : -15) * zoom;\n\n  let transform = `rotate(${rotation}),translate(${translation}, 0)`;\n\n  return (\n    <text className=\"name\" text-anchor={textAnchor} transform={transform} font-size={fontSize}>\n      {' '}\n      {name}{' '}\n    </text>\n  );\n}\n\nexport function SLANTED_TEXT(x, y, node: StateVisNode, renderer: Renderer) {\n  let { baseRadius, baseFontSize, baseStrokeWidth, baseNodeStrokeWidth, zoom } = renderer;\n  let r = baseRadius * zoom;\n  let fontSize = baseFontSize * zoom;\n  let segments = node.name.split('.');\n  let name = segments.pop();\n  if (name == '**') name = segments.pop() + '.**';\n\n  let transform = `rotate(-15),translate(0, ${-15 * zoom})`;\n\n  return (\n    <text className=\"name\" text-anchor=\"middle\" transform={transform} font-size={fontSize}>\n      {' '}\n      {name}{' '}\n    </text>\n  );\n}\n\n///////////////////////////////////////////\n// GRAPH EDGES\n///////////////////////////////////////////\n\n/** Straight line */\nexport function RADIAL_EDGE(node: StateVisNode, renderer: Renderer) {\n  let strokeWidth = renderer.baseStrokeWidth * renderer.zoom;\n\n  const makeLinkPath = (node: StateVisNode) => {\n    let s = { x: node.animX, y: node.animY }; // statevisnode\n    let p = { x: node._parent.animX, y: node._parent.animY }; // parent\n\n    return (\n      'M' +\n      [s.x, s.y] +\n      // + \"C\"  + [s.x, (s.y + p.y) / 2.5]\n      // + \" \"  + [p.x, (s.y + p.y) / 2.5]\n      ' ' +\n      [p.x, p.y]\n    );\n  };\n\n  return <path d={makeLinkPath(node)} stroke-width={strokeWidth} className=\"link\" />;\n}\n\n/** Bezier curve */\nexport function TREE_EDGE(node: StateVisNode, renderer: Renderer) {\n  let strokeWidth = renderer.baseStrokeWidth * renderer.zoom;\n\n  const makeLinkPath = (node: StateVisNode) => {\n    let s = { x: node.animX, y: node.animY }; // statevisnode\n    let p = { x: node._parent.animX, y: node._parent.animY }; // parent\n    let yAvg = (s.y + p.y) / 2;\n    return `M ${s.x} ${s.y} C ${s.x} ${yAvg}, ${p.x} ${yAvg}, ${p.x} ${p.y}`;\n  };\n\n  return <path d={makeLinkPath(node)} stroke-width={strokeWidth} className=\"link\" />;\n}\n","/**\n * Returns a string shortened to a maximum length\n *\n * If the string is already less than the `max` length, return the string.\n * Else return the string, shortened to `max - 3` and append three dots (\"...\").\n *\n * @param max the maximum length of the string to return\n * @param str the input string\n */\nexport function maxLength(max: number, str: string) {\n  if (str.length <= max) return str;\n  return str.substr(0, max - 3) + '...';\n}\n\nfunction stringifyPattern(value) {\n  if (value === undefined) return 'undefined';\n  if (value === null) return 'null';\n  if (typeof value === 'object' && typeof value.then === 'function') return '[Promise]';\n  return value;\n}\n\nexport function stringify(o: Object) {\n  var seen: any[] = [];\n\n  function format(val: any) {\n    if (typeof val === 'object') {\n      if (seen.indexOf(val) !== -1) return '[circular ref]';\n      seen.push(val);\n    }\n    return stringifyPattern(val);\n  }\n\n  return JSON.stringify(o, (key, val) => format(val)).replace(/\\\\\"/g, '\"');\n}\n","import { h, render, Component } from 'preact';\n\nexport interface IProps {\n  router;\n}\n\nexport interface IState {\n  current?: string;\n  states?: string[];\n  deregisterFn?: Function;\n}\n\nexport class StateSelector extends Component<IProps, IState> {\n  deregisterStateListenerFn: Function;\n\n  state = {\n    current: null,\n    states: [],\n    deregisterFn: null,\n  };\n\n  componentDidMount() {\n    let router = this.props.router;\n\n    const updateStates = () => this.setState({ states: router.stateRegistry.get().map(state => state.name) });\n    const updateCurrent = trans => this.setState({ current: trans.to().name });\n\n    if (router.stateRegistry.onStatesChanged) {\n      this.deregisterStateListenerFn = router.stateRegistry.onStatesChanged(updateStates);\n    }\n\n    let deregisterFn = router.transitionService.onSuccess({}, updateCurrent);\n\n    this.setState({ current: router.globals.current.name, states: [], deregisterFn });\n    updateStates();\n  }\n\n  componentWillUnmount() {\n    if (this.state.deregisterFn) {\n      this.state.deregisterFn();\n    }\n    if (this.deregisterStateListenerFn) {\n      this.deregisterStateListenerFn();\n    }\n  }\n\n  selectState = event => {\n    let $state = this.props.router.stateService;\n    var to = event.target.value;\n    if (to) $state.go(to);\n  };\n\n  render() {\n    return (\n      <select value={this.state.current || ''} onChange={this.selectState} style={{ maxWidth: 120 }}>\n        <option value=\"\">Choose a state</option>\n        {this.state.states.map(state => (\n          <option key={state} value={state}>\n            {state}\n          </option>\n        ))}\n      </select>\n    );\n  }\n}\n","export const hasClass = classname => el => !!new RegExp(`\\\\b${classname}\\\\b`).exec(el.className);\n\nexport const addClass = classname => el => (el.className = el.className + ' ' + classname);\n\nexport const removeClass = classname => el =>\n  (el.className = el.className.replace(new RegExp(`\\\\b${classname}\\\\b`, 'g'), ''));\n\nexport const toggleClass = classname => el => {\n  if (hasClass(classname)(el)) removeClass(classname)(el);\n  else addClass(classname)(el);\n};\n","import { h, render, Component } from 'preact';\nimport { StateNode } from './StateNode';\nimport { NodeDimensions, VisDimensions, Renderer } from '../interface';\nimport { animatePath } from '../../util/animatepath';\nimport { easing } from '../../util/easing';\nimport { DEFAULT_RENDERER } from '../renderers';\nimport { createStateVisNode, StateVisNode } from './stateVisNode';\n\nexport interface IProps extends NodeDimensions, VisDimensions {\n  router?: any;\n  renderer?: Renderer;\n}\n\nexport interface IState {\n  nodes?: StateVisNode[];\n}\n\nlet resetMetadata = {\n  label: '',\n  highlight: false,\n  active: false,\n  future: false,\n  retained: false,\n  entered: false,\n  exited: false,\n  inactive: true,\n};\n\nexport class StateTree extends Component<IProps, IState> {\n  static create(router, element?, props = {}) {\n    if (!element) {\n      element = document.createElement('div');\n      element.id = 'uirStateTree';\n    }\n\n    let initialProps = { ...props, router } as IProps;\n    const _render = () => {\n      document.body.appendChild(element);\n      render(h(StateTree, initialProps), element);\n    };\n\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      _render();\n    } else {\n      document.addEventListener('DOMContentLoaded', _render as any, false);\n    }\n\n    return element;\n  }\n\n  public static defaultProps = {\n    height: 350,\n    width: 250,\n    renderer: DEFAULT_RENDERER,\n  };\n\n  state = {\n    nodes: [],\n    layout: {} as any,\n  };\n\n  nodes: StateVisNode[] = [];\n  unmounted: boolean = false;\n  deregisterHookFn: Function;\n  deregisterStateListenerFn: Function;\n\n  componentDidMount() {\n    let registry = this.props.router.stateRegistry;\n    let $transitions = this.props.router.transitionService;\n\n    // Register states changed listener\n    if (registry.onStatesChanged) {\n      this.deregisterStateListenerFn = registry.onStatesChanged(() => this.updateStates());\n    }\n    this.updateStates();\n\n    // Register onSuccess transition hook to toggle the SVG classes\n    this.deregisterHookFn = $transitions.onSuccess({}, trans => this.updateNodes(trans));\n    this.updateNodes();\n\n    let lastSuccessful = this.props.router.globals.successfulTransitions.peekTail();\n    if (lastSuccessful) {\n      this.updateNodes(lastSuccessful);\n    }\n\n    let pending = this.props.router.globals.transition;\n    if (pending) {\n      pending.promise.then(() => this.updateNodes(pending));\n    }\n  }\n\n  componentWillReceiveProps() {\n    let nodes = this.state.nodes;\n    this.setState({ nodes }, this.updateStates);\n  }\n\n  dimensions() {\n    let newProps = {} as any;\n\n    let radius = 15;\n    let offsetX = 0;\n    let offsetY = radius * 2;\n    let height = this.props.height || 500;\n    let width = this.props.width || 500;\n\n    let scaleX = newProps.scaleX || width - offsetX * 2;\n    let scaleY = newProps.scaleY || height - offsetY * 2;\n\n    return { radius, offsetX, offsetY, scaleX, scaleY };\n  }\n\n  componentWillUnmount() {\n    this.unmounted = true;\n    this.deregisterHookFn && this.deregisterHookFn();\n  }\n\n  cancelCurrentAnimation = () => null;\n\n  doLayoutAnimation = () => {\n    this.cancelCurrentAnimation();\n\n    let nodes = this.getNodes();\n    if (!nodes.length) return;\n\n    let rootNode = nodes.filter(state => state.name === '')[0];\n    this.props.renderer.layoutFn(rootNode);\n\n    // Move all non-visible nodes to same x/y coords as the nearest visible parent\n    nodes.filter(node => !node.visible).forEach(node => {\n      let visibleAncestor = node._parent;\n      while (visibleAncestor && !visibleAncestor.visible) visibleAncestor = visibleAncestor._parent;\n      if (visibleAncestor) {\n        node.x = visibleAncestor.x;\n        node.y = visibleAncestor.y;\n      }\n    });\n\n    let dimensions = this.dimensions();\n\n    // Transforms x coord from the tree layout to fit the viewport using scale/offset values\n    const transformX = xval => xval * dimensions.scaleX + dimensions.offsetX;\n    // Transforms y coord from the tree layout to fit the viewport using scale/offset values\n    const transformY = yval => yval * dimensions.scaleY + dimensions.offsetY;\n\n    const getCurrentCoords = node => ({\n      x: node.animX || this.props.width / 2,\n      y: node.animY || this.props.height / 2,\n    });\n\n    // An array containing current x/y coords for all nodes\n    // [ x1, y1, x2, y2, x3, y3, x4, y4 ]\n    let currentCoords = nodes\n      .map(getCurrentCoords)\n      .map(obj => [obj.x, obj.y])\n      .reduce((acc, arr) => acc.concat(arr), []);\n\n    // An array containing target x/y coords for all nodes\n    // [ x1', y1', x2', y2', x3', y3', x4', y4' ]\n    let targetCoords = nodes\n      .map(node => [transformX(node.x), transformY(node.y)])\n      .reduce((acc, arr) => acc.concat(arr), []);\n\n    // xyValArray is an array containing x/y coords for all nodes,\n    // interpolated between currentCoords and targetCoords based on time\n    // [ x1'', y1'', x2'', y2'', x3'', y3'', x4'', y4'' ]\n    const animationFrame = xyValArray => {\n      let tupleCount = xyValArray.length / 2;\n      for (let i = 0; i < tupleCount && i < nodes.length; i++) {\n        let node = nodes[i];\n        node.animX = xyValArray[i * 2];\n        node.animY = xyValArray[i * 2 + 1];\n      }\n\n      this.setState({ nodes });\n    };\n\n    this.cancelCurrentAnimation = animatePath(\n      targetCoords,\n      currentCoords,\n      500,\n      animationFrame,\n      () => null,\n      easing.easeInOutExpo,\n    );\n  };\n\n  nodeForState = (nodes, state) => nodes.filter(node => node.name === state.name)[0];\n\n  updateStates = () => {\n    let router = this.props.router;\n\n    let states = router.stateService.get().map(s => s.$$state());\n    let known = this.nodes.map(Object.getPrototypeOf);\n    let toAdd = states.filter(s => known.indexOf(s) === -1);\n    let toDel = known.filter(s => states.indexOf(s) === -1);\n\n    let nodes = (this.nodes = this.nodes.slice());\n\n    if (toAdd.length || toDel.length) {\n      toAdd.map(s => createStateVisNode(s)).forEach(n => nodes.push(n));\n      toDel\n        .map(del => nodes.filter(node => del.isPrototypeOf(node)))\n        .reduce((acc, x) => acc.concat(x), [])\n        .forEach(node => nodes.splice(nodes.indexOf(node), 1));\n\n      // Rebuild each node's children array\n      nodes.forEach(n => (n._children = []));\n      nodes.forEach(n => {\n        if (!n || !n.parent) return;\n        let parentNode: any = this.nodeForState(nodes, n.parent);\n        if (!parentNode) return;\n        parentNode._children.push(n);\n        n._parent = parentNode;\n      });\n      nodes.forEach(n => (n.future = !!n.lazyLoad));\n    }\n\n    if (!this.unmounted && !this.deregisterStateListenerFn) {\n      // poll if ui-router version is 1.0.0-beta.1 or earlier\n      setTimeout(this.updateStates, 1000);\n    }\n\n    this.setState({ nodes }, this.doLayoutAnimation);\n  };\n\n  updateNodes = ($transition$?) => {\n    let nodes = this.nodes.map(node => Object.assign(node, resetMetadata));\n    nodes.forEach(n => (n.future = !!n.lazyLoad));\n\n    if ($transition$) {\n      let tc = $transition$.treeChanges();\n      const getNode = node => this.nodeForState(this.nodes, node.state);\n\n      tc.retained\n        .concat(tc.entering)\n        .map(getNode)\n        .filter(x => x)\n        .forEach((n: StateVisNode) => (n.entered = true));\n      tc.retained\n        .map(getNode)\n        .filter(x => x)\n        .forEach((n: StateVisNode) => (n.retained = true));\n      tc.exiting\n        .map(getNode)\n        .filter(x => x)\n        .forEach((n: StateVisNode) => (n.exited = true));\n      tc.to\n        .slice(-1)\n        .map(getNode)\n        .filter(x => x)\n        .forEach((n: StateVisNode) => {\n          n.active = true;\n          n.label = 'active';\n        });\n    }\n\n    this.setState({ nodes: this.nodes }, this.doLayoutAnimation);\n  };\n\n  getNodes() {\n    return this.nodes.slice().sort(this.props.renderer.sortNodesFn);\n  }\n\n  render() {\n    let renderer = this.props.renderer;\n    let renderNodes = this.getNodes().filter(node => node.visible && node.animX && node.animY);\n\n    return (\n      <div className=\"statevis\">\n        <svg width={this.props.width} height={this.props.height}>\n          {renderNodes.filter(node => !!node.parent).map(node => renderer.edgeRenderFn(node, renderer))}\n\n          {renderNodes.map((node: StateVisNode) => (\n            <StateNode\n              key={node.name}\n              node={node}\n              router={this.props.router}\n              renderer={this.props.renderer}\n              doLayout={this.doLayoutAnimation.bind(this)}\n              x={node.animX}\n              y={node.animY}\n            />\n          ))}\n        </svg>\n      </div>\n    );\n  }\n}\n","// https://github.com/resin-io/triangular.js\n// http://alexandros.resin.io/angular-d3-svg/\n// MIT License https://opensource.org/licenses/MIT\n\nimport { easing } from './easing';\nimport { interpolateArray } from 'd3-interpolate';\n\n/** This animation code was taken from trangular.js, and is used to interpolate 2 arrays of values using an easing fn */\nexport function animatePath(\n  newValue,\n  oldValue,\n  duration,\n  updateFrame,\n  finishFn = function() {},\n  easeFn = easing.easeOutElastic,\n) {\n  let start = null,\n    interpolate = interpolateArray(oldValue, newValue);\n\n  let step = function(now) {\n    if (duration === -1) return finishFn();\n    if (start == null) start = now;\n    let progress = now - start,\n      percent = 1;\n    if (progress < duration) {\n      requestAnimationFrame(step);\n      percent = easeFn(progress, 0, 1, duration);\n    }\n    updateFrame(interpolate(percent));\n  };\n\n  requestAnimationFrame(step);\n\n  return function cancel() {\n    duration = -1;\n  };\n}\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getTarget = function (target) {\n  return document.querySelector(target);\n};\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(target) {\n                // If passing function in options, then use it for resolve \"head\" element.\n                // Useful for Shadow Root style i.e\n                // {\n                //   insertInto: function () { return document.querySelector(\"#foo\").shadowRoot }\n                // }\n                if (typeof target === 'function') {\n                        return target();\n                }\n                if (typeof memo[target] === \"undefined\") {\n\t\t\tvar styleTarget = getTarget.call(this, target);\n\t\t\t// Special case to return head of iframe instead of iframe itself\n\t\t\tif (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n\t\t\t\ttry {\n\t\t\t\t\t// This will throw an exception if access to iframe is blocked\n\t\t\t\t\t// due to cross-origin restrictions\n\t\t\t\t\tstyleTarget = styleTarget.contentDocument.head;\n\t\t\t\t} catch(e) {\n\t\t\t\t\tstyleTarget = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmemo[target] = styleTarget;\n\t\t}\n\t\treturn memo[target]\n\t};\n})();\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = require(\"./urls\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton && typeof options.singleton !== \"boolean\") options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n        if (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else if (typeof options.insertAt === \"object\" && options.insertAt.before) {\n\t\tvar nextSibling = getElement(options.insertInto + \" \" + options.insertAt.before);\n\t\ttarget.insertBefore(style, nextSibling);\n\t} else {\n\t\tthrow new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = options.transform(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n","import { h, Component } from 'preact';\nimport { Modal } from '../util/modal';\nimport { ResolveData } from './ResolveData';\nimport { maxLength } from '../util/strings';\n\nexport interface KeyValueClasses {\n  div?: string;\n  key?: string;\n  val?: string;\n}\n\nexport interface IKeyValueRowProps {\n  classes: KeyValueClasses;\n  modalTitle: string;\n  tuple: { key: string; val: any };\n}\n\nexport class KeyValueRow extends Component<IKeyValueRowProps, {}> {\n  render() {\n    const { tuple: { key, val }, classes, modalTitle } = this.props;\n    const showModal = () => Modal.show(modalTitle, key, val, ResolveData);\n\n    // prettier-ignore\n    const renderValue = () => {\n      if (val === undefined)                  return <span className=\"uirTranVis_code\">undefined</span>;\n      if (val === null)                       return <span className=\"uirTranVis_code\">null</span>;\n      if (typeof val === 'string')            return <span className=\"uirTranVis_code\">\"{maxLength(100, val)}\"</span>;\n      if (typeof val === 'number')            return <span className=\"uirTranVis_code\">{val.toString()}</span>;\n      if (typeof val === 'boolean')           return <span className=\"uirTranVis_code\">{val.toString()}</span>;\n      if (Array.isArray(val))                 return <span className=\"link\" onClick={showModal}>[Array]</span>;\n      if (typeof val === 'object')            return <span className=\"link\" onClick={showModal}>[Object]</span>;\n      if (typeof val.toString === 'function') return <span>{maxLength(100, val.toString())}</span>;\n    };\n\n    return (\n      <div className={classes.div}>\n        <div className={classes.key}>{key}:</div>\n        <div className={classes.val}>{renderValue()}</div>\n      </div>\n    );\n  }\n}\n\ninterface Bucket {\n  label: string;\n  is: (val) => boolean;\n  value?: any;\n  count: number;\n  data: { [key: string]: any };\n}\n\nexport interface IGroupDefinition {\n  value: any;\n  label: string;\n}\n\nexport interface IKeysAndValuesProps {\n  data: any;\n  classes: KeyValueClasses;\n  modalTitle?: string;\n  groupedValues?: IGroupDefinition[];\n  enableGroupToggle?: boolean;\n}\n\nexport interface IKeysAndValuesState {\n  collapseFalsy: boolean;\n}\n\nexport class KeysAndValues extends Component<IKeysAndValuesProps, IKeysAndValuesState> {\n  public static falsyGroupDefinitions: IGroupDefinition[] = [\n    { value: undefined, label: 'undefined' },\n    { value: null, label: 'null' },\n    { value: '', label: 'empty string' },\n  ];\n  state = { collapseFalsy: true };\n\n  private makeBuckets(definitions: IGroupDefinition[], data: { [key: string]: any }): Bucket[] {\n    const makeBucket = (def: IGroupDefinition): Bucket => ({\n      label: def.label,\n      is: val => val === def.value,\n      value: def.value,\n      count: 0,\n      data: {},\n    });\n\n    let defaultBucket = {\n      label: 'default',\n      is: () => true,\n      count: 0,\n      data: {},\n    };\n\n    const buckets = definitions.map(makeBucket).concat(defaultBucket);\n\n    Object.keys(data).forEach(key => {\n      const bucket = buckets.find(bucket => bucket.is(data[key]));\n      bucket.data[key] = data[key];\n      bucket.value = data[key];\n      bucket.count++;\n    });\n\n    return buckets;\n  }\n\n  render() {\n    const { data, classes, modalTitle } = this.props;\n\n    const groupedValues = this.props.groupedValues || KeysAndValues.falsyGroupDefinitions;\n    const enableGroupToggle = this.props.enableGroupToggle || false;\n\n    const isCollapsed = this.state.collapseFalsy;\n\n    const buckets: Bucket[] = this.makeBuckets(groupedValues, data);\n    const defaultBucket = buckets.find(bucket => bucket.label === 'default');\n    const groupedBuckets = buckets.filter(bucket => !!bucket.count && bucket !== defaultBucket);\n    const groupedCount = groupedBuckets.reduce((total, bucket) => (total += bucket.count), 0);\n\n    const tuples = Object.keys(defaultBucket.data).map(key => ({ key, val: defaultBucket.data[key] }));\n    const groupedTuples = groupedBuckets.map(bucket => {\n      const key = Object.keys(bucket.data)\n        .sort()\n        .join(', ');\n      const val = bucket.value;\n      return { key, val };\n    });\n\n    const showGroupToggle = enableGroupToggle && groupedCount > 1;\n\n    return (\n      <div className=\"uirTranVis_keysAndValues\">\n        {tuples.map(tuple => <KeyValueRow key={tuple.key} tuple={tuple} classes={classes} modalTitle={modalTitle} />)}\n\n        {showGroupToggle &&\n          !!groupedTuples.length && (\n            <a\n              href=\"javascript:void(0)\"\n              onClick={() => this.setState({ collapseFalsy: !isCollapsed })}\n              className=\"uirTranVis_keyValue\"\n            >\n              {isCollapsed ? 'show' : 'hide'} {groupedCount} {groupedBuckets.map(bucket => bucket.label).join(' or ')}{' '}\n              parameter values\n            </a>\n          )}\n\n        {(!showGroupToggle || !this.state.collapseFalsy) &&\n          groupedTuples.map(tuple => (\n            <KeyValueRow key={tuple.key} tuple={tuple} classes={classes} modalTitle={modalTitle} />\n          ))}\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\n\nexport interface IProps {}\nexport interface IState {}\nexport class Modal extends Component<IProps, IState> {\n  _ref: any;\n\n  static show = (modalTitle: string, id: string, value: any, component) => {\n    let modal = document.body.querySelector('#uirTranVis_modal');\n    if (!modal) {\n      modal = document.createElement('div');\n      modal.id = 'uirTranVis_modal';\n      document.body.appendChild(modal);\n    }\n\n    const Nothing = () => null;\n    const close = () => render(<Nothing />, document.body, modal);\n    render(h(component, { close, modalTitle, id, value }), modal);\n  };\n\n  componentDidMount() {\n    let el = this._ref;\n    setTimeout(() => {\n      let fades = el.getElementsByClassName('uir-fade');\n      [].slice.apply(fades).forEach(node => (node.className += ' in'));\n    }, 35);\n  }\n\n  render() {\n    return (\n      <div ref={ref => (this._ref = ref)}>\n        <div className=\"uirTranVis_modal-backdrop uir-fade\" style={{ zIndex: 1040 }} />\n\n        <div tabIndex={-1} className=\"uirTranVis_modal uir-fade\" style={{ zIndex: 1050, display: 'block' }}>\n          <div className=\"uirTranVis_modal-dialog modal-lg\">\n            <div className=\"uirTranVis_modal-content\">{this.props.children}</div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import { render, h } from 'preact';\nimport { UIRouter, UIRouterPlugin } from '@uirouter/core';\nimport { StateSelector } from './selector/StateSelector';\nimport { StateVisualizer } from './statevis/StateVisualizer';\nimport { StateTree } from './statevis/tree/StateTree';\nimport { TransitionVisualizer } from './transition/TransitionVisualizer';\n\nconst visualizer = (router: UIRouter) => new Visualizer(router, {});\n\nexport interface Options {\n  state?: boolean;\n  transition?: boolean;\n}\n\nfunction unmountComponent(node) {\n  let Nothing = () => null;\n  render(h(Nothing as any, null), document.body, node);\n}\n\nconst DEFAULTS = {\n  state: true,\n  transition: true,\n};\n\nclass Visualizer implements UIRouterPlugin {\n  name: string = 'visualizer';\n  private stateVisualizerEl: Element;\n  private transitionVisualizerEl: Element;\n\n  dispose(router?: UIRouter): any {\n    this.stateVisualizerEl && unmountComponent(this.stateVisualizerEl);\n    this.transitionVisualizerEl && unmountComponent(this.transitionVisualizerEl);\n    this.stateVisualizerEl = null;\n    this.transitionVisualizerEl = null;\n  }\n\n  constructor(public router: UIRouter, options: Options) {\n    options = Object.assign({}, DEFAULTS, options);\n    if (options.state) {\n      this.stateVisualizerEl = StateVisualizer.create(router);\n    }\n    if (options.transition) {\n      this.transitionVisualizerEl = TransitionVisualizer.create(router);\n    }\n  }\n}\n\n// Visualizer: router.plugin(Visualizer);\n// visualizer: visualizer(router);\n// StateVisualizer: StateVisualizer.create(router, el?, props?)\n// StateTree: StateTree.create(router, el?, props?)\n// TransitionVisualizer: TransitionVisualizer.create(router, el?, props?)\n// StateSelector: React State Selector component\nexport { Visualizer, visualizer, StateVisualizer, StateTree, TransitionVisualizer, StateSelector };\n","import { h, render, Component } from 'preact';\nimport { StateSelector } from '../selector/StateSelector';\nimport { toggleClass, addClass } from '../util/toggleClass';\nimport { draggable, dragActions } from '../util/draggable';\nimport { StateTree } from './tree/StateTree';\nimport { Controls } from './Controls';\nimport { StateVisWindow } from './StateVisWindow';\nimport { DEFAULT_RENDERER, RENDERER_PRESETS } from './renderers';\nimport { Renderer } from './interface';\n\ndeclare function require(string): string;\nrequire('./statevis.css');\n\nexport interface IProps {\n  router;\n  minimizeAfter?: number; // ms\n  width?: number; // px\n  height?: number; // px\n}\n\nexport interface IState {\n  height?: number;\n  width?: number;\n  renderer?: Renderer;\n  minimized: boolean;\n}\n\nexport class StateVisualizer extends Component<IProps, IState> {\n  state = { height: null, width: null, renderer: DEFAULT_RENDERER, minimized: false };\n\n  private minimizeTimeout: any;\n  private deregisterFns: Function[] = [];\n  private window: StateVisWindow;\n\n  /**\n   * Creates a new StateVisualizer and adds it to the document.\n   *\n   * @param router the UIRouter object\n   * @param element (optional) the element where the StateVisualizer should be placed.\n   *                If no element is passed, an element will be created in the body.\n   * @param props height/width properties default: { height: 350, width: 250 }\n   *\n   * # Angular 1 + UI-Router (1.0.0-beta.2 and higher):\n   *\n   * Inject the router (`$uiRouter`) in a run block, then call StateVisualizer.create();\n   *\n   * ```\n   * app.run(function($uiRouter) {\n   *   StateVisualizer.create($uiRouter);\n   * });\n   * ```\n   *\n   * # Angular 1 + UI-Router 1.0.0-alpha.1 through 1.0.0-beta.1:\n   *\n   * Inject the router (`ng1UIRouter`) in a run block, then call StateVisualizer.create();\n   *\n   * ```\n   * app.run(function(ng1UIRouter) {\n   *   StateVisualizer.create(ng1UIRouter);\n   * });\n   * ```\n   *\n   * Angular 2:\n   *\n   * Call StateVisualizer.create() from your UIRouterConfig\n   *\n   * ```\n   * export class MyUIRouterConfig extends UIRouterConfig {\n   *   configure(router: UIRouter) {\n   *     StateVisualizer.create(router);\n   *   }\n   * }\n   * ```\n   *\n   * React:\n   *\n   * Call StateVisualizer.create() from your bootstrap\n   *\n   * ```\n   * let router = new UIRouterReact();\n   * StateVisualizer.create(router);\n   * router.start();\n   * ```\n   *\n   * @return the element that was bootstrapped.\n   *         You can destroy the component using:\n   *         [ReactDOM.unmountComponentAtNode](https://facebook.github.io/react/docs/top-level-api.html#reactdom.unmountcomponentatnode)\n   */\n  static create(router, element?, props = {}) {\n    if (!element) {\n      element = document.createElement('div');\n      element.id = 'uirStateVisualizer';\n    }\n\n    let initialProps: IProps = Object.assign({}, props, { router, minimizeAfter: 2500 });\n    const _render = () => {\n      document.body.appendChild(element);\n      render(h(StateVisualizer, initialProps), element);\n    };\n\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      _render();\n    } else {\n      document.addEventListener('DOMContentLoaded', _render as any, false);\n    }\n\n    return element;\n  }\n\n  el: HTMLElement;\n  windowEl: HTMLElement;\n\n  dispose() {\n    let Nothing = () => null;\n    render(h(Nothing as any, null), document.body, this.el);\n  }\n\n  handleRendererChange(renderer: Renderer) {\n    this.setState({ renderer });\n  }\n\n  cancelAutoMinimize(ev) {\n    if (this.minimizeTimeout) {\n      clearTimeout(this.minimizeTimeout);\n      this.minimizeTimeout = null;\n    }\n  }\n\n  componentWillUnmount() {\n    this.deregisterFns.forEach(fn => fn());\n  }\n\n  draggable(enaabled: boolean) {\n    let controlsEl = this.windowEl.querySelector('.uirStateVisControls');\n    let visEl = this.windowEl.querySelector('.statevis');\n    this.deregisterFns.push(draggable(controlsEl, dragActions.move(this.windowEl)));\n    this.deregisterFns.push(draggable(visEl, dragActions.move(this.windowEl)));\n  }\n\n  componentDidMount() {\n    this.draggable(true);\n\n    if (this.props.minimizeAfter) {\n      const doMinimize = () => this.setState({ minimized: true });\n      this.minimizeTimeout = setTimeout(doMinimize, this.props.minimizeAfter);\n    }\n  }\n\n  svgWidth = () => this.props.width || this.state.width || 350;\n  svgHeight = () => (this.props.height || this.state.height || 250) - 25;\n\n  render() {\n    const { minimized } = this.state;\n    return (\n      <div\n        ref={el => (this.el = el as HTMLElement)}\n        onMouseDown={this.cancelAutoMinimize.bind(this)}\n        onMouseEnter={this.cancelAutoMinimize.bind(this)}\n      >\n        <StateVisWindow\n          minimized={this.state.minimized}\n          ref={windowRef => (this.windowEl = (windowRef && windowRef.el) || this.windowEl)}\n          onResize={({ width, height }) => this.setState({ width, height })}\n        >\n          <div\n            onClick={() => this.setState({ minimized: false })}\n            className={`uirStateVisWindowOverlay ${minimized ? 'minimized' : ''}`}\n          />\n\n          <Controls\n            router={this.props.router}\n            onRendererChange={this.handleRendererChange.bind(this)}\n            onMinimize={() => this.setState({ minimized: true })}\n            onClose={() => this.dispose()}\n          />\n\n          <StateTree\n            router={this.props.router}\n            width={this.svgWidth()}\n            height={this.svgHeight()}\n            renderer={this.state.renderer}\n          />\n        </StateVisWindow>\n      </div>\n    );\n  }\n}\n","import { addClass } from './toggleClass';\n\nexport interface DragDetails {\n  initialClientX: number;\n  initialClientY: number;\n  lastClientX: number;\n  lastClientY: number;\n  newClientX: number;\n  newClientY: number;\n}\n\nexport interface DragCallback {\n  (el: Element, event: Event, details: DragDetails): void;\n}\n\nconst moveElement = (elementToMove: HTMLElement) =>\n  function _moveElement(elementBeingDragged: HTMLElement, event: MouseEvent, details: DragDetails) {\n    let { initialClientX, initialClientY, lastClientX, lastClientY, newClientX, newClientY } = details;\n\n    let el = elementToMove;\n    let bounds = el.getBoundingClientRect();\n    let { left, top } = bounds;\n    let dx = newClientX - lastClientX;\n    let dy = newClientY - lastClientY;\n\n    el.style.right = 'auto';\n    el.style.bottom = 'auto';\n    el.style.left = left + dx + 'px';\n    el.style.top = top + dy + 'px';\n  };\n\nexport const dragActions = {\n  move: moveElement,\n};\n\nexport function draggable(el, callback: DragCallback) {\n  let enabled = true;\n  let isDragging = false;\n  let initialClientX = 0,\n    initialClientY = 0;\n  let lastClientX = 0,\n    lastClientY = 0;\n\n  const mouseDownListener = (e: MouseEvent) => {\n    if (!enabled) return;\n    isDragging = true;\n\n    lastClientX = initialClientX = e.clientX;\n    lastClientY = initialClientY = e.clientY;\n\n    const dragListener = e => {\n      if (!enabled || !isDragging) return;\n      e.preventDefault();\n      let newClientX = e.clientX,\n        newClientY = e.clientY;\n      callback(el, e, { initialClientX, initialClientY, lastClientX, lastClientY, newClientX, newClientY });\n      lastClientX = newClientX;\n      lastClientY = newClientY;\n    };\n\n    const doneDragging = e => {\n      isDragging = false;\n      document.removeEventListener('mousemove', dragListener);\n      document.removeEventListener('mouseup', doneDragging);\n    };\n\n    document.addEventListener('mousemove', dragListener);\n    document.addEventListener('mouseup', doneDragging);\n  };\n\n  addClass('draggable')(el);\n  el.addEventListener('mousedown', mouseDownListener);\n  return () => el.removeEventListener('mousedown', mouseDownListener);\n}\n","import { h, render, Component } from 'preact';\nimport { Renderer } from '../interface';\nimport { StateVisNode } from './stateVisNode';\n\nexport interface IProps {\n  router: any;\n  node: StateVisNode;\n  renderer: Renderer;\n  doLayout: Function;\n  x: number;\n  y: number;\n}\n\nexport interface IState {}\nexport class StateNode extends Component<IProps, IState> {\n  goTimeout = null;\n\n  handleCollapseClicked = event => {\n    clearTimeout(this.goTimeout);\n    this.props.node._collapsed = !this.props.node._collapsed;\n    this.props.doLayout();\n  };\n\n  handleGoClicked = event => {\n    clearTimeout(this.goTimeout);\n    let stateName = this.props.node.name;\n    stateName = stateName.replace(/\\.\\*\\*$/, '');\n    this.goTimeout = setTimeout(() => this.props.router.stateService.go(stateName), 200);\n  };\n\n  render() {\n    let renderer = this.props.renderer;\n    let { node, x, y } = this.props;\n\n    let { baseRadius, baseFontSize, baseNodeStrokeWidth, zoom } = renderer;\n    let r = baseRadius * zoom;\n\n    let fontSize = baseFontSize * zoom;\n    let nodeStrokeWidth = baseNodeStrokeWidth * (node.entered ? 1.5 : 1) * zoom;\n\n    let classes = ['entered', 'retained', 'exited', 'active', 'inactive', 'future', 'highlight', 'collapsed'];\n    let circleClasses = classes.reduce((str, clazz) => str + (node[clazz] ? ` ${clazz} ` : ''), '');\n\n    let descendents = node.collapsed ? node.totalDescendents : 0;\n\n    return (\n      <g transform={`translate(${x}, ${y})`} onClick={this.handleGoClicked} onDblClick={this.handleCollapseClicked}>\n        <circle className={circleClasses} stroke-width={nodeStrokeWidth} r={r} />\n\n        {!node.collapsed ? (\n          ''\n        ) : (\n          <text className=\"label\" text-anchor=\"middle\" font-size={fontSize * (descendents < 10 ? 1.0 : 0.8)}>\n            ({descendents})\n          </text>\n        )}\n\n        {renderer.labelRenderFn(x, y, node, renderer)}\n\n        <text className=\"label\" text-anchor=\"middle\" font-size={fontSize} transform={`translate(0, ${r * 2})`}>\n          {node.label}\n        </text>\n      </g>\n    );\n  }\n}\n","import { StateObject } from '@uirouter/core';\n\nexport interface StateVisNode {\n  name: string;\n\n  label: string;\n  highlight: boolean;\n  active: boolean;\n  retained: boolean;\n  exited: boolean;\n  entered: boolean;\n  inactive: boolean;\n  _collapsed: boolean;\n  readonly collapsed: boolean;\n  readonly visible: boolean;\n  parent: StateObject;\n  _parent: StateVisNode;\n  _children: StateVisNode[];\n  readonly children: StateVisNode[];\n  future: boolean;\n  lazyLoad: any;\n  readonly totalDescendents: number;\n\n  _classes: string;\n\n  /** Original x coordinate from d3 layout: tree() or cluster() */\n  layoutX: number;\n  /** Original y coordinate from d3 layout: tree() or cluster() */\n  layoutY: number;\n\n  /** Projected x coordinate (i.e., for radial projection) */\n  x: number;\n  /** Projected y coordinate (i.e., for radial projection) */\n  y: number;\n\n  /** Current animation frame's x coordinate */\n  animX: number;\n  /** Current animation frame's y coordinate */\n  animY: number;\n}\n\nexport function createStateVisNode(state: StateObject): StateVisNode {\n  let node: StateVisNode = Object.create(state) as any;\n\n  Object.defineProperty(node, 'visible', {\n    get() {\n      if (this.entered) return true;\n      let ancestorCollapsed = this._parent && (this._parent.collapsed || !this._parent.visible);\n      return !ancestorCollapsed;\n    },\n  });\n\n  Object.defineProperty(node, 'children', {\n    get() {\n      return this._children.filter(child => child.visible);\n    },\n  });\n\n  Object.defineProperty(node, 'totalDescendents', {\n    get() {\n      return this._children.reduce((acc, child) => acc + child.totalDescendents, this._children.length);\n    },\n  });\n\n  Object.defineProperty(node, 'collapsed', {\n    get() {\n      return !this.entered && this._collapsed && this._children.length;\n    },\n  });\n\n  return node;\n}\n","import { h, Component } from 'preact';\nimport { StateSelector } from '../selector/StateSelector';\nimport { RENDERER_PRESETS, DEFAULT_RENDERER } from './renderers';\nimport { LayoutPrefs } from './LayoutPrefs';\nimport { Renderer } from './interface';\nimport { UIRouter } from '@uirouter/core';\n\nimport { ChevronDown } from './icons/ChevronDown';\nimport { Close } from './icons/Close';\nimport { Gear } from './icons/Gear';\nimport { Help } from './icons/Help';\n\nexport interface IControlsProps {\n  router: UIRouter;\n  onRendererChange: (renderer: Renderer) => void;\n  onMinimize: () => void;\n  onClose: () => void;\n}\n\nexport interface IControlsState {\n  showRendererPrefs: boolean;\n}\n\ndeclare function require(string): string;\nconst imgChevron = require('../../images/16/chevron-down.png');\n\nexport class Controls extends Component<IControlsProps, IControlsState> {\n  state = {\n    showRendererPrefs: false,\n  };\n\n  render() {\n    return (\n      <div style={{ width: '100%' }}>\n        <div className=\"uirStateVisControls\">\n          <StateSelector router={this.props.router} />\n          <div style={{ marginLeft: 'auto', cursor: 'pointer' }} className=\"uirStateVisIcons\">\n            <span className=\"uirStateVisHover\">\n              <Help size=\"16px\" />\n              <div className=\"hoverBlock\">\n                <ul>\n                  <li>Click a node to activate that state.</li>\n                  <li>Select a state from the dropdown to activate that state.</li>\n                  <li>\n                    Double click a node to auto-collapse that section of the tree when inactive. Collapsed nodes are\n                    displayed with a dotted outline and the count of collapsed children.\n                  </li>\n                  <li>Lazy loaded states (including future states) are displayed with a dashed outline.</li>\n                </ul>\n              </div>\n            </span>\n\n            <span className=\"uirStateVisHover\">\n              <Gear size=\"16px\" />\n              <div className=\"hoverBlock\">\n                <LayoutPrefs onRendererChange={this.props.onRendererChange} />\n              </div>\n            </span>\n\n            <span className=\"uirStateVisHover\" onClick={this.props.onMinimize}>\n              <ChevronDown size=\"16px\" />\n              <div>\n                <span style={{ float: 'right' }}>Minimize</span>\n              </div>\n              <div>Minimize</div>\n            </span>\n\n            <span className=\"uirStateVisHover\" onClick={this.props.onClose}>\n              <Close size=\"16px\" />\n              <div>\n                <span style={{ float: 'right' }}>Close</span>\n              </div>\n            </span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import { h, Component } from 'preact';\nimport { StateSelector } from '../selector/StateSelector';\nimport { RENDERER_PRESETS, DEFAULT_RENDERER } from './renderers';\nimport { Renderer } from './interface';\nimport { UIRouter } from '@uirouter/core';\n\nexport interface ILayoutPrefsProps {\n  onRendererChange: (renderer: Renderer) => void;\n}\n\nexport interface ILayoutPrefsState {\n  renderer: Renderer;\n  presetName: string;\n}\n\nexport class LayoutPrefs extends Component<ILayoutPrefsProps, ILayoutPrefsState> {\n  state = {\n    renderer: DEFAULT_RENDERER,\n    presetName: 'Tree',\n  };\n\n  componentDidMount() {\n    this.props.onRendererChange(this.state.renderer);\n  }\n\n  handleZoom(event: Event) {\n    let el = event.target;\n    let value = parseFloat(el['value']);\n    let renderer = { ...this.state.renderer, zoom: value };\n    this.setState({ renderer });\n    this.props.onRendererChange(renderer);\n  }\n\n  handleLayout(event: Event) {\n    let presetName = event.target['value'];\n    let settings = RENDERER_PRESETS[presetName];\n    let renderer = { ...this.state.renderer, ...settings };\n    this.setState({ renderer, presetName });\n    this.props.onRendererChange(renderer);\n  }\n\n  render() {\n    return (\n      <div\n        className=\"uirStateVisLayoutPrefs\"\n        style={{ display: 'flex', flexFlow: 'column nowrap' }}\n        onMouseDown={evt => evt.stopPropagation()}\n      >\n        <div style={{ flex: '1 1 auto', display: 'flex', flexFlow: 'row nowrap', alignItems: 'center' }}>\n          <div>Layout:</div>\n          <select\n            style={{ marginLeft: 'auto', maxWidth: '100px' }}\n            onChange={this.handleLayout.bind(this)}\n            value={this.state.presetName}\n          >\n            {Object.keys(RENDERER_PRESETS).map(preset => <option value={preset}>{preset}</option>)}\n          </select>\n        </div>\n\n        <div style={{ flex: '1 1 auto', display: 'flex', flexFlow: 'row nowrap', alignItems: 'center' }}>\n          <span>Node size:</span>\n          <input\n            style={{ marginLeft: 'auto' }}\n            value={'' + this.state.renderer.zoom}\n            type=\"range\"\n            min=\"0.3\"\n            max=\"3.0\"\n            step=\"0.1\"\n            onInput={this.handleZoom.bind(this)}\n          />\n          <span>{this.state.renderer.zoom}x</span>\n        </div>\n      </div>\n    );\n  }\n}\n","import { h } from 'preact';\nexport const ChevronDown = ({ size }) => (\n  <svg width={size} height={size} viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M1683 808l-742 741q-19 19-45 19t-45-19l-742-741q-19-19-19-45.5t19-45.5l166-165q19-19 45-19t45 19l531 531 531-531q19-19 45-19t45 19l166 165q19 19 19 45.5t-19 45.5z\" />\n  </svg>\n);\n","import { h } from 'preact';\nexport const Close = ({ size }) => (\n  <svg width={size} height={size} viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z\" />\n  </svg>\n);\n","import { h } from 'preact';\nexport const Gear = ({ size }) => (\n  <svg width={size} height={size} viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z\" />\n  </svg>\n);\n","import { h } from 'preact';\nexport const Help = ({ size }) => (\n  <svg width={size} height={size} viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M1008 1200v160q0 14-9 23t-23 9h-160q-14 0-23-9t-9-23v-160q0-14 9-23t23-9h160q14 0 23 9t9 23zm256-496q0 50-15 90t-45.5 69-52 44-59.5 36q-32 18-46.5 28t-26 24-11.5 29v32q0 14-9 23t-23 9h-160q-14 0-23-9t-9-23v-68q0-35 10.5-64.5t24-47.5 39-35.5 41-25.5 44.5-21q53-25 75-43t22-49q0-42-43.5-71.5t-95.5-29.5q-56 0-95 27-29 20-80 83-9 12-25 12-11 0-19-6l-108-82q-10-7-12-20t5-23q122-192 349-192 129 0 238.5 89.5t109.5 214.5zm-368-448q-130 0-248.5 51t-204 136.5-136.5 204-51 248.5 51 248.5 136.5 204 204 136.5 248.5 51 248.5-51 204-136.5 136.5-204 51-248.5-51-248.5-136.5-204-204-136.5-248.5-51zm768 640q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z\" />\n  </svg>\n);\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAAeklEQVQ4je2PwQmAMBAEpwuJLfkSJQ+txBKsT0RsxQj6uUAMXkTx4cOF+2R39i7w61X1wACYRMZIpo+NDthkJqXEiOdzXWiWgEuUxLAT5qAaWILQDORABozB+wq02h/tySXxZqvB2iXh5uYK1kpuwV6VlDyCvQqZD2sHTn0xdO0A9D4AAAAASUVORK5CYII=\"","import { h, render, Component } from 'preact';\nimport { StateSelector } from '../selector/StateSelector';\nimport { toggleClass, addClass } from '../util/toggleClass';\nimport { draggable, dragActions } from '../util/draggable';\nimport { StateTree } from './tree/StateTree';\nimport { Controls } from './Controls';\nimport { DEFAULT_RENDERER, RENDERER_PRESETS } from './renderers';\nimport { Renderer } from './interface';\n\nexport interface IProps {\n  minimized?: boolean; // ms\n  onResize?: (dimensions: { width: number; height: number }) => void;\n}\n\nexport interface IState {\n  unminimize: Function;\n}\n\n/** A floating window that supports minimization and resizing  */\nexport class StateVisWindow extends Component<IProps, IState> {\n  private deregisterFns: Function[] = [];\n\n  el: HTMLElement;\n  top: string;\n  left: string;\n  right: string;\n  bottom: string;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.state = {\n      unminimize: null,\n    };\n  }\n\n  componentWillReceiveProps(nextProps: IProps) {\n    if (this.props.minimized !== nextProps.minimized) {\n      const { unminimize } = this.state;\n      if (unminimize) {\n        this.setState({ unminimize: null }, () => unminimize());\n      } else {\n        this.setState({ unminimize: this.minimize() });\n      }\n    }\n  }\n\n  minimize = () => {\n    // evt && evt.preventDefault();\n    // evt && evt.stopPropagation();\n\n    let el = this.el;\n    let bounds = el.getBoundingClientRect();\n\n    this.top = bounds.top + 'px';\n    this.left = bounds.left + 'px';\n    this.right = window.innerWidth - bounds.right + 'px';\n    this.bottom = window.innerHeight - bounds.bottom + 'px';\n\n    el.style.top = 'auto';\n    el.style.left = 'auto';\n    el.style.right = this.right;\n    el.style.bottom = this.bottom;\n\n    let unminimize = () => {\n      el.style.top = 'auto';\n      el.style.left = 'auto';\n      el.style.right = this.right;\n      el.style.bottom = this.bottom;\n\n      toggleClass('minimized')(el);\n      el.removeEventListener('click', unminimize);\n      const animationEndListener = evt => {\n        let bounds = el.getBoundingClientRect();\n        el.style.top = bounds.top + 'px';\n        el.style.left = bounds.left + 'px';\n        el.style.right = 'auto';\n        el.style.bottom = 'auto';\n        el.removeEventListener('transitionend', animationEndListener);\n      };\n      el.addEventListener('transitionend', animationEndListener);\n    };\n\n    addClass('minimized')(el);\n\n    // wait 50ms to avoid coordinates jumping directly to 0/0 and avoid animation\n    setTimeout(() => (el.style.right = el.style.bottom = '0'), 50);\n    return unminimize;\n  };\n\n  componentWillUnmount() {\n    this.deregisterFns.forEach(fn => fn());\n  }\n\n  componentDidMount() {\n    if (typeof MutationObserver === 'function') {\n      this.monitorResizeEvents();\n    }\n  }\n\n  /** The uirStateVisContainer class enables resize: both. This function listens for resize events */\n  monitorResizeEvents() {\n    let _width = this.el.style.width;\n    let _height = this.el.style.height;\n\n    let observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        if (mutation.attributeName == 'style') {\n          let el = mutation.target,\n            newwidth = el['style'].width,\n            newheight = el['style'].height;\n\n          if (newwidth !== _width || newheight !== _height) {\n            _width = newwidth;\n            _height = newheight;\n            let width = parseInt(newwidth.replace(/px$/, ''));\n            let height = parseInt(newheight.replace(/px$/, ''));\n            this.props.onResize({ width, height });\n          }\n        }\n      });\n    });\n\n    let config = {\n      attributes: true,\n      childList: false,\n      characterData: false,\n      subtree: false,\n      attributeFilter: ['style'],\n    };\n\n    observer.observe(this.el, config);\n    this.deregisterFns.push(() => observer.disconnect());\n  }\n\n  render() {\n    return (\n      <div className=\"uirStateVisContainer\" ref={el => (this.el = el as HTMLElement)}>\n        {this.props.children}\n      </div>\n    );\n  }\n}\n","\nvar content = require(\"!!../../node_modules/css-loader/index.js?sourceMap-loader!./statevis.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":false,\"attrs\":{\"nonce\":\"uiroutervisualizer\"}}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\n","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* http://meyerweb.com/eric/tools/css/reset/\\n   v2.0 | 20110126\\n   License: none (public domain)\\n*/\\n\\n#uirStateVisualizer {\\n    margin: 0;\\n    padding: 0;\\n    border: 0;\\n    font-size: 16px;\\n    font-family: sans-serif;\\n    font-weight: normal;\\n    vertical-align: baseline;\\n    line-height: 1;\\n    display: block;\\n    box-sizing: content-box;\\n}\\n#uirStateVisualizer svg {\\n    box-sizing: content-box;\\n}\\n\\n.uirStateVisContainer {\\n    z-index: 3;\\n    position: fixed;\\n    right: 32px;\\n    bottom: 64px;\\n    display: flex;\\n    flex-direction: column;\\n    align-items: center;\\n    background-color: rgba(255, 255, 255, 0.8);\\n    transform: scale(1);\\n    transform-origin: right bottom;\\n    transition: right 0.5s ease, bottom 0.5s ease, transform 0.5s ease;\\n    overflow: hidden;\\n    resize: both;\\n}\\n\\n.uirStateVisContainer.minimized {\\n    cursor: pointer;\\n    transform: scale(0.25);\\n    z-index: 60;\\n}\\n\\n.uirStateVisContainer:hover {\\n    outline: 2px solid rgba(0,0,0,0.35)\\n}\\n\\n.uirStateVisContainer:hover .uirStateVisControls {\\n    visibility: visible;\\n}\\n\\n.uirStateVisContainer .uirStateVisControls {\\n    visibility: hidden;\\n    display: flex;\\n    width: 100%;\\n    flex-flow: row nowrap;\\n    justify-content: space-between;\\n    flex: 1 0 auto;\\n    z-index: 1;\\n}\\n\\n.uirStateVisContainer .uirStateVisControls .uirStateVisIcons span svg {\\n    padding: 3px;\\n    fill: #777777;\\n}\\n\\n.uirStateVisContainer .uirStateVisControls .uirStateVisIcons span:hover svg {\\n    fill: black;\\n}\\n\\n.uirStateVisHover > div {\\n    transition: opacity 500ms ease;\\n    opacity: 0;\\n    height: 0;\\n    padding: 0;\\n\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    overflow: hidden;\\n\\n    margin-top: 26px;\\n    font-size: 14px;\\n}\\n\\n.uirStateVisHover > div.hoverBlock {\\n    left: 0;\\n    border-bottom: none;\\n    background: white;\\n}\\n\\n.uirStateVisHover:hover > div.hoverBlock {\\n    border-bottom: 2px solid lightgrey;\\n}\\n\\n\\n.uirStateVisHover:hover > div {\\n    opacity: 1;\\n    height: auto;\\n}\\n\\n.uirStateVisHover .uirStateVisLayoutPrefs {\\n    padding: 12px 24px;\\n}\\n\\n.uirStateVisContainer .statevis {\\n    flex: 1 1 auto;\\n    transition: all 1s ease;\\n}\\n\\n.uirStateVisWindowOverlay {\\n    display: none;\\n}\\n\\n.minimized .uirStateVisWindowOverlay {\\n    display: block;\\n    position: absolute;\\n    left: 0;\\n    right: 0; \\n    top: 0;\\n    bottom: 0;\\n    z-index: 10;\\n}\\n  \\n.statevis circle {\\n    /*r: 10;*/\\n    fill: #fff;\\n    stroke: grey;\\n    /*stroke-width: 3px;*/\\n\\n    transition-property: r, fill, stroke, stroke-width;\\n    transition-duration: 350ms;\\n    transition-timing-function: ease-in-out;\\n\\n    cursor: pointer;\\n}\\n\\n.statevis text {\\n    transition-property: x, y, font-size, stroke, stroke-width;\\n    transition-duration: 350ms;\\n    transition-timing-function: ease-in-out;\\n}\\n\\n.statevis circle.future {\\n    /*r: 10;*/\\n    stroke: grey;\\n    stroke-dasharray: 7,5;\\n    /*stroke-width: 1px;*/\\n}\\n\\n.statevis circle.entered {\\n    /*r: 10;*/\\n    stroke: black;\\n    fill: lightgreen;\\n}\\n\\n.statevis circle.entered:after {\\n    content: \\\"<text>Entered</text>\\\"\\n}\\n\\n.statevis circle.active {\\n    /*r: 15;*/\\n    fill: green;\\n    stroke: black;\\n}\\n\\n.statevis circle.collapsed {\\n    stroke-dasharray: 2, 2\\n}\\n\\n.statevis text {\\n    font-family: sans-serif;\\n}\\n\\n.statevis .link {\\n    fill: none;\\n    stroke: #ccc;\\n    /*stroke-width: 2px;*/\\n}\\n\\n.statevis text.label {\\n    fill: grey;\\n    alignment-baseline: middle;\\n}\\n\\n\\n.draggable {\\n    cursor: move;\\n}\\n\\n/*.draggable:hover {*/\\n    /*outline: 3px solid rgba(0,0,0,0.15)*/\\n/*}*/\\n\", \"\"]);\n\n// exports\n","\n/**\n * When source maps are enabled, `style-loader` uses a link element with a data-uri to\n * embed the css on the page. This breaks all relative urls because now they are relative to a\n * bundle instead of the current page.\n *\n * One solution is to only use full urls, but that may be impossible.\n *\n * Instead, this function \"fixes\" the relative urls to be absolute according to the current page location.\n *\n * A rudimentary test suite is located at `test/fixUrls.js` and can be run via the `npm test` command.\n *\n */\n\nmodule.exports = function (css) {\n  // get current location\n  var location = typeof window !== \"undefined\" && window.location;\n\n  if (!location) {\n    throw new Error(\"fixUrls requires window.location\");\n  }\n\n\t// blank or null?\n\tif (!css || typeof css !== \"string\") {\n\t  return css;\n  }\n\n  var baseUrl = location.protocol + \"//\" + location.host;\n  var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\n\n\t// convert each url(...)\n\t/*\n\tThis regular expression is just a way to recursively match brackets within\n\ta string.\n\n\t /url\\s*\\(  = Match on the word \"url\" with any whitespace after it and then a parens\n\t   (  = Start a capturing group\n\t     (?:  = Start a non-capturing group\n\t         [^)(]  = Match anything that isn't a parentheses\n\t         |  = OR\n\t         \\(  = Match a start parentheses\n\t             (?:  = Start another non-capturing groups\n\t                 [^)(]+  = Match anything that isn't a parentheses\n\t                 |  = OR\n\t                 \\(  = Match a start parentheses\n\t                     [^)(]*  = Match anything that isn't a parentheses\n\t                 \\)  = Match a end parentheses\n\t             )  = End Group\n              *\\) = Match anything and then a close parens\n          )  = Close non-capturing group\n          *  = Match anything\n       )  = Close capturing group\n\t \\)  = Match a close parens\n\n\t /gi  = Get all matches, not the first.  Be case insensitive.\n\t */\n\tvar fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function(fullMatch, origUrl) {\n\t\t// strip quotes (if they exist)\n\t\tvar unquotedOrigUrl = origUrl\n\t\t\t.trim()\n\t\t\t.replace(/^\"(.*)\"$/, function(o, $1){ return $1; })\n\t\t\t.replace(/^'(.*)'$/, function(o, $1){ return $1; });\n\n\t\t// already a full url? no change\n\t\tif (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(unquotedOrigUrl)) {\n\t\t  return fullMatch;\n\t\t}\n\n\t\t// convert the url to a full url\n\t\tvar newUrl;\n\n\t\tif (unquotedOrigUrl.indexOf(\"//\") === 0) {\n\t\t  \t//TODO: should we add protocol?\n\t\t\tnewUrl = unquotedOrigUrl;\n\t\t} else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\n\t\t\t// path should be relative to the base url\n\t\t\tnewUrl = baseUrl + unquotedOrigUrl; // already starts with '/'\n\t\t} else {\n\t\t\t// path should be relative to current directory\n\t\t\tnewUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\"); // Strip leading './'\n\t\t}\n\n\t\t// send back the fixed url(...)\n\t\treturn \"url(\" + JSON.stringify(newUrl) + \")\";\n\t});\n\n\t// send back the fixed css\n\treturn fixedCss;\n};\n","import { h, render, Component } from 'preact';\n\nimport { TransitionView } from './TransitionView';\nimport { easing } from '../util/easing';\nimport { animatePath } from '../util/animatepath';\n\ndeclare var require;\nrequire('./transitionVisualizer.css');\n\nexport interface IProps {\n  router: any;\n  maximumTransitions?: number;\n}\n\nexport interface IState {\n  transitions?: any[];\n  pointerEvents?: string;\n}\n\n/**\n * This outer component manages the list of all transitions (history), and provides a fixed, scrolling viewport.\n * It attaches hooks for lifecycle events and decorates the transition with a descriptive message.\n */\nexport class TransitionVisualizer extends Component<IProps, IState> {\n  /**\n   * Creates a new TransitionVisualizer and adds it to the document.\n   *\n   * @param router the UIRouter object\n   * @param element (optional) the element where the TransitionVisualizer should be placed.\n   *                If no element is passed, an element will be created in the body.\n   * @param props maximum transitions default: { maximumTransitions: 15 }\n   *\n   *\n   * # Angular 1 + UI-Router (1.0.0-beta.2 and higher):\n   *\n   * Inject the router (`$uiRouter`) in a run block, then call TransitionVisualizer.create();\n   *\n   * ```\n   * app.run(function($uiRouter) {\n   *   TransitionVisualizer.create($uiRouter);\n   * });\n   * ```\n   *\n   * # Angular 1 + UI-Router 1.0.0-alpha.1 through 1.0.0-beta.1:\n   *\n   * Inject the router (`ng1UIRouter`) in a run block, then call TransitionVisualizer.create();\n   *\n   * ```\n   * app.run(function(ng1UIRouter) {\n   *   TransitionVisualizer.create(ng1UIRouter);\n   * });\n   * ```\n   *\n   * Angular 2:\n   *\n   * Call TransitionVisualizer.create() from your UIRouterConfig\n   *\n   * ```\n   * export class MyUIRouterConfig extends UIRouterConfig {\n   *   configure(router: UIRouter) {\n   *     TransitionVisualizer.create(router);\n   *   }\n   * }\n   * ```\n   *\n   * React:\n   *\n   * Call TransitionVisualizer.create() from your bootstrap\n   *\n   * ```\n   * let router = new UIRouterReact();\n   * TransitionVisualizer.create(router);\n   * router.start();\n   * ```\n   *\n   * @return the element that was bootstrapped.\n   *         You can destroy the component using:\n   *         [ReactDOM.unmountComponentAtNode](https://facebook.github.io/react/docs/top-level-api.html#reactdom.unmountcomponentatnode)\n   */\n  static create(router, element?, props = {}) {\n    if (!element) {\n      element = document.createElement('div');\n      element.id = 'uirTransitionVisualizer';\n    }\n\n    let initialProps = Object.assign({}, props, { router });\n    const _render = () => {\n      document.body.appendChild(element);\n      render(h(TransitionVisualizer, initialProps), element);\n    };\n\n    if (document.readyState === 'interactive' || document.readyState === 'complete') {\n      _render();\n    } else {\n      document.addEventListener('DOMContentLoaded', _render as any, false);\n    }\n\n    return element;\n  }\n\n  deregisterFns = [];\n\n  state = {\n    transitions: [],\n    pointerEvents: 'auto',\n  };\n\n  static defaultProps = {\n    router: null,\n    maximumTransitions: 15,\n  };\n\n  _div;\n  cancelPreviousAnim = null;\n\n  componentDidMount() {\n    let dereg = this.props.router.transitionService.onBefore({}, trans => {\n      this.setState({ transitions: this.state.transitions.concat(trans) });\n\n      let duration = 750,\n        el = this._div.children[0];\n\n      let scrollToRight = () => {\n        let targetScrollX = el.scrollWidth - el.clientWidth + 200;\n        this.cancelPreviousAnim && this.cancelPreviousAnim();\n        let newVal = [targetScrollX],\n          oldVal = [el.scrollLeft];\n        let max = this.props.maximumTransitions;\n\n        let enforceMax = () => {\n          let list = this.state.transitions;\n          if (list.length <= max) return;\n          this.setState({ transitions: list.slice(list.length - max) });\n        };\n\n        let callback = vals => (el.scrollLeft = vals[0]);\n        this.cancelPreviousAnim = animatePath(newVal, oldVal, duration, callback, enforceMax, easing.easeInOutCubic);\n      };\n\n      setTimeout(scrollToRight, 25);\n    });\n    this.deregisterFns.push(dereg);\n\n    document.body.addEventListener('mousemove', this.onMouseMove);\n    this.deregisterFns.push(() => document.body.removeEventListener('mousemove', this.onMouseMove));\n  }\n\n  /**\n   * Disable pointer events when the mouse is above the timeline\n   *\n   * This allows clicks to pass through the outer div to the user's app components\n   * even when a transitionview details box is open and pinned.\n   *\n   * Enable pointer events when mouse is inside the timeline to allow horizontal scroll & scroll wheel\n   */\n  onMouseMove = evt => {\n    let windowHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    var pointerEvents = windowHeight - evt.clientY < 65 ? 'auto' : 'none';\n    if (this.state.pointerEvents != pointerEvents) {\n      this.setState({ pointerEvents });\n    }\n  };\n\n  componentWillUnmount() {\n    while (this.deregisterFns.length) this.deregisterFns.pop()();\n  }\n\n  render() {\n    let pointerEvents = this.state.pointerEvents;\n\n    return (\n      <div ref={el => (this._div = el)}>\n        <div className=\"uirTranVis_history\" style={{ pointerEvents }}>\n          {this.state.transitions.map(trans => (\n            <div key={trans.$id} className=\"uirTranVis_transition\">\n              <TransitionView transition={trans} />\n              <div style={{ minWidth: '18em', border: '1px solid transparent' }} />\n            </div>\n          ))}\n          <div style={{ width: '200px', height: '1px' }} />\n        </div>\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\nimport { TransitionPopover } from './TransitionPopover';\nimport { BreadcrumbArrow } from './BreadcrumbArrow';\nimport { maxLength } from '../util/strings';\nimport { makeCancelable } from '../util/cancelablePromise';\n\nexport interface IProps {\n  transition: any;\n}\n\nexport interface IState {\n  status?: string;\n  message?: string;\n  rejection?: string;\n  pinned?: boolean;\n  expanded?: boolean;\n  open?: boolean;\n  deregisterFunctions?: Function[];\n}\n\nexport class TransitionView extends Component<IProps, IState> {\n  transitionPromise = null;\n\n  state = {\n    status: 'running',\n    message: null,\n    rejection: null,\n    pinned: false,\n    expanded: false,\n    open: false,\n    deregisterFunctions: [],\n  };\n\n  componentDidMount() {\n    let trans = this.props.transition;\n\n    const setMessage = message => {\n      // Transition hooks are computed when the trans starts; they can't be removed while the trans is running.\n      if (!this.transitionPromise.isCanceled) {\n        this.setState({ message });\n      }\n    };\n    const statename = state => state.name || '(root)';\n\n    let fns = [];\n    fns.push(trans.onStart({}, () => setMessage('Starting...'), { priority: 10000 }));\n    fns.push(trans.onExit({}, (t, state) => setMessage(`Exiting ${statename(state)}`), { priority: 10000 }));\n    fns.push(trans.onRetain({}, (t, state) => setMessage(`Retained ${statename(state)}`), { priority: 10000 }));\n    fns.push(trans.onEnter({}, (t, state) => setMessage(`Entering ${statename(state)}`), { priority: 10000 }));\n    fns.push(trans.onFinish({}, () => setMessage(`Finishing...`)));\n\n    this.setState({ deregisterFunctions: fns });\n\n    const success = () => this.setState({ status: 'success', message: null });\n    const error = err => {\n      if (err && err.isCanceled) return;\n\n      let status = 'error',\n        rejection = null;\n\n      if (err) {\n        rejection = err && err.message;\n\n        let type = err && err.type;\n        if (type == 2 && err.redirected === true) {\n          status = 'redirected';\n          let targetState = err['detail'];\n          let toState = targetState.name();\n          let toParams = JSON.stringify(targetState.params());\n          rejection = maxLength(100, `${toState}(${toParams}`) + ')';\n        }\n\n        if (type == 5) {\n          status = 'ignored';\n          rejection = 'All states and parameters in the To and From paths are identical.';\n        }\n      }\n\n      this.setState({ status, rejection, message: null });\n    };\n\n    this.transitionPromise = makeCancelable(trans.promise);\n    this.transitionPromise.promise.then(success, error);\n  }\n\n  componentWillUnmount() {\n    this.transitionPromise.cancel();\n    if (this.state.deregisterFunctions) {\n      this.state.deregisterFunctions.forEach(fn => fn());\n    }\n  }\n\n  togglePin = () => this.setState({ pinned: !this.state.pinned });\n  toggleExpand = () => this.setState({ expanded: !this.state.expanded });\n  open = () => this.setState({ open: true });\n  close = () => this.setState({ open: false });\n\n  render() {\n    return (\n      <div onMouseEnter={this.open} onMouseLeave={this.close}>\n        <TransitionPopover\n          transition={this.props.transition}\n          status={this.state.status}\n          rejection={this.state.rejection}\n          pinned={this.state.pinned}\n          expanded={this.state.expanded}\n          open={this.state.open}\n          togglePinned={this.togglePin}\n          toggleExpand={this.toggleExpand}\n        />\n\n        <BreadcrumbArrow\n          transition={this.props.transition}\n          status={this.state.status}\n          message={this.state.message}\n          toggleExpand={this.toggleExpand}\n        />\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\nimport { PopoverHeading } from './PopoverHeading';\nimport { TransSummary } from './TransSummary';\nimport { NodePaths } from './NodePaths';\n\nexport interface IProps {\n  transition: any;\n  status: string;\n  rejection: string;\n\n  pinned: boolean;\n  expanded: boolean;\n  open: boolean;\n  togglePinned: Function;\n  toggleExpand: Function;\n}\n\nexport interface IState {}\n\nexport class TransitionPopover extends Component<IProps, IState> {\n  render() {\n    if (!this.props.open && !this.props.pinned) return null;\n\n    const classes = () =>\n      'uirTranVis_transitionDetail uirTranVis_panel panel-default ' +\n      (this.props.pinned ? 'pin ' : '') +\n      (this.props.expanded ? 'expand ' : '') +\n      (this.props.open ? 'showDetail ' : '');\n\n    return (\n      <div className={classes()}>\n        <PopoverHeading\n          transition={this.props.transition}\n          pinned={this.props.pinned}\n          expanded={this.props.expanded}\n          togglePinned={this.props.togglePinned}\n          toggleExpand={this.props.toggleExpand}\n        />\n\n        <div className=\"uirTranVis_panelBody\">\n          <TransSummary trans={this.props.transition} status={this.props.status} rejection={this.props.rejection} />\n          <hr />\n          <NodePaths transition={this.props.transition} />\n        </div>\n\n        <div className=\"uirTranVis_downArrow\" />\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\n\nexport interface IProps {\n  transition: any;\n\n  pinned: boolean;\n  expanded: boolean;\n  togglePinned: any;\n  toggleExpand: any;\n}\n\nexport interface IState {}\n\nexport class PopoverHeading extends Component<IProps, IState> {\n  render() {\n    const tackClass = () => 'uir-icon uir-icon-thumb-tack ' + (this.props.pinned ? '' : 'uir-rotate-35');\n    const expandClass = () =>\n      'uir-icon uirTranVis_tooltipRight ' + (this.props.expanded ? 'uir-icon-toggle-on' : 'uir-icon-toggle-off');\n\n    return (\n      <div className=\"uirTranVis_panelHeading uirTranVis_heading\">\n        <div style={{ cursor: 'pointer' }} onClick={this.props.togglePinned}>\n          <i className={tackClass()} />\n        </div>\n\n        <h3 className=\"uirTranVis_panelTitle\">Transition #{this.props.transition.$id}</h3>\n\n        <div style={{ cursor: 'pointer' }} onClick={this.props.toggleExpand}>\n          <i className={expandClass()} />\n        </div>\n      </div>\n    );\n  }\n}\n","import { h, Component } from 'preact';\nimport { KeysAndValues } from './KeysAndValues';\n\nexport interface IProps {\n  trans: any;\n  status: string;\n  rejection: string;\n}\n\nexport class TransSummary extends Component<IProps, {}> {\n  render() {\n    return (\n      <div className=\"uirTranVis_transSummary\">\n        <div className=\"uirTranVis_summaryData\">\n          <span>From:</span>\n          <strong>{this.props.trans.from().name || '(root)'}</strong>\n        </div>\n\n        <div className=\"uirTranVis_summaryData\">\n          <span>To:</span>\n          <strong>{this.props.trans.to().name || '(root)'}</strong>\n        </div>\n\n        <div className=\"uirTranVis_summaryData\">\n          <span>Result:</span>\n          <div>\n            <strong>{this.props.status}</strong>\n            {this.props.rejection ? <span>: {this.props.rejection}</span> : null}\n          </div>\n        </div>\n\n        <div className=\"uirTranVis_summaryHeading\">Parameter Values:</div>\n\n        <div>\n          <KeysAndValues\n            groupedValues={KeysAndValues.falsyGroupDefinitions}\n            enableGroupToggle={true}\n            data={this.props.trans.params()}\n            modalTitle=\"Parameter value\"\n            classes={{ div: 'uirTranVis_keyValue', key: '', val: '' }}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\nimport { Modal } from '../util/modal';\nimport { Pretty } from '../util/pretty';\n\nexport interface IProps {\n  toggles?: any;\n  open?: boolean;\n  close?: Function;\n  modalTitle?: string;\n  id?: string;\n  value?: any;\n}\n\nexport class ResolveData extends Component<IProps, any> {\n  close = () => this.props.close();\n\n  render() {\n    return (\n      <div>\n        <Modal>\n          <div className=\"uirTranVis_modal-header uir-resolve-header\">\n            <div style={{ fontSize: '20px' }}>\n              {this.props.modalTitle}: {this.props.id}\n            </div>\n            <button className=\"uirTranVis_btn uirTranVis_btnXs uirTranVis_btnPrimary\" onClick={this.close}>\n              <i className=\"uir-icon uir-iconw-close\" />\n            </button>\n          </div>\n\n          <div className=\"uirTranVis_modalBody\">\n            <Pretty data={this.props.value} />\n          </div>\n\n          <div className=\"uirTranVis_modalFooter\">\n            <button className=\"uirTranVis_btn uirTranVis_btnPrimary\" onClick={this.close}>\n              Close\n            </button>\n          </div>\n        </Modal>\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\n\nexport interface IProps {\n  data: any;\n}\nexport interface IState {\n  show: boolean;\n}\n\nexport class Pretty extends Component<IProps, IState> {\n  preStyle = {\n    display: 'block',\n    padding: '10px 30px',\n    margin: '0',\n  };\n\n  state = { show: true };\n\n  toggle() {\n    this.setState({\n      show: !this.state.show,\n    });\n  }\n\n  render() {\n    return (\n      <div>{this.state.show ? <pre style={this.preStyle}>{JSON.stringify(this.props.data, null, 2)}</pre> : false}</div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\nimport { NodeDetail } from './NodeDetail';\nimport { FlowArrow } from './FlowArrow';\n\nexport interface TransStruct {\n  key: string;\n  to: any;\n  toType: string;\n  from: any;\n  fromType: string;\n}\n\nexport interface IProps {\n  transition: any;\n}\n\nexport interface IState {\n  retained: TransStruct[];\n  enterExit: TransStruct[];\n}\n\nexport class NodePaths extends Component<IProps, IState> {\n  state = {\n    retained: [],\n    enterExit: [],\n  };\n\n  componentDidMount() {\n    let trans = this.props.transition;\n    let tcPaths = Object.assign({}, trans.treeChanges());\n\n    // Ignore the root state when drawing paths.\n    ['entering', 'exiting', 'retained'].forEach(key => (tcPaths[key] = tcPaths[key].filter(node => !!node.state.name)));\n\n    const partialKey = (pathname, idx) => {\n      let node = tcPaths[pathname][idx];\n      return node ? node.state.name : '';\n    };\n\n    const key = (pathname1, pathname2, idx) =>\n      `${trans.$id}.${partialKey(pathname1, idx)}-${partialKey(pathname2, idx)}`;\n\n    let retained: TransStruct[] = tcPaths.retained.map((node, idx) => ({\n      key: key('retained', 'retained', idx),\n      to: node,\n      toType: 'retain',\n      from: node,\n      fromType: 'retain',\n    }));\n    let enterExit: TransStruct[] = [];\n\n    let maxPathLength = Math.max(tcPaths.exiting.length, tcPaths.entering.length);\n    for (let i = 0; i < maxPathLength; i++) {\n      enterExit.push({\n        key: key('exiting', 'entering', i),\n        to: tcPaths.entering[i],\n        toType: tcPaths.entering[i] && 'enter',\n        from: tcPaths.exiting[i],\n        fromType: tcPaths.exiting[i] && 'exit',\n      });\n    }\n\n    this.setState({ retained, enterExit });\n  }\n\n  render() {\n    var height = 2000;\n    var retained = this.state.retained || [];\n    var enterExit = this.state.enterExit || [];\n    var lastEnterIdx = enterExit.filter(x => !!x.toType).length - 1;\n\n    return (\n      <table className=\"uirTranVis_paths\">\n        <thead>\n          <tr>\n            <th>From Path</th>\n            <th>To Path</th>\n          </tr>\n        </thead>\n\n        <tbody>\n          {// Render the retained states\n          retained.map(elem => (\n            <tr key={elem.key}>\n              <td className={elem.fromType} colSpan={2}>\n                <NodeDetail trans={this.props.transition} node={elem.from} type={elem.fromType} />\n              </td>\n            </tr>\n          ))}\n\n          {// Render the entered/exited states\n          enterExit.map((elem, idx) => (\n            <tr key={elem.key}>\n              <td colSpan={2}>\n                <div className=\"uirTranVis_Row\">\n                  <div className={`${elem.fromType}`}>\n                    {!elem.fromType ? null : (\n                      <div className=\"uirTranVis_nodeContent\">\n                        <NodeDetail trans={this.props.transition} node={elem.from} type={elem.fromType} />\n                        <FlowArrow bottom=\"V\" top={idx ? 'V' : elem.toType ? 'RU' : 'AU'} />\n                      </div>\n                    )}\n                  </div>\n\n                  <div className={`${elem.toType}`}>\n                    {!elem.toType ? null : (\n                      <div className=\"uirTranVis_nodeContent\">\n                        <FlowArrow\n                          top={idx ? 'V' : elem.fromType ? 'RD' : 'V'}\n                          bottom={idx == lastEnterIdx ? 'AD' : 'V'}\n                        />\n                        <NodeDetail trans={this.props.transition} node={elem.to} type={elem.toType} />\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\nimport { stringify, maxLength } from '../util/strings';\nimport { KeysAndValues } from './KeysAndValues';\nimport { Transition } from '@uirouter/core';\n\nexport interface IProps {\n  trans: Transition;\n  node: any;\n  type: string;\n}\n\nexport class NodeDetail extends Component<IProps, {}> {\n  stateName() {\n    let node = this.props.node;\n    let name = node && node.state && node.state.name;\n    if (name === '') name = '(root)';\n    return name && name.split('.').reverse()[0];\n  }\n\n  params() {\n    let node = this.props.node;\n    return (\n      node &&\n      node.paramSchema.reduce((params, param) => {\n        params[param.id] = node.paramValues[param.id];\n        return params;\n      }, {})\n    );\n  }\n\n  resolves() {\n    const asString = val => (typeof val === 'string' ? val : maxLength(30, stringify(val)));\n\n    let node = this.props.node;\n    let ignoredTokens = ['$stateParams', '$transition$', '$state$', this.props.trans.constructor];\n\n    return (\n      node &&\n      node.resolvables.filter(r => ignoredTokens.indexOf(r.token) === -1).reduce((acc, r) => {\n        acc[asString(r.token)] = r.data;\n        return acc;\n      }, {})\n    );\n  }\n\n  render() {\n    if (!this.props.node) return null;\n    const params = this.params();\n    const resolves = this.resolves();\n\n    return !this.props.node ? null : (\n      <div className=\"uirTranVis_nodeDetail\">\n        <div className=\"uirTranVis_heading\">\n          <div className=\"uirTranVis_nowrap uirTranVis_deemphasize\">({this.props.type} state)</div>\n          <div className=\"uirTranVis_stateName\">{this.stateName()}</div>\n        </div>\n\n        {!!Object.keys(params).length && (\n          <div className=\"params\">\n            <div className=\"uirTranVis_paramsLabel uirTranVis_deemphasize\">Parameter values</div>\n\n            <KeysAndValues data={this.params()} classes={{ div: 'uirTranVis_keyValue' }} modalTitle=\"Parameter value\" />\n          </div>\n        )}\n\n        {!!Object.keys(resolves).length && (\n          <div className=\"params resolve\">\n            <div className=\"uirTranVis_resolveLabel uirTranVis_deemphasize\">Resolved data</div>\n\n            <KeysAndValues\n              data={this.resolves()}\n              classes={{ div: 'uirTranVis_keyValue' }}\n              modalTitle=\"Resolved value\"\n            />\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\n\nexport interface IProps {\n  top: string;\n  bottom: string;\n}\nexport class FlowArrow extends Component<IProps, any> {\n  height = 1000;\n\n  renderCurve = () => (\n    <path\n      stroke=\"white\"\n      stroke-width=\"20\"\n      fill=\"none\"\n      d={`M50 ${this.height} V 70 Q50 20, 100 20 Q150 20, 150 70 V ${this.height}`}\n    />\n  );\n\n  renderVerticalLine = () => (\n    <svg viewBox={`0 70 100 ${this.height - 70}`} className=\"flowArrowSvg\">\n      {this.renderCurve()}\n    </svg>\n  );\n\n  renderCurveRU = () => (\n    <svg viewBox={`0 0 100 ${this.height}`} className=\"flowArrowSvg top\">\n      {this.renderCurve()}\n    </svg>\n  );\n\n  renderCurveRD = () => (\n    <svg viewBox={`100 0 100 ${this.height}`} className=\"flowArrowSvg top\">\n      {this.renderCurve()}\n    </svg>\n  );\n\n  renderArrowU = () => (\n    <svg viewBox={`0 0 100 ${this.height}`} className=\"flowArrowSvg top\">\n      <path stroke=\"white\" stroke-width=\"20\" fill=\"none\" d={`M50 ${this.height} V 20 `} />\n      <polygon fill=\"white\" stroke=\"white\" stroke-width=\"20\" points=\"50,20 35,40 65,40\" />\n    </svg>\n  );\n\n  renderArrowD = () => (\n    <svg viewBox={`0 0 100 ${this.height}`} className=\"flowArrowSvg bottom\">\n      <path stroke=\"white\" stroke-width=\"20\" fill=\"none\" d={`M50 0 V ${this.height - 20}`} />\n      <polygon\n        fill=\"white\"\n        stroke=\"white\"\n        stroke-width=\"20\"\n        points={`50,${this.height - 20} 35,${this.height - 40} 65,${this.height - 40}`}\n      />\n    </svg>\n  );\n\n  render() {\n    const renderSvg = type => {\n      switch (type) {\n        case 'V':\n          return this.renderVerticalLine();\n        case 'RU':\n          return this.renderCurveRU();\n        case 'RD':\n          return this.renderCurveRD();\n        case 'AU':\n          return this.renderArrowU();\n        case 'AD':\n          return this.renderArrowD();\n        default:\n          return null;\n      }\n    };\n\n    return (\n      <div className=\"flowArrowCell\">\n        <div style={{ overflow: 'hidden', position: 'relative', flex: '1' }}>{renderSvg(this.props.top)}</div>\n\n        <div style={{ overflow: 'hidden', position: 'relative', flex: '1' }}>{renderSvg(this.props.bottom)}</div>\n      </div>\n    );\n  }\n}\n","import { h, render, Component } from 'preact';\n\nexport interface IProps {\n  transition: any;\n  toggleExpand: Function;\n  status: string;\n  message: string;\n}\n\nexport interface IState {}\n\nexport class BreadcrumbArrow extends Component<IProps, IState> {\n  handleClick = () => this.props.toggleExpand();\n\n  iconClass() {\n    let iconClasses = {\n      running: 'uir-icon uir-spin uir-iconw-spinner',\n      success: 'uir-icon uir-iconw-check',\n      redirected: 'uir-icon uir-iconw-share',\n      ignored: 'uir-icon uir-iconw-circle-o',\n      error: 'uir-icon uir-iconw-close',\n    };\n\n    return iconClasses[this.props.status];\n  }\n\n  render() {\n    return !this.props.transition ? null : (\n      <div className={this.props.status + ' uirTranVis_historyEntry'} onClick={this.handleClick}>\n        <div className=\"uirTranVis_historyEntrySummary\">\n          <div className=\"uirTranVis_transId\">{this.props.transition.$id}</div>\n          <div className=\"uirTranVis_status\">\n            {this.props.status}\n            {!this.props.message ? null : <span>: {this.props.message}</span>}\n          </div>\n          <div className=\"uirTranVis_transName\">\n            <i className={this.iconClass()} />\n            <span>{this.props.transition.to().name}</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","export const makeCancelable = promise => {\n  let hasCanceled_ = false;\n\n  const wrappedPromise = new Promise((resolve, reject) => {\n    promise.then(\n      val => (hasCanceled_ ? reject({ isCanceled: true }) : resolve(val)),\n      error => (hasCanceled_ ? reject({ isCanceled: true }) : reject(error)),\n    );\n  });\n\n  var cancelablePromise = {\n    promise: wrappedPromise,\n    isCanceled: false,\n    cancel() {\n      cancelablePromise.isCanceled = hasCanceled_ = true;\n    },\n  };\n\n  return cancelablePromise;\n};\n","\nvar content = require(\"!!../../node_modules/css-loader/index.js?sourceMap-loader!./transitionVisualizer.css\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":false,\"attrs\":{\"nonce\":\"uiroutervisualizer\"}}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\n","var escape = require(\"../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/*\\n    .uirTranVis_history is the breadcrumbs and transition details block.\\n    It fills the footer of the screen, and scrolls horizontally.\\n    Mouse clicks should pass through to the elements underneath.\\n*/\\n\\n.uirTranVis_history {\\n    display: flex;\\n    align-items: flex-end;\\n    position: fixed;\\n    left: 0;\\n    bottom: 0;\\n    right: 0;\\n    padding: 0 16px;\\n    overflow-x: scroll;\\n    z-index: 50;\\n    /* disable mouse clicks, hover, etc, for the overall div */\\n    pointer-events: none;\\n}\\n\\n.uirTranVis_history > * {\\n    /* Enable mouse for any sub-elements (the breadcrumb elemetns and detail elements) */\\n    pointer-events: all;\\n    flex: 0 0 auto;\\n}\\n\\n/*  workaround for modal screen, and chrome and safari not allowing it to be\\n    visible outside the .uirTranVis_history overflow while the .uirTranVis_history div is scrolled */\\n.fullScreen .uirTranVis_history {\\n    top: 0;\\n}\\n\\n/* A single history entry (breadcrumb) arrow looking thing */\\n.uirTranVis_history .uirTranVis_historyEntry {\\n    position: relative;\\n    text-align: center;\\n    padding: 12px 30px;\\n    margin-bottom: 6px;\\n    margin-right: 6px;\\n    color: #000;\\n    cursor: pointer;\\n}\\n\\n\\n/* History entry arrow CSS */\\n.uirTranVis_history .uirTranVis_historyEntry:before,.uirTranVis_historyEntry:after {\\n    content: '';\\n    position: absolute;\\n    background: darkgrey;\\n    left: 0;\\n    height: 50.2%; /* +0.2% so firefox doesn't render a white line down the center */\\n    width: 100%;\\n    border: 1px solid black;\\n    box-sizing: border-box;\\n    z-index: -1;\\n}\\n\\n.uirTranVis_history .uirTranVis_historyEntry:before {\\n    top: 0;\\n    border-bottom: 0;\\n    -webkit-transform: skew(40deg, 0deg);\\n    -ms-transform: skew(40deg, 0deg);\\n    transform: skew(40deg, 0deg);\\n}\\n\\n.uirTranVis_history .uirTranVis_historyEntry:after {\\n    bottom: 0;\\n    border-top: 0;\\n    -webkit-transform: skew(-40deg, 0deg);\\n    -ms-transform: skew(-40deg, 0deg);\\n    transform: skew(-40deg, 0deg);\\n}\\n\\n/*.uirTranVis_historyEntry::before height: 51% (|| ::after) */\\n\\n/* Styling for breadcrumb contents */\\n.uirTranVis_historyEntry .uirTranVis_historyEntrySummary {\\n    color: white;\\n    white-space: nowrap;\\n    font-size: small;\\n}\\n.uirTranVis_historyEntry .uirTranVis_historyEntrySummary .uirTranVis_transId {\\n    position: absolute;\\n    top: 3px;\\n    left: 10px;\\n    font-size: smaller;\\n}\\n.uirTranVis_historyEntry .uirTranVis_historyEntrySummary .uirTranVis_status {\\n    position: absolute;\\n    bottom: 3px;\\n    left: 10px;\\n    font-size: smaller;\\n}\\n.uirTranVis_historyEntry .uirTranVis_historyEntrySummary .uirTranVis_transName {\\n    font-weight: bold;\\n    display: flex;\\n    flex-flow: row nowrap;\\n    align-items: center;\\n    justify-content: center\\n}\\n.uirTranVis_historyEntry .uirTranVis_historyEntrySummary .uirTranVis_transName span {\\n    overflow: hidden;\\n    text-overflow: ellipsis;\\n    direction: rtl;\\n}\\n\\n.uirTranVis_transSummary {\\n    margin: 8px 0;\\n}\\n.uirTranVis_transSummary .uirTranVis_summaryHeading {\\n    background-color: #f5f5f5;\\n    margin: 8px -16px;\\n    padding: 4px 16px;\\n}\\n.uirTranVis_transSummary .uirTranVis_summaryData {\\n    display: flex;\\n    flex-flow: row nowrap;\\n    align-items: baseline;\\n}\\n.uirTranVis_transSummary .uirTranVis_summaryData span {\\n    min-width: 60px;\\n    text-align: right;\\n    padding-right: 6px;\\n}\\n.uirTranVis_transSummary .uirTranVis_summaryData strong {\\n    overflow: hidden;\\n    text-overflow: ellipsis;\\n    direction: rtl;\\n}\\n\\n.uirTranVis_history .uirTranVis_code {\\n    padding: 0px 2px;\\n    color: black;\\n    background: #e6e6e6;\\n    margin: 0;\\n    font-family: monospace;\\n}\\n\\n/* breadcrumb/history entry color coding */\\n.uirTranVis_history .uirTranVis_historyEntry:before,.uirTranVis_historyEntry:after {\\n    background: #737373;\\n}\\n.uirTranVis_history .uirTranVis_historyEntry:hover:before,.uirTranVis_historyEntry:hover:after {\\n    background: #a6a6a6;\\n}\\n\\n.uirTranVis_history .uirTranVis_historyEntry.success:before,.uirTranVis_historyEntry.success:after {\\n    background: #45803b;\\n}\\n.uirTranVis_history .uirTranVis_historyEntry.success:hover:before,.uirTranVis_historyEntry.success:hover:after {\\n    background: #19a600;\\n}\\n\\n\\n.uirTranVis_history .uirTranVis_historyEntry.error:before,.uirTranVis_historyEntry.error:after {\\n    background: #bf1f1d;\\n}\\n.uirTranVis_history .uirTranVis_historyEntry.error:hover:before,.uirTranVis_historyEntry.error:hover:after {\\n    background: #e62622;\\n}\\n\\n\\n.uirTranVis_history .uirTranVis_historyEntry.ignored:before,.uirTranVis_historyEntry.ignored:after {\\n    background: #e68b05;\\n}\\n.uirTranVis_history .uirTranVis_historyEntry.ignored:hover:before,.uirTranVis_historyEntry.ignored:hover:after {\\n    background: #ff9808;\\n}\\n\\n.uirTranVis_history .uirTranVis_historyEntry.redirected:before,.uirTranVis_historyEntry.redirected:after {\\n    background: #e68b05;\\n}\\n.uirTranVis_history .uirTranVis_historyEntry.redirected:hover:before,.uirTranVis_historyEntry.redirected:hover:after {\\n    background: #ff9808;\\n}\\n\\n.uirTranVis_history .uirTranVis_keyValue {\\n    display: flex;\\n    flex-flow: row nowrap;\\n    justify-content: space-between;\\n    align-items: baseline;\\n}\\n\\n.uirTranVis_history .uirTranVis_keyValue + .uirTranVis_keyValue {\\n    margin-top: 3px;\\n}\\n\\n\\n\\n\\n/* The transition detail popover (when hovering over a breadcrumb) */\\n.uirTranVis_transitionDetail {\\n    border: 1px solid lightgrey;\\n    font-size: small;\\n    transition: box-shadow 0.5s ease,  border 1.0s ease\\n}\\n\\n/* Pointer element points from the uirTranVis_transitionDetail to the breadcrumb */\\n.uirTranVis_transitionDetail .uirTranVis_downArrow {\\n    position: relative;\\n    width: 100%;\\n    bottom: -10px;\\n    margin-bottom: 10px;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_downArrow:before, .uirTranVis_transitionDetail .uirTranVis_downArrow:after {\\n    content: \\\"\\\";\\n    position: absolute;\\n    border-left: 10px solid transparent;\\n    border-right: 10px solid transparent;\\n    top: 100%;\\n    left: 50%;\\n    margin-left: -10px;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_downArrow:before {\\n    border-top: 10px solid lightgray;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_downArrow:after{\\n    border-top: 10px solid white;\\n    margin-top: -1px;\\n    z-index: 1;\\n}\\n\\n\\n/* The layout and styling of the transition detail popover */\\n/*.uirTranVis_transitionDetail .panel-heading {*/\\n    /*text-align: center;*/\\n/*}*/\\n\\n.uirTranVis_transitionDetail table {\\n    border-collapse: collapse;\\n}\\n\\n.uirTranVis_transitionDetail th {\\n    text-align: center;\\n    font-size: small;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_heading {\\n    display: flex;\\n    flex-flow: row-reverse nowrap;\\n    justify-content: space-between;\\n    align-items: baseline;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_heading > *  {\\n    flex: 0 1 auto;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_heading > * i {\\n    transition: all 0.5s ease;\\n}\\n\\n.uirTranVis_transitionDetail table.uirTranVis_paths {\\n    width: 100%;\\n}\\n\\n.uirTranVis_transitionDetail table.uirTranVis_paths td {\\n    color: white;\\n    border: 0;\\n    font-size: small;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_transSummary .uirTranVis_keyValue > div:nth-child(2){\\n    padding-left: 8px;\\n    font-weight: normal;\\n}\\n\\n\\n.uirTranVis_transitionDetail td {\\n    padding: 0;\\n}\\n\\n.uirTranVis_transitionDetail td .flowArrowCell {\\n    display: flex;\\n    flex-flow: column nowrap;\\n    align-items: stretch;\\n    justify-content: space-between;\\n    width: 12px;\\n    transition: width 0.25s ease;\\n    height: auto;\\n    flex: 0 0 auto;\\n}\\n.uirTranVis_transitionDetail.expand td .flowArrowCell { width: 24px; }\\n\\n.uirTranVis_transitionDetail .exit  .flowArrowSvg          { right: 0; }\\n.uirTranVis_transitionDetail .enter .flowArrowSvg          { left: 0; }\\n.uirTranVis_transitionDetail        .flowArrowSvg.bottom   { bottom: 0 }\\n.uirTranVis_transitionDetail        .flowArrowSvg.top      { top: 0 }\\n.uirTranVis_transitionDetail        .flowArrowSvg {\\n    position: absolute;\\n    width: 100%;\\n    height: auto;\\n    transition: width 0.25s ease;\\n}\\n\\n/* color code path elements by retained/exited/entered */\\n.uirTranVis_transitionDetail .retain {\\n    background-color: #737273;\\n}\\n\\n.uirTranVis_transitionDetail .exit {\\n    background-color: #7c1010;\\n}\\n\\n.uirTranVis_transitionDetail .enter {\\n    background-color: #31592a;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_deemphasize {\\n    color: #eaeaea;\\n    font-size: x-small;\\n}\\n\\n/* Styling for parameter values and resolve values */\\n.uirTranVis_transitionDetail .params {\\n    background-color: rgba(255,255,255,0.15);\\n    padding: 0;\\n    opacity: 0;\\n    overflow: hidden;\\n    transition: opacity 1s ease;\\n    max-height: 0;\\n}\\n\\n.uirTranVis_transitionDetail.expand .params {\\n    display: block;\\n    border-radius: 4px;\\n    box-shadow: 1px 1px 2px black;\\n    padding: 8px;\\n    max-height: 250px;\\n    overflow-y: auto;\\n    opacity: 1;\\n    margin: 8px 0;\\n}\\n\\n.uirTranVis_transitionDetail.pin {\\n    box-shadow: 4px 4px 12px rgba(0,0,0,0.3);\\n    border: 1px solid black;\\n}\\n\\n.uirTranVis_transitionDetail.pin .uirTranVis_downArrow:before {\\n    border-top-color: black;\\n}\\n\\n\\n/* When showing expanded details, put space between path elements */\\n.uirTranVis_transitionDetail.expand table.uirTranVis_paths td {\\n    max-height: 100px;\\n    vertical-align: top;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_Row {\\n    display: flex;\\n    flex-flow: row nowrap;\\n    justify-content: space-between;\\n    align-items: stretch;\\n    min-width: 400px;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_Row > div {\\n    flex: 1 0 50%;\\n    min-width: 0;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_nodeContent {\\n    display: flex;\\n    flex-flow: row nowrap;\\n    min-height: 16px;\\n    transition: min-height 0.25s ease;\\n}\\n\\n.uirTranVis_transitionDetail.expand .uirTranVis_nodeContent {\\n    height: 100%;\\n    min-height: 65px;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_nodeDetail {\\n    flex: 1 1 auto;\\n    padding: 3px 7px;\\n    min-width: 0;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_stateName {\\n    font-weight: bolder;\\n    margin-right: 16px;\\n    margin-left: 0;\\n}\\n.uirTranVis_transitionDetail .enter .uirTranVis_stateName {\\n    margin-right: 0;\\n    margin-left: 16px;\\n}\\n\\n.uirTranVis_transitionDetail .uirTranVis_nowrap {\\n    white-space: nowrap;\\n}\\n\\n.uirTranVis_history .uirTranVis_paramsLabel,\\n.uirTranVis_history .uirTranVis_resolveLabel {\\n    color: white;\\n    margin-top: -8px;\\n    text-align: center;\\n    font-weight: bold;\\n}\\n\\n\\nspan.link {\\n    cursor: pointer;\\n    text-decoration: underline;\\n}\\n\\n\\n.uirTranVis_tooltipRight {\\n    display: inline;\\n    position: relative;\\n    transition: all 1.5s ease;\\n}\\n\\n.uirTranVis_tooltipRight:after {\\n    color: rgba(0,0,0,0);\\n    text-decoration: none;\\n    transition: all 1.5s ease;\\n}\\n\\n.uirTranVis_tooltipRight:hover:after {\\n    bottom: 0;\\n    color: rgba(0,0,0,0.5);\\n    content: attr(title);\\n    display: block;\\n    position: absolute;\\n    white-space: nowrap;\\n    font-size: smaller;\\n}\\n\\n\\n\\n/* Bootstrap stuff */\\n\\n.uirTranVis_modal .uirTranVis_btnPrimary {\\n    color: #fff;\\n    background-color: #337ab7;\\n    border-color: #2e6da4;\\n}\\n\\n.uirTranVis_modal .uirTranVis_btn {\\n    display: inline-block;\\n    padding: 6px 12px;\\n    margin-bottom: 0;\\n    font-size: 14px;\\n    font-weight: normal;\\n    line-height: 1.42857143;\\n    text-align: center;\\n    white-space: nowrap;\\n    vertical-align: middle;\\n    -ms-touch-action: manipulation;\\n    touch-action: manipulation;\\n    cursor: pointer;\\n    -webkit-user-select: none;\\n    -moz-user-select: none;\\n    -ms-user-select: none;\\n    user-select: none;\\n    background-image: none;\\n    border: 1px solid transparent;\\n    border-radius: 4px;\\n}\\n\\n.uirTranVis_modal .uirTranVis_btnXs, .uirTranVis_btnGroupXs > .uirTranVis_btn {\\n    padding: 1px 5px;\\n    font-size: 12px;\\n    line-height: 1.5;\\n    border-radius: 3px;\\n}\\n\\n.uirTranVis_transition {\\n    max-width: 550px;\\n}\\n\\n.uirTranVis_transitionDetail span.link {\\n    color: white;\\n}\\n\\n.uirTranVis_history *:not(.fa):not(pre):not(.uirTranVis_code) {\\n    font-family: Arial, Helvetica, sans-serif;\\n}\\n\\n.uirTranVis_transitionDetail .enter .uirTranVis_heading {\\n    flex-flow: row nowrap;\\n}\\n.uirTranVis_transitionDetail .uirTranVis_heading {\\n    display: flex;\\n    flex-flow: row-reverse nowrap;\\n    justify-content: space-between;\\n    align-items: baseline;\\n}\\n\\n.uirTranVis_transitionDetail .retain .uirTranVis_heading {\\n    justify-content: center;\\n}\\n\\n.uirTranVis_panel {\\n    margin-bottom: 20px;\\n    background-color: #fff;\\n    border: 1px solid lightgrey;\\n    border-radius: 4px;\\n    -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .05);\\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .05);\\n}\\n\\n.uirTranVis_panelHeading {\\n    color: #333;\\n    background-color: #f5f5f5;\\n    border-color: #ddd;\\n\\n    padding: 10px 16px;\\n    border-bottom: 1px solid transparent;\\n    border-top-left-radius: 3px;\\n    border-top-right-radius: 3px;\\n}\\n\\n.uirTranVis_panelTitle {\\n    margin-top: 0;\\n    margin-bottom: 0;\\n    font-size: 16px;\\n    color: inherit;\\n}\\n\\n.uirTranVis_panelBody {\\n    padding: 0 16px;\\n}\\n\\n\\n\\n\\n\\n/* Styles go here */\\n.uir-fade {\\n    opacity: 0;\\n    -webkit-transition: opacity .15s linear;\\n    -o-transition: opacity .15s linear;\\n    transition: opacity .15s linear;\\n}\\n\\n.uir-fade.in {\\n    opacity: 1;\\n}\\n\\n.uirTranVis_modal-backdrop {\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    bottom: 0;\\n    left: 0;\\n    z-index: 1040;\\n    background-color: #000;\\n}\\n\\n.uirTranVis_modal-backdrop.in {\\n    filter: alpha(opacity=50);\\n    opacity: .5;\\n}\\n\\n.uirTranVis_modal {\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    bottom: 0;\\n    left: 0;\\n    z-index: 1050;\\n    display: block;\\n    overflow-y: auto;\\n    -webkit-overflow-scrolling: touch;\\n    outline: 0;\\n}\\n\\n\\n.uirTranVis_modal-dialog {\\n    position: relative;\\n    width: auto;\\n    margin: 10px;\\n}\\n\\n.uirTranVis_modal-content {\\n    position: relative;\\n    background-color: #fff;\\n    -webkit-background-clip: padding-box;\\n    background-clip: padding-box;\\n    border: 1px solid #999;\\n    border: 1px solid rgba(0, 0, 0, .2);\\n    border-radius: 6px;\\n    outline: 0;\\n    -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, .5);\\n    box-shadow: 0 3px 9px rgba(0, 0, 0, .5);\\n}\\n\\n.uirTranVis_modal-header {\\n    padding: 16px;\\n    border-bottom: 1px solid #e5e5e5;\\n}\\n\\n.uir-resolve-header {\\n    display: flex;\\n    flex-flow: row nowrap;\\n    justify-content: space-between;\\n    background-color: cornflowerblue;\\n}\\n\\n.uirTranVis_modalBody {\\n    color: black;\\n    position: relative;\\n    padding: 16px;\\n}\\n\\n.uirTranVis_modalFooter {\\n    padding: 16px;\\n    text-align: right;\\n    border-top: 1px solid #e5e5e5;\\n}\\n\\n.uir-icon {\\n    display: inline-block;\\n    height: 16px; width: 16px;\\n    margin: 4px;\\n    background-size: cover;\\n    background-position: 0 0;\\n}\\n\\n.uir-spin {\\n    animation: uirspin 2s infinite;\\n    transform: rotate(0deg);\\n}\\n\\n.uir-rotate-35 {\\n    transform: rotate(35deg);\\n    opacity: 0.5;\\n}\\n\\n@keyframes uirspin {\\n    0% { transform: rotate(0deg); }\\n    100% { transform: rotate(360deg); }\\n}\\n\\n\\n.uir-iconw-spinner       { background-image: url(\" + escape(require(\"../../images/w/16/spinner.png\")) + \"); }\\n.uir-iconw-check         { background-image: url(\" + escape(require(\"../../images/w/16/check.png\")) + \"); }\\n.uir-iconw-circle-o      { background-image: url(\" + escape(require(\"../../images/w/16/circle-o.png\")) + \"); }\\n.uir-iconw-share         { background-image: url(\" + escape(require(\"../../images/w/16/share.png\")) + \"); }\\n.uir-iconw-close         { background-image: url(\" + escape(require(\"../../images/w/16/close.png\")) + \"); }\\n\\n.uir-icon-thumb-tack     { background-image: url(\" + escape(require(\"../../images/16/thumb-tack.png\")) + \"); }\\n.uir-icon-toggle-on      { background-image: url(\" + escape(require(\"../../images/16/toggle-on.png\")) + \"); }\\n.uir-icon-toggle-off     { background-image: url(\" + escape(require(\"../../images/16/toggle-off.png\")) + \"); }\\n\", \"\"]);\n\n// exports\n","module.exports = function escape(url) {\n    if (typeof url !== 'string') {\n        return url\n    }\n    // If url is already wrapped in quotes, remove them\n    if (/^['\"].*['\"]$/.test(url)) {\n        url = url.slice(1, -1);\n    }\n    // Should url be wrapped?\n    // See https://drafts.csswg.org/css-values-3/#urls\n    if (/[\"'() \\t\\n]/.test(url)) {\n        return '\"' + url.replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n') + '\"'\n    }\n\n    return url\n}\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAABCElEQVQ4ja2SMU4CYRCF34Db6RISmi04gCZacgDuYElDYcFZLLWx1c4b6BE0sbaysBEh0aCdm3w2szKQ/1cTmGSz+795897Mzm/KBGCSjv14bWbkuDmBCcuY5HitUNAGxsDQoSrwKuAAeATegVHKcexuX0AFdIELf7rAVejoranbCRpPkmpJU0kfZvYp6SQYvARu/F7pogJ2M7k94BS4BPbXkwYUSdW0WOFb+gFugVeg94/iHjADbqTlFlh7/6mzwt14hK0E0AHugbNfOOfAHVA2WLwHpaRDhdman2pmc4cGko4kdSQtUg79Rt3nnPl2CsdKoB9rYgcys+dwrCU9eEe15xdJ503iGzoj4fOiDj0FAAAAAElFTkSuQmCC\"","function defaultSeparation(a, b) {\n  return a.parent === b.parent ? 1 : 2;\n}\n\nfunction meanX(children) {\n  return children.reduce(meanXReduce, 0) / children.length;\n}\n\nfunction meanXReduce(x, c) {\n  return x + c.x;\n}\n\nfunction maxY(children) {\n  return 1 + children.reduce(maxYReduce, 0);\n}\n\nfunction maxYReduce(y, c) {\n  return Math.max(y, c.y);\n}\n\nfunction leafLeft(node) {\n  var children;\n  while (children = node.children) node = children[0];\n  return node;\n}\n\nfunction leafRight(node) {\n  var children;\n  while (children = node.children) node = children[children.length - 1];\n  return node;\n}\n\nexport default function() {\n  var separation = defaultSeparation,\n      dx = 1,\n      dy = 1,\n      nodeSize = false;\n\n  function cluster(root) {\n    var previousNode,\n        x = 0;\n\n    // First walk, computing the initial x & y values.\n    root.eachAfter(function(node) {\n      var children = node.children;\n      if (children) {\n        node.x = meanX(children);\n        node.y = maxY(children);\n      } else {\n        node.x = previousNode ? x += separation(node, previousNode) : 0;\n        node.y = 0;\n        previousNode = node;\n      }\n    });\n\n    var left = leafLeft(root),\n        right = leafRight(root),\n        x0 = left.x - separation(left, right) / 2,\n        x1 = right.x + separation(right, left) / 2;\n\n    // Second walk, normalizing x & y to the desired size.\n    return root.eachAfter(nodeSize ? function(node) {\n      node.x = (node.x - root.x) * dx;\n      node.y = (root.y - node.y) * dy;\n    } : function(node) {\n      node.x = (node.x - x0) / (x1 - x0) * dx;\n      node.y = (1 - (root.y ? node.y / root.y : 1)) * dy;\n    });\n  }\n\n  cluster.separation = function(x) {\n    return arguments.length ? (separation = x, cluster) : separation;\n  };\n\n  cluster.size = function(x) {\n    return arguments.length ? (nodeSize = false, dx = +x[0], dy = +x[1], cluster) : (nodeSize ? null : [dx, dy]);\n  };\n\n  cluster.nodeSize = function(x) {\n    return arguments.length ? (nodeSize = true, dx = +x[0], dy = +x[1], cluster) : (nodeSize ? [dx, dy] : null);\n  };\n\n  return cluster;\n}\n","function count(node) {\n  var sum = 0,\n      children = node.children,\n      i = children && children.length;\n  if (!i) sum = 1;\n  else while (--i >= 0) sum += children[i].value;\n  node.value = sum;\n}\n\nexport default function() {\n  return this.eachAfter(count);\n}\n","import node_count from \"./count\";\nimport node_each from \"./each\";\nimport node_eachBefore from \"./eachBefore\";\nimport node_eachAfter from \"./eachAfter\";\nimport node_sum from \"./sum\";\nimport node_sort from \"./sort\";\nimport node_path from \"./path\";\nimport node_ancestors from \"./ancestors\";\nimport node_descendants from \"./descendants\";\nimport node_leaves from \"./leaves\";\nimport node_links from \"./links\";\n\nexport default function hierarchy(data, children) {\n  var root = new Node(data),\n      valued = +data.value && (root.value = data.value),\n      node,\n      nodes = [root],\n      child,\n      childs,\n      i,\n      n;\n\n  if (children == null) children = defaultChildren;\n\n  while (node = nodes.pop()) {\n    if (valued) node.value = +node.data.value;\n    if ((childs = children(node.data)) && (n = childs.length)) {\n      node.children = new Array(n);\n      for (i = n - 1; i >= 0; --i) {\n        nodes.push(child = node.children[i] = new Node(childs[i]));\n        child.parent = node;\n        child.depth = node.depth + 1;\n      }\n    }\n  }\n\n  return root.eachBefore(computeHeight);\n}\n\nfunction node_copy() {\n  return hierarchy(this).eachBefore(copyData);\n}\n\nfunction defaultChildren(d) {\n  return d.children;\n}\n\nfunction copyData(node) {\n  node.data = node.data.data;\n}\n\nexport function computeHeight(node) {\n  var height = 0;\n  do node.height = height;\n  while ((node = node.parent) && (node.height < ++height));\n}\n\nexport function Node(data) {\n  this.data = data;\n  this.depth =\n  this.height = 0;\n  this.parent = null;\n}\n\nNode.prototype = hierarchy.prototype = {\n  constructor: Node,\n  count: node_count,\n  each: node_each,\n  eachAfter: node_eachAfter,\n  eachBefore: node_eachBefore,\n  sum: node_sum,\n  sort: node_sort,\n  path: node_path,\n  ancestors: node_ancestors,\n  descendants: node_descendants,\n  leaves: node_leaves,\n  links: node_links,\n  copy: node_copy\n};\n","export default function(callback) {\n  var node = this, current, next = [node], children, i, n;\n  do {\n    current = next.reverse(), next = [];\n    while (node = current.pop()) {\n      callback(node), children = node.children;\n      if (children) for (i = 0, n = children.length; i < n; ++i) {\n        next.push(children[i]);\n      }\n    }\n  } while (next.length);\n  return this;\n}\n","export default function(callback) {\n  var node = this, nodes = [node], next = [], children, i, n;\n  while (node = nodes.pop()) {\n    next.push(node), children = node.children;\n    if (children) for (i = 0, n = children.length; i < n; ++i) {\n      nodes.push(children[i]);\n    }\n  }\n  while (node = next.pop()) {\n    callback(node);\n  }\n  return this;\n}\n","export default function(callback) {\n  var node = this, nodes = [node], children, i;\n  while (node = nodes.pop()) {\n    callback(node), children = node.children;\n    if (children) for (i = children.length - 1; i >= 0; --i) {\n      nodes.push(children[i]);\n    }\n  }\n  return this;\n}\n","export default function(value) {\n  return this.eachAfter(function(node) {\n    var sum = +value(node.data) || 0,\n        children = node.children,\n        i = children && children.length;\n    while (--i >= 0) sum += children[i].value;\n    node.value = sum;\n  });\n}\n","export default function(compare) {\n  return this.eachBefore(function(node) {\n    if (node.children) {\n      node.children.sort(compare);\n    }\n  });\n}\n","export default function(end) {\n  var start = this,\n      ancestor = leastCommonAncestor(start, end),\n      nodes = [start];\n  while (start !== ancestor) {\n    start = start.parent;\n    nodes.push(start);\n  }\n  var k = nodes.length;\n  while (end !== ancestor) {\n    nodes.splice(k, 0, end);\n    end = end.parent;\n  }\n  return nodes;\n}\n\nfunction leastCommonAncestor(a, b) {\n  if (a === b) return a;\n  var aNodes = a.ancestors(),\n      bNodes = b.ancestors(),\n      c = null;\n  a = aNodes.pop();\n  b = bNodes.pop();\n  while (a === b) {\n    c = a;\n    a = aNodes.pop();\n    b = bNodes.pop();\n  }\n  return c;\n}\n","export default function() {\n  var node = this, nodes = [node];\n  while (node = node.parent) {\n    nodes.push(node);\n  }\n  return nodes;\n}\n","export default function() {\n  var nodes = [];\n  this.each(function(node) {\n    nodes.push(node);\n  });\n  return nodes;\n}\n","export default function() {\n  var leaves = [];\n  this.eachBefore(function(node) {\n    if (!node.children) {\n      leaves.push(node);\n    }\n  });\n  return leaves;\n}\n","export default function() {\n  var root = this, links = [];\n  root.each(function(node) {\n    if (node !== root) { // Dont include the roots parent, if any.\n      links.push({source: node.parent, target: node});\n    }\n  });\n  return links;\n}\n","export var slice = Array.prototype.slice;\n\nexport function shuffle(array) {\n  var m = array.length,\n      t,\n      i;\n\n  while (m) {\n    i = Math.random() * m-- | 0;\n    t = array[m];\n    array[m] = array[i];\n    array[i] = t;\n  }\n\n  return array;\n}\n","import {shuffle, slice} from \"../array\";\n\nexport default function(circles) {\n  var i = 0, n = (circles = shuffle(slice.call(circles))).length, B = [], p, e;\n\n  while (i < n) {\n    p = circles[i];\n    if (e && enclosesWeak(e, p)) ++i;\n    else e = encloseBasis(B = extendBasis(B, p)), i = 0;\n  }\n\n  return e;\n}\n\nfunction extendBasis(B, p) {\n  var i, j;\n\n  if (enclosesWeakAll(p, B)) return [p];\n\n  // If we get here then B must have at least one element.\n  for (i = 0; i < B.length; ++i) {\n    if (enclosesNot(p, B[i])\n        && enclosesWeakAll(encloseBasis2(B[i], p), B)) {\n      return [B[i], p];\n    }\n  }\n\n  // If we get here then B must have at least two elements.\n  for (i = 0; i < B.length - 1; ++i) {\n    for (j = i + 1; j < B.length; ++j) {\n      if (enclosesNot(encloseBasis2(B[i], B[j]), p)\n          && enclosesNot(encloseBasis2(B[i], p), B[j])\n          && enclosesNot(encloseBasis2(B[j], p), B[i])\n          && enclosesWeakAll(encloseBasis3(B[i], B[j], p), B)) {\n        return [B[i], B[j], p];\n      }\n    }\n  }\n\n  // If we get here then something is very wrong.\n  throw new Error;\n}\n\nfunction enclosesNot(a, b) {\n  var dr = a.r - b.r, dx = b.x - a.x, dy = b.y - a.y;\n  return dr < 0 || dr * dr < dx * dx + dy * dy;\n}\n\nfunction enclosesWeak(a, b) {\n  var dr = a.r - b.r + 1e-6, dx = b.x - a.x, dy = b.y - a.y;\n  return dr > 0 && dr * dr > dx * dx + dy * dy;\n}\n\nfunction enclosesWeakAll(a, B) {\n  for (var i = 0; i < B.length; ++i) {\n    if (!enclosesWeak(a, B[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction encloseBasis(B) {\n  switch (B.length) {\n    case 1: return encloseBasis1(B[0]);\n    case 2: return encloseBasis2(B[0], B[1]);\n    case 3: return encloseBasis3(B[0], B[1], B[2]);\n  }\n}\n\nfunction encloseBasis1(a) {\n  return {\n    x: a.x,\n    y: a.y,\n    r: a.r\n  };\n}\n\nfunction encloseBasis2(a, b) {\n  var x1 = a.x, y1 = a.y, r1 = a.r,\n      x2 = b.x, y2 = b.y, r2 = b.r,\n      x21 = x2 - x1, y21 = y2 - y1, r21 = r2 - r1,\n      l = Math.sqrt(x21 * x21 + y21 * y21);\n  return {\n    x: (x1 + x2 + x21 / l * r21) / 2,\n    y: (y1 + y2 + y21 / l * r21) / 2,\n    r: (l + r1 + r2) / 2\n  };\n}\n\nfunction encloseBasis3(a, b, c) {\n  var x1 = a.x, y1 = a.y, r1 = a.r,\n      x2 = b.x, y2 = b.y, r2 = b.r,\n      x3 = c.x, y3 = c.y, r3 = c.r,\n      a2 = x1 - x2,\n      a3 = x1 - x3,\n      b2 = y1 - y2,\n      b3 = y1 - y3,\n      c2 = r2 - r1,\n      c3 = r3 - r1,\n      d1 = x1 * x1 + y1 * y1 - r1 * r1,\n      d2 = d1 - x2 * x2 - y2 * y2 + r2 * r2,\n      d3 = d1 - x3 * x3 - y3 * y3 + r3 * r3,\n      ab = a3 * b2 - a2 * b3,\n      xa = (b2 * d3 - b3 * d2) / (ab * 2) - x1,\n      xb = (b3 * c2 - b2 * c3) / ab,\n      ya = (a3 * d2 - a2 * d3) / (ab * 2) - y1,\n      yb = (a2 * c3 - a3 * c2) / ab,\n      A = xb * xb + yb * yb - 1,\n      B = 2 * (r1 + xa * xb + ya * yb),\n      C = xa * xa + ya * ya - r1 * r1,\n      r = -(A ? (B + Math.sqrt(B * B - 4 * A * C)) / (2 * A) : C / B);\n  return {\n    x: x1 + xa + xb * r,\n    y: y1 + ya + yb * r,\n    r: r\n  };\n}\n","import enclose from \"./enclose\";\n\nfunction place(b, a, c) {\n  var dx = b.x - a.x, x, a2,\n      dy = b.y - a.y, y, b2,\n      d2 = dx * dx + dy * dy;\n  if (d2) {\n    a2 = a.r + c.r, a2 *= a2;\n    b2 = b.r + c.r, b2 *= b2;\n    if (a2 > b2) {\n      x = (d2 + b2 - a2) / (2 * d2);\n      y = Math.sqrt(Math.max(0, b2 / d2 - x * x));\n      c.x = b.x - x * dx - y * dy;\n      c.y = b.y - x * dy + y * dx;\n    } else {\n      x = (d2 + a2 - b2) / (2 * d2);\n      y = Math.sqrt(Math.max(0, a2 / d2 - x * x));\n      c.x = a.x + x * dx - y * dy;\n      c.y = a.y + x * dy + y * dx;\n    }\n  } else {\n    c.x = a.x + c.r;\n    c.y = a.y;\n  }\n}\n\nfunction intersects(a, b) {\n  var dr = a.r + b.r - 1e-6, dx = b.x - a.x, dy = b.y - a.y;\n  return dr > 0 && dr * dr > dx * dx + dy * dy;\n}\n\nfunction score(node) {\n  var a = node._,\n      b = node.next._,\n      ab = a.r + b.r,\n      dx = (a.x * b.r + b.x * a.r) / ab,\n      dy = (a.y * b.r + b.y * a.r) / ab;\n  return dx * dx + dy * dy;\n}\n\nfunction Node(circle) {\n  this._ = circle;\n  this.next = null;\n  this.previous = null;\n}\n\nexport function packEnclose(circles) {\n  if (!(n = circles.length)) return 0;\n\n  var a, b, c, n, aa, ca, i, j, k, sj, sk;\n\n  // Place the first circle.\n  a = circles[0], a.x = 0, a.y = 0;\n  if (!(n > 1)) return a.r;\n\n  // Place the second circle.\n  b = circles[1], a.x = -b.r, b.x = a.r, b.y = 0;\n  if (!(n > 2)) return a.r + b.r;\n\n  // Place the third circle.\n  place(b, a, c = circles[2]);\n\n  // Initialize the front-chain using the first three circles a, b and c.\n  a = new Node(a), b = new Node(b), c = new Node(c);\n  a.next = c.previous = b;\n  b.next = a.previous = c;\n  c.next = b.previous = a;\n\n  // Attempt to place each remaining circle\n  pack: for (i = 3; i < n; ++i) {\n    place(a._, b._, c = circles[i]), c = new Node(c);\n\n    // Find the closest intersecting circle on the front-chain, if any.\n    // Closeness is determined by linear distance along the front-chain.\n    // Ahead or behind is likewise determined by linear distance.\n    j = b.next, k = a.previous, sj = b._.r, sk = a._.r;\n    do {\n      if (sj <= sk) {\n        if (intersects(j._, c._)) {\n          b = j, a.next = b, b.previous = a, --i;\n          continue pack;\n        }\n        sj += j._.r, j = j.next;\n      } else {\n        if (intersects(k._, c._)) {\n          a = k, a.next = b, b.previous = a, --i;\n          continue pack;\n        }\n        sk += k._.r, k = k.previous;\n      }\n    } while (j !== k.next);\n\n    // Success! Insert the new circle c between a and b.\n    c.previous = a, c.next = b, a.next = b.previous = b = c;\n\n    // Compute the new closest circle pair to the centroid.\n    aa = score(a);\n    while ((c = c.next) !== b) {\n      if ((ca = score(c)) < aa) {\n        a = c, aa = ca;\n      }\n    }\n    b = a.next;\n  }\n\n  // Compute the enclosing circle of the front chain.\n  a = [b._], c = b; while ((c = c.next) !== b) a.push(c._); c = enclose(a);\n\n  // Translate the circles to put the enclosing circle around the origin.\n  for (i = 0; i < n; ++i) a = circles[i], a.x -= c.x, a.y -= c.y;\n\n  return c.r;\n}\n\nexport default function(circles) {\n  packEnclose(circles);\n  return circles;\n}\n","export function optional(f) {\n  return f == null ? null : required(f);\n}\n\nexport function required(f) {\n  if (typeof f !== \"function\") throw new Error;\n  return f;\n}\n","export function constantZero() {\n  return 0;\n}\n\nexport default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import {packEnclose} from \"./siblings\";\nimport {optional} from \"../accessors\";\nimport constant, {constantZero} from \"../constant\";\n\nfunction defaultRadius(d) {\n  return Math.sqrt(d.value);\n}\n\nexport default function() {\n  var radius = null,\n      dx = 1,\n      dy = 1,\n      padding = constantZero;\n\n  function pack(root) {\n    root.x = dx / 2, root.y = dy / 2;\n    if (radius) {\n      root.eachBefore(radiusLeaf(radius))\n          .eachAfter(packChildren(padding, 0.5))\n          .eachBefore(translateChild(1));\n    } else {\n      root.eachBefore(radiusLeaf(defaultRadius))\n          .eachAfter(packChildren(constantZero, 1))\n          .eachAfter(packChildren(padding, root.r / Math.min(dx, dy)))\n          .eachBefore(translateChild(Math.min(dx, dy) / (2 * root.r)));\n    }\n    return root;\n  }\n\n  pack.radius = function(x) {\n    return arguments.length ? (radius = optional(x), pack) : radius;\n  };\n\n  pack.size = function(x) {\n    return arguments.length ? (dx = +x[0], dy = +x[1], pack) : [dx, dy];\n  };\n\n  pack.padding = function(x) {\n    return arguments.length ? (padding = typeof x === \"function\" ? x : constant(+x), pack) : padding;\n  };\n\n  return pack;\n}\n\nfunction radiusLeaf(radius) {\n  return function(node) {\n    if (!node.children) {\n      node.r = Math.max(0, +radius(node) || 0);\n    }\n  };\n}\n\nfunction packChildren(padding, k) {\n  return function(node) {\n    if (children = node.children) {\n      var children,\n          i,\n          n = children.length,\n          r = padding(node) * k || 0,\n          e;\n\n      if (r) for (i = 0; i < n; ++i) children[i].r += r;\n      e = packEnclose(children);\n      if (r) for (i = 0; i < n; ++i) children[i].r -= r;\n      node.r = e + r;\n    }\n  };\n}\n\nfunction translateChild(k) {\n  return function(node) {\n    var parent = node.parent;\n    node.r *= k;\n    if (parent) {\n      node.x = parent.x + k * node.x;\n      node.y = parent.y + k * node.y;\n    }\n  };\n}\n","export default function(node) {\n  node.x0 = Math.round(node.x0);\n  node.y0 = Math.round(node.y0);\n  node.x1 = Math.round(node.x1);\n  node.y1 = Math.round(node.y1);\n}\n","export default function(parent, x0, y0, x1, y1) {\n  var nodes = parent.children,\n      node,\n      i = -1,\n      n = nodes.length,\n      k = parent.value && (x1 - x0) / parent.value;\n\n  while (++i < n) {\n    node = nodes[i], node.y0 = y0, node.y1 = y1;\n    node.x0 = x0, node.x1 = x0 += node.value * k;\n  }\n}\n","import roundNode from \"./treemap/round\";\nimport treemapDice from \"./treemap/dice\";\n\nexport default function() {\n  var dx = 1,\n      dy = 1,\n      padding = 0,\n      round = false;\n\n  function partition(root) {\n    var n = root.height + 1;\n    root.x0 =\n    root.y0 = padding;\n    root.x1 = dx;\n    root.y1 = dy / n;\n    root.eachBefore(positionNode(dy, n));\n    if (round) root.eachBefore(roundNode);\n    return root;\n  }\n\n  function positionNode(dy, n) {\n    return function(node) {\n      if (node.children) {\n        treemapDice(node, node.x0, dy * (node.depth + 1) / n, node.x1, dy * (node.depth + 2) / n);\n      }\n      var x0 = node.x0,\n          y0 = node.y0,\n          x1 = node.x1 - padding,\n          y1 = node.y1 - padding;\n      if (x1 < x0) x0 = x1 = (x0 + x1) / 2;\n      if (y1 < y0) y0 = y1 = (y0 + y1) / 2;\n      node.x0 = x0;\n      node.y0 = y0;\n      node.x1 = x1;\n      node.y1 = y1;\n    };\n  }\n\n  partition.round = function(x) {\n    return arguments.length ? (round = !!x, partition) : round;\n  };\n\n  partition.size = function(x) {\n    return arguments.length ? (dx = +x[0], dy = +x[1], partition) : [dx, dy];\n  };\n\n  partition.padding = function(x) {\n    return arguments.length ? (padding = +x, partition) : padding;\n  };\n\n  return partition;\n}\n","import {required} from \"./accessors\";\nimport {Node, computeHeight} from \"./hierarchy/index\";\n\nvar keyPrefix = \"$\", // Protect against keys like __proto__.\n    preroot = {depth: -1},\n    ambiguous = {};\n\nfunction defaultId(d) {\n  return d.id;\n}\n\nfunction defaultParentId(d) {\n  return d.parentId;\n}\n\nexport default function() {\n  var id = defaultId,\n      parentId = defaultParentId;\n\n  function stratify(data) {\n    var d,\n        i,\n        n = data.length,\n        root,\n        parent,\n        node,\n        nodes = new Array(n),\n        nodeId,\n        nodeKey,\n        nodeByKey = {};\n\n    for (i = 0; i < n; ++i) {\n      d = data[i], node = nodes[i] = new Node(d);\n      if ((nodeId = id(d, i, data)) != null && (nodeId += \"\")) {\n        nodeKey = keyPrefix + (node.id = nodeId);\n        nodeByKey[nodeKey] = nodeKey in nodeByKey ? ambiguous : node;\n      }\n    }\n\n    for (i = 0; i < n; ++i) {\n      node = nodes[i], nodeId = parentId(data[i], i, data);\n      if (nodeId == null || !(nodeId += \"\")) {\n        if (root) throw new Error(\"multiple roots\");\n        root = node;\n      } else {\n        parent = nodeByKey[keyPrefix + nodeId];\n        if (!parent) throw new Error(\"missing: \" + nodeId);\n        if (parent === ambiguous) throw new Error(\"ambiguous: \" + nodeId);\n        if (parent.children) parent.children.push(node);\n        else parent.children = [node];\n        node.parent = parent;\n      }\n    }\n\n    if (!root) throw new Error(\"no root\");\n    root.parent = preroot;\n    root.eachBefore(function(node) { node.depth = node.parent.depth + 1; --n; }).eachBefore(computeHeight);\n    root.parent = null;\n    if (n > 0) throw new Error(\"cycle\");\n\n    return root;\n  }\n\n  stratify.id = function(x) {\n    return arguments.length ? (id = required(x), stratify) : id;\n  };\n\n  stratify.parentId = function(x) {\n    return arguments.length ? (parentId = required(x), stratify) : parentId;\n  };\n\n  return stratify;\n}\n","import {Node} from \"./hierarchy/index\";\n\nfunction defaultSeparation(a, b) {\n  return a.parent === b.parent ? 1 : 2;\n}\n\n// function radialSeparation(a, b) {\n//   return (a.parent === b.parent ? 1 : 2) / a.depth;\n// }\n\n// This function is used to traverse the left contour of a subtree (or\n// subforest). It returns the successor of v on this contour. This successor is\n// either given by the leftmost child of v or by the thread of v. The function\n// returns null if and only if v is on the highest level of its subtree.\nfunction nextLeft(v) {\n  var children = v.children;\n  return children ? children[0] : v.t;\n}\n\n// This function works analogously to nextLeft.\nfunction nextRight(v) {\n  var children = v.children;\n  return children ? children[children.length - 1] : v.t;\n}\n\n// Shifts the current subtree rooted at w+. This is done by increasing\n// prelim(w+) and mod(w+) by shift.\nfunction moveSubtree(wm, wp, shift) {\n  var change = shift / (wp.i - wm.i);\n  wp.c -= change;\n  wp.s += shift;\n  wm.c += change;\n  wp.z += shift;\n  wp.m += shift;\n}\n\n// All other shifts, applied to the smaller subtrees between w- and w+, are\n// performed by this function. To prepare the shifts, we have to adjust\n// change(w+), shift(w+), and change(w-).\nfunction executeShifts(v) {\n  var shift = 0,\n      change = 0,\n      children = v.children,\n      i = children.length,\n      w;\n  while (--i >= 0) {\n    w = children[i];\n    w.z += shift;\n    w.m += shift;\n    shift += w.s + (change += w.c);\n  }\n}\n\n// If vi-s ancestor is a sibling of v, returns vi-s ancestor. Otherwise,\n// returns the specified (default) ancestor.\nfunction nextAncestor(vim, v, ancestor) {\n  return vim.a.parent === v.parent ? vim.a : ancestor;\n}\n\nfunction TreeNode(node, i) {\n  this._ = node;\n  this.parent = null;\n  this.children = null;\n  this.A = null; // default ancestor\n  this.a = this; // ancestor\n  this.z = 0; // prelim\n  this.m = 0; // mod\n  this.c = 0; // change\n  this.s = 0; // shift\n  this.t = null; // thread\n  this.i = i; // number\n}\n\nTreeNode.prototype = Object.create(Node.prototype);\n\nfunction treeRoot(root) {\n  var tree = new TreeNode(root, 0),\n      node,\n      nodes = [tree],\n      child,\n      children,\n      i,\n      n;\n\n  while (node = nodes.pop()) {\n    if (children = node._.children) {\n      node.children = new Array(n = children.length);\n      for (i = n - 1; i >= 0; --i) {\n        nodes.push(child = node.children[i] = new TreeNode(children[i], i));\n        child.parent = node;\n      }\n    }\n  }\n\n  (tree.parent = new TreeNode(null, 0)).children = [tree];\n  return tree;\n}\n\n// Node-link tree diagram using the Reingold-Tilford \"tidy\" algorithm\nexport default function() {\n  var separation = defaultSeparation,\n      dx = 1,\n      dy = 1,\n      nodeSize = null;\n\n  function tree(root) {\n    var t = treeRoot(root);\n\n    // Compute the layout using Buchheim et al.s algorithm.\n    t.eachAfter(firstWalk), t.parent.m = -t.z;\n    t.eachBefore(secondWalk);\n\n    // If a fixed node size is specified, scale x and y.\n    if (nodeSize) root.eachBefore(sizeNode);\n\n    // If a fixed tree size is specified, scale x and y based on the extent.\n    // Compute the left-most, right-most, and depth-most nodes for extents.\n    else {\n      var left = root,\n          right = root,\n          bottom = root;\n      root.eachBefore(function(node) {\n        if (node.x < left.x) left = node;\n        if (node.x > right.x) right = node;\n        if (node.depth > bottom.depth) bottom = node;\n      });\n      var s = left === right ? 1 : separation(left, right) / 2,\n          tx = s - left.x,\n          kx = dx / (right.x + s + tx),\n          ky = dy / (bottom.depth || 1);\n      root.eachBefore(function(node) {\n        node.x = (node.x + tx) * kx;\n        node.y = node.depth * ky;\n      });\n    }\n\n    return root;\n  }\n\n  // Computes a preliminary x-coordinate for v. Before that, FIRST WALK is\n  // applied recursively to the children of v, as well as the function\n  // APPORTION. After spacing out the children by calling EXECUTE SHIFTS, the\n  // node v is placed to the midpoint of its outermost children.\n  function firstWalk(v) {\n    var children = v.children,\n        siblings = v.parent.children,\n        w = v.i ? siblings[v.i - 1] : null;\n    if (children) {\n      executeShifts(v);\n      var midpoint = (children[0].z + children[children.length - 1].z) / 2;\n      if (w) {\n        v.z = w.z + separation(v._, w._);\n        v.m = v.z - midpoint;\n      } else {\n        v.z = midpoint;\n      }\n    } else if (w) {\n      v.z = w.z + separation(v._, w._);\n    }\n    v.parent.A = apportion(v, w, v.parent.A || siblings[0]);\n  }\n\n  // Computes all real x-coordinates by summing up the modifiers recursively.\n  function secondWalk(v) {\n    v._.x = v.z + v.parent.m;\n    v.m += v.parent.m;\n  }\n\n  // The core of the algorithm. Here, a new subtree is combined with the\n  // previous subtrees. Threads are used to traverse the inside and outside\n  // contours of the left and right subtree up to the highest common level. The\n  // vertices used for the traversals are vi+, vi-, vo-, and vo+, where the\n  // superscript o means outside and i means inside, the subscript - means left\n  // subtree and + means right subtree. For summing up the modifiers along the\n  // contour, we use respective variables si+, si-, so-, and so+. Whenever two\n  // nodes of the inside contours conflict, we compute the left one of the\n  // greatest uncommon ancestors using the function ANCESTOR and call MOVE\n  // SUBTREE to shift the subtree and prepare the shifts of smaller subtrees.\n  // Finally, we add a new thread (if necessary).\n  function apportion(v, w, ancestor) {\n    if (w) {\n      var vip = v,\n          vop = v,\n          vim = w,\n          vom = vip.parent.children[0],\n          sip = vip.m,\n          sop = vop.m,\n          sim = vim.m,\n          som = vom.m,\n          shift;\n      while (vim = nextRight(vim), vip = nextLeft(vip), vim && vip) {\n        vom = nextLeft(vom);\n        vop = nextRight(vop);\n        vop.a = v;\n        shift = vim.z + sim - vip.z - sip + separation(vim._, vip._);\n        if (shift > 0) {\n          moveSubtree(nextAncestor(vim, v, ancestor), v, shift);\n          sip += shift;\n          sop += shift;\n        }\n        sim += vim.m;\n        sip += vip.m;\n        som += vom.m;\n        sop += vop.m;\n      }\n      if (vim && !nextRight(vop)) {\n        vop.t = vim;\n        vop.m += sim - sop;\n      }\n      if (vip && !nextLeft(vom)) {\n        vom.t = vip;\n        vom.m += sip - som;\n        ancestor = v;\n      }\n    }\n    return ancestor;\n  }\n\n  function sizeNode(node) {\n    node.x *= dx;\n    node.y = node.depth * dy;\n  }\n\n  tree.separation = function(x) {\n    return arguments.length ? (separation = x, tree) : separation;\n  };\n\n  tree.size = function(x) {\n    return arguments.length ? (nodeSize = false, dx = +x[0], dy = +x[1], tree) : (nodeSize ? null : [dx, dy]);\n  };\n\n  tree.nodeSize = function(x) {\n    return arguments.length ? (nodeSize = true, dx = +x[0], dy = +x[1], tree) : (nodeSize ? [dx, dy] : null);\n  };\n\n  return tree;\n}\n","export default function(parent, x0, y0, x1, y1) {\n  var nodes = parent.children,\n      node,\n      i = -1,\n      n = nodes.length,\n      k = parent.value && (y1 - y0) / parent.value;\n\n  while (++i < n) {\n    node = nodes[i], node.x0 = x0, node.x1 = x1;\n    node.y0 = y0, node.y1 = y0 += node.value * k;\n  }\n}\n","import treemapDice from \"./dice\";\nimport treemapSlice from \"./slice\";\n\nexport var phi = (1 + Math.sqrt(5)) / 2;\n\nexport function squarifyRatio(ratio, parent, x0, y0, x1, y1) {\n  var rows = [],\n      nodes = parent.children,\n      row,\n      nodeValue,\n      i0 = 0,\n      i1 = 0,\n      n = nodes.length,\n      dx, dy,\n      value = parent.value,\n      sumValue,\n      minValue,\n      maxValue,\n      newRatio,\n      minRatio,\n      alpha,\n      beta;\n\n  while (i0 < n) {\n    dx = x1 - x0, dy = y1 - y0;\n\n    // Find the next non-empty node.\n    do sumValue = nodes[i1++].value; while (!sumValue && i1 < n);\n    minValue = maxValue = sumValue;\n    alpha = Math.max(dy / dx, dx / dy) / (value * ratio);\n    beta = sumValue * sumValue * alpha;\n    minRatio = Math.max(maxValue / beta, beta / minValue);\n\n    // Keep adding nodes while the aspect ratio maintains or improves.\n    for (; i1 < n; ++i1) {\n      sumValue += nodeValue = nodes[i1].value;\n      if (nodeValue < minValue) minValue = nodeValue;\n      if (nodeValue > maxValue) maxValue = nodeValue;\n      beta = sumValue * sumValue * alpha;\n      newRatio = Math.max(maxValue / beta, beta / minValue);\n      if (newRatio > minRatio) { sumValue -= nodeValue; break; }\n      minRatio = newRatio;\n    }\n\n    // Position and record the row orientation.\n    rows.push(row = {value: sumValue, dice: dx < dy, children: nodes.slice(i0, i1)});\n    if (row.dice) treemapDice(row, x0, y0, x1, value ? y0 += dy * sumValue / value : y1);\n    else treemapSlice(row, x0, y0, value ? x0 += dx * sumValue / value : x1, y1);\n    value -= sumValue, i0 = i1;\n  }\n\n  return rows;\n}\n\nexport default (function custom(ratio) {\n\n  function squarify(parent, x0, y0, x1, y1) {\n    squarifyRatio(ratio, parent, x0, y0, x1, y1);\n  }\n\n  squarify.ratio = function(x) {\n    return custom((x = +x) > 1 ? x : 1);\n  };\n\n  return squarify;\n})(phi);\n","import roundNode from \"./round\";\nimport squarify from \"./squarify\";\nimport {required} from \"../accessors\";\nimport constant, {constantZero} from \"../constant\";\n\nexport default function() {\n  var tile = squarify,\n      round = false,\n      dx = 1,\n      dy = 1,\n      paddingStack = [0],\n      paddingInner = constantZero,\n      paddingTop = constantZero,\n      paddingRight = constantZero,\n      paddingBottom = constantZero,\n      paddingLeft = constantZero;\n\n  function treemap(root) {\n    root.x0 =\n    root.y0 = 0;\n    root.x1 = dx;\n    root.y1 = dy;\n    root.eachBefore(positionNode);\n    paddingStack = [0];\n    if (round) root.eachBefore(roundNode);\n    return root;\n  }\n\n  function positionNode(node) {\n    var p = paddingStack[node.depth],\n        x0 = node.x0 + p,\n        y0 = node.y0 + p,\n        x1 = node.x1 - p,\n        y1 = node.y1 - p;\n    if (x1 < x0) x0 = x1 = (x0 + x1) / 2;\n    if (y1 < y0) y0 = y1 = (y0 + y1) / 2;\n    node.x0 = x0;\n    node.y0 = y0;\n    node.x1 = x1;\n    node.y1 = y1;\n    if (node.children) {\n      p = paddingStack[node.depth + 1] = paddingInner(node) / 2;\n      x0 += paddingLeft(node) - p;\n      y0 += paddingTop(node) - p;\n      x1 -= paddingRight(node) - p;\n      y1 -= paddingBottom(node) - p;\n      if (x1 < x0) x0 = x1 = (x0 + x1) / 2;\n      if (y1 < y0) y0 = y1 = (y0 + y1) / 2;\n      tile(node, x0, y0, x1, y1);\n    }\n  }\n\n  treemap.round = function(x) {\n    return arguments.length ? (round = !!x, treemap) : round;\n  };\n\n  treemap.size = function(x) {\n    return arguments.length ? (dx = +x[0], dy = +x[1], treemap) : [dx, dy];\n  };\n\n  treemap.tile = function(x) {\n    return arguments.length ? (tile = required(x), treemap) : tile;\n  };\n\n  treemap.padding = function(x) {\n    return arguments.length ? treemap.paddingInner(x).paddingOuter(x) : treemap.paddingInner();\n  };\n\n  treemap.paddingInner = function(x) {\n    return arguments.length ? (paddingInner = typeof x === \"function\" ? x : constant(+x), treemap) : paddingInner;\n  };\n\n  treemap.paddingOuter = function(x) {\n    return arguments.length ? treemap.paddingTop(x).paddingRight(x).paddingBottom(x).paddingLeft(x) : treemap.paddingTop();\n  };\n\n  treemap.paddingTop = function(x) {\n    return arguments.length ? (paddingTop = typeof x === \"function\" ? x : constant(+x), treemap) : paddingTop;\n  };\n\n  treemap.paddingRight = function(x) {\n    return arguments.length ? (paddingRight = typeof x === \"function\" ? x : constant(+x), treemap) : paddingRight;\n  };\n\n  treemap.paddingBottom = function(x) {\n    return arguments.length ? (paddingBottom = typeof x === \"function\" ? x : constant(+x), treemap) : paddingBottom;\n  };\n\n  treemap.paddingLeft = function(x) {\n    return arguments.length ? (paddingLeft = typeof x === \"function\" ? x : constant(+x), treemap) : paddingLeft;\n  };\n\n  return treemap;\n}\n","export default function(parent, x0, y0, x1, y1) {\n  var nodes = parent.children,\n      i, n = nodes.length,\n      sum, sums = new Array(n + 1);\n\n  for (sums[0] = sum = i = 0; i < n; ++i) {\n    sums[i + 1] = sum += nodes[i].value;\n  }\n\n  partition(0, n, parent.value, x0, y0, x1, y1);\n\n  function partition(i, j, value, x0, y0, x1, y1) {\n    if (i >= j - 1) {\n      var node = nodes[i];\n      node.x0 = x0, node.y0 = y0;\n      node.x1 = x1, node.y1 = y1;\n      return;\n    }\n\n    var valueOffset = sums[i],\n        valueTarget = (value / 2) + valueOffset,\n        k = i + 1,\n        hi = j - 1;\n\n    while (k < hi) {\n      var mid = k + hi >>> 1;\n      if (sums[mid] < valueTarget) k = mid + 1;\n      else hi = mid;\n    }\n\n    if ((valueTarget - sums[k - 1]) < (sums[k] - valueTarget) && i + 1 < k) --k;\n\n    var valueLeft = sums[k] - valueOffset,\n        valueRight = value - valueLeft;\n\n    if ((x1 - x0) > (y1 - y0)) {\n      var xk = (x0 * valueRight + x1 * valueLeft) / value;\n      partition(i, k, valueLeft, x0, y0, xk, y1);\n      partition(k, j, valueRight, xk, y0, x1, y1);\n    } else {\n      var yk = (y0 * valueRight + y1 * valueLeft) / value;\n      partition(i, k, valueLeft, x0, y0, x1, yk);\n      partition(k, j, valueRight, x0, yk, x1, y1);\n    }\n  }\n}\n","import dice from \"./dice\";\nimport slice from \"./slice\";\n\nexport default function(parent, x0, y0, x1, y1) {\n  (parent.depth & 1 ? slice : dice)(parent, x0, y0, x1, y1);\n}\n","import treemapDice from \"./dice\";\nimport treemapSlice from \"./slice\";\nimport {phi, squarifyRatio} from \"./squarify\";\n\nexport default (function custom(ratio) {\n\n  function resquarify(parent, x0, y0, x1, y1) {\n    if ((rows = parent._squarify) && (rows.ratio === ratio)) {\n      var rows,\n          row,\n          nodes,\n          i,\n          j = -1,\n          n,\n          m = rows.length,\n          value = parent.value;\n\n      while (++j < m) {\n        row = rows[j], nodes = row.children;\n        for (i = row.value = 0, n = nodes.length; i < n; ++i) row.value += nodes[i].value;\n        if (row.dice) treemapDice(row, x0, y0, x1, y0 += (y1 - y0) * row.value / value);\n        else treemapSlice(row, x0, y0, x0 += (x1 - x0) * row.value / value, y1);\n        value -= row.value;\n      }\n    } else {\n      parent._squarify = rows = squarifyRatio(ratio, parent, x0, y0, x1, y1);\n      rows.ratio = ratio;\n    }\n  }\n\n  resquarify.ratio = function(x) {\n    return custom((x = +x) > 1 ? x : 1);\n  };\n\n  return resquarify;\n})(phi);\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex3 = /^#([0-9a-f]{3})$/,\n    reHex6 = /^#([0-9a-f]{6})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  toString: function() {\n    return this.rgb() + \"\";\n  }\n});\n\nexport default function color(format) {\n  var m;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex3.exec(format)) ? (m = parseInt(m[1], 16), new Rgb((m >> 8 & 0xf) | (m >> 4 & 0x0f0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1)) // #f00\n      : (m = reHex6.exec(format)) ? rgbn(parseInt(m[1], 16)) // #ff0000\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format])\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (0 <= this.r && this.r <= 255)\n        && (0 <= this.g && this.g <= 255)\n        && (0 <= this.b && this.b <= 255)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  toString: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"rgb(\" : \"rgba(\")\n        + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n        + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n        + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export var deg2rad = Math.PI / 180;\nexport var rad2deg = 180 / Math.PI;\n","import define, {extend} from \"./define\";\nimport {Color, rgbConvert, Rgb} from \"./color\";\nimport {deg2rad, rad2deg} from \"./math\";\n\nvar Kn = 18,\n    Xn = 0.950470, // D65 standard referent\n    Yn = 1,\n    Zn = 1.088830,\n    t0 = 4 / 29,\n    t1 = 6 / 29,\n    t2 = 3 * t1 * t1,\n    t3 = t1 * t1 * t1;\n\nfunction labConvert(o) {\n  if (o instanceof Lab) return new Lab(o.l, o.a, o.b, o.opacity);\n  if (o instanceof Hcl) {\n    var h = o.h * deg2rad;\n    return new Lab(o.l, Math.cos(h) * o.c, Math.sin(h) * o.c, o.opacity);\n  }\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var b = rgb2xyz(o.r),\n      a = rgb2xyz(o.g),\n      l = rgb2xyz(o.b),\n      x = xyz2lab((0.4124564 * b + 0.3575761 * a + 0.1804375 * l) / Xn),\n      y = xyz2lab((0.2126729 * b + 0.7151522 * a + 0.0721750 * l) / Yn),\n      z = xyz2lab((0.0193339 * b + 0.1191920 * a + 0.9503041 * l) / Zn);\n  return new Lab(116 * y - 16, 500 * (x - y), 200 * (y - z), o.opacity);\n}\n\nexport default function lab(l, a, b, opacity) {\n  return arguments.length === 1 ? labConvert(l) : new Lab(l, a, b, opacity == null ? 1 : opacity);\n}\n\nexport function Lab(l, a, b, opacity) {\n  this.l = +l;\n  this.a = +a;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Lab, lab, extend(Color, {\n  brighter: function(k) {\n    return new Lab(this.l + Kn * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  darker: function(k) {\n    return new Lab(this.l - Kn * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  rgb: function() {\n    var y = (this.l + 16) / 116,\n        x = isNaN(this.a) ? y : y + this.a / 500,\n        z = isNaN(this.b) ? y : y - this.b / 200;\n    y = Yn * lab2xyz(y);\n    x = Xn * lab2xyz(x);\n    z = Zn * lab2xyz(z);\n    return new Rgb(\n      xyz2rgb( 3.2404542 * x - 1.5371385 * y - 0.4985314 * z), // D65 -> sRGB\n      xyz2rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z),\n      xyz2rgb( 0.0556434 * x - 0.2040259 * y + 1.0572252 * z),\n      this.opacity\n    );\n  }\n}));\n\nfunction xyz2lab(t) {\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\n}\n\nfunction lab2xyz(t) {\n  return t > t1 ? t * t * t : t2 * (t - t0);\n}\n\nfunction xyz2rgb(x) {\n  return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\n}\n\nfunction rgb2xyz(x) {\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n}\n\nfunction hclConvert(o) {\n  if (o instanceof Hcl) return new Hcl(o.h, o.c, o.l, o.opacity);\n  if (!(o instanceof Lab)) o = labConvert(o);\n  var h = Math.atan2(o.b, o.a) * rad2deg;\n  return new Hcl(h < 0 ? h + 360 : h, Math.sqrt(o.a * o.a + o.b * o.b), o.l, o.opacity);\n}\n\nexport function hcl(h, c, l, opacity) {\n  return arguments.length === 1 ? hclConvert(h) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function Hcl(h, c, l, opacity) {\n  this.h = +h;\n  this.c = +c;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hcl, hcl, extend(Color, {\n  brighter: function(k) {\n    return new Hcl(this.h, this.c, this.l + Kn * (k == null ? 1 : k), this.opacity);\n  },\n  darker: function(k) {\n    return new Hcl(this.h, this.c, this.l - Kn * (k == null ? 1 : k), this.opacity);\n  },\n  rgb: function() {\n    return labConvert(this).rgb();\n  }\n}));\n","import define, {extend} from \"./define\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color\";\nimport {deg2rad, rad2deg} from \"./math\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * rad2deg - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * deg2rad,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import {basis} from \"./basis\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import constant from \"./constant\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis\";\nimport basisClosed from \"./basisClosed\";\nimport nogamma, {gamma} from \"./color\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","import decompose, {identity} from \"./decompose\";\n\nvar cssNode,\n    cssRoot,\n    cssView,\n    svgNode;\n\nexport function parseCss(value) {\n  if (value === \"none\") return identity;\n  if (!cssNode) cssNode = document.createElement(\"DIV\"), cssRoot = document.documentElement, cssView = document.defaultView;\n  cssNode.style.transform = value;\n  value = cssView.getComputedStyle(cssRoot.appendChild(cssNode), null).getPropertyValue(\"transform\");\n  cssRoot.removeChild(cssNode);\n  value = value.slice(7, -1).split(\",\");\n  return decompose(+value[0], +value[1], +value[2], +value[3], +value[4], +value[5]);\n}\n\nexport function parseSvg(value) {\n  if (value == null) return identity;\n  if (!svgNode) svgNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  svgNode.setAttribute(\"transform\", value);\n  if (!(value = svgNode.transform.baseVal.consolidate())) return identity;\n  value = value.matrix;\n  return decompose(value.a, value.b, value.c, value.d, value.e, value.f);\n}\n","import value from \"./value\";\n\nexport default function(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b -= a, function(t) {\n    return d.setTime(a + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b -= a, function(t) {\n    return a + b * t;\n  };\n}\n","import value from \"./value\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import number from \"./number\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb\";\nimport array from \"./array\";\nimport date from \"./date\";\nimport number from \"./number\";\nimport object from \"./object\";\nimport string from \"./string\";\nimport constant from \"./constant\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : Array.isArray(b) ? array\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b -= a, function(t) {\n    return Math.round(a + b * t);\n  };\n}\n","var degrees = 180 / Math.PI;\n\nexport var identity = {\n  translateX: 0,\n  translateY: 0,\n  rotate: 0,\n  skewX: 0,\n  scaleX: 1,\n  scaleY: 1\n};\n\nexport default function(a, b, c, d, e, f) {\n  var scaleX, scaleY, skewX;\n  if (scaleX = Math.sqrt(a * a + b * b)) a /= scaleX, b /= scaleX;\n  if (skewX = a * c + b * d) c -= a * skewX, d -= b * skewX;\n  if (scaleY = Math.sqrt(c * c + d * d)) c /= scaleY, d /= scaleY, skewX /= scaleY;\n  if (a * d < b * c) a = -a, b = -b, skewX = -skewX, scaleX = -scaleX;\n  return {\n    translateX: e,\n    translateY: f,\n    rotate: Math.atan2(b, a) * degrees,\n    skewX: Math.atan(skewX) * degrees,\n    scaleX: scaleX,\n    scaleY: scaleY\n  };\n}\n","import number from \"../number\";\nimport {parseCss, parseSvg} from \"./parse\";\n\nfunction interpolateTransform(parse, pxComma, pxParen, degParen) {\n\n  function pop(s) {\n    return s.length ? s.pop() + \" \" : \"\";\n  }\n\n  function translate(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(\"translate(\", null, pxComma, null, pxParen);\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb || yb) {\n      s.push(\"translate(\" + xb + pxComma + yb + pxParen);\n    }\n  }\n\n  function rotate(a, b, s, q) {\n    if (a !== b) {\n      if (a - b > 180) b += 360; else if (b - a > 180) a += 360; // shortest path\n      q.push({i: s.push(pop(s) + \"rotate(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"rotate(\" + b + degParen);\n    }\n  }\n\n  function skewX(a, b, s, q) {\n    if (a !== b) {\n      q.push({i: s.push(pop(s) + \"skewX(\", null, degParen) - 2, x: number(a, b)});\n    } else if (b) {\n      s.push(pop(s) + \"skewX(\" + b + degParen);\n    }\n  }\n\n  function scale(xa, ya, xb, yb, s, q) {\n    if (xa !== xb || ya !== yb) {\n      var i = s.push(pop(s) + \"scale(\", null, \",\", null, \")\");\n      q.push({i: i - 4, x: number(xa, xb)}, {i: i - 2, x: number(ya, yb)});\n    } else if (xb !== 1 || yb !== 1) {\n      s.push(pop(s) + \"scale(\" + xb + \",\" + yb + \")\");\n    }\n  }\n\n  return function(a, b) {\n    var s = [], // string constants and placeholders\n        q = []; // number interpolators\n    a = parse(a), b = parse(b);\n    translate(a.translateX, a.translateY, b.translateX, b.translateY, s, q);\n    rotate(a.rotate, b.rotate, s, q);\n    skewX(a.skewX, b.skewX, s, q);\n    scale(a.scaleX, a.scaleY, b.scaleX, b.scaleY, s, q);\n    a = b = null; // gc\n    return function(t) {\n      var i = -1, n = q.length, o;\n      while (++i < n) s[(o = q[i]).i] = o.x(t);\n      return s.join(\"\");\n    };\n  };\n}\n\nexport var interpolateTransformCss = interpolateTransform(parseCss, \"px, \", \"px)\", \"deg)\");\nexport var interpolateTransformSvg = interpolateTransform(parseSvg, \", \", \")\", \")\");\n","var rho = Math.SQRT2,\n    rho2 = 2,\n    rho4 = 4,\n    epsilon2 = 1e-12;\n\nfunction cosh(x) {\n  return ((x = Math.exp(x)) + 1 / x) / 2;\n}\n\nfunction sinh(x) {\n  return ((x = Math.exp(x)) - 1 / x) / 2;\n}\n\nfunction tanh(x) {\n  return ((x = Math.exp(2 * x)) - 1) / (x + 1);\n}\n\n// p0 = [ux0, uy0, w0]\n// p1 = [ux1, uy1, w1]\nexport default function(p0, p1) {\n  var ux0 = p0[0], uy0 = p0[1], w0 = p0[2],\n      ux1 = p1[0], uy1 = p1[1], w1 = p1[2],\n      dx = ux1 - ux0,\n      dy = uy1 - uy0,\n      d2 = dx * dx + dy * dy,\n      i,\n      S;\n\n  // Special case for u0  u1.\n  if (d2 < epsilon2) {\n    S = Math.log(w1 / w0) / rho;\n    i = function(t) {\n      return [\n        ux0 + t * dx,\n        uy0 + t * dy,\n        w0 * Math.exp(rho * t * S)\n      ];\n    }\n  }\n\n  // General case.\n  else {\n    var d1 = Math.sqrt(d2),\n        b0 = (w1 * w1 - w0 * w0 + rho4 * d2) / (2 * w0 * rho2 * d1),\n        b1 = (w1 * w1 - w0 * w0 - rho4 * d2) / (2 * w1 * rho2 * d1),\n        r0 = Math.log(Math.sqrt(b0 * b0 + 1) - b0),\n        r1 = Math.log(Math.sqrt(b1 * b1 + 1) - b1);\n    S = (r1 - r0) / rho;\n    i = function(t) {\n      var s = t * S,\n          coshr0 = cosh(r0),\n          u = w0 / (rho2 * d1) * (coshr0 * tanh(rho * s + r0) - sinh(r0));\n      return [\n        ux0 + u * dx,\n        uy0 + u * dy,\n        w0 * coshr0 / cosh(rho * s + r0)\n      ];\n    }\n  }\n\n  i.duration = S * 1000;\n\n  return i;\n}\n","import {hsl as colorHsl} from \"d3-color\";\nimport color, {hue} from \"./color\";\n\nfunction hsl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHsl(start)).h, (end = colorHsl(end)).h),\n        s = color(start.s, end.s),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.s = s(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hsl(hue);\nexport var hslLong = hsl(color);\n","import {lab as colorLab} from \"d3-color\";\nimport color from \"./color\";\n\nexport default function lab(start, end) {\n  var l = color((start = colorLab(start)).l, (end = colorLab(end)).l),\n      a = color(start.a, end.a),\n      b = color(start.b, end.b),\n      opacity = color(start.opacity, end.opacity);\n  return function(t) {\n    start.l = l(t);\n    start.a = a(t);\n    start.b = b(t);\n    start.opacity = opacity(t);\n    return start + \"\";\n  };\n}\n","import {hcl as colorHcl} from \"d3-color\";\nimport color, {hue} from \"./color\";\n\nfunction hcl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHcl(start)).h, (end = colorHcl(end)).h),\n        c = color(start.c, end.c),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.c = c(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hcl(hue);\nexport var hclLong = hcl(color);\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","export default function piecewise(interpolate, values) {\n  var i = 0, n = values.length - 1, v = values[0], I = new Array(n < 0 ? 0 : n);\n  while (i < n) I[i] = interpolate(v, v = values[++i]);\n  return function(t) {\n    var i = Math.max(0, Math.min(n - 1, Math.floor(t *= n)));\n    return I[i](t - i);\n  };\n}\n","export default function(interpolator, n) {\n  var samples = new Array(n);\n  for (var i = 0; i < n; ++i) samples[i] = interpolator(i / (n - 1));\n  return samples;\n}\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n"],"sourceRoot":""}